{"version":3,"sources":["../../../public/fullcalendar/fullcalendar.js"],"names":["factory","define","amd","exports","module","require","jQuery","moment","$","FC","fullCalendar","version","internalApiVersion","fcViews","views","fn","options","args","Array","prototype","slice","call","arguments","res","each","i","_element","element","calendar","data","singleRes","destroy","removeData","warn","isFunction","apply","Calendar","render","complexOptions","mergeOptions","optionObjs","mergeProps","applyAll","debounce","isInt","htmlEscape","cssToStr","proxy","capitaliseFirstLetter","compensateScroll","rowEls","scrollbarWidths","left","css","right","uncompensateScroll","disableCursor","addClass","enableCursor","removeClass","distributeHeight","els","availableHeight","shouldRedistribute","minOffset1","Math","floor","length","minOffset2","flexEls","flexOffsets","flexHeights","usedHeight","undistributeHeight","el","minOffset","naturalOffset","outerHeight","push","height","naturalHeight","newHeight","matchCellWidths","maxInnerWidth","find","innerEl","innerWidth","outerWidth","width","subtractInnerElHeight","outerEl","both","add","diff","position","getOuterRect","getClientRect","getContentRect","getScrollbarWidths","getScrollParent","scrollParent","parents","filter","parent","test","eq","ownerDocument","document","origin","offset","top","bottom","getCssFloat","clientWidth","clientHeight","leftRightWidth","offsetWidth","bottomWidth","offsetHeight","widths","sanitizeScrollbarWidth","getIsLeftRtlScrollbars","max","round","_isLeftRtlScrollbars","computeIsLeftRtlScrollbars","border","padding","overflow","direction","appendTo","children","remove","prop","parseFloat","preventDefault","isPrimaryMouseButton","ev","which","ctrlKey","getEvX","touches","originalEvent","pageX","getEvY","pageY","getEvIsTouch","type","preventSelection","on","allowSelection","off","intersectRects","rect1","rect2","min","constrainPoint","point","rect","getRectCenter","diffPoints","point1","point2","parseFieldSpecs","compareByFieldSpecs","compareByFieldSpec","flexibleCompare","input","specs","tokens","token","split","isArray","charAt","field","substring","order","func","obj1","obj2","fieldSpecs","cmp","fieldSpec","a","b","String","localeCompare","computeGreatestUnit","divideRangeByDuration","divideDurationByDuration","multiplyDuration","durationHasTime","dayIDs","unitsDesc","diffDayTime","duration","days","clone","stripTime","ms","time","diffDay","diffByUnit","unit","start","end","val","computeRangeAs","computeDurationGreatestUnit","durationInput","isDuration","as","dur","months","asMonths","abs","asDays","dur1","dur2","months1","months2","n","Boolean","hours","minutes","seconds","milliseconds","isNativeDate","Object","toString","Date","isTimeString","str","log","console","window","hasOwnPropMethod","hasOwnProperty","propObjs","complexProps","dest","name","complexObjs","j","props","unshift","undefined","copyOwnProps","src","hasOwnProp","obj","functions","thisObj","ret","removeMatching","array","testFunc","removeCnt","splice","removeExact","exactVal","isArraysEqual","a0","a1","len","firstDefined","s","replace","stripHtmlEntities","text","cssProps","statements","join","attrsToStr","attrs","parts","toUpperCase","compareNumbers","methodName","method","wait","immediate","timeout","context","timestamp","result","later","last","setTimeout","callNow","ambigDateOfMonthRegex","ambigTimeOrZoneRegex","newMomentProto","oldMomentProto","extend","momentProperties","makeMoment","utc","mom","hasTime","parseZone","parseAsUTC","isSingleString","isAmbigTime","isAmbigZone","ambigMatch","isMoment","exec","_ambigTime","_ambigZone","utcOffset","_fullCalendar","week","weeks","weekCalc","_locale","_fullCalendar_weekCalc","isoWeek","dayHours","set","stripZone","wasAmbigTime","hasZone","local","keepLocalTime","tzo","format","formatDate","oldMomentFormat","englishMoment","toISOString","locale","formatRange","queryMostGranularFormatUnit","PART_SEPARATOR","SPECIAL_TOKEN_MARKER","MAYBE_MARKER","MAYBE_REGEXP","RegExp","specialTokens","t","date","T","largeTokenMap","Y","value","M","W","w","D","d","formatStr","renderFakeFormatString","getParsedFormatString","fakeFormatString","date1","date2","separator","isRTL","localeData","longDateFormat","renderParsedFormat","parsedFormat","sameUnits","unzonedDate1","unzonedDate2","renderedParts1","renderFakeFormatStringParts","renderedParts2","leftI","leftStr","rightI","rightStr","middleI","middleStr1","middleStr2","middleStr","isSame","processMaybeMarkers","parsedFormatStrCache","parseFormatString","chunks","chunkFormatString","buildFakeFormatString","buildSameUnits","match","chunker","splitStringLiteral","maybe","chunk","units","tokenInfo","fakeRender","fakeParts","fakePart","m0","m1","candidate","best","Class","members","extendClass","mixin","superClass","subClass","constructor","create","EmitterMixin","types","handler","_prepareIntercept","one","intercept","extra","guid","trigger","triggerHandler","triggerWith","hasHandlers","hash","_data","ListenerMixin","listenerId","listenTo","other","arg","callback","eventName","getListenerNamespace","stopListeningTo","ParsableModelMixin","standardPropMap","applyProps","rawProps","manualProps","miscProps","propName","applyMiscProps","applyManualStandardProps","isStandardProp","ParsableModelMixin_defineStandardProps","propDefs","proto","ParsableModelMixin_copyVerbatimStandardProps","map","Model","_props","_watchers","_globalWatchArgs","applyGlobalWatchers","constructed","watch","has","get","newProps","setProps","reset","oldProps","changeset","unset","names","changedProps","changedCnt","depList","startFunc","stopFunc","_this","unwatch","_watchDeps","deps","then","watcher","teardown","queuedChangeCnt","depCnt","satisfyCnt","values","bindTuples","isCallingStop","onBeforeDepChange","depName","isOptional","onDepChange","bind","forEach","flash","Promise","construct","executor","deferred","Deferred","promise","resolve","attachImmediatelyResolvingThen","reject","attachImmediatelyRejectingThen","onResolve","onReject","TaskQueue","q","isPaused","isRunning","queue","tryStart","pause","resume","getIsIdle","canRunNext","runRemaining","task","shift","runTask","RenderQueue","waitsByNamespace","waitNamespace","waitId","taskFunc","namespace","waitMs","delayWait","clearWait","compoundTask","startWait","spawnWait","clearTimeout","newTask","shouldAppend","Popover","isHidden","margin","show","hide","className","append","content","parentEl","autoHide","documentMousedown","target","closest","removeElement","offsetParent","windowEl","viewportEl","viewportTop","viewportLeft","viewportOffset","is","scrollTop","scrollLeft","viewportConstrain","CoordCache","forcedOffsetParentEl","boundingRect","isHorizontal","isVertical","lefts","rights","tops","bottoms","build","offsetParentEl","queryBoundingRect","buildElHorizontals","buildElVerticals","clear","ensureBuilt","node","getHorizontalIndex","leftOffset","getVerticalIndex","topOffset","getLeftOffset","leftIndex","getLeftPosition","getRightOffset","getRightPosition","getWidth","getTopOffset","topIndex","getTopPosition","getBottomOffset","getBottomPosition","getHeight","scrollParentEl","isPointInBounds","isLeftInBounds","isTopInBounds","DragListener","subjectEl","originX","originY","scrollEl","isInteracting","isDistanceSurpassed","isDelayEnded","isDragging","isTouch","isGeneric","delay","delayTimeoutId","minDistance","shouldCancelTouchScroll","scrollAlwaysKills","startInteraction","extraOptions","GlobalEmitter","shouldIgnoreMouse","distance","bindHandlers","initAutoScroll","handleInteractionStart","startDelay","handleDistanceSurpassed","endInteraction","isCancelled","endDrag","destroyAutoScroll","unbindHandlers","handleInteractionEnd","globalEmitter","drag","handleMove","dragstop","touchmove","handleTouchMove","touchend","scroll","handleTouchScroll","mousemove","handleMouseMove","mouseup","selectstart","contextmenu","startDrag","handleDragStart","dx","dy","distanceSq","handleDrag","updateAutoScroll","handleDragEnd","initialEv","handleDelayEnd","isAutoScroll","scrollBounds","scrollTopVel","scrollLeftVel","scrollIntervalId","scrollSensitivity","scrollSpeed","scrollIntervalMs","handleDebouncedScroll","endAutoScroll","computeScrollBounds","sensitivity","bounds","topCloseness","bottomCloseness","leftCloseness","rightCloseness","topVel","leftVel","setScrollVel","constrainScrollVel","setInterval","scrollHeight","scrollWidth","scrollIntervalFunc","frac","clearInterval","handleScrollEnd","HitDragListener","component","origHit","hit","coordAdjust","subjectRect","origPoint","hitsNeeded","queryHit","subjectCenter","handleHitOver","isHitsEqual","handleHitOut","handleHitDone","isOrig","hitsNotNeeded","releaseHits","prepareHits","hit0","hit1","isHitPropsWithin","subHit","superHit","touchMouseIgnoreWait","isTouching","mouseIgnoreDepth","handleScrollProxy","touchstart","handleTouchStart","touchcancel","handleTouchCancel","handleTouchEnd","mousedown","handleMouseDown","handleMouseUp","click","handleClick","handleSelectStart","handleContextMenu","addEventListener","handleTouchMoveProxy","Event","passive","handleScroll","unbind","removeEventListener","stopTouch","skipMouseIgnore","startTouchMouseIgnore","neededCount","needed","unneeded","MouseFollower","sourceEl","top0","left0","y0","x0","topDelta","leftDelta","isFollowing","isAnimating","updatePosition","stop","shouldRevert","revertDuration","complete","animate","getEl","additionalClass","visibility","display","opacity","zIndex","sourceOffset","Scroller","overflowX","overflowY","renderEl","applyOverflow","setHeight","lockOverflow","getScrollTop","setScrollTop","getClientWidth","getClientHeight","Iterator","items","proxyCall","results","item","Interaction","view","_getView","opt","DateClicking","dragListener","buildDragListener","bindToEl","bindDateHandlerToEl","shouldIgnoreTouch","dayClickHit","interactionStart","hitOver","hitOut","interactionEnd","componentFootprint","getSafeHitFootprint","triggerDayClick","getHitEl","DateSelecting","getDelay","selectionFootprint","dragStart","unselect","origHitFootprint","hitFootprint","computeSelection","renderSelectionFootprint","unrenderSelection","hitDone","reportSelection","footprint0","footprint1","wholeFootprint","computeSelectionFootprint","isSelectionFootprintAllowed","unzonedRange","startMs","endMs","sort","ComponentFootprint","UnzonedRange","isAllDay","dateProfile","validUnzonedRange","containsRange","EventDragging","eventPointing","getSelectionDelay","bindSegHandlerToEl","handleMousedown","seg","canStartDrag","settings","isEventDefSelected","footprint","eventDef","canStartSelection","buildSelectListener","eventInstance","selectEventInstance","eventManager","mouseFollower","eventDefMutation","handleMouseout","segDragStart","hideEventsWithId","id","isAllowed","origFootprint","mutatedEventInstanceGroup","computeEventDropMutation","buildMutatedEventInstanceGroup","isEventInstanceGroupAllowed","renderDrag","eventRangesToEventFootprints","sliceRenderRanges","renderUnzonedRange","unrenderDrag","segDragStop","showEventsWithId","reportEventDrop","publiclyTrigger","getEventLegacy","startFootprint","endFootprint","EventDefMutation","setDateMutation","computeEventDateMutation","date0","getStart","clearEnd","forceTimed","forceAllDay","dateDelta","dateMutation","diffDates","EventDefDateMutation","setDateDelta","EventResizing","isResizing","canStartResize","isStart","resizeMutation","segResizeStart","computeEventStartResizeMutation","computeEventEndResizeMutation","isEmpty","renderEventResize","unrenderEventResize","segResizeStop","reportEventResize","origEventFootprint","origRange","startDelta","getEnd","setStartDelta","endDelta","setEndDelta","ExternalDropping","bindToDocument","dragstart","sortstart","unbindFromDocument","ui","accept","listenToExternalDrag","meta","getDraggedElMeta","singleEventDef","computeExternalDrop","EventInstanceGroup","buildInstances","eventProps","isExternalInstanceGroupAllowed","reportExternalDrop","stick","startTime","applyTimezone","SingleEventDef","parse","EventSource","dataAttrPrefix","prefix","EventPointing","mousedOverSeg","handleMouseover","isEventDefResizable","StandardInteractionsMixin","dateClickingClass","dateSelectingClass","eventPointingClass","eventDraggingClass","eventResizingClass","externalDroppingClass","EventRenderer","fillRenderer","fgSegs","bgSegs","eventTimeFormat","displayEventTime","displayEventEnd","rangeUpdated","computeEventTimeFormat","computeDisplayEventTime","computeDisplayEventEnd","eventsPayload","_getDateProfile","eventDefId","instanceGroup","eventRanges","bgRanges","fgRanges","activeUnzonedRange","getEventDef","hasBgRendering","renderBgRanges","renderFgRanges","unrender","unrenderBgRanges","unrenderFgRanges","eventFootprints","segs","eventFootprintsToSegs","renderFgSegEls","renderFgSegs","unrenderFgSegs","renderBgSegs","unrenderBgSegs","getSegs","concat","renderSegs","getClasses","getBgClasses","getCss","getBgColor","filterEl","filterEventRenderEl","disableResizing","hasEventRenderHandlers","hasPublicHandlers","html","renderedSegs","beforeFgSegHtml","fgSegHtml","getSegClasses","isDraggable","isResizable","classes","isEnd","eventFootprint","legacy","custom","getTimeText","displayEnd","_getTimeText","classNames","objs","getStylingObjs","eventClassName","getSkinCss","getBorderColor","color","getTextColor","eventBackgroundColor","eventColor","backgroundColor","eventBorderColor","borderColor","eventTextColor","textColor","getFallbackStylingObjs","source","sortEventSegs","compareEventSegs","seg1","seg2","f1","r1","f2","r2","eventOrderSpecs","BusinessHourRenderer","businessHourGenerator","eventInstanceGroup","buildEventInstanceGroup","hasAllDayBusinessHours","renderEventFootprints","FillRenderer","fillSegTag","elsByFill","renderFootprint","componentFootprintToSegs","buildSegEls","attachSegEls","reportEls","buildSegHtml","nodes","HelperRenderer","eventRenderer","helperEls","renderComponentFootprint","fabricateEventFootprint","renderEventDraggingFootprints","sourceSeg","renderEventResizingFootprints","extraClassNames","eventDateProfile","footprintToDateProfile","dummyEvent","dummyInstance","buildInstance","EventFootprint","Component","setElement","bindGlobalHandlers","renderSkeleton","unrenderSkeleton","unbindGlobalHandlers","DateComponent","uid","childrenByUid","nextDayThreshold","eventRendererClass","helperRendererClass","businessHourRendererClass","fillRendererClass","helperRenderer","businessHourRenderer","hitsNeededDepth","isDatesRendered","addChild","child","removeChild","updateSize","totalHeight","isAuto","isResize","callChildren","_getCalendar","executeDateRender","renderDates","executeDateUnrender","unrenderDates","getNowIndicatorUnit","renderNowIndicator","unrenderNowIndicator","renderBusinessHours","unrenderBusinessHours","executeEventRender","renderEvents","convertEventsPayloadToLegacyArray","executeEventUnrender","destroyEvents","getBusinessHourSegs","getOwnBusinessHourSegs","iterChildren","getEventSegs","getOwnEventSegs","triggerAfterEventsRendered","triggerAfterEventSegsRendered","triggerBeforeEventsDestroyed","triggerBeforeEventSegsDestroyed","renderedHelper","renderHighlight","unrenderHighlight","getHitFootprint","eventRangeToEventFootprints","eventRange","eventRangeToEventFootprint","eventFootprintToSegs","eventInstances","legacyEvents","toLegacy","buildGotoAnchorHtml","gotoOptions","innerHtml","forceOff","finalOptions","isPlainObject","JSON","stringify","getAllDayHtml","getDayClasses","noThemeHighlight","today","containsDate","day","isDateInOtherMonth","getNow","theme","getClass","range","subtract","currentRangeAs","currentUnzonedRange","computeDayRange","startDay","msToUtcMoment","endTimeMS","endDay","isMultiDayRange","dayRange","InteractiveDateComponent","dateClicking","dateSelecting","eventDragging","eventResizing","externalDropping","segSelector","largeUnit","bindAllSegHandlersToEl","endInteractions","eventInteraction","shouldIgnoreEventPointing","isSelected","selectedEvent","isEventDefDraggable","interaction","isEventDefStartEditable","isEditable","isStartExplicitlyEditable","isEventDefGenerallyEditable","isExplicitlyEditable","isEventDefResizableFromStart","isEventDefResizableFromEnd","isDurationExplicitlyEditable","getAllEventRanges","DayTableMixin","breakOnWeeks","dayDates","dayIndices","daysPerRow","rowCnt","colCnt","colHeadFormat","updateDayTable","dayIndex","firstDay","isBefore","isHiddenDay","ceil","updateDayTableCols","computeColCnt","computeColHeadFormat","getCellDate","row","col","getCellDayIndex","getCellRange","getColDayIndex","getDateDayIndex","dayOffset","sliceRangeByRow","normalRange","rangeFirst","rangeLast","rowFirst","rowLast","segFirst","segLast","firstRowDayIndex","lastRowDayIndex","sliceRangeByDay","renderHeadHtml","renderHeadTrHtml","renderHeadIntroHtml","renderIntroHtml","renderHeadDateCellsHtml","htmls","renderHeadDateCellHtml","colspan","otherAttrs","isDateValid","renderBgTrHtml","renderBgIntroHtml","renderBgCellsHtml","renderBgCellHtml","bookendCells","trEl","introHtml","prepend","View","title","viewSpec","renderQueue","batchRenderDepth","queuedScroll","selectedEventInstance","isHiddenDayHash","isNowIndicatorRendered","initialNowDate","initialNowQueriedMs","nowIndicatorTimeoutID","nowIndicatorIntervalID","initRenderQueue","initHiddenDays","bindBaseRenderHandlers","initialize","event","onRenderQueueStart","onRenderQueueStop","startBatchRender","stopBatchRender","freezeContentHeight","addScroll","queryScroll","updateViewSize","popScroll","thawContentHeight","requestRender","actionType","whenSizeUpdated","computeTitle","currentRangeUnit","msToMoment","isRangeAllDay","computeTitleFormat","setDate","currentDateProfile","newDateProfile","buildDateProfile","equals","unsetDate","fetchInitialEvents","usesMinMaxTime","requestEvents","bindEventChanges","resetEvents","unbindEventChanges","setEvents","unsetEvents","requestDateRender","requestDateUnrender","isDateInit","startNowIndicator","stopNowIndicator","triggerViewRender","triggerViewDestroy","requestEventsRender","requestEventsUnrender","requestBusinessHoursRender","requestBusinessHoursUnrender","processUnselect","handleDocumentMousedown","update","startOf","updateNowIndicator","applyQueuedScroll","applyScroll","queryDateScroll","computeInitialDateScroll","applyDateScroll","eventMutation","undoFunc","mutateEventsWithId","def","buildNewDateProfile","triggerEventDrop","isEvent","isSticky","addEventDef","triggerExternalDrop","triggerEventResize","durationDelta","select","renderSelection","triggerSelect","destroySelection","unselectEventInstance","processRangeUnselect","processEventUnselect","ignore","triggerBaseRendered","triggerBaseUnrendered","dayEl","initialEvents","intervalStart","intervalEnd","buildPrevDateProfile","prevDate","dateIncrement","buildNextDateProfile","nextDate","forceToValid","isDateAllDay","minTime","maxTime","currentInfo","isValid","buildValidRange","trimHiddenDays","constrainDate","buildCurrentRangeInfo","buildRenderRange","intersect","adjustActiveRange","intersectsWith","buildDateIncrement","getUnzonedRangeOption","dayCount","durationUnit","buildRangeFromDuration","buildRangeFromDayCount","buildCustomVisibleRange","getFallbackDuration","alignment","dateIncrementInput","dateIncrementDuration","skipHiddenDays","customAlignment","runningCount","visibleUnzonedRange","fallback","inputUnzonedRange","parseUnzonedRange","hiddenDays","dayCnt","inArray","inc","isExclusive","out","Toolbar","toolbarOptions","setToolbarOptions","updateTitle","activateButton","deactivateButton","disableButton","enableButton","getViewsWithButtons","viewsWithButtons","newToolbarOptions","sections","layout","extraClasses","empty","renderSection","sectionEl","buttonStr","calendarCustomButtons","calendarButtonTextOverrides","overrides","buttonText","calendarButtonText","groupChildren","isOnlyButtons","groupEl","buttonName","customButtonProps","buttonClick","buttonIcon","buttonInnerHtml","buttonClasses","buttonEl","getCustomButtonIconClass","getIconClass","getViewSpec","changeView","buttonTextOverride","buttonTextDefault","hasClass","not","hover","first","viewsByType","currentDate","loadingLevel","viewSpecCache","initOptionsInternals","initMomentInternals","initCurrentDate","initEventManager","getView","triggerInfo","optHandler","instantiateView","viewType","spec","isValidViewType","viewName","dateOrRange","recordOptionOverrides","visibleRange","renderView","zoomTo","newDate","getUnitViewSpec","defaultDateInput","prev","prevInfo","next","nextInfo","prevYear","nextYear","gotoDate","zonedDateInput","incrementDate","delta","getDate","pushLoading","popLoading","zonedStartInput","zonedEndInput","buildSelectFootprint","defaultTimedEventDuration","defaultAllDayEventDuration","rangeInput","rerenderEvents","EventManager","rawSources","singleRawSource","freeze","rawSource","EventSourceParser","addSource","thaw","dirDefaults","localeDefaults","dynamicOverrides","optionsModel","populateOptionsHash","option","newOptionHash","setOptions","optionCnt","optionName","renderHeader","renderFooter","reinitView","rawOptions","localeOptionHash","defaults","rtlDefaults","populateInstanceComputableOptions","opts","weekNumberCalculation","_week","getMomentLocaleData","monthNames","_months","monthNamesShort","_monthsShort","dayNames","_weekdays","dayNamesShort","_weekdaysShort","dow","localizeMoment","getIsAmbigTimezone","zonedDate","toArray","timeAdjust","adjustedZonedDate","ignoreEnd","EventDateProfile","now","humanizeDuration","humanize","getEventEnd","getDefaultEventEnd","allDay","zonedStart","cache","buildViewSpec","viewTypes","header","singleUnit","requestedViewType","viewOverrides","specChain","defaultsChain","overridesChain","valueOf","buildViewSpecOptions","buildViewSpecButtonText","queryButtonText","buttonTextKey","contentEl","suggestedViewHeight","ignoreUpdateViewSize","freezeContentHeightDepth","windowResizeProxy","initialRender","elementVisible","calcSize","anchorEl","customAction","themeClass","ThemeRegistry","getThemeClass","themeSystem","widgetClass","BusinessHourGenerator","businessHours","toggleClass","prependTo","initToolbars","resize","windowResize","clearView","toolbarsManager","bindViewHandlers","setToolbarsTitle","updateToolbarButtons","unbindViewHandlers","oldView","newView","currentView","getSuggestedViewHeight","isHeightAuto","_calcSize","contentHeightInput","heightInput","queryToolbarsHeight","forceFreezeContentHeight","footer","computeHeaderOptions","computeFooterOptions","todayInfo","reduce","accumulator","toolbar","toolbarHeight","peerEventInstances","getPeerEventInstances","peerEventRanges","eventInstanceToEventRange","peerEventFootprints","constraintVal","getConstraint","overlapVal","getOverlap","eventAllowFunc","isFootprintAllowed","getEventInstancesWithoutId","getEventInstances","selectAllowFunc","subjectEventInstance","constraintFootprints","overlapEventFootprints","constraintValToFootprints","isFootprintWithinConstraints","collectOverlapEventFootprints","isOverlapsAllowedByFunc","isOverlapEventInstancesAllowed","footprintContainsFootprint","buildCurrentBusinessFootprints","parseEventDefToInstances","parseFootprints","eventInstancesToFootprints","getEventInstancesWithId","eventFootprintToComponentFootprint","targetFootprint","footprintsIntersect","overlapFunc","subjectLegacyInstance","overlapEventInstance","overlapEventDef","eventInput","EventDefParser","currentPeriod","rawInput","outerFootprint","innerFootprint","getEventSources","otherSources","getEventSourceById","getSourceById","normalizeId","addEventSource","sourceInput","removeEventSources","sourceMultiQuery","sources","removeAllSources","multiQuerySources","removeSource","removeEventSource","sourceQuery","querySources","refetchEventSources","refetchSource","refetchEvents","refetchAllSources","eventInputs","renderEvent","stickySource","removeEvents","legacyQuery","legacyInstances","idMap","removeAllEventDefs","filterLegacyEventInstances","getEventDefByUid","_id","removeEventDefsById","clientEvents","legacyEventInstances","updateEvents","eventPropsArray","updateEvent","createFromRawProps","legacyEventInstance","titleRangeSeparator","monthYearFormat","forceEventDuration","columnHeader","defaultView","aspectRatio","center","weekends","weekNumbers","weekNumberTitle","scrollTime","showNonCurrentDates","lazyFetching","startParam","endParam","timezoneParam","timezone","year","month","allDayText","agendaEventMinHeight","dragOpacity","dragRevertDuration","dragScroll","unselectAuto","dropAccept","eventOrder","eventLimit","eventLimitText","eventLimitClick","dayPopoverFormat","handleWindowResize","windowResizeDelay","longPressDelay","englishDefaults","buttonIcons","themeButtonIcons","locales","datepickerLocale","localeCode","dpLocaleCode","dpOptions","fcOptions","weekHeader","dpComputableOptions","datepicker","regional","en","setDefaults","newFcOptions","momOptions","momComputableOptions","prevText","nextText","currentText","showMonthAfterYear","yearSuffix","dayOfMonthFormat","mediumTimeFormat","smallTimeFormat","extraSmallTimeFormat","hourFormat","noMeridiemTimeFormat","instanceComputableOptions","smallDayDateFormat","weekFormat","smallWeekFormat","startInput","endInput","otherRange","newRange","innerRange","invertUnzonedRanges","ranges","constraintRange","invertedRanges","dateRange","compareUnzonedRanges","range1","range2","EventPeriod","requestsByUid","pendingCnt","freezeDepth","stuntedReleaseCnt","releaseCnt","eventDefsByUid","eventDefsById","eventInstanceGroupsById","isWithinRange","isAfter","requestSources","requestSource","request","status","fetch","eventDefs","addEventDefs","tryRelease","purgeSource","removeEventDef","purgeAllSources","completedCnt","eventDefUid","getEventDefsById","addEventInstance","isEmptyObject","removeEventInstancesForDef","matchingInstances","currentEventInstance","release","whenReleased","ArrayEventSource","force","setPeriod","eventSource","doomedSource","getSources","matchInputs","matchingSources","matchInput","grep","isSourcesEquivalent","eventPeriod","unbindPeriod","bindPeriod","eventId","undoFuncs","mutateSingle","defCopy","allInstances","source0","source1","getPrimitive","BUSINESS_HOUR_EVENT_DEFAULTS","rendering","rawComplexDef","buildEventDefs","eventDefsToEventInstances","explicitEventDef","rawDefs","requireDow","defs","buildEventDef","rawDef","fullRawDef","RecurringEventDef","EventDef","rawId","url","constraint","overlap","editable","startEditable","durationEditable","copy","copyVerbatimStandardProps","hasInverseRendering","getRendering","generateId","defineStandardProps","uuid","calendarTransform","sourceTransform","eventDataTransform","EventInstance","rezone","superSuccess","endTime","dowHash","unzonedDate","unzonedEnd","zonedDayStart","instanceStart","instanceEnd","instances","setDow","dowNumbers","sliceNormalRenderRanges","isInverse","sliceInverseRenderRanges","slicedRange","slicedEventRanges","EventRange","unzonedRanges","eventInstanceToUnzonedRange","ownerDef","buildUnzonedRange","forcedAllDay","allDayDefault","verbatimStandardProps","origDateProfile","dateProps","standardProps","defMutation","createFromDiff","shouldRezone","dateProfile0","dateProfile1","endDiff","mutation","subtractDates","otherSource","parseEventDefs","rawEventDefs","sourceClasses","registerClass","EventSourceClass","currentTimezone","setRawEventDefs","events","FuncEventSource","JsonFeedEventSource","ajaxSettings","onSuccess","success","onError","error","requestParams","buildRequestParams","ajax","AJAX_DEFAULTS","callbackRes","customRequestParams","params","dataType","themeClassHash","register","themeName","themeSetting","StandardTheme","JqueryUiTheme","Theme","iconClasses","baseIconClass","iconOverrideOption","iconOverrideCustomButtonOption","iconOverridePrefix","processIconOverride","setIconOverride","iconOverrideHash","iconClassesCopy","applyIconOverridePrefix","indexOf","key","widget","widgetHeader","widgetContent","buttonGroup","button","cornerLeft","cornerRight","stateDefault","stateActive","stateDisabled","stateHover","stateDown","popoverHeader","popoverContent","headerRow","dayRow","listView","close","BootstrapTheme","tableGrid","tableList","popover","DayGridFillRenderer","skeletonEl","renderFillRow","startCol","leftCol","endCol","rightCol","toLowerCase","attr","DayGridEventRenderer","dayGrid","rowStructs","renderSegRows","rowNode","tbodyEl","rowStruct","pop","segRows","groupSegRows","renderSegRow","rowSegs","segLevels","buildSegLevels","levelCnt","tbody","segMatrix","cellMatrix","loneCellMatrix","levelSegs","tr","td","emptyCellsUntil","parseInt","levels","isDaySegCollision","level","compareDaySegCols","isResizableFromStart","isResizableFromEnd","skinCss","timeHtml","timeText","titleHtml","otherSegs","otherSeg","DayGridHelperRenderer","helperNodes","rowEl","skeletonTopEl","skeletonTop","DayGrid","cellWeekNumbersVisible","bottomCoordPadding","headContainerEl","cellEls","rowCoordCache","colCoordCache","isRigid","renderGrid","removeSegPopover","renderDayRowHtml","getCellEl","getIsNumbersVisible","renderNumberTrHtml","getIsDayNumbersVisible","renderNumberIntroHtml","renderNumberCellsHtml","renderNumberCellHtml","isDayNumberVisible","weekCalcFirstDoW","firstDayOfWeek","getCellHit","unrenderEvents","popoverSegs","segPopover","limitRows","levelLimit","rowLevelLimit","unlimitRow","computeRowLevelLimit","limitRow","rowHeight","trEls","trHeight","iterInnerHeights","childNode","moreNodes","limitedNodes","segsBelow","totalSegsBelow","colSegsBelow","rowspan","segMoreNodes","moreTd","moreWrap","moreLink","getCellSegs","renderMoreLink","after","moreEls","limitedEls","hiddenSegs","getMoreLinkText","clickOption","moreEl","allSegs","reslicedAllSegs","resliceDaySegs","reslicedHiddenSegs","showSegPopover","topEl","renderSegPopoverContent","segContainer","dayDate","dayStart","dayEnd","newSegs","num","startLevel","BasicView","scroller","dayGridClass","weekNumberWidth","instantiateDayGrid","hasRigidRows","colWeekNumbersVisible","subclass","basicDayGridMethods","weekday","dayGridContainerEl","dayGridEl","renderSkeletonHtml","weekNumberStyleAttr","headRowEl","scrollerHeight","computeScrollerHeight","setGridHeight","weekStart","MonthView","isFixedWeeks","basic","basicDay","basicWeek","fixedWeekCount","TimeGridFillRenderer","timeGrid","containerEls","bgContainerEls","businessContainerEls","highlightContainerEls","updateSegVerticals","attachSegsByCol","groupSegsByCol","TimeGridEventRenderer","renderFgSegsIntoContainers","fgContainerEls","segsByCol","updateFgSegCoords","fullTimeText","startTimeText","zonedEnd","computeSegVerticals","computeFgSegHorizontals","assignSegVerticals","assignFgSegHorizontals","level0","buildSlotSegLevels","computeForwardSlotSegs","computeSlotSegPressures","computeFgSegForwardBack","seriesBackwardPressure","seriesBackwardCoord","forwardSegs","forwardCoord","sortForwardSegs","backwardCoord","compareForwardSegs","forwardPressure","generateFgSegHorizontalCss","shouldOverlap","generateSegVerticalCss","computeSlotSegCollisions","k","forwardSeg","isSlotSegCollision","TimeGridHelperRenderer","helperContainerEls","TimeGrid","dayRanges","slotDuration","snapDuration","snapsPerSlot","labelFormat","labelInterval","colEls","slatContainerEl","slatEls","nowIndicatorEls","slatCoordCache","bottomRuleEl","colContainerEls","helperSegs","highlightSegs","businessSegs","processOptions","sliceRangeByTimes","segRange","computeLabelInterval","slotsPerLabel","AGENDA_STOCK_SUB_DURATIONS","renderSlats","renderColumns","renderSlatRowHtml","slotTime","slotIterator","slotDate","isLabeled","axisHtml","axisStyleAttr","renderContentSkeleton","cellHtml","computeDateTop","getTotalSlatHeight","startOfDayDate","computeTimeTop","slatCoverage","slatIndex","slatRemainder","eventMinHeight","colIndex","slatTop","slatHeight","partial","localSnapIndex","snapIndex","snapTop","snapBottom","snap","computeSnapTime","AgendaView","timeGridClass","axisWidth","instantiateTimeGrid","agendaTimeGridMethods","agendaDayGridMethods","timeGridWrapEl","timeGridEl","noScrollRowEls","AGENDA_ALL_DAY_EVENT_LIMIT","dayEventsPayload","timedEventsPayload","groups","groupEventFootprintsByAllDay","timed","weekText","agenda","allDaySlot","slotEventOverlap","agendaDay","agendaWeek","ListView","viewEnd","renderEmptyMessage","renderSegList","bgColor","isDefaultPrevented","location","href","segsByDay","groupSegsByDay","daySegs","tableEl","dayHeaderHtml","mainFormat","altFormat","list","listDayFormat","noEventsMessage","listDay","listWeek","listDayAltFormat","listMonth","listYear"],"mappings":"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","file":"fullcalendar.js","sourcesContent":["/*!\n * FullCalendar v3.6.1\n * Docs & License: https://fullcalendar.io/\n * (c) 2017 Adam Shaw\n */\n\n(function(factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine([ 'jquery', 'moment' ], factory);\n\t}\n\telse if (typeof exports === 'object') { // Node/CommonJS\n\t\tmodule.exports = factory(require('jquery'), require('moment'));\n\t}\n\telse {\n\t\tfactory(jQuery, moment);\n\t}\n})(function($, moment) {\n\n;;\n\nvar FC = $.fullCalendar = {\n\tversion: \"3.6.1\",\n\t// When introducing internal API incompatibilities (where fullcalendar plugins would break),\n\t// the minor version of the calendar should be upped (ex: 2.7.2 -> 2.8.0)\n\t// and the below integer should be incremented.\n\tinternalApiVersion: 11\n};\nvar fcViews = FC.views = {};\n\n\n$.fn.fullCalendar = function(options) {\n\tvar args = Array.prototype.slice.call(arguments, 1); // for a possible method call\n\tvar res = this; // what this function will return (this jQuery object by default)\n\n\tthis.each(function(i, _element) { // loop each DOM element involved\n\t\tvar element = $(_element);\n\t\tvar calendar = element.data('fullCalendar'); // get the existing calendar object (if any)\n\t\tvar singleRes; // the returned value of this single method call\n\n\t\t// a method call\n\t\tif (typeof options === 'string') {\n\n\t\t\tif (options === 'getCalendar') {\n\t\t\t\tif (!i) { // first element only\n\t\t\t\t\tres = calendar;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (options === 'destroy') { // don't warn if no calendar object\n\t\t\t\tif (calendar) {\n\t\t\t\t\tcalendar.destroy();\n\t\t\t\t\telement.removeData('fullCalendar');\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (!calendar) {\n\t\t\t\tFC.warn(\"Attempting to call a FullCalendar method on an element with no calendar.\");\n\t\t\t}\n\t\t\telse if ($.isFunction(calendar[options])) {\n\t\t\t\tsingleRes = calendar[options].apply(calendar, args);\n\n\t\t\t\tif (!i) {\n\t\t\t\t\tres = singleRes; // record the first method call result\n\t\t\t\t}\n\t\t\t\tif (options === 'destroy') { // for the destroy method, must remove Calendar object data\n\t\t\t\t\telement.removeData('fullCalendar');\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tFC.warn(\"'\" + options + \"' is an unknown FullCalendar method.\");\n\t\t\t}\n\t\t}\n\t\t// a new calendar initialization\n\t\telse if (!calendar) { // don't initialize twice\n\t\t\tcalendar = new Calendar(element, options);\n\t\t\telement.data('fullCalendar', calendar);\n\t\t\tcalendar.render();\n\t\t}\n\t});\n\n\treturn res;\n};\n\n\nvar complexOptions = [ // names of options that are objects whose properties should be combined\n\t'header',\n\t'footer',\n\t'buttonText',\n\t'buttonIcons',\n\t'themeButtonIcons'\n];\n\n\n// Merges an array of option objects into a single object\nfunction mergeOptions(optionObjs) {\n\treturn mergeProps(optionObjs, complexOptions);\n}\n\n;;\n\n// exports\nFC.applyAll = applyAll;\nFC.debounce = debounce;\nFC.isInt = isInt;\nFC.htmlEscape = htmlEscape;\nFC.cssToStr = cssToStr;\nFC.proxy = proxy;\nFC.capitaliseFirstLetter = capitaliseFirstLetter;\n\n\n/* FullCalendar-specific DOM Utilities\n----------------------------------------------------------------------------------------------------------------------*/\n\n\n// Given the scrollbar widths of some other container, create borders/margins on rowEls in order to match the left\n// and right space that was offset by the scrollbars. A 1-pixel border first, then margin beyond that.\nfunction compensateScroll(rowEls, scrollbarWidths) {\n\tif (scrollbarWidths.left) {\n\t\trowEls.css({\n\t\t\t'border-left-width': 1,\n\t\t\t'margin-left': scrollbarWidths.left - 1\n\t\t});\n\t}\n\tif (scrollbarWidths.right) {\n\t\trowEls.css({\n\t\t\t'border-right-width': 1,\n\t\t\t'margin-right': scrollbarWidths.right - 1\n\t\t});\n\t}\n}\n\n\n// Undoes compensateScroll and restores all borders/margins\nfunction uncompensateScroll(rowEls) {\n\trowEls.css({\n\t\t'margin-left': '',\n\t\t'margin-right': '',\n\t\t'border-left-width': '',\n\t\t'border-right-width': ''\n\t});\n}\n\n\n// Make the mouse cursor express that an event is not allowed in the current area\nfunction disableCursor() {\n\t$('body').addClass('fc-not-allowed');\n}\n\n\n// Returns the mouse cursor to its original look\nfunction enableCursor() {\n\t$('body').removeClass('fc-not-allowed');\n}\n\n\n// Given a total available height to fill, have `els` (essentially child rows) expand to accomodate.\n// By default, all elements that are shorter than the recommended height are expanded uniformly, not considering\n// any other els that are already too tall. if `shouldRedistribute` is on, it considers these tall rows and \n// reduces the available height.\nfunction distributeHeight(els, availableHeight, shouldRedistribute) {\n\n\t// *FLOORING NOTE*: we floor in certain places because zoom can give inaccurate floating-point dimensions,\n\t// and it is better to be shorter than taller, to avoid creating unnecessary scrollbars.\n\n\tvar minOffset1 = Math.floor(availableHeight / els.length); // for non-last element\n\tvar minOffset2 = Math.floor(availableHeight - minOffset1 * (els.length - 1)); // for last element *FLOORING NOTE*\n\tvar flexEls = []; // elements that are allowed to expand. array of DOM nodes\n\tvar flexOffsets = []; // amount of vertical space it takes up\n\tvar flexHeights = []; // actual css height\n\tvar usedHeight = 0;\n\n\tundistributeHeight(els); // give all elements their natural height\n\n\t// find elements that are below the recommended height (expandable).\n\t// important to query for heights in a single first pass (to avoid reflow oscillation).\n\tels.each(function(i, el) {\n\t\tvar minOffset = i === els.length - 1 ? minOffset2 : minOffset1;\n\t\tvar naturalOffset = $(el).outerHeight(true);\n\n\t\tif (naturalOffset < minOffset) {\n\t\t\tflexEls.push(el);\n\t\t\tflexOffsets.push(naturalOffset);\n\t\t\tflexHeights.push($(el).height());\n\t\t}\n\t\telse {\n\t\t\t// this element stretches past recommended height (non-expandable). mark the space as occupied.\n\t\t\tusedHeight += naturalOffset;\n\t\t}\n\t});\n\n\t// readjust the recommended height to only consider the height available to non-maxed-out rows.\n\tif (shouldRedistribute) {\n\t\tavailableHeight -= usedHeight;\n\t\tminOffset1 = Math.floor(availableHeight / flexEls.length);\n\t\tminOffset2 = Math.floor(availableHeight - minOffset1 * (flexEls.length - 1)); // *FLOORING NOTE*\n\t}\n\n\t// assign heights to all expandable elements\n\t$(flexEls).each(function(i, el) {\n\t\tvar minOffset = i === flexEls.length - 1 ? minOffset2 : minOffset1;\n\t\tvar naturalOffset = flexOffsets[i];\n\t\tvar naturalHeight = flexHeights[i];\n\t\tvar newHeight = minOffset - (naturalOffset - naturalHeight); // subtract the margin/padding\n\n\t\tif (naturalOffset < minOffset) { // we check this again because redistribution might have changed things\n\t\t\t$(el).height(newHeight);\n\t\t}\n\t});\n}\n\n\n// Undoes distrubuteHeight, restoring all els to their natural height\nfunction undistributeHeight(els) {\n\tels.height('');\n}\n\n\n// Given `els`, a jQuery set of <td> cells, find the cell with the largest natural width and set the widths of all the\n// cells to be that width.\n// PREREQUISITE: if you want a cell to take up width, it needs to have a single inner element w/ display:inline\nfunction matchCellWidths(els) {\n\tvar maxInnerWidth = 0;\n\n\tels.find('> *').each(function(i, innerEl) {\n\t\tvar innerWidth = $(innerEl).outerWidth();\n\t\tif (innerWidth > maxInnerWidth) {\n\t\t\tmaxInnerWidth = innerWidth;\n\t\t}\n\t});\n\n\tmaxInnerWidth++; // sometimes not accurate of width the text needs to stay on one line. insurance\n\n\tels.width(maxInnerWidth);\n\n\treturn maxInnerWidth;\n}\n\n\n// Given one element that resides inside another,\n// Subtracts the height of the inner element from the outer element.\nfunction subtractInnerElHeight(outerEl, innerEl) {\n\tvar both = outerEl.add(innerEl);\n\tvar diff;\n\n\t// effin' IE8/9/10/11 sometimes returns 0 for dimensions. this weird hack was the only thing that worked\n\tboth.css({\n\t\tposition: 'relative', // cause a reflow, which will force fresh dimension recalculation\n\t\tleft: -1 // ensure reflow in case the el was already relative. negative is less likely to cause new scroll\n\t});\n\tdiff = outerEl.outerHeight() - innerEl.outerHeight(); // grab the dimensions\n\tboth.css({ position: '', left: '' }); // undo hack\n\n\treturn diff;\n}\n\n\n/* Element Geom Utilities\n----------------------------------------------------------------------------------------------------------------------*/\n\nFC.getOuterRect = getOuterRect;\nFC.getClientRect = getClientRect;\nFC.getContentRect = getContentRect;\nFC.getScrollbarWidths = getScrollbarWidths;\n\n\n// borrowed from https://github.com/jquery/jquery-ui/blob/1.11.0/ui/core.js#L51\nfunction getScrollParent(el) {\n\tvar position = el.css('position'),\n\t\tscrollParent = el.parents().filter(function() {\n\t\t\tvar parent = $(this);\n\t\t\treturn (/(auto|scroll)/).test(\n\t\t\t\tparent.css('overflow') + parent.css('overflow-y') + parent.css('overflow-x')\n\t\t\t);\n\t\t}).eq(0);\n\n\treturn position === 'fixed' || !scrollParent.length ? $(el[0].ownerDocument || document) : scrollParent;\n}\n\n\n// Queries the outer bounding area of a jQuery element.\n// Returns a rectangle with absolute coordinates: left, right (exclusive), top, bottom (exclusive).\n// Origin is optional.\nfunction getOuterRect(el, origin) {\n\tvar offset = el.offset();\n\tvar left = offset.left - (origin ? origin.left : 0);\n\tvar top = offset.top - (origin ? origin.top : 0);\n\n\treturn {\n\t\tleft: left,\n\t\tright: left + el.outerWidth(),\n\t\ttop: top,\n\t\tbottom: top + el.outerHeight()\n\t};\n}\n\n\n// Queries the area within the margin/border/scrollbars of a jQuery element. Does not go within the padding.\n// Returns a rectangle with absolute coordinates: left, right (exclusive), top, bottom (exclusive).\n// Origin is optional.\n// WARNING: given element can't have borders\n// NOTE: should use clientLeft/clientTop, but very unreliable cross-browser.\nfunction getClientRect(el, origin) {\n\tvar offset = el.offset();\n\tvar scrollbarWidths = getScrollbarWidths(el);\n\tvar left = offset.left + getCssFloat(el, 'border-left-width') + scrollbarWidths.left - (origin ? origin.left : 0);\n\tvar top = offset.top + getCssFloat(el, 'border-top-width') + scrollbarWidths.top - (origin ? origin.top : 0);\n\n\treturn {\n\t\tleft: left,\n\t\tright: left + el[0].clientWidth, // clientWidth includes padding but NOT scrollbars\n\t\ttop: top,\n\t\tbottom: top + el[0].clientHeight // clientHeight includes padding but NOT scrollbars\n\t};\n}\n\n\n// Queries the area within the margin/border/padding of a jQuery element. Assumed not to have scrollbars.\n// Returns a rectangle with absolute coordinates: left, right (exclusive), top, bottom (exclusive).\n// Origin is optional.\nfunction getContentRect(el, origin) {\n\tvar offset = el.offset(); // just outside of border, margin not included\n\tvar left = offset.left + getCssFloat(el, 'border-left-width') + getCssFloat(el, 'padding-left') -\n\t\t(origin ? origin.left : 0);\n\tvar top = offset.top + getCssFloat(el, 'border-top-width') + getCssFloat(el, 'padding-top') -\n\t\t(origin ? origin.top : 0);\n\n\treturn {\n\t\tleft: left,\n\t\tright: left + el.width(),\n\t\ttop: top,\n\t\tbottom: top + el.height()\n\t};\n}\n\n\n// Returns the computed left/right/top/bottom scrollbar widths for the given jQuery element.\n// WARNING: given element can't have borders (which will cause offsetWidth/offsetHeight to be larger).\n// NOTE: should use clientLeft/clientTop, but very unreliable cross-browser.\nfunction getScrollbarWidths(el) {\n\tvar leftRightWidth = el[0].offsetWidth - el[0].clientWidth;\n\tvar bottomWidth = el[0].offsetHeight - el[0].clientHeight;\n\tvar widths;\n\n\tleftRightWidth = sanitizeScrollbarWidth(leftRightWidth);\n\tbottomWidth = sanitizeScrollbarWidth(bottomWidth);\n\n\twidths = { left: 0, right: 0, top: 0, bottom: bottomWidth };\n\n\tif (getIsLeftRtlScrollbars() && el.css('direction') == 'rtl') { // is the scrollbar on the left side?\n\t\twidths.left = leftRightWidth;\n\t}\n\telse {\n\t\twidths.right = leftRightWidth;\n\t}\n\n\treturn widths;\n}\n\n\n// The scrollbar width computations in getScrollbarWidths are sometimes flawed when it comes to\n// retina displays, rounding, and IE11. Massage them into a usable value.\nfunction sanitizeScrollbarWidth(width) {\n\twidth = Math.max(0, width); // no negatives\n\twidth = Math.round(width);\n\treturn width;\n}\n\n\n// Logic for determining if, when the element is right-to-left, the scrollbar appears on the left side\n\nvar _isLeftRtlScrollbars = null;\n\nfunction getIsLeftRtlScrollbars() { // responsible for caching the computation\n\tif (_isLeftRtlScrollbars === null) {\n\t\t_isLeftRtlScrollbars = computeIsLeftRtlScrollbars();\n\t}\n\treturn _isLeftRtlScrollbars;\n}\n\nfunction computeIsLeftRtlScrollbars() { // creates an offscreen test element, then removes it\n\tvar el = $('<div><div/></div>')\n\t\t.css({\n\t\t\tposition: 'absolute',\n\t\t\ttop: -1000,\n\t\t\tleft: 0,\n\t\t\tborder: 0,\n\t\t\tpadding: 0,\n\t\t\toverflow: 'scroll',\n\t\t\tdirection: 'rtl'\n\t\t})\n\t\t.appendTo('body');\n\tvar innerEl = el.children();\n\tvar res = innerEl.offset().left > el.offset().left; // is the inner div shifted to accommodate a left scrollbar?\n\tel.remove();\n\treturn res;\n}\n\n\n// Retrieves a jQuery element's computed CSS value as a floating-point number.\n// If the queried value is non-numeric (ex: IE can return \"medium\" for border width), will just return zero.\nfunction getCssFloat(el, prop) {\n\treturn parseFloat(el.css(prop)) || 0;\n}\n\n\n/* Mouse / Touch Utilities\n----------------------------------------------------------------------------------------------------------------------*/\n\nFC.preventDefault = preventDefault;\n\n\n// Returns a boolean whether this was a left mouse click and no ctrl key (which means right click on Mac)\nfunction isPrimaryMouseButton(ev) {\n\treturn ev.which == 1 && !ev.ctrlKey;\n}\n\n\nfunction getEvX(ev) {\n\tvar touches = ev.originalEvent.touches;\n\n\t// on mobile FF, pageX for touch events is present, but incorrect,\n\t// so, look at touch coordinates first.\n\tif (touches && touches.length) {\n\t\treturn touches[0].pageX;\n\t}\n\n\treturn ev.pageX;\n}\n\n\nfunction getEvY(ev) {\n\tvar touches = ev.originalEvent.touches;\n\n\t// on mobile FF, pageX for touch events is present, but incorrect,\n\t// so, look at touch coordinates first.\n\tif (touches && touches.length) {\n\t\treturn touches[0].pageY;\n\t}\n\n\treturn ev.pageY;\n}\n\n\nfunction getEvIsTouch(ev) {\n\treturn /^touch/.test(ev.type);\n}\n\n\nfunction preventSelection(el) {\n\tel.addClass('fc-unselectable')\n\t\t.on('selectstart', preventDefault);\n}\n\n\nfunction allowSelection(el) {\n\tel.removeClass('fc-unselectable')\n\t\t.off('selectstart', preventDefault);\n}\n\n\n// Stops a mouse/touch event from doing it's native browser action\nfunction preventDefault(ev) {\n\tev.preventDefault();\n}\n\n\n/* General Geometry Utils\n----------------------------------------------------------------------------------------------------------------------*/\n\nFC.intersectRects = intersectRects;\n\n// Returns a new rectangle that is the intersection of the two rectangles. If they don't intersect, returns false\nfunction intersectRects(rect1, rect2) {\n\tvar res = {\n\t\tleft: Math.max(rect1.left, rect2.left),\n\t\tright: Math.min(rect1.right, rect2.right),\n\t\ttop: Math.max(rect1.top, rect2.top),\n\t\tbottom: Math.min(rect1.bottom, rect2.bottom)\n\t};\n\n\tif (res.left < res.right && res.top < res.bottom) {\n\t\treturn res;\n\t}\n\treturn false;\n}\n\n\n// Returns a new point that will have been moved to reside within the given rectangle\nfunction constrainPoint(point, rect) {\n\treturn {\n\t\tleft: Math.min(Math.max(point.left, rect.left), rect.right),\n\t\ttop: Math.min(Math.max(point.top, rect.top), rect.bottom)\n\t};\n}\n\n\n// Returns a point that is the center of the given rectangle\nfunction getRectCenter(rect) {\n\treturn {\n\t\tleft: (rect.left + rect.right) / 2,\n\t\ttop: (rect.top + rect.bottom) / 2\n\t};\n}\n\n\n// Subtracts point2's coordinates from point1's coordinates, returning a delta\nfunction diffPoints(point1, point2) {\n\treturn {\n\t\tleft: point1.left - point2.left,\n\t\ttop: point1.top - point2.top\n\t};\n}\n\n\n/* Object Ordering by Field\n----------------------------------------------------------------------------------------------------------------------*/\n\nFC.parseFieldSpecs = parseFieldSpecs;\nFC.compareByFieldSpecs = compareByFieldSpecs;\nFC.compareByFieldSpec = compareByFieldSpec;\nFC.flexibleCompare = flexibleCompare;\n\n\nfunction parseFieldSpecs(input) {\n\tvar specs = [];\n\tvar tokens = [];\n\tvar i, token;\n\n\tif (typeof input === 'string') {\n\t\ttokens = input.split(/\\s*,\\s*/);\n\t}\n\telse if (typeof input === 'function') {\n\t\ttokens = [ input ];\n\t}\n\telse if ($.isArray(input)) {\n\t\ttokens = input;\n\t}\n\n\tfor (i = 0; i < tokens.length; i++) {\n\t\ttoken = tokens[i];\n\n\t\tif (typeof token === 'string') {\n\t\t\tspecs.push(\n\t\t\t\ttoken.charAt(0) == '-' ?\n\t\t\t\t\t{ field: token.substring(1), order: -1 } :\n\t\t\t\t\t{ field: token, order: 1 }\n\t\t\t);\n\t\t}\n\t\telse if (typeof token === 'function') {\n\t\t\tspecs.push({ func: token });\n\t\t}\n\t}\n\n\treturn specs;\n}\n\n\nfunction compareByFieldSpecs(obj1, obj2, fieldSpecs) {\n\tvar i;\n\tvar cmp;\n\n\tfor (i = 0; i < fieldSpecs.length; i++) {\n\t\tcmp = compareByFieldSpec(obj1, obj2, fieldSpecs[i]);\n\t\tif (cmp) {\n\t\t\treturn cmp;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\n\nfunction compareByFieldSpec(obj1, obj2, fieldSpec) {\n\tif (fieldSpec.func) {\n\t\treturn fieldSpec.func(obj1, obj2);\n\t}\n\treturn flexibleCompare(obj1[fieldSpec.field], obj2[fieldSpec.field]) *\n\t\t(fieldSpec.order || 1);\n}\n\n\nfunction flexibleCompare(a, b) {\n\tif (!a && !b) {\n\t\treturn 0;\n\t}\n\tif (b == null) {\n\t\treturn -1;\n\t}\n\tif (a == null) {\n\t\treturn 1;\n\t}\n\tif ($.type(a) === 'string' || $.type(b) === 'string') {\n\t\treturn String(a).localeCompare(String(b));\n\t}\n\treturn a - b;\n}\n\n\n/* Date Utilities\n----------------------------------------------------------------------------------------------------------------------*/\n\nFC.computeGreatestUnit = computeGreatestUnit;\nFC.divideRangeByDuration = divideRangeByDuration;\nFC.divideDurationByDuration = divideDurationByDuration;\nFC.multiplyDuration = multiplyDuration;\nFC.durationHasTime = durationHasTime;\n\nvar dayIDs = [ 'sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat' ];\nvar unitsDesc = [ 'year', 'month', 'week', 'day', 'hour', 'minute', 'second', 'millisecond' ]; // descending\n\n\n// Diffs the two moments into a Duration where full-days are recorded first, then the remaining time.\n// Moments will have their timezones normalized.\nfunction diffDayTime(a, b) {\n\treturn moment.duration({\n\t\tdays: a.clone().stripTime().diff(b.clone().stripTime(), 'days'),\n\t\tms: a.time() - b.time() // time-of-day from day start. disregards timezone\n\t});\n}\n\n\n// Diffs the two moments via their start-of-day (regardless of timezone). Produces whole-day durations.\nfunction diffDay(a, b) {\n\treturn moment.duration({\n\t\tdays: a.clone().stripTime().diff(b.clone().stripTime(), 'days')\n\t});\n}\n\n\n// Diffs two moments, producing a duration, made of a whole-unit-increment of the given unit. Uses rounding.\nfunction diffByUnit(a, b, unit) {\n\treturn moment.duration(\n\t\tMath.round(a.diff(b, unit, true)), // returnFloat=true\n\t\tunit\n\t);\n}\n\n\n// Computes the unit name of the largest whole-unit period of time.\n// For example, 48 hours will be \"days\" whereas 49 hours will be \"hours\".\n// Accepts start/end, a range object, or an original duration object.\nfunction computeGreatestUnit(start, end) {\n\tvar i, unit;\n\tvar val;\n\n\tfor (i = 0; i < unitsDesc.length; i++) {\n\t\tunit = unitsDesc[i];\n\t\tval = computeRangeAs(unit, start, end);\n\n\t\tif (val >= 1 && isInt(val)) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn unit; // will be \"milliseconds\" if nothing else matches\n}\n\n\n// like computeGreatestUnit, but has special abilities to interpret the source input for clues\nfunction computeDurationGreatestUnit(duration, durationInput) {\n\tvar unit = computeGreatestUnit(duration);\n\n\t// prevent days:7 from being interpreted as a week\n\tif (unit === 'week' && typeof durationInput === 'object' && durationInput.days) {\n\t\tunit = 'day';\n\t}\n\n\treturn unit;\n}\n\n\n// Computes the number of units (like \"hours\") in the given range.\n// Range can be a {start,end} object, separate start/end args, or a Duration.\n// Results are based on Moment's .as() and .diff() methods, so results can depend on internal handling\n// of month-diffing logic (which tends to vary from version to version).\nfunction computeRangeAs(unit, start, end) {\n\n\tif (end != null) { // given start, end\n\t\treturn end.diff(start, unit, true);\n\t}\n\telse if (moment.isDuration(start)) { // given duration\n\t\treturn start.as(unit);\n\t}\n\telse { // given { start, end } range object\n\t\treturn start.end.diff(start.start, unit, true);\n\t}\n}\n\n\n// Intelligently divides a range (specified by a start/end params) by a duration\nfunction divideRangeByDuration(start, end, dur) {\n\tvar months;\n\n\tif (durationHasTime(dur)) {\n\t\treturn (end - start) / dur;\n\t}\n\tmonths = dur.asMonths();\n\tif (Math.abs(months) >= 1 && isInt(months)) {\n\t\treturn end.diff(start, 'months', true) / months;\n\t}\n\treturn end.diff(start, 'days', true) / dur.asDays();\n}\n\n\n// Intelligently divides one duration by another\nfunction divideDurationByDuration(dur1, dur2) {\n\tvar months1, months2;\n\n\tif (durationHasTime(dur1) || durationHasTime(dur2)) {\n\t\treturn dur1 / dur2;\n\t}\n\tmonths1 = dur1.asMonths();\n\tmonths2 = dur2.asMonths();\n\tif (\n\t\tMath.abs(months1) >= 1 && isInt(months1) &&\n\t\tMath.abs(months2) >= 1 && isInt(months2)\n\t) {\n\t\treturn months1 / months2;\n\t}\n\treturn dur1.asDays() / dur2.asDays();\n}\n\n\n// Intelligently multiplies a duration by a number\nfunction multiplyDuration(dur, n) {\n\tvar months;\n\n\tif (durationHasTime(dur)) {\n\t\treturn moment.duration(dur * n);\n\t}\n\tmonths = dur.asMonths();\n\tif (Math.abs(months) >= 1 && isInt(months)) {\n\t\treturn moment.duration({ months: months * n });\n\t}\n\treturn moment.duration({ days: dur.asDays() * n });\n}\n\n\n// Returns a boolean about whether the given duration has any time parts (hours/minutes/seconds/ms)\nfunction durationHasTime(dur) {\n\treturn Boolean(dur.hours() || dur.minutes() || dur.seconds() || dur.milliseconds());\n}\n\n\nfunction isNativeDate(input) {\n\treturn  Object.prototype.toString.call(input) === '[object Date]' || input instanceof Date;\n}\n\n\n// Returns a boolean about whether the given input is a time string, like \"06:40:00\" or \"06:00\"\nfunction isTimeString(str) {\n\treturn typeof str === 'string' &&\n\t\t/^\\d+\\:\\d+(?:\\:\\d+\\.?(?:\\d{3})?)?$/.test(str);\n}\n\n\n/* Logging and Debug\n----------------------------------------------------------------------------------------------------------------------*/\n\nFC.log = function() {\n\tvar console = window.console;\n\n\tif (console && console.log) {\n\t\treturn console.log.apply(console, arguments);\n\t}\n};\n\nFC.warn = function() {\n\tvar console = window.console;\n\n\tif (console && console.warn) {\n\t\treturn console.warn.apply(console, arguments);\n\t}\n\telse {\n\t\treturn FC.log.apply(FC, arguments);\n\t}\n};\n\n\n/* General Utilities\n----------------------------------------------------------------------------------------------------------------------*/\n\nvar hasOwnPropMethod = {}.hasOwnProperty;\n\n\n// Merges an array of objects into a single object.\n// The second argument allows for an array of property names who's object values will be merged together.\nfunction mergeProps(propObjs, complexProps) {\n\tvar dest = {};\n\tvar i, name;\n\tvar complexObjs;\n\tvar j, val;\n\tvar props;\n\n\tif (complexProps) {\n\t\tfor (i = 0; i < complexProps.length; i++) {\n\t\t\tname = complexProps[i];\n\t\t\tcomplexObjs = [];\n\n\t\t\t// collect the trailing object values, stopping when a non-object is discovered\n\t\t\tfor (j = propObjs.length - 1; j >= 0; j--) {\n\t\t\t\tval = propObjs[j][name];\n\n\t\t\t\tif (typeof val === 'object') {\n\t\t\t\t\tcomplexObjs.unshift(val);\n\t\t\t\t}\n\t\t\t\telse if (val !== undefined) {\n\t\t\t\t\tdest[name] = val; // if there were no objects, this value will be used\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if the trailing values were objects, use the merged value\n\t\t\tif (complexObjs.length) {\n\t\t\t\tdest[name] = mergeProps(complexObjs);\n\t\t\t}\n\t\t}\n\t}\n\n\t// copy values into the destination, going from last to first\n\tfor (i = propObjs.length - 1; i >= 0; i--) {\n\t\tprops = propObjs[i];\n\n\t\tfor (name in props) {\n\t\t\tif (!(name in dest)) { // if already assigned by previous props or complex props, don't reassign\n\t\t\t\tdest[name] = props[name];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn dest;\n}\n\n\nfunction copyOwnProps(src, dest) {\n\tfor (var name in src) {\n\t\tif (hasOwnProp(src, name)) {\n\t\t\tdest[name] = src[name];\n\t\t}\n\t}\n}\n\n\nfunction hasOwnProp(obj, name) {\n\treturn hasOwnPropMethod.call(obj, name);\n}\n\n\nfunction applyAll(functions, thisObj, args) {\n\tif ($.isFunction(functions)) {\n\t\tfunctions = [ functions ];\n\t}\n\tif (functions) {\n\t\tvar i;\n\t\tvar ret;\n\t\tfor (i=0; i<functions.length; i++) {\n\t\t\tret = functions[i].apply(thisObj, args) || ret;\n\t\t}\n\t\treturn ret;\n\t}\n}\n\n\nfunction removeMatching(array, testFunc) {\n\tvar removeCnt = 0;\n\tvar i = 0;\n\n\twhile (i < array.length) {\n\t\tif (testFunc(array[i])) { // truthy value means *remove*\n\t\t\tarray.splice(i, 1);\n\t\t\tremoveCnt++;\n\t\t}\n\t\telse {\n\t\t\ti++;\n\t\t}\n\t}\n\n\treturn removeCnt;\n}\n\n\nfunction removeExact(array, exactVal) {\n\tvar removeCnt = 0;\n\tvar i = 0;\n\n\twhile (i < array.length) {\n\t\tif (array[i] === exactVal) {\n\t\t\tarray.splice(i, 1);\n\t\t\tremoveCnt++;\n\t\t}\n\t\telse {\n\t\t\ti++;\n\t\t}\n\t}\n\n\treturn removeCnt;\n}\nFC.removeExact = removeExact;\n\n\nfunction isArraysEqual(a0, a1) {\n\tvar len = a0.length;\n\tvar i;\n\n\tif (len == null || len !== a1.length) { // not array? or not same length?\n\t\treturn false;\n\t}\n\n\tfor (i = 0; i < len; i++) {\n\t\tif (a0[i] !== a1[i]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n\n\nfunction firstDefined() {\n\tfor (var i=0; i<arguments.length; i++) {\n\t\tif (arguments[i] !== undefined) {\n\t\t\treturn arguments[i];\n\t\t}\n\t}\n}\n\n\nfunction htmlEscape(s) {\n\treturn (s + '').replace(/&/g, '&amp;')\n\t\t.replace(/</g, '&lt;')\n\t\t.replace(/>/g, '&gt;')\n\t\t.replace(/'/g, '&#039;')\n\t\t.replace(/\"/g, '&quot;')\n\t\t.replace(/\\n/g, '<br />');\n}\n\n\nfunction stripHtmlEntities(text) {\n\treturn text.replace(/&.*?;/g, '');\n}\n\n\n// Given a hash of CSS properties, returns a string of CSS.\n// Uses property names as-is (no camel-case conversion). Will not make statements for null/undefined values.\nfunction cssToStr(cssProps) {\n\tvar statements = [];\n\n\t$.each(cssProps, function(name, val) {\n\t\tif (val != null) {\n\t\t\tstatements.push(name + ':' + val);\n\t\t}\n\t});\n\n\treturn statements.join(';');\n}\n\n\n// Given an object hash of HTML attribute names to values,\n// generates a string that can be injected between < > in HTML\nfunction attrsToStr(attrs) {\n\tvar parts = [];\n\n\t$.each(attrs, function(name, val) {\n\t\tif (val != null) {\n\t\t\tparts.push(name + '=\"' + htmlEscape(val) + '\"');\n\t\t}\n\t});\n\n\treturn parts.join(' ');\n}\n\n\nfunction capitaliseFirstLetter(str) {\n\treturn str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n\nfunction compareNumbers(a, b) { // for .sort()\n\treturn a - b;\n}\n\n\nfunction isInt(n) {\n\treturn n % 1 === 0;\n}\n\n\n// Returns a method bound to the given object context.\n// Just like one of the jQuery.proxy signatures, but without the undesired behavior of treating the same method with\n// different contexts as identical when binding/unbinding events.\nfunction proxy(obj, methodName) {\n\tvar method = obj[methodName];\n\n\treturn function() {\n\t\treturn method.apply(obj, arguments);\n\t};\n}\n\n\n// Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The function will be called after it stops being called for\n// N milliseconds. If `immediate` is passed, trigger the function on the\n// leading edge, instead of the trailing.\n// https://github.com/jashkenas/underscore/blob/1.6.0/underscore.js#L714\nfunction debounce(func, wait, immediate) {\n\tvar timeout, args, context, timestamp, result;\n\n\tvar later = function() {\n\t\tvar last = +new Date() - timestamp;\n\t\tif (last < wait) {\n\t\t\ttimeout = setTimeout(later, wait - last);\n\t\t}\n\t\telse {\n\t\t\ttimeout = null;\n\t\t\tif (!immediate) {\n\t\t\t\tresult = func.apply(context, args);\n\t\t\t\tcontext = args = null;\n\t\t\t}\n\t\t}\n\t};\n\n\treturn function() {\n\t\tcontext = this;\n\t\targs = arguments;\n\t\ttimestamp = +new Date();\n\t\tvar callNow = immediate && !timeout;\n\t\tif (!timeout) {\n\t\t\ttimeout = setTimeout(later, wait);\n\t\t}\n\t\tif (callNow) {\n\t\t\tresult = func.apply(context, args);\n\t\t\tcontext = args = null;\n\t\t}\n\t\treturn result;\n\t};\n}\n\n;;\n\n/*\nGENERAL NOTE on moments throughout the *entire rest* of the codebase:\nAll moments are assumed to be ambiguously-zoned unless otherwise noted,\nwith the NOTABLE EXCEOPTION of start/end dates that live on *Event Objects*.\nAmbiguously-TIMED moments are assumed to be ambiguously-zoned by nature.\n*/\n\nvar ambigDateOfMonthRegex = /^\\s*\\d{4}-\\d\\d$/;\nvar ambigTimeOrZoneRegex =\n\t/^\\s*\\d{4}-(?:(\\d\\d-\\d\\d)|(W\\d\\d$)|(W\\d\\d-\\d)|(\\d\\d\\d))((T| )(\\d\\d(:\\d\\d(:\\d\\d(\\.\\d+)?)?)?)?)?$/;\nvar newMomentProto = moment.fn; // where we will attach our new methods\nvar oldMomentProto = $.extend({}, newMomentProto); // copy of original moment methods\n\n// tell momentjs to transfer these properties upon clone\nvar momentProperties = moment.momentProperties;\nmomentProperties.push('_fullCalendar');\nmomentProperties.push('_ambigTime');\nmomentProperties.push('_ambigZone');\n\n\n// Creating\n// -------------------------------------------------------------------------------------------------\n\n// Creates a new moment, similar to the vanilla moment(...) constructor, but with\n// extra features (ambiguous time, enhanced formatting). When given an existing moment,\n// it will function as a clone (and retain the zone of the moment). Anything else will\n// result in a moment in the local zone.\nFC.moment = function() {\n\treturn makeMoment(arguments);\n};\n\n// Sames as FC.moment, but forces the resulting moment to be in the UTC timezone.\nFC.moment.utc = function() {\n\tvar mom = makeMoment(arguments, true);\n\n\t// Force it into UTC because makeMoment doesn't guarantee it\n\t// (if given a pre-existing moment for example)\n\tif (mom.hasTime()) { // don't give ambiguously-timed moments a UTC zone\n\t\tmom.utc();\n\t}\n\n\treturn mom;\n};\n\n// Same as FC.moment, but when given an ISO8601 string, the timezone offset is preserved.\n// ISO8601 strings with no timezone offset will become ambiguously zoned.\nFC.moment.parseZone = function() {\n\treturn makeMoment(arguments, true, true);\n};\n\n// Builds an enhanced moment from args. When given an existing moment, it clones. When given a\n// native Date, or called with no arguments (the current time), the resulting moment will be local.\n// Anything else needs to be \"parsed\" (a string or an array), and will be affected by:\n//    parseAsUTC - if there is no zone information, should we parse the input in UTC?\n//    parseZone - if there is zone information, should we force the zone of the moment?\nfunction makeMoment(args, parseAsUTC, parseZone) {\n\tvar input = args[0];\n\tvar isSingleString = args.length == 1 && typeof input === 'string';\n\tvar isAmbigTime;\n\tvar isAmbigZone;\n\tvar ambigMatch;\n\tvar mom;\n\n\tif (moment.isMoment(input) || isNativeDate(input) || input === undefined) {\n\t\tmom = moment.apply(null, args);\n\t}\n\telse { // \"parsing\" is required\n\t\tisAmbigTime = false;\n\t\tisAmbigZone = false;\n\n\t\tif (isSingleString) {\n\t\t\tif (ambigDateOfMonthRegex.test(input)) {\n\t\t\t\t// accept strings like '2014-05', but convert to the first of the month\n\t\t\t\tinput += '-01';\n\t\t\t\targs = [ input ]; // for when we pass it on to moment's constructor\n\t\t\t\tisAmbigTime = true;\n\t\t\t\tisAmbigZone = true;\n\t\t\t}\n\t\t\telse if ((ambigMatch = ambigTimeOrZoneRegex.exec(input))) {\n\t\t\t\tisAmbigTime = !ambigMatch[5]; // no time part?\n\t\t\t\tisAmbigZone = true;\n\t\t\t}\n\t\t}\n\t\telse if ($.isArray(input)) {\n\t\t\t// arrays have no timezone information, so assume ambiguous zone\n\t\t\tisAmbigZone = true;\n\t\t}\n\t\t// otherwise, probably a string with a format\n\n\t\tif (parseAsUTC || isAmbigTime) {\n\t\t\tmom = moment.utc.apply(moment, args);\n\t\t}\n\t\telse {\n\t\t\tmom = moment.apply(null, args);\n\t\t}\n\n\t\tif (isAmbigTime) {\n\t\t\tmom._ambigTime = true;\n\t\t\tmom._ambigZone = true; // ambiguous time always means ambiguous zone\n\t\t}\n\t\telse if (parseZone) { // let's record the inputted zone somehow\n\t\t\tif (isAmbigZone) {\n\t\t\t\tmom._ambigZone = true;\n\t\t\t}\n\t\t\telse if (isSingleString) {\n\t\t\t\tmom.utcOffset(input); // if not a valid zone, will assign UTC\n\t\t\t}\n\t\t}\n\t}\n\n\tmom._fullCalendar = true; // flag for extended functionality\n\n\treturn mom;\n}\n\n\n// Week Number\n// -------------------------------------------------------------------------------------------------\n\n\n// Returns the week number, considering the locale's custom week number calcuation\n// `weeks` is an alias for `week`\nnewMomentProto.week = newMomentProto.weeks = function(input) {\n\tvar weekCalc = this._locale._fullCalendar_weekCalc;\n\n\tif (input == null && typeof weekCalc === 'function') { // custom function only works for getter\n\t\treturn weekCalc(this);\n\t}\n\telse if (weekCalc === 'ISO') {\n\t\treturn oldMomentProto.isoWeek.apply(this, arguments); // ISO getter/setter\n\t}\n\n\treturn oldMomentProto.week.apply(this, arguments); // local getter/setter\n};\n\n\n// Time-of-day\n// -------------------------------------------------------------------------------------------------\n\n// GETTER\n// Returns a Duration with the hours/minutes/seconds/ms values of the moment.\n// If the moment has an ambiguous time, a duration of 00:00 will be returned.\n//\n// SETTER\n// You can supply a Duration, a Moment, or a Duration-like argument.\n// When setting the time, and the moment has an ambiguous time, it then becomes unambiguous.\nnewMomentProto.time = function(time) {\n\n\t// Fallback to the original method (if there is one) if this moment wasn't created via FullCalendar.\n\t// `time` is a generic enough method name where this precaution is necessary to avoid collisions w/ other plugins.\n\tif (!this._fullCalendar) {\n\t\treturn oldMomentProto.time.apply(this, arguments);\n\t}\n\n\tif (time == null) { // getter\n\t\treturn moment.duration({\n\t\t\thours: this.hours(),\n\t\t\tminutes: this.minutes(),\n\t\t\tseconds: this.seconds(),\n\t\t\tmilliseconds: this.milliseconds()\n\t\t});\n\t}\n\telse { // setter\n\n\t\tthis._ambigTime = false; // mark that the moment now has a time\n\n\t\tif (!moment.isDuration(time) && !moment.isMoment(time)) {\n\t\t\ttime = moment.duration(time);\n\t\t}\n\n\t\t// The day value should cause overflow (so 24 hours becomes 00:00:00 of next day).\n\t\t// Only for Duration times, not Moment times.\n\t\tvar dayHours = 0;\n\t\tif (moment.isDuration(time)) {\n\t\t\tdayHours = Math.floor(time.asDays()) * 24;\n\t\t}\n\n\t\t// We need to set the individual fields.\n\t\t// Can't use startOf('day') then add duration. In case of DST at start of day.\n\t\treturn this.hours(dayHours + time.hours())\n\t\t\t.minutes(time.minutes())\n\t\t\t.seconds(time.seconds())\n\t\t\t.milliseconds(time.milliseconds());\n\t}\n};\n\n// Converts the moment to UTC, stripping out its time-of-day and timezone offset,\n// but preserving its YMD. A moment with a stripped time will display no time\n// nor timezone offset when .format() is called.\nnewMomentProto.stripTime = function() {\n\n\tif (!this._ambigTime) {\n\n\t\tthis.utc(true); // keepLocalTime=true (for keeping *date* value)\n\n\t\t// set time to zero\n\t\tthis.set({\n\t\t\thours: 0,\n\t\t\tminutes: 0,\n\t\t\tseconds: 0,\n\t\t\tms: 0\n\t\t});\n\n\t\t// Mark the time as ambiguous. This needs to happen after the .utc() call, which might call .utcOffset(),\n\t\t// which clears all ambig flags.\n\t\tthis._ambigTime = true;\n\t\tthis._ambigZone = true; // if ambiguous time, also ambiguous timezone offset\n\t}\n\n\treturn this; // for chaining\n};\n\n// Returns if the moment has a non-ambiguous time (boolean)\nnewMomentProto.hasTime = function() {\n\treturn !this._ambigTime;\n};\n\n\n// Timezone\n// -------------------------------------------------------------------------------------------------\n\n// Converts the moment to UTC, stripping out its timezone offset, but preserving its\n// YMD and time-of-day. A moment with a stripped timezone offset will display no\n// timezone offset when .format() is called.\nnewMomentProto.stripZone = function() {\n\tvar wasAmbigTime;\n\n\tif (!this._ambigZone) {\n\n\t\twasAmbigTime = this._ambigTime;\n\n\t\tthis.utc(true); // keepLocalTime=true (for keeping date and time values)\n\n\t\t// the above call to .utc()/.utcOffset() unfortunately might clear the ambig flags, so restore\n\t\tthis._ambigTime = wasAmbigTime || false;\n\n\t\t// Mark the zone as ambiguous. This needs to happen after the .utc() call, which might call .utcOffset(),\n\t\t// which clears the ambig flags.\n\t\tthis._ambigZone = true;\n\t}\n\n\treturn this; // for chaining\n};\n\n// Returns of the moment has a non-ambiguous timezone offset (boolean)\nnewMomentProto.hasZone = function() {\n\treturn !this._ambigZone;\n};\n\n\n// implicitly marks a zone\nnewMomentProto.local = function(keepLocalTime) {\n\n\t// for when converting from ambiguously-zoned to local,\n\t// keep the time values when converting from UTC -> local\n\toldMomentProto.local.call(this, this._ambigZone || keepLocalTime);\n\n\t// ensure non-ambiguous\n\t// this probably already happened via local() -> utcOffset(), but don't rely on Moment's internals\n\tthis._ambigTime = false;\n\tthis._ambigZone = false;\n\n\treturn this; // for chaining\n};\n\n\n// implicitly marks a zone\nnewMomentProto.utc = function(keepLocalTime) {\n\n\toldMomentProto.utc.call(this, keepLocalTime);\n\n\t// ensure non-ambiguous\n\t// this probably already happened via utc() -> utcOffset(), but don't rely on Moment's internals\n\tthis._ambigTime = false;\n\tthis._ambigZone = false;\n\n\treturn this;\n};\n\n\n// implicitly marks a zone (will probably get called upon .utc() and .local())\nnewMomentProto.utcOffset = function(tzo) {\n\n\tif (tzo != null) { // setter\n\t\t// these assignments needs to happen before the original zone method is called.\n\t\t// I forget why, something to do with a browser crash.\n\t\tthis._ambigTime = false;\n\t\tthis._ambigZone = false;\n\t}\n\n\treturn oldMomentProto.utcOffset.apply(this, arguments);\n};\n\n\n// Formatting\n// -------------------------------------------------------------------------------------------------\n\nnewMomentProto.format = function() {\n\n\tif (this._fullCalendar && arguments[0]) { // an enhanced moment? and a format string provided?\n\t\treturn formatDate(this, arguments[0]); // our extended formatting\n\t}\n\tif (this._ambigTime) {\n\t\treturn oldMomentFormat(englishMoment(this), 'YYYY-MM-DD');\n\t}\n\tif (this._ambigZone) {\n\t\treturn oldMomentFormat(englishMoment(this), 'YYYY-MM-DD[T]HH:mm:ss');\n\t}\n\tif (this._fullCalendar) { // enhanced non-ambig moment?\n\t\t// moment.format() doesn't ensure english, but we want to.\n\t\treturn oldMomentFormat(englishMoment(this));\n\t}\n\n\treturn oldMomentProto.format.apply(this, arguments);\n};\n\nnewMomentProto.toISOString = function() {\n\n\tif (this._ambigTime) {\n\t\treturn oldMomentFormat(englishMoment(this), 'YYYY-MM-DD');\n\t}\n\tif (this._ambigZone) {\n\t\treturn oldMomentFormat(englishMoment(this), 'YYYY-MM-DD[T]HH:mm:ss');\n\t}\n\tif (this._fullCalendar) { // enhanced non-ambig moment?\n\t\t// depending on browser, moment might not output english. ensure english.\n\t\t// https://github.com/moment/moment/blob/2.18.1/src/lib/moment/format.js#L22\n\t\treturn oldMomentProto.toISOString.apply(englishMoment(this), arguments);\n\t}\n\n\treturn oldMomentProto.toISOString.apply(this, arguments);\n};\n\nfunction englishMoment(mom) {\n\tif (mom.locale() !== 'en') {\n\t\treturn mom.clone().locale('en');\n\t}\n\treturn mom;\n}\n\n;;\n(function() {\n\n// exports\nFC.formatDate = formatDate;\nFC.formatRange = formatRange;\nFC.oldMomentFormat = oldMomentFormat;\nFC.queryMostGranularFormatUnit = queryMostGranularFormatUnit;\n\n\n// Config\n// ---------------------------------------------------------------------------------------------------------------------\n\n/*\nInserted between chunks in the fake (\"intermediate\") formatting string.\nImportant that it passes as whitespace (\\s) because moment often identifies non-standalone months\nvia a regexp with an \\s.\n*/\nvar PART_SEPARATOR = '\\u000b'; // vertical tab\n\n/*\nInserted as the first character of a literal-text chunk to indicate that the literal text is not actually literal text,\nbut rather, a \"special\" token that has custom rendering (see specialTokens map).\n*/\nvar SPECIAL_TOKEN_MARKER = '\\u001f'; // information separator 1\n\n/*\nInserted at the beginning and end of a span of text that must have non-zero numeric characters.\nHandling of these markers is done in a post-processing step at the very end of text rendering.\n*/\nvar MAYBE_MARKER = '\\u001e'; // information separator 2\nvar MAYBE_REGEXP = new RegExp(MAYBE_MARKER + '([^' + MAYBE_MARKER + ']*)' + MAYBE_MARKER, 'g'); // must be global\n\n/*\nAddition formatting tokens we want recognized\n*/\nvar specialTokens = {\n\tt: function(date) { // \"a\" or \"p\"\n\t\treturn oldMomentFormat(date, 'a').charAt(0);\n\t},\n\tT: function(date) { // \"A\" or \"P\"\n\t\treturn oldMomentFormat(date, 'A').charAt(0);\n\t}\n};\n\n/*\nThe first characters of formatting tokens for units that are 1 day or larger.\n`value` is for ranking relative size (lower means bigger).\n`unit` is a normalized unit, used for comparing moments.\n*/\nvar largeTokenMap = {\n\tY: { value: 1, unit: 'year' },\n\tM: { value: 2, unit: 'month' },\n\tW: { value: 3, unit: 'week' }, // ISO week\n\tw: { value: 3, unit: 'week' }, // local week\n\tD: { value: 4, unit: 'day' }, // day of month\n\td: { value: 4, unit: 'day' } // day of week\n};\n\n\n// Single Date Formatting\n// ---------------------------------------------------------------------------------------------------------------------\n\n/*\nFormats `date` with a Moment formatting string, but allow our non-zero areas and special token\n*/\nfunction formatDate(date, formatStr) {\n\treturn renderFakeFormatString(\n\t\tgetParsedFormatString(formatStr).fakeFormatString,\n\t\tdate\n\t);\n}\n\n/*\nCall this if you want Moment's original format method to be used\n*/\nfunction oldMomentFormat(mom, formatStr) {\n\treturn oldMomentProto.format.call(mom, formatStr); // oldMomentProto defined in moment-ext.js\n}\n\n\n// Date Range Formatting\n// -------------------------------------------------------------------------------------------------\n// TODO: make it work with timezone offset\n\n/*\nUsing a formatting string meant for a single date, generate a range string, like\n\"Sep 2 - 9 2013\", that intelligently inserts a separator where the dates differ.\nIf the dates are the same as far as the format string is concerned, just return a single\nrendering of one date, without any separator.\n*/\nfunction formatRange(date1, date2, formatStr, separator, isRTL) {\n\tvar localeData;\n\n\tdate1 = FC.moment.parseZone(date1);\n\tdate2 = FC.moment.parseZone(date2);\n\n\tlocaleData = date1.localeData();\n\n\t// Expand localized format strings, like \"LL\" -> \"MMMM D YYYY\".\n\t// BTW, this is not important for `formatDate` because it is impossible to put custom tokens\n\t// or non-zero areas in Moment's localized format strings.\n\tformatStr = localeData.longDateFormat(formatStr) || formatStr;\n\n\treturn renderParsedFormat(\n\t\tgetParsedFormatString(formatStr),\n\t\tdate1,\n\t\tdate2,\n\t\tseparator || ' - ',\n\t\tisRTL\n\t);\n}\n\n/*\nRenders a range with an already-parsed format string.\n*/\nfunction renderParsedFormat(parsedFormat, date1, date2, separator, isRTL) {\n\tvar sameUnits = parsedFormat.sameUnits;\n\tvar unzonedDate1 = date1.clone().stripZone(); // for same-unit comparisons\n\tvar unzonedDate2 = date2.clone().stripZone(); // \"\n\n\tvar renderedParts1 = renderFakeFormatStringParts(parsedFormat.fakeFormatString, date1);\n\tvar renderedParts2 = renderFakeFormatStringParts(parsedFormat.fakeFormatString, date2);\n\n\tvar leftI;\n\tvar leftStr = '';\n\tvar rightI;\n\tvar rightStr = '';\n\tvar middleI;\n\tvar middleStr1 = '';\n\tvar middleStr2 = '';\n\tvar middleStr = '';\n\n\t// Start at the leftmost side of the formatting string and continue until you hit a token\n\t// that is not the same between dates.\n\tfor (\n\t\tleftI = 0;\n\t\tleftI < sameUnits.length && (!sameUnits[leftI] || unzonedDate1.isSame(unzonedDate2, sameUnits[leftI]));\n\t\tleftI++\n\t) {\n\t\tleftStr += renderedParts1[leftI];\n\t}\n\n\t// Similarly, start at the rightmost side of the formatting string and move left\n\tfor (\n\t\trightI = sameUnits.length - 1;\n\t\trightI > leftI && (!sameUnits[rightI] || unzonedDate1.isSame(unzonedDate2, sameUnits[rightI]));\n\t\trightI--\n\t) {\n\t\t// If current chunk is on the boundary of unique date-content, and is a special-case\n\t\t// date-formatting postfix character, then don't consume it. Consider it unique date-content.\n\t\t// TODO: make configurable\n\t\tif (rightI - 1 === leftI && renderedParts1[rightI] === '.') {\n\t\t\tbreak;\n\t\t}\n\n\t\trightStr = renderedParts1[rightI] + rightStr;\n\t}\n\n\t// The area in the middle is different for both of the dates.\n\t// Collect them distinctly so we can jam them together later.\n\tfor (middleI = leftI; middleI <= rightI; middleI++) {\n\t\tmiddleStr1 += renderedParts1[middleI];\n\t\tmiddleStr2 += renderedParts2[middleI];\n\t}\n\n\tif (middleStr1 || middleStr2) {\n\t\tif (isRTL) {\n\t\t\tmiddleStr = middleStr2 + separator + middleStr1;\n\t\t}\n\t\telse {\n\t\t\tmiddleStr = middleStr1 + separator + middleStr2;\n\t\t}\n\t}\n\n\treturn processMaybeMarkers(\n\t\tleftStr + middleStr + rightStr\n\t);\n}\n\n\n// Format String Parsing\n// ---------------------------------------------------------------------------------------------------------------------\n\nvar parsedFormatStrCache = {};\n\n/*\nReturns a parsed format string, leveraging a cache.\n*/\nfunction getParsedFormatString(formatStr) {\n\treturn parsedFormatStrCache[formatStr] ||\n\t\t(parsedFormatStrCache[formatStr] = parseFormatString(formatStr));\n}\n\n/*\nParses a format string into the following:\n- fakeFormatString: a momentJS formatting string, littered with special control characters that get post-processed.\n- sameUnits: for every part in fakeFormatString, if the part is a token, the value will be a unit string (like \"day\"),\n  that indicates how similar a range's start & end must be in order to share the same formatted text.\n  If not a token, then the value is null.\n  Always a flat array (not nested liked \"chunks\").\n*/\nfunction parseFormatString(formatStr) {\n\tvar chunks = chunkFormatString(formatStr);\n\t\n\treturn {\n\t\tfakeFormatString: buildFakeFormatString(chunks),\n\t\tsameUnits: buildSameUnits(chunks)\n\t};\n}\n\n/*\nBreak the formatting string into an array of chunks.\nA 'maybe' chunk will have nested chunks.\n*/\nfunction chunkFormatString(formatStr) {\n\tvar chunks = [];\n\tvar match;\n\n\t// TODO: more descrimination\n\t// \\4 is a backreference to the first character of a multi-character set.\n\tvar chunker = /\\[([^\\]]*)\\]|\\(([^\\)]*)\\)|(LTS|LT|(\\w)\\4*o?)|([^\\w\\[\\(]+)/g;\n\n\twhile ((match = chunker.exec(formatStr))) {\n\t\tif (match[1]) { // a literal string inside [ ... ]\n\t\t\tchunks.push.apply(chunks, // append\n\t\t\t\tsplitStringLiteral(match[1])\n\t\t\t);\n\t\t}\n\t\telse if (match[2]) { // non-zero formatting inside ( ... )\n\t\t\tchunks.push({ maybe: chunkFormatString(match[2]) });\n\t\t}\n\t\telse if (match[3]) { // a formatting token\n\t\t\tchunks.push({ token: match[3] });\n\t\t}\n\t\telse if (match[5]) { // an unenclosed literal string\n\t\t\tchunks.push.apply(chunks, // append\n\t\t\t\tsplitStringLiteral(match[5])\n\t\t\t);\n\t\t}\n\t}\n\n\treturn chunks;\n}\n\n/*\nPotentially splits a literal-text string into multiple parts. For special cases.\n*/\nfunction splitStringLiteral(s) {\n\tif (s === '. ') {\n\t\treturn [ '.', ' ' ]; // for locales with periods bound to the end of each year/month/date\n\t}\n\telse {\n\t\treturn [ s ];\n\t}\n}\n\n/*\nGiven chunks parsed from a real format string, generate a fake (aka \"intermediate\") format string with special control\ncharacters that will eventually be given to moment for formatting, and then post-processed.\n*/\nfunction buildFakeFormatString(chunks) {\n\tvar parts = [];\n\tvar i, chunk;\n\n\tfor (i = 0; i < chunks.length; i++) {\n\t\tchunk = chunks[i];\n\n\t\tif (typeof chunk === 'string') {\n\t\t\tparts.push('[' + chunk + ']');\n\t\t}\n\t\telse if (chunk.token) {\n\t\t\tif (chunk.token in specialTokens) {\n\t\t\t\tparts.push(\n\t\t\t\t\tSPECIAL_TOKEN_MARKER + // useful during post-processing\n\t\t\t\t\t'[' + chunk.token + ']' // preserve as literal text\n\t\t\t\t);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tparts.push(chunk.token); // unprotected text implies a format string\n\t\t\t}\n\t\t}\n\t\telse if (chunk.maybe) {\n\t\t\tparts.push(\n\t\t\t\tMAYBE_MARKER + // useful during post-processing\n\t\t\t\tbuildFakeFormatString(chunk.maybe) +\n\t\t\t\tMAYBE_MARKER\n\t\t\t);\n\t\t}\n\t}\n\n\treturn parts.join(PART_SEPARATOR);\n}\n\n/*\nGiven parsed chunks from a real formatting string, generates an array of unit strings (like \"day\") that indicate\nin which regard two dates must be similar in order to share range formatting text.\nThe `chunks` can be nested (because of \"maybe\" chunks), however, the returned array will be flat.\n*/\nfunction buildSameUnits(chunks) {\n\tvar units = [];\n\tvar i, chunk;\n\tvar tokenInfo;\n\n\tfor (i = 0; i < chunks.length; i++) {\n\t\tchunk = chunks[i];\n\n\t\tif (chunk.token) {\n\t\t\ttokenInfo = largeTokenMap[chunk.token.charAt(0)];\n\t\t\tunits.push(tokenInfo ? tokenInfo.unit : 'second'); // default to a very strict same-second\n\t\t}\n\t\telse if (chunk.maybe) {\n\t\t\tunits.push.apply(units, // append\n\t\t\t\tbuildSameUnits(chunk.maybe)\n\t\t\t);\n\t\t}\n\t\telse {\n\t\t\tunits.push(null);\n\t\t}\n\t}\n\n\treturn units;\n}\n\n\n// Rendering to text\n// ---------------------------------------------------------------------------------------------------------------------\n\n/*\nFormats a date with a fake format string, post-processes the control characters, then returns.\n*/\nfunction renderFakeFormatString(fakeFormatString, date) {\n\treturn processMaybeMarkers(\n\t\trenderFakeFormatStringParts(fakeFormatString, date).join('')\n\t);\n}\n\n/*\nFormats a date into parts that will have been post-processed, EXCEPT for the \"maybe\" markers.\n*/\nfunction renderFakeFormatStringParts(fakeFormatString, date) {\n\tvar parts = [];\n\tvar fakeRender = oldMomentFormat(date, fakeFormatString);\n\tvar fakeParts = fakeRender.split(PART_SEPARATOR);\n\tvar i, fakePart;\n\n\tfor (i = 0; i < fakeParts.length; i++) {\n\t\tfakePart = fakeParts[i];\n\n\t\tif (fakePart.charAt(0) === SPECIAL_TOKEN_MARKER) {\n\t\t\tparts.push(\n\t\t\t\t// the literal string IS the token's name.\n\t\t\t\t// call special token's registered function.\n\t\t\t\tspecialTokens[fakePart.substring(1)](date)\n\t\t\t);\n\t\t}\n\t\telse {\n\t\t\tparts.push(fakePart);\n\t\t}\n\t}\n\n\treturn parts;\n}\n\n/*\nAccepts an almost-finally-formatted string and processes the \"maybe\" control characters, returning a new string.\n*/\nfunction processMaybeMarkers(s) {\n\treturn s.replace(MAYBE_REGEXP, function(m0, m1) { // regex assumed to have 'g' flag\n\t\tif (m1.match(/[1-9]/)) { // any non-zero numeric characters?\n\t\t\treturn m1;\n\t\t}\n\t\telse {\n\t\t\treturn '';\n\t\t}\n\t});\n}\n\n\n// Misc Utils\n// -------------------------------------------------------------------------------------------------\n\n/*\nReturns a unit string, either 'year', 'month', 'day', or null for the most granular formatting token in the string.\n*/\nfunction queryMostGranularFormatUnit(formatStr) {\n\tvar chunks = chunkFormatString(formatStr);\n\tvar i, chunk;\n\tvar candidate;\n\tvar best;\n\n\tfor (i = 0; i < chunks.length; i++) {\n\t\tchunk = chunks[i];\n\n\t\tif (chunk.token) {\n\t\t\tcandidate = largeTokenMap[chunk.token.charAt(0)];\n\t\t\tif (candidate) {\n\t\t\t\tif (!best || candidate.value > best.value) {\n\t\t\t\t\tbest = candidate;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (best) {\n\t\treturn best.unit;\n\t}\n\n\treturn null;\n};\n\n})();\n\n// quick local references\nvar formatDate = FC.formatDate;\nvar formatRange = FC.formatRange;\nvar oldMomentFormat = FC.oldMomentFormat;\n\n;;\n\nFC.Class = Class; // export\n\n// Class that all other classes will inherit from\nfunction Class() { }\n\n\n// Called on a class to create a subclass.\n// Last argument contains instance methods. Any argument before the last are considered mixins.\nClass.extend = function() {\n\tvar members = {};\n\tvar i;\n\n\tfor (i = 0; i < arguments.length; i++) {\n\t\tcopyOwnProps(arguments[i], members);\n\t}\n\n\treturn extendClass(this, members);\n};\n\n\n// Adds new member variables/methods to the class's prototype.\n// Can be called with another class, or a plain object hash containing new members.\nClass.mixin = function(members) {\n\tcopyOwnProps(members, this.prototype);\n};\n\n\nfunction extendClass(superClass, members) {\n\tvar subClass;\n\n\t// ensure a constructor for the subclass, forwarding all arguments to the super-constructor if it doesn't exist\n\tif (hasOwnProp(members, 'constructor')) {\n\t\tsubClass = members.constructor;\n\t}\n\tif (typeof subClass !== 'function') {\n\t\tsubClass = members.constructor = function() {\n\t\t\tsuperClass.apply(this, arguments);\n\t\t};\n\t}\n\n\t// build the base prototype for the subclass, which is an new object chained to the superclass's prototype\n\tsubClass.prototype = Object.create(superClass.prototype);\n\n\t// copy each member variable/method onto the the subclass's prototype\n\tcopyOwnProps(members, subClass.prototype);\n\n\t// copy over all class variables/methods to the subclass, such as `extend` and `mixin`\n\tcopyOwnProps(superClass, subClass);\n\n\treturn subClass;\n}\n\n;;\n\nvar EmitterMixin = FC.EmitterMixin = {\n\n\t// jQuery-ification via $(this) allows a non-DOM object to have\n\t// the same event handling capabilities (including namespaces).\n\n\n\ton: function(types, handler) {\n\t\t$(this).on(types, this._prepareIntercept(handler));\n\t\treturn this; // for chaining\n\t},\n\n\n\tone: function(types, handler) {\n\t\t$(this).one(types, this._prepareIntercept(handler));\n\t\treturn this; // for chaining\n\t},\n\n\n\t_prepareIntercept: function(handler) {\n\t\t// handlers are always called with an \"event\" object as their first param.\n\t\t// sneak the `this` context and arguments into the extra parameter object\n\t\t// and forward them on to the original handler.\n\t\tvar intercept = function(ev, extra) {\n\t\t\treturn handler.apply(\n\t\t\t\textra.context || this,\n\t\t\t\textra.args || []\n\t\t\t);\n\t\t};\n\n\t\t// mimick jQuery's internal \"proxy\" system (risky, I know)\n\t\t// causing all functions with the same .guid to appear to be the same.\n\t\t// https://github.com/jquery/jquery/blob/2.2.4/src/core.js#L448\n\t\t// this is needed for calling .off with the original non-intercept handler.\n\t\tif (!handler.guid) {\n\t\t\thandler.guid = $.guid++;\n\t\t}\n\t\tintercept.guid = handler.guid;\n\n\t\treturn intercept;\n\t},\n\n\n\toff: function(types, handler) {\n\t\t$(this).off(types, handler);\n\n\t\treturn this; // for chaining\n\t},\n\n\n\ttrigger: function(types) {\n\t\tvar args = Array.prototype.slice.call(arguments, 1); // arguments after the first\n\n\t\t// pass in \"extra\" info to the intercept\n\t\t$(this).triggerHandler(types, { args: args });\n\n\t\treturn this; // for chaining\n\t},\n\n\n\ttriggerWith: function(types, context, args) {\n\n\t\t// `triggerHandler` is less reliant on the DOM compared to `trigger`.\n\t\t// pass in \"extra\" info to the intercept.\n\t\t$(this).triggerHandler(types, { context: context, args: args });\n\n\t\treturn this; // for chaining\n\t},\n\n\n\thasHandlers: function(type) {\n\t\tvar hash = $._data(this, 'events'); // http://blog.jquery.com/2012/08/09/jquery-1-8-released/\n\n\t\treturn hash && hash[type] && hash[type].length > 0;\n\t}\n\n};\n\n;;\n\n/*\nUtility methods for easily listening to events on another object,\nand more importantly, easily unlistening from them.\n*/\nvar ListenerMixin = FC.ListenerMixin = (function() {\n\tvar guid = 0;\n\tvar ListenerMixin = {\n\n\t\tlistenerId: null,\n\n\t\t/*\n\t\tGiven an `other` object that has on/off methods, bind the given `callback` to an event by the given name.\n\t\tThe `callback` will be called with the `this` context of the object that .listenTo is being called on.\n\t\tCan be called:\n\t\t\t.listenTo(other, eventName, callback)\n\t\tOR\n\t\t\t.listenTo(other, {\n\t\t\t\teventName1: callback1,\n\t\t\t\teventName2: callback2\n\t\t\t})\n\t\t*/\n\t\tlistenTo: function(other, arg, callback) {\n\t\t\tif (typeof arg === 'object') { // given dictionary of callbacks\n\t\t\t\tfor (var eventName in arg) {\n\t\t\t\t\tif (arg.hasOwnProperty(eventName)) {\n\t\t\t\t\t\tthis.listenTo(other, eventName, arg[eventName]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (typeof arg === 'string') {\n\t\t\t\tother.on(\n\t\t\t\t\targ + '.' + this.getListenerNamespace(), // use event namespacing to identify this object\n\t\t\t\t\t$.proxy(callback, this) // always use `this` context\n\t\t\t\t\t\t// the usually-undesired jQuery guid behavior doesn't matter,\n\t\t\t\t\t\t// because we always unbind via namespace\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\n\t\t/*\n\t\tCauses the current object to stop listening to events on the `other` object.\n\t\t`eventName` is optional. If omitted, will stop listening to ALL events on `other`.\n\t\t*/\n\t\tstopListeningTo: function(other, eventName) {\n\t\t\tother.off((eventName || '') + '.' + this.getListenerNamespace());\n\t\t},\n\n\t\t/*\n\t\tReturns a string, unique to this object, to be used for event namespacing\n\t\t*/\n\t\tgetListenerNamespace: function() {\n\t\t\tif (this.listenerId == null) {\n\t\t\t\tthis.listenerId = guid++;\n\t\t\t}\n\t\t\treturn '_listener' + this.listenerId;\n\t\t}\n\n\t};\n\treturn ListenerMixin;\n})();\n;;\n\nvar ParsableModelMixin = {\n\n\tstandardPropMap: {}, // will be cloned by defineStandardProps\n\n\n\t/*\n\tReturns true/false for success.\n\tMeant to be only called ONCE, at object creation.\n\t*/\n\tapplyProps: function(rawProps) {\n\t\tvar standardPropMap = this.standardPropMap;\n\t\tvar manualProps = {};\n\t\tvar miscProps = {};\n\t\tvar propName;\n\n\t\tfor (propName in rawProps) {\n\t\t\tif (standardPropMap[propName] === true) { // copy verbatim\n\t\t\t\tthis[propName] = rawProps[propName];\n\t\t\t}\n\t\t\telse if (standardPropMap[propName] === false) {\n\t\t\t\tmanualProps[propName] = rawProps[propName];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmiscProps[propName] = rawProps[propName];\n\t\t\t}\n\t\t}\n\n\t\tthis.applyMiscProps(miscProps);\n\n\t\treturn this.applyManualStandardProps(manualProps);\n\t},\n\n\n\t/*\n\tIf subclasses override, they must call this supermethod and return the boolean response.\n\tMeant to be only called ONCE, at object creation.\n\t*/\n\tapplyManualStandardProps: function(rawProps) {\n\t\treturn true;\n\t},\n\n\n\t/*\n\tCan be called even after initial object creation.\n\t*/\n\tapplyMiscProps: function(rawProps) {\n\t\t// subclasses can implement\n\t},\n\n\n\t/*\n\tTODO: why is this a method when defineStandardProps is static\n\t*/\n\tisStandardProp: function(propName) {\n\t\treturn propName in this.standardPropMap;\n\t}\n\n};\n\n\n/*\nTODO: devise a better system\n*/\nvar ParsableModelMixin_defineStandardProps = function(propDefs) {\n\tvar proto = this.prototype;\n\n\tif (!proto.hasOwnProperty('standardPropMap')) {\n\t\tproto.standardPropMap = Object.create(proto.standardPropMap);\n\t}\n\n\tcopyOwnProps(propDefs, proto.standardPropMap);\n};\n\n\n/*\nTODO: devise a better system\n*/\nvar ParsableModelMixin_copyVerbatimStandardProps = function(src, dest) {\n\tvar map = this.prototype.standardPropMap;\n\tvar propName;\n\n\tfor (propName in map) {\n\t\tif (\n\t\t\tsrc[propName] != null && // in the src object?\n\t\t\tmap[propName] === true // false means \"copy verbatim\"\n\t\t) {\n\t\t\tdest[propName] = src[propName];\n\t\t}\n\t}\n};\n\n;;\n\nvar Model = Class.extend(EmitterMixin, ListenerMixin, {\n\n\t_props: null,\n\t_watchers: null,\n\t_globalWatchArgs: {}, // mutation protection in Model.watch\n\n\tconstructor: function() {\n\t\tthis._watchers = {};\n\t\tthis._props = {};\n\t\tthis.applyGlobalWatchers();\n\t\tthis.constructed();\n\t},\n\n\t// useful for monkeypatching. TODO: BaseClass?\n\tconstructed: function() {\n\t},\n\n\tapplyGlobalWatchers: function() {\n\t\tvar map = this._globalWatchArgs;\n\t\tvar name;\n\n\t\tfor (name in map) {\n\t\t\tthis.watch.apply(this, map[name]);\n\t\t}\n\t},\n\n\thas: function(name) {\n\t\treturn name in this._props;\n\t},\n\n\tget: function(name) {\n\t\tif (name === undefined) {\n\t\t\treturn this._props;\n\t\t}\n\n\t\treturn this._props[name];\n\t},\n\n\tset: function(name, val) {\n\t\tvar newProps;\n\n\t\tif (typeof name === 'string') {\n\t\t\tnewProps = {};\n\t\t\tnewProps[name] = val === undefined ? null : val;\n\t\t}\n\t\telse {\n\t\t\tnewProps = name;\n\t\t}\n\n\t\tthis.setProps(newProps);\n\t},\n\n\treset: function(newProps) {\n\t\tvar oldProps = this._props;\n\t\tvar changeset = {}; // will have undefined's to signal unsets\n\t\tvar name;\n\n\t\tfor (name in oldProps) {\n\t\t\tchangeset[name] = undefined;\n\t\t}\n\n\t\tfor (name in newProps) {\n\t\t\tchangeset[name] = newProps[name];\n\t\t}\n\n\t\tthis.setProps(changeset);\n\t},\n\n\tunset: function(name) { // accepts a string or array of strings\n\t\tvar newProps = {};\n\t\tvar names;\n\t\tvar i;\n\n\t\tif (typeof name === 'string') {\n\t\t\tnames = [ name ];\n\t\t}\n\t\telse {\n\t\t\tnames = name;\n\t\t}\n\n\t\tfor (i = 0; i < names.length; i++) {\n\t\t\tnewProps[names[i]] = undefined;\n\t\t}\n\n\t\tthis.setProps(newProps);\n\t},\n\n\tsetProps: function(newProps) {\n\t\tvar changedProps = {};\n\t\tvar changedCnt = 0;\n\t\tvar name, val;\n\n\t\tfor (name in newProps) {\n\t\t\tval = newProps[name];\n\n\t\t\t// a change in value?\n\t\t\t// if an object, don't check equality, because might have been mutated internally.\n\t\t\t// TODO: eventually enforce immutability.\n\t\t\tif (\n\t\t\t\ttypeof val === 'object' ||\n\t\t\t\tval !== this._props[name]\n\t\t\t) {\n\t\t\t\tchangedProps[name] = val;\n\t\t\t\tchangedCnt++;\n\t\t\t}\n\t\t}\n\n\t\tif (changedCnt) {\n\n\t\t\tthis.trigger('before:batchChange', changedProps);\n\n\t\t\tfor (name in changedProps) {\n\t\t\t\tval = changedProps[name];\n\n\t\t\t\tthis.trigger('before:change', name, val);\n\t\t\t\tthis.trigger('before:change:' + name, val);\n\t\t\t}\n\n\t\t\tfor (name in changedProps) {\n\t\t\t\tval = changedProps[name];\n\n\t\t\t\tif (val === undefined) {\n\t\t\t\t\tdelete this._props[name];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._props[name] = val;\n\t\t\t\t}\n\n\t\t\t\tthis.trigger('change:' + name, val);\n\t\t\t\tthis.trigger('change', name, val);\n\t\t\t}\n\n\t\t\tthis.trigger('batchChange', changedProps);\n\t\t}\n\t},\n\n\twatch: function(name, depList, startFunc, stopFunc) {\n\t\tvar _this = this;\n\n\t\tthis.unwatch(name);\n\n\t\tthis._watchers[name] = this._watchDeps(depList, function(deps) {\n\t\t\tvar res = startFunc.call(_this, deps);\n\n\t\t\tif (res && res.then) {\n\t\t\t\t_this.unset(name); // put in an unset state while resolving\n\t\t\t\tres.then(function(val) {\n\t\t\t\t\t_this.set(name, val);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\t_this.set(name, res);\n\t\t\t}\n\t\t}, function(deps) {\n\t\t\t_this.unset(name);\n\n\t\t\tif (stopFunc) {\n\t\t\t\tstopFunc.call(_this, deps);\n\t\t\t}\n\t\t});\n\t},\n\n\tunwatch: function(name) {\n\t\tvar watcher = this._watchers[name];\n\n\t\tif (watcher) {\n\t\t\tdelete this._watchers[name];\n\t\t\twatcher.teardown();\n\t\t}\n\t},\n\n\t_watchDeps: function(depList, startFunc, stopFunc) {\n\t\tvar _this = this;\n\t\tvar queuedChangeCnt = 0;\n\t\tvar depCnt = depList.length;\n\t\tvar satisfyCnt = 0;\n\t\tvar values = {}; // what's passed as the `deps` arguments\n\t\tvar bindTuples = []; // array of [ eventName, handlerFunc ] arrays\n\t\tvar isCallingStop = false;\n\n\t\tfunction onBeforeDepChange(depName, val, isOptional) {\n\t\t\tqueuedChangeCnt++;\n\t\t\tif (queuedChangeCnt === 1) { // first change to cause a \"stop\" ?\n\t\t\t\tif (satisfyCnt === depCnt) { // all deps previously satisfied?\n\t\t\t\t\tisCallingStop = true;\n\t\t\t\t\tstopFunc(values);\n\t\t\t\t\tisCallingStop = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction onDepChange(depName, val, isOptional) {\n\n\t\t\tif (val === undefined) { // unsetting a value?\n\n\t\t\t\t// required dependency that was previously set?\n\t\t\t\tif (!isOptional && values[depName] !== undefined) {\n\t\t\t\t\tsatisfyCnt--;\n\t\t\t\t}\n\n\t\t\t\tdelete values[depName];\n\t\t\t}\n\t\t\telse { // setting a value?\n\n\t\t\t\t// required dependency that was previously unset?\n\t\t\t\tif (!isOptional && values[depName] === undefined) {\n\t\t\t\t\tsatisfyCnt++;\n\t\t\t\t}\n\n\t\t\t\tvalues[depName] = val;\n\t\t\t}\n\n\t\t\tqueuedChangeCnt--;\n\t\t\tif (!queuedChangeCnt) { // last change to cause a \"start\"?\n\n\t\t\t\t// now finally satisfied or satisfied all along?\n\t\t\t\tif (satisfyCnt === depCnt) {\n\n\t\t\t\t\t// if the stopFunc initiated another value change, ignore it.\n\t\t\t\t\t// it will be processed by another change event anyway.\n\t\t\t\t\tif (!isCallingStop) {\n\t\t\t\t\t\tstartFunc(values);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// intercept for .on() that remembers handlers\n\t\tfunction bind(eventName, handler) {\n\t\t\t_this.on(eventName, handler);\n\t\t\tbindTuples.push([ eventName, handler ]);\n\t\t}\n\n\t\t// listen to dependency changes\n\t\tdepList.forEach(function(depName) {\n\t\t\tvar isOptional = false;\n\n\t\t\tif (depName.charAt(0) === '?') { // TODO: more DRY\n\t\t\t\tdepName = depName.substring(1);\n\t\t\t\tisOptional = true;\n\t\t\t}\n\n\t\t\tbind('before:change:' + depName, function(val) {\n\t\t\t\tonBeforeDepChange(depName, val, isOptional);\n\t\t\t});\n\n\t\t\tbind('change:' + depName, function(val) {\n\t\t\t\tonDepChange(depName, val, isOptional);\n\t\t\t});\n\t\t});\n\n\t\t// process current dependency values\n\t\tdepList.forEach(function(depName) {\n\t\t\tvar isOptional = false;\n\n\t\t\tif (depName.charAt(0) === '?') { // TODO: more DRY\n\t\t\t\tdepName = depName.substring(1);\n\t\t\t\tisOptional = true;\n\t\t\t}\n\n\t\t\tif (_this.has(depName)) {\n\t\t\t\tvalues[depName] = _this.get(depName);\n\t\t\t\tsatisfyCnt++;\n\t\t\t}\n\t\t\telse if (isOptional) {\n\t\t\t\tsatisfyCnt++;\n\t\t\t}\n\t\t});\n\n\t\t// initially satisfied\n\t\tif (satisfyCnt === depCnt) {\n\t\t\tstartFunc(values);\n\t\t}\n\n\t\treturn {\n\t\t\tteardown: function() {\n\t\t\t\t// remove all handlers\n\t\t\t\tfor (var i = 0; i < bindTuples.length; i++) {\n\t\t\t\t\t_this.off(bindTuples[i][0], bindTuples[i][1]);\n\t\t\t\t}\n\t\t\t\tbindTuples = null;\n\n\t\t\t\t// was satisfied, so call stopFunc\n\t\t\t\tif (satisfyCnt === depCnt) {\n\t\t\t\t\tstopFunc();\n\t\t\t\t}\n\t\t\t},\n\t\t\tflash: function() {\n\t\t\t\tif (satisfyCnt === depCnt) {\n\t\t\t\t\tstopFunc();\n\t\t\t\t\tstartFunc(values);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t},\n\n\tflash: function(name) {\n\t\tvar watcher = this._watchers[name];\n\n\t\tif (watcher) {\n\t\t\twatcher.flash();\n\t\t}\n\t}\n\n});\n\n\nModel.watch = function(name /* , depList, startFunc, stopFunc */) {\n\n\t// subclasses should make a masked-copy of the superclass's map\n\t// TODO: write test\n\tif (!this.prototype.hasOwnProperty('_globalWatchArgs')) {\n\t\tthis.prototype._globalWatchArgs = Object.create(this.prototype._globalWatchArgs);\n\t}\n\n\tthis.prototype._globalWatchArgs[name] = arguments;\n};\n\n\nFC.Model = Model;\n\n\n;;\n\nvar Promise = {\n\n\tconstruct: function(executor) {\n\t\tvar deferred = $.Deferred();\n\t\tvar promise = deferred.promise();\n\n\t\tif (typeof executor === 'function') {\n\t\t\texecutor(\n\t\t\t\tfunction(val) { // resolve\n\t\t\t\t\tdeferred.resolve(val);\n\t\t\t\t\tattachImmediatelyResolvingThen(promise, val);\n\t\t\t\t},\n\t\t\t\tfunction() { // reject\n\t\t\t\t\tdeferred.reject();\n\t\t\t\t\tattachImmediatelyRejectingThen(promise);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn promise;\n\t},\n\n\tresolve: function(val) {\n\t\tvar deferred = $.Deferred().resolve(val);\n\t\tvar promise = deferred.promise();\n\n\t\tattachImmediatelyResolvingThen(promise, val);\n\n\t\treturn promise;\n\t},\n\n\treject: function() {\n\t\tvar deferred = $.Deferred().reject();\n\t\tvar promise = deferred.promise();\n\n\t\tattachImmediatelyRejectingThen(promise);\n\n\t\treturn promise;\n\t}\n\n};\n\n\nfunction attachImmediatelyResolvingThen(promise, val) {\n\tpromise.then = function(onResolve) {\n\t\tif (typeof onResolve === 'function') {\n\t\t\treturn Promise.resolve(onResolve(val));\n\t\t}\n\t\treturn promise;\n\t};\n}\n\n\nfunction attachImmediatelyRejectingThen(promise) {\n\tpromise.then = function(onResolve, onReject) {\n\t\tif (typeof onReject === 'function') {\n\t\t\tonReject();\n\t\t}\n\t\treturn promise;\n\t};\n}\n\n\nFC.Promise = Promise;\n\n;;\n\nvar TaskQueue = Class.extend(EmitterMixin, {\n\n\tq: null,\n\tisPaused: false,\n\tisRunning: false,\n\n\n\tconstructor: function() {\n\t\tthis.q = [];\n\t},\n\n\n\tqueue: function(/* taskFunc, taskFunc... */) {\n\t\tthis.q.push.apply(this.q, arguments); // append\n\t\tthis.tryStart();\n\t},\n\n\n\tpause: function() {\n\t\tthis.isPaused = true;\n\t},\n\n\n\tresume: function() {\n\t\tthis.isPaused = false;\n\t\tthis.tryStart();\n\t},\n\n\n\tgetIsIdle: function() {\n\t\treturn !this.isRunning && !this.isPaused;\n\t},\n\n\n\ttryStart: function() {\n\t\tif (!this.isRunning && this.canRunNext()) {\n\t\t\tthis.isRunning = true;\n\t\t\tthis.trigger('start');\n\t\t\tthis.runRemaining();\n\t\t}\n\t},\n\n\n\tcanRunNext: function() {\n\t\treturn !this.isPaused && this.q.length;\n\t},\n\n\n\trunRemaining: function() { // assumes at least one task in queue. does not check canRunNext for first task.\n\t\tvar _this = this;\n\t\tvar task;\n\t\tvar res;\n\n\t\tdo {\n\t\t\ttask = this.q.shift(); // always freshly reference q. might have been reassigned.\n\t\t\tres = this.runTask(task);\n\n\t\t\tif (res && res.then) {\n\t\t\t\tres.then(function() { // jshint ignore:line\n\t\t\t\t\tif (_this.canRunNext()) {\n\t\t\t\t\t\t_this.runRemaining();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn; // prevent marking as stopped\n\t\t\t}\n\t\t} while (this.canRunNext());\n\n\t\tthis.trigger('stop'); // not really a 'stop' ... more of a 'drained'\n\t\tthis.isRunning = false;\n\n\t\t// if 'stop' handler added more tasks.... TODO: write test for this\n\t\tthis.tryStart();\n\t},\n\n\n\trunTask: function(task) {\n\t\treturn task(); // task *is* the function, but subclasses can change the format of a task\n\t}\n\n});\n\nFC.TaskQueue = TaskQueue;\n\n;;\n\nvar RenderQueue = TaskQueue.extend({\n\n\twaitsByNamespace: null,\n\twaitNamespace: null,\n\twaitId: null,\n\n\n\tconstructor: function(waitsByNamespace) {\n\t\tTaskQueue.call(this); // super-constructor\n\n\t\tthis.waitsByNamespace = waitsByNamespace || {};\n\t},\n\n\n\tqueue: function(taskFunc, namespace, type) {\n\t\tvar task = {\n\t\t\tfunc: taskFunc,\n\t\t\tnamespace: namespace,\n\t\t\ttype: type\n\t\t};\n\t\tvar waitMs;\n\n\t\tif (namespace) {\n\t\t\twaitMs = this.waitsByNamespace[namespace];\n\t\t}\n\n\t\tif (this.waitNamespace) {\n\t\t\tif (namespace === this.waitNamespace && waitMs != null) {\n\t\t\t\tthis.delayWait(waitMs);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.clearWait();\n\t\t\t\tthis.tryStart();\n\t\t\t}\n\t\t}\n\n\t\tif (this.compoundTask(task)) { // appended to queue?\n\n\t\t\tif (!this.waitNamespace && waitMs != null) {\n\t\t\t\tthis.startWait(namespace, waitMs);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.tryStart();\n\t\t\t}\n\t\t}\n\t},\n\n\n\tstartWait: function(namespace, waitMs) {\n\t\tthis.waitNamespace = namespace;\n\t\tthis.spawnWait(waitMs);\n\t},\n\n\n\tdelayWait: function(waitMs) {\n\t\tclearTimeout(this.waitId);\n\t\tthis.spawnWait(waitMs);\n\t},\n\n\n\tspawnWait: function(waitMs) {\n\t\tvar _this = this;\n\n\t\tthis.waitId = setTimeout(function() {\n\t\t\t_this.waitNamespace = null;\n\t\t\t_this.tryStart();\n\t\t}, waitMs);\n\t},\n\n\n\tclearWait: function() {\n\t\tif (this.waitNamespace) {\n\t\t\tclearTimeout(this.waitId);\n\t\t\tthis.waitId = null;\n\t\t\tthis.waitNamespace = null;\n\t\t}\n\t},\n\n\n\tcanRunNext: function() {\n\t\tif (!TaskQueue.prototype.canRunNext.apply(this, arguments)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// waiting for a certain namespace to stop receiving tasks?\n\t\tif (this.waitNamespace) {\n\n\t\t\t// if there was a different namespace task in the meantime,\n\t\t\t// that forces all previously-waiting tasks to suddenly execute.\n\t\t\t// TODO: find a way to do this in constant time.\n\t\t\tfor (var q = this.q, i = 0; i < q.length; i++) {\n\t\t\t\tif (q[i].namespace !== this.waitNamespace) {\n\t\t\t\t\treturn true; // allow execution\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\n\trunTask: function(task) {\n\t\ttask.func();\n\t},\n\n\n\tcompoundTask: function(newTask) {\n\t\tvar q = this.q;\n\t\tvar shouldAppend = true;\n\t\tvar i, task;\n\n\t\tif (newTask.namespace && newTask.type === 'destroy') {\n\n\t\t\t// remove all init/add/remove ops with same namespace, regardless of order\n\t\t\tfor (i = q.length - 1; i >= 0; i--) {\n\t\t\t\ttask = q[i];\n\n\t\t\t\tswitch (task.type) {\n\t\t\t\t\tcase 'init':\n\t\t\t\t\t\tshouldAppend = false; // jshint ignore:line\n\t\t\t\t\t\t// the latest destroy is cancelled out by not doing the init\n\t\t\t\t\t\t// and fallthrough....\n\t\t\t\t\tcase 'add':\n\t\t\t\t\tcase 'remove':\n\t\t\t\t\t\tq.splice(i, 1); // remove task\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (shouldAppend) {\n\t\t\tq.push(newTask);\n\t\t}\n\n\t\treturn shouldAppend;\n\t}\n\n});\n\nFC.RenderQueue = RenderQueue;\n\n;;\n\n/* A rectangular panel that is absolutely positioned over other content\n------------------------------------------------------------------------------------------------------------------------\nOptions:\n\t- className (string)\n\t- content (HTML string or jQuery element set)\n\t- parentEl\n\t- top\n\t- left\n\t- right (the x coord of where the right edge should be. not a \"CSS\" right)\n\t- autoHide (boolean)\n\t- show (callback)\n\t- hide (callback)\n*/\n\nvar Popover = Class.extend(ListenerMixin, {\n\n\tisHidden: true,\n\toptions: null,\n\tel: null, // the container element for the popover. generated by this object\n\tmargin: 10, // the space required between the popover and the edges of the scroll container\n\n\n\tconstructor: function(options) {\n\t\tthis.options = options || {};\n\t},\n\n\n\t// Shows the popover on the specified position. Renders it if not already\n\tshow: function() {\n\t\tif (this.isHidden) {\n\t\t\tif (!this.el) {\n\t\t\t\tthis.render();\n\t\t\t}\n\t\t\tthis.el.show();\n\t\t\tthis.position();\n\t\t\tthis.isHidden = false;\n\t\t\tthis.trigger('show');\n\t\t}\n\t},\n\n\n\t// Hides the popover, through CSS, but does not remove it from the DOM\n\thide: function() {\n\t\tif (!this.isHidden) {\n\t\t\tthis.el.hide();\n\t\t\tthis.isHidden = true;\n\t\t\tthis.trigger('hide');\n\t\t}\n\t},\n\n\n\t// Creates `this.el` and renders content inside of it\n\trender: function() {\n\t\tvar _this = this;\n\t\tvar options = this.options;\n\n\t\tthis.el = $('<div class=\"fc-popover\"/>')\n\t\t\t.addClass(options.className || '')\n\t\t\t.css({\n\t\t\t\t// position initially to the top left to avoid creating scrollbars\n\t\t\t\ttop: 0,\n\t\t\t\tleft: 0\n\t\t\t})\n\t\t\t.append(options.content)\n\t\t\t.appendTo(options.parentEl);\n\n\t\t// when a click happens on anything inside with a 'fc-close' className, hide the popover\n\t\tthis.el.on('click', '.fc-close', function() {\n\t\t\t_this.hide();\n\t\t});\n\n\t\tif (options.autoHide) {\n\t\t\tthis.listenTo($(document), 'mousedown', this.documentMousedown);\n\t\t}\n\t},\n\n\n\t// Triggered when the user clicks *anywhere* in the document, for the autoHide feature\n\tdocumentMousedown: function(ev) {\n\t\t// only hide the popover if the click happened outside the popover\n\t\tif (this.el && !$(ev.target).closest(this.el).length) {\n\t\t\tthis.hide();\n\t\t}\n\t},\n\n\n\t// Hides and unregisters any handlers\n\tremoveElement: function() {\n\t\tthis.hide();\n\n\t\tif (this.el) {\n\t\t\tthis.el.remove();\n\t\t\tthis.el = null;\n\t\t}\n\n\t\tthis.stopListeningTo($(document), 'mousedown');\n\t},\n\n\n\t// Positions the popover optimally, using the top/left/right options\n\tposition: function() {\n\t\tvar options = this.options;\n\t\tvar origin = this.el.offsetParent().offset();\n\t\tvar width = this.el.outerWidth();\n\t\tvar height = this.el.outerHeight();\n\t\tvar windowEl = $(window);\n\t\tvar viewportEl = getScrollParent(this.el);\n\t\tvar viewportTop;\n\t\tvar viewportLeft;\n\t\tvar viewportOffset;\n\t\tvar top; // the \"position\" (not \"offset\") values for the popover\n\t\tvar left; //\n\n\t\t// compute top and left\n\t\ttop = options.top || 0;\n\t\tif (options.left !== undefined) {\n\t\t\tleft = options.left;\n\t\t}\n\t\telse if (options.right !== undefined) {\n\t\t\tleft = options.right - width; // derive the left value from the right value\n\t\t}\n\t\telse {\n\t\t\tleft = 0;\n\t\t}\n\n\t\tif (viewportEl.is(window) || viewportEl.is(document)) { // normalize getScrollParent's result\n\t\t\tviewportEl = windowEl;\n\t\t\tviewportTop = 0; // the window is always at the top left\n\t\t\tviewportLeft = 0; // (and .offset() won't work if called here)\n\t\t}\n\t\telse {\n\t\t\tviewportOffset = viewportEl.offset();\n\t\t\tviewportTop = viewportOffset.top;\n\t\t\tviewportLeft = viewportOffset.left;\n\t\t}\n\n\t\t// if the window is scrolled, it causes the visible area to be further down\n\t\tviewportTop += windowEl.scrollTop();\n\t\tviewportLeft += windowEl.scrollLeft();\n\n\t\t// constrain to the view port. if constrained by two edges, give precedence to top/left\n\t\tif (options.viewportConstrain !== false) {\n\t\t\ttop = Math.min(top, viewportTop + viewportEl.outerHeight() - height - this.margin);\n\t\t\ttop = Math.max(top, viewportTop + this.margin);\n\t\t\tleft = Math.min(left, viewportLeft + viewportEl.outerWidth() - width - this.margin);\n\t\t\tleft = Math.max(left, viewportLeft + this.margin);\n\t\t}\n\n\t\tthis.el.css({\n\t\t\ttop: top - origin.top,\n\t\t\tleft: left - origin.left\n\t\t});\n\t},\n\n\n\t// Triggers a callback. Calls a function in the option hash of the same name.\n\t// Arguments beyond the first `name` are forwarded on.\n\t// TODO: better code reuse for this. Repeat code\n\ttrigger: function(name) {\n\t\tif (this.options[name]) {\n\t\t\tthis.options[name].apply(this, Array.prototype.slice.call(arguments, 1));\n\t\t}\n\t}\n\n});\n\n;;\n\n/*\nA cache for the left/right/top/bottom/width/height values for one or more elements.\nWorks with both offset (from topleft document) and position (from offsetParent).\n\noptions:\n- els\n- isHorizontal\n- isVertical\n*/\nvar CoordCache = FC.CoordCache = Class.extend({\n\n\tels: null, // jQuery set (assumed to be siblings)\n\tforcedOffsetParentEl: null, // options can override the natural offsetParent\n\torigin: null, // {left,top} position of offsetParent of els\n\tboundingRect: null, // constrain cordinates to this rectangle. {left,right,top,bottom} or null\n\tisHorizontal: false, // whether to query for left/right/width\n\tisVertical: false, // whether to query for top/bottom/height\n\n\t// arrays of coordinates (offsets from topleft of document)\n\tlefts: null,\n\trights: null,\n\ttops: null,\n\tbottoms: null,\n\n\n\tconstructor: function(options) {\n\t\tthis.els = $(options.els);\n\t\tthis.isHorizontal = options.isHorizontal;\n\t\tthis.isVertical = options.isVertical;\n\t\tthis.forcedOffsetParentEl = options.offsetParent ? $(options.offsetParent) : null;\n\t},\n\n\n\t// Queries the els for coordinates and stores them.\n\t// Call this method before using and of the get* methods below.\n\tbuild: function() {\n\t\tvar offsetParentEl = this.forcedOffsetParentEl;\n\t\tif (!offsetParentEl && this.els.length > 0) {\n\t\t\toffsetParentEl = this.els.eq(0).offsetParent();\n\t\t}\n\n\t\tthis.origin = offsetParentEl ?\n\t\t\toffsetParentEl.offset() :\n\t\t\tnull;\n\n\t\tthis.boundingRect = this.queryBoundingRect();\n\n\t\tif (this.isHorizontal) {\n\t\t\tthis.buildElHorizontals();\n\t\t}\n\t\tif (this.isVertical) {\n\t\t\tthis.buildElVerticals();\n\t\t}\n\t},\n\n\n\t// Destroys all internal data about coordinates, freeing memory\n\tclear: function() {\n\t\tthis.origin = null;\n\t\tthis.boundingRect = null;\n\t\tthis.lefts = null;\n\t\tthis.rights = null;\n\t\tthis.tops = null;\n\t\tthis.bottoms = null;\n\t},\n\n\n\t// When called, if coord caches aren't built, builds them\n\tensureBuilt: function() {\n\t\tif (!this.origin) {\n\t\t\tthis.build();\n\t\t}\n\t},\n\n\n\t// Populates the left/right internal coordinate arrays\n\tbuildElHorizontals: function() {\n\t\tvar lefts = [];\n\t\tvar rights = [];\n\n\t\tthis.els.each(function(i, node) {\n\t\t\tvar el = $(node);\n\t\t\tvar left = el.offset().left;\n\t\t\tvar width = el.outerWidth();\n\n\t\t\tlefts.push(left);\n\t\t\trights.push(left + width);\n\t\t});\n\n\t\tthis.lefts = lefts;\n\t\tthis.rights = rights;\n\t},\n\n\n\t// Populates the top/bottom internal coordinate arrays\n\tbuildElVerticals: function() {\n\t\tvar tops = [];\n\t\tvar bottoms = [];\n\n\t\tthis.els.each(function(i, node) {\n\t\t\tvar el = $(node);\n\t\t\tvar top = el.offset().top;\n\t\t\tvar height = el.outerHeight();\n\n\t\t\ttops.push(top);\n\t\t\tbottoms.push(top + height);\n\t\t});\n\n\t\tthis.tops = tops;\n\t\tthis.bottoms = bottoms;\n\t},\n\n\n\t// Given a left offset (from document left), returns the index of the el that it horizontally intersects.\n\t// If no intersection is made, returns undefined.\n\tgetHorizontalIndex: function(leftOffset) {\n\t\tthis.ensureBuilt();\n\n\t\tvar lefts = this.lefts;\n\t\tvar rights = this.rights;\n\t\tvar len = lefts.length;\n\t\tvar i;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (leftOffset >= lefts[i] && leftOffset < rights[i]) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Given a top offset (from document top), returns the index of the el that it vertically intersects.\n\t// If no intersection is made, returns undefined.\n\tgetVerticalIndex: function(topOffset) {\n\t\tthis.ensureBuilt();\n\n\t\tvar tops = this.tops;\n\t\tvar bottoms = this.bottoms;\n\t\tvar len = tops.length;\n\t\tvar i;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (topOffset >= tops[i] && topOffset < bottoms[i]) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Gets the left offset (from document left) of the element at the given index\n\tgetLeftOffset: function(leftIndex) {\n\t\tthis.ensureBuilt();\n\t\treturn this.lefts[leftIndex];\n\t},\n\n\n\t// Gets the left position (from offsetParent left) of the element at the given index\n\tgetLeftPosition: function(leftIndex) {\n\t\tthis.ensureBuilt();\n\t\treturn this.lefts[leftIndex] - this.origin.left;\n\t},\n\n\n\t// Gets the right offset (from document left) of the element at the given index.\n\t// This value is NOT relative to the document's right edge, like the CSS concept of \"right\" would be.\n\tgetRightOffset: function(leftIndex) {\n\t\tthis.ensureBuilt();\n\t\treturn this.rights[leftIndex];\n\t},\n\n\n\t// Gets the right position (from offsetParent left) of the element at the given index.\n\t// This value is NOT relative to the offsetParent's right edge, like the CSS concept of \"right\" would be.\n\tgetRightPosition: function(leftIndex) {\n\t\tthis.ensureBuilt();\n\t\treturn this.rights[leftIndex] - this.origin.left;\n\t},\n\n\n\t// Gets the width of the element at the given index\n\tgetWidth: function(leftIndex) {\n\t\tthis.ensureBuilt();\n\t\treturn this.rights[leftIndex] - this.lefts[leftIndex];\n\t},\n\n\n\t// Gets the top offset (from document top) of the element at the given index\n\tgetTopOffset: function(topIndex) {\n\t\tthis.ensureBuilt();\n\t\treturn this.tops[topIndex];\n\t},\n\n\n\t// Gets the top position (from offsetParent top) of the element at the given position\n\tgetTopPosition: function(topIndex) {\n\t\tthis.ensureBuilt();\n\t\treturn this.tops[topIndex] - this.origin.top;\n\t},\n\n\t// Gets the bottom offset (from the document top) of the element at the given index.\n\t// This value is NOT relative to the offsetParent's bottom edge, like the CSS concept of \"bottom\" would be.\n\tgetBottomOffset: function(topIndex) {\n\t\tthis.ensureBuilt();\n\t\treturn this.bottoms[topIndex];\n\t},\n\n\n\t// Gets the bottom position (from the offsetParent top) of the element at the given index.\n\t// This value is NOT relative to the offsetParent's bottom edge, like the CSS concept of \"bottom\" would be.\n\tgetBottomPosition: function(topIndex) {\n\t\tthis.ensureBuilt();\n\t\treturn this.bottoms[topIndex] - this.origin.top;\n\t},\n\n\n\t// Gets the height of the element at the given index\n\tgetHeight: function(topIndex) {\n\t\tthis.ensureBuilt();\n\t\treturn this.bottoms[topIndex] - this.tops[topIndex];\n\t},\n\n\n\t// Bounding Rect\n\t// TODO: decouple this from CoordCache\n\n\t// Compute and return what the elements' bounding rectangle is, from the user's perspective.\n\t// Right now, only returns a rectangle if constrained by an overflow:scroll element.\n\t// Returns null if there are no elements\n\tqueryBoundingRect: function() {\n\t\tvar scrollParentEl;\n\n\t\tif (this.els.length > 0) {\n\t\t\tscrollParentEl = getScrollParent(this.els.eq(0));\n\n\t\t\tif (!scrollParentEl.is(document)) {\n\t\t\t\treturn getClientRect(scrollParentEl);\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\tisPointInBounds: function(leftOffset, topOffset) {\n\t\treturn this.isLeftInBounds(leftOffset) && this.isTopInBounds(topOffset);\n\t},\n\n\tisLeftInBounds: function(leftOffset) {\n\t\treturn !this.boundingRect || (leftOffset >= this.boundingRect.left && leftOffset < this.boundingRect.right);\n\t},\n\n\tisTopInBounds: function(topOffset) {\n\t\treturn !this.boundingRect || (topOffset >= this.boundingRect.top && topOffset < this.boundingRect.bottom);\n\t}\n\n});\n\n;;\n\n/* Tracks a drag's mouse movement, firing various handlers\n----------------------------------------------------------------------------------------------------------------------*/\n// TODO: use Emitter\n\nvar DragListener = FC.DragListener = Class.extend(ListenerMixin, {\n\n\toptions: null,\n\tsubjectEl: null,\n\n\t// coordinates of the initial mousedown\n\toriginX: null,\n\toriginY: null,\n\n\t// the wrapping element that scrolls, or MIGHT scroll if there's overflow.\n\t// TODO: do this for wrappers that have overflow:hidden as well.\n\tscrollEl: null,\n\n\tisInteracting: false,\n\tisDistanceSurpassed: false,\n\tisDelayEnded: false,\n\tisDragging: false,\n\tisTouch: false,\n\tisGeneric: false, // initiated by 'dragstart' (jqui)\n\n\tdelay: null,\n\tdelayTimeoutId: null,\n\tminDistance: null,\n\n\tshouldCancelTouchScroll: true,\n\tscrollAlwaysKills: false,\n\n\n\tconstructor: function(options) {\n\t\tthis.options = options || {};\n\t},\n\n\n\t// Interaction (high-level)\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tstartInteraction: function(ev, extraOptions) {\n\n\t\tif (ev.type === 'mousedown') {\n\t\t\tif (GlobalEmitter.get().shouldIgnoreMouse()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if (!isPrimaryMouseButton(ev)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tev.preventDefault(); // prevents native selection in most browsers\n\t\t\t}\n\t\t}\n\n\t\tif (!this.isInteracting) {\n\n\t\t\t// process options\n\t\t\textraOptions = extraOptions || {};\n\t\t\tthis.delay = firstDefined(extraOptions.delay, this.options.delay, 0);\n\t\t\tthis.minDistance = firstDefined(extraOptions.distance, this.options.distance, 0);\n\t\t\tthis.subjectEl = this.options.subjectEl;\n\n\t\t\tpreventSelection($('body'));\n\n\t\t\tthis.isInteracting = true;\n\t\t\tthis.isTouch = getEvIsTouch(ev);\n\t\t\tthis.isGeneric = ev.type === 'dragstart';\n\t\t\tthis.isDelayEnded = false;\n\t\t\tthis.isDistanceSurpassed = false;\n\n\t\t\tthis.originX = getEvX(ev);\n\t\t\tthis.originY = getEvY(ev);\n\t\t\tthis.scrollEl = getScrollParent($(ev.target));\n\n\t\t\tthis.bindHandlers();\n\t\t\tthis.initAutoScroll();\n\t\t\tthis.handleInteractionStart(ev);\n\t\t\tthis.startDelay(ev);\n\n\t\t\tif (!this.minDistance) {\n\t\t\t\tthis.handleDistanceSurpassed(ev);\n\t\t\t}\n\t\t}\n\t},\n\n\n\thandleInteractionStart: function(ev) {\n\t\tthis.trigger('interactionStart', ev);\n\t},\n\n\n\tendInteraction: function(ev, isCancelled) {\n\t\tif (this.isInteracting) {\n\t\t\tthis.endDrag(ev);\n\n\t\t\tif (this.delayTimeoutId) {\n\t\t\t\tclearTimeout(this.delayTimeoutId);\n\t\t\t\tthis.delayTimeoutId = null;\n\t\t\t}\n\n\t\t\tthis.destroyAutoScroll();\n\t\t\tthis.unbindHandlers();\n\n\t\t\tthis.isInteracting = false;\n\t\t\tthis.handleInteractionEnd(ev, isCancelled);\n\n\t\t\tallowSelection($('body'));\n\t\t}\n\t},\n\n\n\thandleInteractionEnd: function(ev, isCancelled) {\n\t\tthis.trigger('interactionEnd', ev, isCancelled || false);\n\t},\n\n\n\t// Binding To DOM\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tbindHandlers: function() {\n\t\t// some browsers (Safari in iOS 10) don't allow preventDefault on touch events that are bound after touchstart,\n\t\t// so listen to the GlobalEmitter singleton, which is always bound, instead of the document directly.\n\t\tvar globalEmitter = GlobalEmitter.get();\n\n\t\tif (this.isGeneric) {\n\t\t\tthis.listenTo($(document), { // might only work on iOS because of GlobalEmitter's bind :(\n\t\t\t\tdrag: this.handleMove,\n\t\t\t\tdragstop: this.endInteraction\n\t\t\t});\n\t\t}\n\t\telse if (this.isTouch) {\n\t\t\tthis.listenTo(globalEmitter, {\n\t\t\t\ttouchmove: this.handleTouchMove,\n\t\t\t\ttouchend: this.endInteraction,\n\t\t\t\tscroll: this.handleTouchScroll\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tthis.listenTo(globalEmitter, {\n\t\t\t\tmousemove: this.handleMouseMove,\n\t\t\t\tmouseup: this.endInteraction\n\t\t\t});\n\t\t}\n\n\t\tthis.listenTo(globalEmitter, {\n\t\t\tselectstart: preventDefault, // don't allow selection while dragging\n\t\t\tcontextmenu: preventDefault // long taps would open menu on Chrome dev tools\n\t\t});\n\t},\n\n\n\tunbindHandlers: function() {\n\t\tthis.stopListeningTo(GlobalEmitter.get());\n\t\tthis.stopListeningTo($(document)); // for isGeneric\n\t},\n\n\n\t// Drag (high-level)\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\t// extraOptions ignored if drag already started\n\tstartDrag: function(ev, extraOptions) {\n\t\tthis.startInteraction(ev, extraOptions); // ensure interaction began\n\n\t\tif (!this.isDragging) {\n\t\t\tthis.isDragging = true;\n\t\t\tthis.handleDragStart(ev);\n\t\t}\n\t},\n\n\n\thandleDragStart: function(ev) {\n\t\tthis.trigger('dragStart', ev);\n\t},\n\n\n\thandleMove: function(ev) {\n\t\tvar dx = getEvX(ev) - this.originX;\n\t\tvar dy = getEvY(ev) - this.originY;\n\t\tvar minDistance = this.minDistance;\n\t\tvar distanceSq; // current distance from the origin, squared\n\n\t\tif (!this.isDistanceSurpassed) {\n\t\t\tdistanceSq = dx * dx + dy * dy;\n\t\t\tif (distanceSq >= minDistance * minDistance) { // use pythagorean theorem\n\t\t\t\tthis.handleDistanceSurpassed(ev);\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDragging) {\n\t\t\tthis.handleDrag(dx, dy, ev);\n\t\t}\n\t},\n\n\n\t// Called while the mouse is being moved and when we know a legitimate drag is taking place\n\thandleDrag: function(dx, dy, ev) {\n\t\tthis.trigger('drag', dx, dy, ev);\n\t\tthis.updateAutoScroll(ev); // will possibly cause scrolling\n\t},\n\n\n\tendDrag: function(ev) {\n\t\tif (this.isDragging) {\n\t\t\tthis.isDragging = false;\n\t\t\tthis.handleDragEnd(ev);\n\t\t}\n\t},\n\n\n\thandleDragEnd: function(ev) {\n\t\tthis.trigger('dragEnd', ev);\n\t},\n\n\n\t// Delay\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tstartDelay: function(initialEv) {\n\t\tvar _this = this;\n\n\t\tif (this.delay) {\n\t\t\tthis.delayTimeoutId = setTimeout(function() {\n\t\t\t\t_this.handleDelayEnd(initialEv);\n\t\t\t}, this.delay);\n\t\t}\n\t\telse {\n\t\t\tthis.handleDelayEnd(initialEv);\n\t\t}\n\t},\n\n\n\thandleDelayEnd: function(initialEv) {\n\t\tthis.isDelayEnded = true;\n\n\t\tif (this.isDistanceSurpassed) {\n\t\t\tthis.startDrag(initialEv);\n\t\t}\n\t},\n\n\n\t// Distance\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\thandleDistanceSurpassed: function(ev) {\n\t\tthis.isDistanceSurpassed = true;\n\n\t\tif (this.isDelayEnded) {\n\t\t\tthis.startDrag(ev);\n\t\t}\n\t},\n\n\n\t// Mouse / Touch\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\thandleTouchMove: function(ev) {\n\n\t\t// prevent inertia and touchmove-scrolling while dragging\n\t\tif (this.isDragging && this.shouldCancelTouchScroll) {\n\t\t\tev.preventDefault();\n\t\t}\n\n\t\tthis.handleMove(ev);\n\t},\n\n\n\thandleMouseMove: function(ev) {\n\t\tthis.handleMove(ev);\n\t},\n\n\n\t// Scrolling (unrelated to auto-scroll)\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\thandleTouchScroll: function(ev) {\n\t\t// if the drag is being initiated by touch, but a scroll happens before\n\t\t// the drag-initiating delay is over, cancel the drag\n\t\tif (!this.isDragging || this.scrollAlwaysKills) {\n\t\t\tthis.endInteraction(ev, true); // isCancelled=true\n\t\t}\n\t},\n\n\n\t// Utils\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\t// Triggers a callback. Calls a function in the option hash of the same name.\n\t// Arguments beyond the first `name` are forwarded on.\n\ttrigger: function(name) {\n\t\tif (this.options[name]) {\n\t\t\tthis.options[name].apply(this, Array.prototype.slice.call(arguments, 1));\n\t\t}\n\t\t// makes _methods callable by event name. TODO: kill this\n\t\tif (this['_' + name]) {\n\t\t\tthis['_' + name].apply(this, Array.prototype.slice.call(arguments, 1));\n\t\t}\n\t}\n\n\n});\n\n;;\n/*\nthis.scrollEl is set in DragListener\n*/\nDragListener.mixin({\n\n\tisAutoScroll: false,\n\n\tscrollBounds: null, // { top, bottom, left, right }\n\tscrollTopVel: null, // pixels per second\n\tscrollLeftVel: null, // pixels per second\n\tscrollIntervalId: null, // ID of setTimeout for scrolling animation loop\n\n\t// defaults\n\tscrollSensitivity: 30, // pixels from edge for scrolling to start\n\tscrollSpeed: 200, // pixels per second, at maximum speed\n\tscrollIntervalMs: 50, // millisecond wait between scroll increment\n\n\n\tinitAutoScroll: function() {\n\t\tvar scrollEl = this.scrollEl;\n\n\t\tthis.isAutoScroll =\n\t\t\tthis.options.scroll &&\n\t\t\tscrollEl &&\n\t\t\t!scrollEl.is(window) &&\n\t\t\t!scrollEl.is(document);\n\n\t\tif (this.isAutoScroll) {\n\t\t\t// debounce makes sure rapid calls don't happen\n\t\t\tthis.listenTo(scrollEl, 'scroll', debounce(this.handleDebouncedScroll, 100));\n\t\t}\n\t},\n\n\n\tdestroyAutoScroll: function() {\n\t\tthis.endAutoScroll(); // kill any animation loop\n\n\t\t// remove the scroll handler if there is a scrollEl\n\t\tif (this.isAutoScroll) {\n\t\t\tthis.stopListeningTo(this.scrollEl, 'scroll'); // will probably get removed by unbindHandlers too :(\n\t\t}\n\t},\n\n\n\t// Computes and stores the bounding rectangle of scrollEl\n\tcomputeScrollBounds: function() {\n\t\tif (this.isAutoScroll) {\n\t\t\tthis.scrollBounds = getOuterRect(this.scrollEl);\n\t\t\t// TODO: use getClientRect in future. but prevents auto scrolling when on top of scrollbars\n\t\t}\n\t},\n\n\n\t// Called when the dragging is in progress and scrolling should be updated\n\tupdateAutoScroll: function(ev) {\n\t\tvar sensitivity = this.scrollSensitivity;\n\t\tvar bounds = this.scrollBounds;\n\t\tvar topCloseness, bottomCloseness;\n\t\tvar leftCloseness, rightCloseness;\n\t\tvar topVel = 0;\n\t\tvar leftVel = 0;\n\n\t\tif (bounds) { // only scroll if scrollEl exists\n\n\t\t\t// compute closeness to edges. valid range is from 0.0 - 1.0\n\t\t\ttopCloseness = (sensitivity - (getEvY(ev) - bounds.top)) / sensitivity;\n\t\t\tbottomCloseness = (sensitivity - (bounds.bottom - getEvY(ev))) / sensitivity;\n\t\t\tleftCloseness = (sensitivity - (getEvX(ev) - bounds.left)) / sensitivity;\n\t\t\trightCloseness = (sensitivity - (bounds.right - getEvX(ev))) / sensitivity;\n\n\t\t\t// translate vertical closeness into velocity.\n\t\t\t// mouse must be completely in bounds for velocity to happen.\n\t\t\tif (topCloseness >= 0 && topCloseness <= 1) {\n\t\t\t\ttopVel = topCloseness * this.scrollSpeed * -1; // negative. for scrolling up\n\t\t\t}\n\t\t\telse if (bottomCloseness >= 0 && bottomCloseness <= 1) {\n\t\t\t\ttopVel = bottomCloseness * this.scrollSpeed;\n\t\t\t}\n\n\t\t\t// translate horizontal closeness into velocity\n\t\t\tif (leftCloseness >= 0 && leftCloseness <= 1) {\n\t\t\t\tleftVel = leftCloseness * this.scrollSpeed * -1; // negative. for scrolling left\n\t\t\t}\n\t\t\telse if (rightCloseness >= 0 && rightCloseness <= 1) {\n\t\t\t\tleftVel = rightCloseness * this.scrollSpeed;\n\t\t\t}\n\t\t}\n\n\t\tthis.setScrollVel(topVel, leftVel);\n\t},\n\n\n\t// Sets the speed-of-scrolling for the scrollEl\n\tsetScrollVel: function(topVel, leftVel) {\n\n\t\tthis.scrollTopVel = topVel;\n\t\tthis.scrollLeftVel = leftVel;\n\n\t\tthis.constrainScrollVel(); // massages into realistic values\n\n\t\t// if there is non-zero velocity, and an animation loop hasn't already started, then START\n\t\tif ((this.scrollTopVel || this.scrollLeftVel) && !this.scrollIntervalId) {\n\t\t\tthis.scrollIntervalId = setInterval(\n\t\t\t\tproxy(this, 'scrollIntervalFunc'), // scope to `this`\n\t\t\t\tthis.scrollIntervalMs\n\t\t\t);\n\t\t}\n\t},\n\n\n\t// Forces scrollTopVel and scrollLeftVel to be zero if scrolling has already gone all the way\n\tconstrainScrollVel: function() {\n\t\tvar el = this.scrollEl;\n\n\t\tif (this.scrollTopVel < 0) { // scrolling up?\n\t\t\tif (el.scrollTop() <= 0) { // already scrolled all the way up?\n\t\t\t\tthis.scrollTopVel = 0;\n\t\t\t}\n\t\t}\n\t\telse if (this.scrollTopVel > 0) { // scrolling down?\n\t\t\tif (el.scrollTop() + el[0].clientHeight >= el[0].scrollHeight) { // already scrolled all the way down?\n\t\t\t\tthis.scrollTopVel = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (this.scrollLeftVel < 0) { // scrolling left?\n\t\t\tif (el.scrollLeft() <= 0) { // already scrolled all the left?\n\t\t\t\tthis.scrollLeftVel = 0;\n\t\t\t}\n\t\t}\n\t\telse if (this.scrollLeftVel > 0) { // scrolling right?\n\t\t\tif (el.scrollLeft() + el[0].clientWidth >= el[0].scrollWidth) { // already scrolled all the way right?\n\t\t\t\tthis.scrollLeftVel = 0;\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// This function gets called during every iteration of the scrolling animation loop\n\tscrollIntervalFunc: function() {\n\t\tvar el = this.scrollEl;\n\t\tvar frac = this.scrollIntervalMs / 1000; // considering animation frequency, what the vel should be mult'd by\n\n\t\t// change the value of scrollEl's scroll\n\t\tif (this.scrollTopVel) {\n\t\t\tel.scrollTop(el.scrollTop() + this.scrollTopVel * frac);\n\t\t}\n\t\tif (this.scrollLeftVel) {\n\t\t\tel.scrollLeft(el.scrollLeft() + this.scrollLeftVel * frac);\n\t\t}\n\n\t\tthis.constrainScrollVel(); // since the scroll values changed, recompute the velocities\n\n\t\t// if scrolled all the way, which causes the vels to be zero, stop the animation loop\n\t\tif (!this.scrollTopVel && !this.scrollLeftVel) {\n\t\t\tthis.endAutoScroll();\n\t\t}\n\t},\n\n\n\t// Kills any existing scrolling animation loop\n\tendAutoScroll: function() {\n\t\tif (this.scrollIntervalId) {\n\t\t\tclearInterval(this.scrollIntervalId);\n\t\t\tthis.scrollIntervalId = null;\n\n\t\t\tthis.handleScrollEnd();\n\t\t}\n\t},\n\n\n\t// Get called when the scrollEl is scrolled (NOTE: this is delayed via debounce)\n\thandleDebouncedScroll: function() {\n\t\t// recompute all coordinates, but *only* if this is *not* part of our scrolling animation\n\t\tif (!this.scrollIntervalId) {\n\t\t\tthis.handleScrollEnd();\n\t\t}\n\t},\n\n\n\t// Called when scrolling has stopped, whether through auto scroll, or the user scrolling\n\thandleScrollEnd: function() {\n\t}\n\n});\n;;\n\n/* Tracks mouse movements over a component and raises events about which hit the mouse is over.\n------------------------------------------------------------------------------------------------------------------------\noptions:\n- subjectEl\n- subjectCenter\n*/\n\nvar HitDragListener = DragListener.extend({\n\n\tcomponent: null, // converts coordinates to hits\n\t\t// methods: hitsNeeded, hitsNotNeeded, queryHit\n\n\torigHit: null, // the hit the mouse was over when listening started\n\thit: null, // the hit the mouse is over\n\tcoordAdjust: null, // delta that will be added to the mouse coordinates when computing collisions\n\n\n\tconstructor: function(component, options) {\n\t\tDragListener.call(this, options); // call the super-constructor\n\n\t\tthis.component = component;\n\t},\n\n\n\t// Called when drag listening starts (but a real drag has not necessarily began).\n\t// ev might be undefined if dragging was started manually.\n\thandleInteractionStart: function(ev) {\n\t\tvar subjectEl = this.subjectEl;\n\t\tvar subjectRect;\n\t\tvar origPoint;\n\t\tvar point;\n\n\t\tthis.component.hitsNeeded();\n\t\tthis.computeScrollBounds(); // for autoscroll\n\n\t\tif (ev) {\n\t\t\torigPoint = { left: getEvX(ev), top: getEvY(ev) };\n\t\t\tpoint = origPoint;\n\n\t\t\t// constrain the point to bounds of the element being dragged\n\t\t\tif (subjectEl) {\n\t\t\t\tsubjectRect = getOuterRect(subjectEl); // used for centering as well\n\t\t\t\tpoint = constrainPoint(point, subjectRect);\n\t\t\t}\n\n\t\t\tthis.origHit = this.queryHit(point.left, point.top);\n\n\t\t\t// treat the center of the subject as the collision point?\n\t\t\tif (subjectEl && this.options.subjectCenter) {\n\n\t\t\t\t// only consider the area the subject overlaps the hit. best for large subjects.\n\t\t\t\t// TODO: skip this if hit didn't supply left/right/top/bottom\n\t\t\t\tif (this.origHit) {\n\t\t\t\t\tsubjectRect = intersectRects(this.origHit, subjectRect) ||\n\t\t\t\t\t\tsubjectRect; // in case there is no intersection\n\t\t\t\t}\n\n\t\t\t\tpoint = getRectCenter(subjectRect);\n\t\t\t}\n\n\t\t\tthis.coordAdjust = diffPoints(point, origPoint); // point - origPoint\n\t\t}\n\t\telse {\n\t\t\tthis.origHit = null;\n\t\t\tthis.coordAdjust = null;\n\t\t}\n\n\t\t// call the super-method. do it after origHit has been computed\n\t\tDragListener.prototype.handleInteractionStart.apply(this, arguments);\n\t},\n\n\n\t// Called when the actual drag has started\n\thandleDragStart: function(ev) {\n\t\tvar hit;\n\n\t\tDragListener.prototype.handleDragStart.apply(this, arguments); // call the super-method\n\n\t\t// might be different from this.origHit if the min-distance is large\n\t\thit = this.queryHit(getEvX(ev), getEvY(ev));\n\n\t\t// report the initial hit the mouse is over\n\t\t// especially important if no min-distance and drag starts immediately\n\t\tif (hit) {\n\t\t\tthis.handleHitOver(hit);\n\t\t}\n\t},\n\n\n\t// Called when the drag moves\n\thandleDrag: function(dx, dy, ev) {\n\t\tvar hit;\n\n\t\tDragListener.prototype.handleDrag.apply(this, arguments); // call the super-method\n\n\t\thit = this.queryHit(getEvX(ev), getEvY(ev));\n\n\t\tif (!isHitsEqual(hit, this.hit)) { // a different hit than before?\n\t\t\tif (this.hit) {\n\t\t\t\tthis.handleHitOut();\n\t\t\t}\n\t\t\tif (hit) {\n\t\t\t\tthis.handleHitOver(hit);\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Called when dragging has been stopped\n\thandleDragEnd: function() {\n\t\tthis.handleHitDone();\n\t\tDragListener.prototype.handleDragEnd.apply(this, arguments); // call the super-method\n\t},\n\n\n\t// Called when a the mouse has just moved over a new hit\n\thandleHitOver: function(hit) {\n\t\tvar isOrig = isHitsEqual(hit, this.origHit);\n\n\t\tthis.hit = hit;\n\n\t\tthis.trigger('hitOver', this.hit, isOrig, this.origHit);\n\t},\n\n\n\t// Called when the mouse has just moved out of a hit\n\thandleHitOut: function() {\n\t\tif (this.hit) {\n\t\t\tthis.trigger('hitOut', this.hit);\n\t\t\tthis.handleHitDone();\n\t\t\tthis.hit = null;\n\t\t}\n\t},\n\n\n\t// Called after a hitOut. Also called before a dragStop\n\thandleHitDone: function() {\n\t\tif (this.hit) {\n\t\t\tthis.trigger('hitDone', this.hit);\n\t\t}\n\t},\n\n\n\t// Called when the interaction ends, whether there was a real drag or not\n\thandleInteractionEnd: function() {\n\t\tDragListener.prototype.handleInteractionEnd.apply(this, arguments); // call the super-method\n\n\t\tthis.origHit = null;\n\t\tthis.hit = null;\n\n\t\tthis.component.hitsNotNeeded();\n\t},\n\n\n\t// Called when scrolling has stopped, whether through auto scroll, or the user scrolling\n\thandleScrollEnd: function() {\n\t\tDragListener.prototype.handleScrollEnd.apply(this, arguments); // call the super-method\n\n\t\t// hits' absolute positions will be in new places after a user's scroll.\n\t\t// HACK for recomputing.\n\t\tif (this.isDragging) {\n\t\t\tthis.component.releaseHits();\n\t\t\tthis.component.prepareHits();\n\t\t}\n\t},\n\n\n\t// Gets the hit underneath the coordinates for the given mouse event\n\tqueryHit: function(left, top) {\n\n\t\tif (this.coordAdjust) {\n\t\t\tleft += this.coordAdjust.left;\n\t\t\ttop += this.coordAdjust.top;\n\t\t}\n\n\t\treturn this.component.queryHit(left, top);\n\t}\n\n});\n\n\n// Returns `true` if the hits are identically equal. `false` otherwise. Must be from the same component.\n// Two null values will be considered equal, as two \"out of the component\" states are the same.\nfunction isHitsEqual(hit0, hit1) {\n\n\tif (!hit0 && !hit1) {\n\t\treturn true;\n\t}\n\n\tif (hit0 && hit1) {\n\t\treturn hit0.component === hit1.component &&\n\t\t\tisHitPropsWithin(hit0, hit1) &&\n\t\t\tisHitPropsWithin(hit1, hit0); // ensures all props are identical\n\t}\n\n\treturn false;\n}\n\n\n// Returns true if all of subHit's non-standard properties are within superHit\nfunction isHitPropsWithin(subHit, superHit) {\n\tfor (var propName in subHit) {\n\t\tif (!/^(component|left|right|top|bottom)$/.test(propName)) {\n\t\t\tif (subHit[propName] !== superHit[propName]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\treturn true;\n}\n\n;;\n\n/*\nListens to document and window-level user-interaction events, like touch events and mouse events,\nand fires these events as-is to whoever is observing a GlobalEmitter.\nBest when used as a singleton via GlobalEmitter.get()\n\nNormalizes mouse/touch events. For examples:\n- ignores the the simulated mouse events that happen after a quick tap: mousemove+mousedown+mouseup+click\n- compensates for various buggy scenarios where a touchend does not fire\n*/\n\nFC.touchMouseIgnoreWait = 500;\n\nvar GlobalEmitter = Class.extend(ListenerMixin, EmitterMixin, {\n\n\tisTouching: false,\n\tmouseIgnoreDepth: 0,\n\thandleScrollProxy: null,\n\n\n\tbind: function() {\n\t\tvar _this = this;\n\n\t\tthis.listenTo($(document), {\n\t\t\ttouchstart: this.handleTouchStart,\n\t\t\ttouchcancel: this.handleTouchCancel,\n\t\t\ttouchend: this.handleTouchEnd,\n\t\t\tmousedown: this.handleMouseDown,\n\t\t\tmousemove: this.handleMouseMove,\n\t\t\tmouseup: this.handleMouseUp,\n\t\t\tclick: this.handleClick,\n\t\t\tselectstart: this.handleSelectStart,\n\t\t\tcontextmenu: this.handleContextMenu\n\t\t});\n\n\t\t// because we need to call preventDefault\n\t\t// because https://www.chromestatus.com/features/5093566007214080\n\t\t// TODO: investigate performance because this is a global handler\n\t\twindow.addEventListener(\n\t\t\t'touchmove',\n\t\t\tthis.handleTouchMoveProxy = function(ev) {\n\t\t\t\t_this.handleTouchMove($.Event(ev));\n\t\t\t},\n\t\t\t{ passive: false } // allows preventDefault()\n\t\t);\n\n\t\t// attach a handler to get called when ANY scroll action happens on the page.\n\t\t// this was impossible to do with normal on/off because 'scroll' doesn't bubble.\n\t\t// http://stackoverflow.com/a/32954565/96342\n\t\twindow.addEventListener(\n\t\t\t'scroll',\n\t\t\tthis.handleScrollProxy = function(ev) {\n\t\t\t\t_this.handleScroll($.Event(ev));\n\t\t\t},\n\t\t\ttrue // useCapture\n\t\t);\n\t},\n\n\tunbind: function() {\n\t\tthis.stopListeningTo($(document));\n\n\t\twindow.removeEventListener(\n\t\t\t'touchmove',\n\t\t\tthis.handleTouchMoveProxy\n\t\t);\n\n\t\twindow.removeEventListener(\n\t\t\t'scroll',\n\t\t\tthis.handleScrollProxy,\n\t\t\ttrue // useCapture\n\t\t);\n\t},\n\n\n\t// Touch Handlers\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\thandleTouchStart: function(ev) {\n\n\t\t// if a previous touch interaction never ended with a touchend, then implicitly end it,\n\t\t// but since a new touch interaction is about to begin, don't start the mouse ignore period.\n\t\tthis.stopTouch(ev, true); // skipMouseIgnore=true\n\n\t\tthis.isTouching = true;\n\t\tthis.trigger('touchstart', ev);\n\t},\n\n\thandleTouchMove: function(ev) {\n\t\tif (this.isTouching) {\n\t\t\tthis.trigger('touchmove', ev);\n\t\t}\n\t},\n\n\thandleTouchCancel: function(ev) {\n\t\tif (this.isTouching) {\n\t\t\tthis.trigger('touchcancel', ev);\n\n\t\t\t// Have touchcancel fire an artificial touchend. That way, handlers won't need to listen to both.\n\t\t\t// If touchend fires later, it won't have any effect b/c isTouching will be false.\n\t\t\tthis.stopTouch(ev);\n\t\t}\n\t},\n\n\thandleTouchEnd: function(ev) {\n\t\tthis.stopTouch(ev);\n\t},\n\n\n\t// Mouse Handlers\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\thandleMouseDown: function(ev) {\n\t\tif (!this.shouldIgnoreMouse()) {\n\t\t\tthis.trigger('mousedown', ev);\n\t\t}\n\t},\n\n\thandleMouseMove: function(ev) {\n\t\tif (!this.shouldIgnoreMouse()) {\n\t\t\tthis.trigger('mousemove', ev);\n\t\t}\n\t},\n\n\thandleMouseUp: function(ev) {\n\t\tif (!this.shouldIgnoreMouse()) {\n\t\t\tthis.trigger('mouseup', ev);\n\t\t}\n\t},\n\n\thandleClick: function(ev) {\n\t\tif (!this.shouldIgnoreMouse()) {\n\t\t\tthis.trigger('click', ev);\n\t\t}\n\t},\n\n\n\t// Misc Handlers\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\thandleSelectStart: function(ev) {\n\t\tthis.trigger('selectstart', ev);\n\t},\n\n\thandleContextMenu: function(ev) {\n\t\tthis.trigger('contextmenu', ev);\n\t},\n\n\thandleScroll: function(ev) {\n\t\tthis.trigger('scroll', ev);\n\t},\n\n\n\t// Utils\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\tstopTouch: function(ev, skipMouseIgnore) {\n\t\tif (this.isTouching) {\n\t\t\tthis.isTouching = false;\n\t\t\tthis.trigger('touchend', ev);\n\n\t\t\tif (!skipMouseIgnore) {\n\t\t\t\tthis.startTouchMouseIgnore();\n\t\t\t}\n\t\t}\n\t},\n\n\tstartTouchMouseIgnore: function() {\n\t\tvar _this = this;\n\t\tvar wait = FC.touchMouseIgnoreWait;\n\n\t\tif (wait) {\n\t\t\tthis.mouseIgnoreDepth++;\n\t\t\tsetTimeout(function() {\n\t\t\t\t_this.mouseIgnoreDepth--;\n\t\t\t}, wait);\n\t\t}\n\t},\n\n\tshouldIgnoreMouse: function() {\n\t\treturn this.isTouching || Boolean(this.mouseIgnoreDepth);\n\t}\n\n});\n\n\n// Singleton\n// ---------------------------------------------------------------------------------------------------------------------\n\n(function() {\n\tvar globalEmitter = null;\n\tvar neededCount = 0;\n\n\n\t// gets the singleton\n\tGlobalEmitter.get = function() {\n\n\t\tif (!globalEmitter) {\n\t\t\tglobalEmitter = new GlobalEmitter();\n\t\t\tglobalEmitter.bind();\n\t\t}\n\n\t\treturn globalEmitter;\n\t};\n\n\n\t// called when an object knows it will need a GlobalEmitter in the near future.\n\tGlobalEmitter.needed = function() {\n\t\tGlobalEmitter.get(); // ensures globalEmitter\n\t\tneededCount++;\n\t};\n\n\n\t// called when the object that originally called needed() doesn't need a GlobalEmitter anymore.\n\tGlobalEmitter.unneeded = function() {\n\t\tneededCount--;\n\n\t\tif (!neededCount) { // nobody else needs it\n\t\t\tglobalEmitter.unbind();\n\t\t\tglobalEmitter = null;\n\t\t}\n\t};\n\n})();\n\n;;\n\n/* Creates a clone of an element and lets it track the mouse as it moves\n----------------------------------------------------------------------------------------------------------------------*/\n\nvar MouseFollower = Class.extend(ListenerMixin, {\n\n\toptions: null,\n\n\tsourceEl: null, // the element that will be cloned and made to look like it is dragging\n\tel: null, // the clone of `sourceEl` that will track the mouse\n\tparentEl: null, // the element that `el` (the clone) will be attached to\n\n\t// the initial position of el, relative to the offset parent. made to match the initial offset of sourceEl\n\ttop0: null,\n\tleft0: null,\n\n\t// the absolute coordinates of the initiating touch/mouse action\n\ty0: null,\n\tx0: null,\n\n\t// the number of pixels the mouse has moved from its initial position\n\ttopDelta: null,\n\tleftDelta: null,\n\n\tisFollowing: false,\n\tisHidden: false,\n\tisAnimating: false, // doing the revert animation?\n\n\tconstructor: function(sourceEl, options) {\n\t\tthis.options = options = options || {};\n\t\tthis.sourceEl = sourceEl;\n\t\tthis.parentEl = options.parentEl ? $(options.parentEl) : sourceEl.parent(); // default to sourceEl's parent\n\t},\n\n\n\t// Causes the element to start following the mouse\n\tstart: function(ev) {\n\t\tif (!this.isFollowing) {\n\t\t\tthis.isFollowing = true;\n\n\t\t\tthis.y0 = getEvY(ev);\n\t\t\tthis.x0 = getEvX(ev);\n\t\t\tthis.topDelta = 0;\n\t\t\tthis.leftDelta = 0;\n\n\t\t\tif (!this.isHidden) {\n\t\t\t\tthis.updatePosition();\n\t\t\t}\n\n\t\t\tif (getEvIsTouch(ev)) {\n\t\t\t\tthis.listenTo($(document), 'touchmove', this.handleMove);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.listenTo($(document), 'mousemove', this.handleMove);\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Causes the element to stop following the mouse. If shouldRevert is true, will animate back to original position.\n\t// `callback` gets invoked when the animation is complete. If no animation, it is invoked immediately.\n\tstop: function(shouldRevert, callback) {\n\t\tvar _this = this;\n\t\tvar revertDuration = this.options.revertDuration;\n\n\t\tfunction complete() { // might be called by .animate(), which might change `this` context\n\t\t\t_this.isAnimating = false;\n\t\t\t_this.removeElement();\n\n\t\t\t_this.top0 = _this.left0 = null; // reset state for future updatePosition calls\n\n\t\t\tif (callback) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\n\t\tif (this.isFollowing && !this.isAnimating) { // disallow more than one stop animation at a time\n\t\t\tthis.isFollowing = false;\n\n\t\t\tthis.stopListeningTo($(document));\n\n\t\t\tif (shouldRevert && revertDuration && !this.isHidden) { // do a revert animation?\n\t\t\t\tthis.isAnimating = true;\n\t\t\t\tthis.el.animate({\n\t\t\t\t\ttop: this.top0,\n\t\t\t\t\tleft: this.left0\n\t\t\t\t}, {\n\t\t\t\t\tduration: revertDuration,\n\t\t\t\t\tcomplete: complete\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcomplete();\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Gets the tracking element. Create it if necessary\n\tgetEl: function() {\n\t\tvar el = this.el;\n\n\t\tif (!el) {\n\t\t\tel = this.el = this.sourceEl.clone()\n\t\t\t\t.addClass(this.options.additionalClass || '')\n\t\t\t\t.css({\n\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\tvisibility: '', // in case original element was hidden (commonly through hideEvents())\n\t\t\t\t\tdisplay: this.isHidden ? 'none' : '', // for when initially hidden\n\t\t\t\t\tmargin: 0,\n\t\t\t\t\tright: 'auto', // erase and set width instead\n\t\t\t\t\tbottom: 'auto', // erase and set height instead\n\t\t\t\t\twidth: this.sourceEl.width(), // explicit height in case there was a 'right' value\n\t\t\t\t\theight: this.sourceEl.height(), // explicit width in case there was a 'bottom' value\n\t\t\t\t\topacity: this.options.opacity || '',\n\t\t\t\t\tzIndex: this.options.zIndex\n\t\t\t\t});\n\n\t\t\t// we don't want long taps or any mouse interaction causing selection/menus.\n\t\t\t// would use preventSelection(), but that prevents selectstart, causing problems.\n\t\t\tel.addClass('fc-unselectable');\n\n\t\t\tel.appendTo(this.parentEl);\n\t\t}\n\n\t\treturn el;\n\t},\n\n\n\t// Removes the tracking element if it has already been created\n\tremoveElement: function() {\n\t\tif (this.el) {\n\t\t\tthis.el.remove();\n\t\t\tthis.el = null;\n\t\t}\n\t},\n\n\n\t// Update the CSS position of the tracking element\n\tupdatePosition: function() {\n\t\tvar sourceOffset;\n\t\tvar origin;\n\n\t\tthis.getEl(); // ensure this.el\n\n\t\t// make sure origin info was computed\n\t\tif (this.top0 === null) {\n\t\t\tsourceOffset = this.sourceEl.offset();\n\t\t\torigin = this.el.offsetParent().offset();\n\t\t\tthis.top0 = sourceOffset.top - origin.top;\n\t\t\tthis.left0 = sourceOffset.left - origin.left;\n\t\t}\n\n\t\tthis.el.css({\n\t\t\ttop: this.top0 + this.topDelta,\n\t\t\tleft: this.left0 + this.leftDelta\n\t\t});\n\t},\n\n\n\t// Gets called when the user moves the mouse\n\thandleMove: function(ev) {\n\t\tthis.topDelta = getEvY(ev) - this.y0;\n\t\tthis.leftDelta = getEvX(ev) - this.x0;\n\n\t\tif (!this.isHidden) {\n\t\t\tthis.updatePosition();\n\t\t}\n\t},\n\n\n\t// Temporarily makes the tracking element invisible. Can be called before following starts\n\thide: function() {\n\t\tif (!this.isHidden) {\n\t\t\tthis.isHidden = true;\n\t\t\tif (this.el) {\n\t\t\t\tthis.el.hide();\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Show the tracking element after it has been temporarily hidden\n\tshow: function() {\n\t\tif (this.isHidden) {\n\t\t\tthis.isHidden = false;\n\t\t\tthis.updatePosition();\n\t\t\tthis.getEl().show();\n\t\t}\n\t}\n\n});\n\n;;\n\n/*\nEmbodies a div that has potential scrollbars\n*/\nvar Scroller = FC.Scroller = Class.extend({\n\n\tel: null, // the guaranteed outer element\n\tscrollEl: null, // the element with the scrollbars\n\toverflowX: null,\n\toverflowY: null,\n\n\n\tconstructor: function(options) {\n\t\toptions = options || {};\n\t\tthis.overflowX = options.overflowX || options.overflow || 'auto';\n\t\tthis.overflowY = options.overflowY || options.overflow || 'auto';\n\t},\n\n\n\trender: function() {\n\t\tthis.el = this.renderEl();\n\t\tthis.applyOverflow();\n\t},\n\n\n\trenderEl: function() {\n\t\treturn (this.scrollEl = $('<div class=\"fc-scroller\"></div>'));\n\t},\n\n\n\t// sets to natural height, unlocks overflow\n\tclear: function() {\n\t\tthis.setHeight('auto');\n\t\tthis.applyOverflow();\n\t},\n\n\n\tdestroy: function() {\n\t\tthis.el.remove();\n\t},\n\n\n\t// Overflow\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tapplyOverflow: function() {\n\t\tthis.scrollEl.css({\n\t\t\t'overflow-x': this.overflowX,\n\t\t\t'overflow-y': this.overflowY\n\t\t});\n\t},\n\n\n\t// Causes any 'auto' overflow values to resolves to 'scroll' or 'hidden'.\n\t// Useful for preserving scrollbar widths regardless of future resizes.\n\t// Can pass in scrollbarWidths for optimization.\n\tlockOverflow: function(scrollbarWidths) {\n\t\tvar overflowX = this.overflowX;\n\t\tvar overflowY = this.overflowY;\n\n\t\tscrollbarWidths = scrollbarWidths || this.getScrollbarWidths();\n\n\t\tif (overflowX === 'auto') {\n\t\t\toverflowX = (\n\t\t\t\t\tscrollbarWidths.top || scrollbarWidths.bottom || // horizontal scrollbars?\n\t\t\t\t\t// OR scrolling pane with massless scrollbars?\n\t\t\t\t\tthis.scrollEl[0].scrollWidth - 1 > this.scrollEl[0].clientWidth\n\t\t\t\t\t\t// subtract 1 because of IE off-by-one issue\n\t\t\t\t) ? 'scroll' : 'hidden';\n\t\t}\n\n\t\tif (overflowY === 'auto') {\n\t\t\toverflowY = (\n\t\t\t\t\tscrollbarWidths.left || scrollbarWidths.right || // vertical scrollbars?\n\t\t\t\t\t// OR scrolling pane with massless scrollbars?\n\t\t\t\t\tthis.scrollEl[0].scrollHeight - 1 > this.scrollEl[0].clientHeight\n\t\t\t\t\t\t// subtract 1 because of IE off-by-one issue\n\t\t\t\t) ? 'scroll' : 'hidden';\n\t\t}\n\n\t\tthis.scrollEl.css({ 'overflow-x': overflowX, 'overflow-y': overflowY });\n\t},\n\n\n\t// Getters / Setters\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tsetHeight: function(height) {\n\t\tthis.scrollEl.height(height);\n\t},\n\n\n\tgetScrollTop: function() {\n\t\treturn this.scrollEl.scrollTop();\n\t},\n\n\n\tsetScrollTop: function(top) {\n\t\tthis.scrollEl.scrollTop(top);\n\t},\n\n\n\tgetClientWidth: function() {\n\t\treturn this.scrollEl[0].clientWidth;\n\t},\n\n\n\tgetClientHeight: function() {\n\t\treturn this.scrollEl[0].clientHeight;\n\t},\n\n\n\tgetScrollbarWidths: function() {\n\t\treturn getScrollbarWidths(this.scrollEl);\n\t}\n\n});\n\n;;\nfunction Iterator(items) {\n    this.items = items || [];\n}\n\n\n/* Calls a method on every item passing the arguments through */\nIterator.prototype.proxyCall = function(methodName) {\n    var args = Array.prototype.slice.call(arguments, 1);\n    var results = [];\n\n    this.items.forEach(function(item) {\n        results.push(item[methodName].apply(item, args));\n    });\n\n    return results;\n};\n\n;;\n\nvar Interaction = Class.extend({\n\n\tview: null,\n\tcomponent: null,\n\n\n\tconstructor: function(component) {\n\t\tthis.view = component._getView();\n\t\tthis.component = component;\n\t},\n\n\n\topt: function(name) {\n\t\treturn this.view.opt(name);\n\t},\n\n\n\tend: function() {\n\t\t// subclasses can implement\n\t}\n\n});\n\n;;\n\nvar DateClicking = Interaction.extend({\n\n\tdragListener: null,\n\n\n\t/*\n\tcomponent must implement:\n\t\t- bindDateHandlerToEl\n\t\t- getSafeHitFootprint\n\t\t- getHitEl\n\t*/\n\tconstructor: function(component) {\n\t\tInteraction.call(this, component);\n\n\t\tthis.dragListener = this.buildDragListener();\n\t},\n\n\n\tend: function() {\n\t\tthis.dragListener.endInteraction();\n\t},\n\n\n\tbindToEl: function(el) {\n\t\tvar component = this.component;\n\t\tvar dragListener = this.dragListener;\n\n\t\tcomponent.bindDateHandlerToEl(el, 'mousedown', function(ev) {\n\t\t\tif (!component.shouldIgnoreMouse()) {\n\t\t\t\tdragListener.startInteraction(ev);\n\t\t\t}\n\t\t});\n\n\t\tcomponent.bindDateHandlerToEl(el, 'touchstart', function(ev) {\n\t\t\tif (!component.shouldIgnoreTouch()) {\n\t\t\t\tdragListener.startInteraction(ev);\n\t\t\t}\n\t\t});\n\t},\n\n\n\t// Creates a listener that tracks the user's drag across day elements, for day clicking.\n\tbuildDragListener: function() {\n\t\tvar _this = this;\n\t\tvar component = this.component;\n\t\tvar dayClickHit; // null if invalid dayClick\n\n\t\tvar dragListener = new HitDragListener(component, {\n\t\t\tscroll: this.opt('dragScroll'),\n\t\t\tinteractionStart: function() {\n\t\t\t\tdayClickHit = dragListener.origHit;\n\t\t\t},\n\t\t\thitOver: function(hit, isOrig, origHit) {\n\t\t\t\t// if user dragged to another cell at any point, it can no longer be a dayClick\n\t\t\t\tif (!isOrig) {\n\t\t\t\t\tdayClickHit = null;\n\t\t\t\t}\n\t\t\t},\n\t\t\thitOut: function() { // called before mouse moves to a different hit OR moved out of all hits\n\t\t\t\tdayClickHit = null;\n\t\t\t},\n\t\t\tinteractionEnd: function(ev, isCancelled) {\n\t\t\t\tvar componentFootprint;\n\n\t\t\t\tif (!isCancelled && dayClickHit) {\n\t\t\t\t\tcomponentFootprint = component.getSafeHitFootprint(dayClickHit);\n\n\t\t\t\t\tif (componentFootprint) {\n\t\t\t\t\t\t_this.view.triggerDayClick(componentFootprint, component.getHitEl(dayClickHit), ev);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// because dragListener won't be called with any time delay, \"dragging\" will begin immediately,\n\t\t// which will kill any touchmoving/scrolling. Prevent this.\n\t\tdragListener.shouldCancelTouchScroll = false;\n\n\t\tdragListener.scrollAlwaysKills = true;\n\n\t\treturn dragListener;\n\t}\n\n});\n\n;;\n\nvar DateSelecting = FC.DateSelecting = Interaction.extend({\n\n\tdragListener: null,\n\n\n\t/*\n\tcomponent must implement:\n\t\t- bindDateHandlerToEl\n\t\t- getSafeHitFootprint\n\t\t- renderHighlight\n\t\t- unrenderHighlight\n\t*/\n\tconstructor: function(component) {\n\t\tInteraction.call(this, component);\n\n\t\tthis.dragListener = this.buildDragListener();\n\t},\n\n\n\tend: function() {\n\t\tthis.dragListener.endInteraction();\n\t},\n\n\n\tgetDelay: function() {\n\t\tvar delay = this.opt('selectLongPressDelay');\n\n\t\tif (delay == null) {\n\t\t\tdelay = this.opt('longPressDelay'); // fallback\n\t\t}\n\n\t\treturn delay;\n\t},\n\n\n\tbindToEl: function(el) {\n\t\tvar _this = this;\n\t\tvar component = this.component;\n\t\tvar dragListener = this.dragListener;\n\n\t\tcomponent.bindDateHandlerToEl(el, 'mousedown', function(ev) {\n\t\t\tif (_this.opt('selectable') && !component.shouldIgnoreMouse()) {\n\t\t\t\tdragListener.startInteraction(ev, {\n\t\t\t\t\tdistance: _this.opt('selectMinDistance')\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tcomponent.bindDateHandlerToEl(el, 'touchstart', function(ev) {\n\t\t\tif (_this.opt('selectable') && !component.shouldIgnoreTouch()) {\n\t\t\t\tdragListener.startInteraction(ev, {\n\t\t\t\t\tdelay: _this.getDelay()\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tpreventSelection(el);\n\t},\n\n\n\t// Creates a listener that tracks the user's drag across day elements, for day selecting.\n\tbuildDragListener: function() {\n\t\tvar _this = this;\n\t\tvar component = this.component;\n\t\tvar selectionFootprint; // null if invalid selection\n\n\t\tvar dragListener = new HitDragListener(component, {\n\t\t\tscroll: this.opt('dragScroll'),\n\t\t\tinteractionStart: function() {\n\t\t\t\tselectionFootprint = null;\n\t\t\t},\n\t\t\tdragStart: function(ev) {\n\t\t\t\t_this.view.unselect(ev); // since we could be rendering a new selection, we want to clear any old one\n\t\t\t},\n\t\t\thitOver: function(hit, isOrig, origHit) {\n\t\t\t\tvar origHitFootprint;\n\t\t\t\tvar hitFootprint;\n\n\t\t\t\tif (origHit) { // click needs to have started on a hit\n\n\t\t\t\t\torigHitFootprint = component.getSafeHitFootprint(origHit);\n\t\t\t\t\thitFootprint = component.getSafeHitFootprint(hit);\n\n\t\t\t\t\tif (origHitFootprint && hitFootprint) {\n\t\t\t\t\t\tselectionFootprint = _this.computeSelection(origHitFootprint, hitFootprint);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tselectionFootprint = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (selectionFootprint) {\n\t\t\t\t\t\tcomponent.renderSelectionFootprint(selectionFootprint);\n\t\t\t\t\t}\n\t\t\t\t\telse if (selectionFootprint === false) {\n\t\t\t\t\t\tdisableCursor();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\thitOut: function() { // called before mouse moves to a different hit OR moved out of all hits\n\t\t\t\tselectionFootprint = null;\n\t\t\t\tcomponent.unrenderSelection();\n\t\t\t},\n\t\t\thitDone: function() { // called after a hitOut OR before a dragEnd\n\t\t\t\tenableCursor();\n\t\t\t},\n\t\t\tinteractionEnd: function(ev, isCancelled) {\n\t\t\t\tif (!isCancelled && selectionFootprint) {\n\t\t\t\t\t// the selection will already have been rendered. just report it\n\t\t\t\t\t_this.view.reportSelection(selectionFootprint, ev);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn dragListener;\n\t},\n\n\n\t// Given the first and last date-spans of a selection, returns another date-span object.\n\t// Subclasses can override and provide additional data in the span object. Will be passed to renderSelectionFootprint().\n\t// Will return false if the selection is invalid and this should be indicated to the user.\n\t// Will return null/undefined if a selection invalid but no error should be reported.\n\tcomputeSelection: function(footprint0, footprint1) {\n\t\tvar wholeFootprint = this.computeSelectionFootprint(footprint0, footprint1);\n\n\t\tif (wholeFootprint && !this.isSelectionFootprintAllowed(wholeFootprint)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn wholeFootprint;\n\t},\n\n\n\t// Given two spans, must return the combination of the two.\n\t// TODO: do this separation of concerns (combining VS validation) for event dnd/resize too.\n\t// Assumes both footprints are non-open-ended.\n\tcomputeSelectionFootprint: function(footprint0, footprint1) {\n\t\tvar ms = [\n\t\t\tfootprint0.unzonedRange.startMs,\n\t\t\tfootprint0.unzonedRange.endMs,\n\t\t\tfootprint1.unzonedRange.startMs,\n\t\t\tfootprint1.unzonedRange.endMs\n\t\t];\n\n\t\tms.sort(compareNumbers);\n\n\t\treturn new ComponentFootprint(\n\t\t\tnew UnzonedRange(ms[0], ms[3]),\n\t\t\tfootprint0.isAllDay\n\t\t);\n\t},\n\n\n\tisSelectionFootprintAllowed: function(componentFootprint) {\n\t\treturn this.component.dateProfile.validUnzonedRange.containsRange(componentFootprint.unzonedRange) &&\n\t\t\tthis.view.calendar.isSelectionFootprintAllowed(componentFootprint);\n\t}\n\n});\n\n;;\n\nvar EventDragging = FC.EventDragging = Interaction.extend({\n\n\teventPointing: null,\n\tdragListener: null,\n\tisDragging: false,\n\n\n\t/*\n\tcomponent implements:\n\t\t- bindSegHandlerToEl\n\t\t- publiclyTrigger\n\t\t- diffDates\n\t\t- eventRangesToEventFootprints\n\t\t- isEventInstanceGroupAllowed\n\t*/\n\tconstructor: function(component, eventPointing) {\n\t\tInteraction.call(this, component);\n\n\t\tthis.eventPointing = eventPointing;\n\t},\n\n\n\tend: function() {\n\t\tif (this.dragListener) {\n\t\t\tthis.dragListener.endInteraction();\n\t\t}\n\t},\n\n\n\tgetSelectionDelay: function() {\n\t\tvar delay = this.opt('eventLongPressDelay');\n\n\t\tif (delay == null) {\n\t\t\tdelay = this.opt('longPressDelay'); // fallback\n\t\t}\n\n\t\treturn delay;\n\t},\n\n\n\tbindToEl: function(el) {\n\t\tvar component = this.component;\n\n\t\tcomponent.bindSegHandlerToEl(el, 'mousedown', this.handleMousedown.bind(this));\n\t\tcomponent.bindSegHandlerToEl(el, 'touchstart', this.handleTouchStart.bind(this));\n\t},\n\n\n\thandleMousedown: function(seg, ev) {\n\t\tif (this.component.canStartDrag(seg, ev)) {\n\t\t\tthis.buildDragListener(seg).startInteraction(ev, { distance: 5 });\n\t\t}\n\t},\n\n\n\thandleTouchStart: function(seg, ev) {\n\t\tvar component = this.component;\n\t\tvar settings = {\n\t\t\tdelay: this.view.isEventDefSelected(seg.footprint.eventDef) ? // already selected?\n\t\t\t\t0 : this.getSelectionDelay()\n\t\t};\n\n\t\tif (component.canStartDrag(seg, ev)) {\n\t\t\tthis.buildDragListener(seg).startInteraction(ev, settings);\n\t\t}\n\t\telse if (component.canStartSelection(seg, ev)) {\n\t\t\tthis.buildSelectListener(seg).startInteraction(ev, settings);\n\t\t}\n\t},\n\n\n\t// seg isn't draggable, but let's use a generic DragListener\n\t// simply for the delay, so it can be selected.\n\t// Has side effect of setting/unsetting `dragListener`\n\tbuildSelectListener: function(seg) {\n\t\tvar _this = this;\n\t\tvar view = this.view;\n\t\tvar eventDef = seg.footprint.eventDef;\n\t\tvar eventInstance = seg.footprint.eventInstance; // null for inverse-background events\n\n\t\tif (this.dragListener) {\n\t\t\treturn this.dragListener;\n\t\t}\n\n\t\tvar dragListener = this.dragListener = new DragListener({\n\t\t\tdragStart: function(ev) {\n\t\t\t\tif (\n\t\t\t\t\tdragListener.isTouch &&\n\t\t\t\t\t!view.isEventDefSelected(eventDef) &&\n\t\t\t\t\teventInstance\n\t\t\t\t) {\n\t\t\t\t\t// if not previously selected, will fire after a delay. then, select the event\n\t\t\t\t\tview.selectEventInstance(eventInstance);\n\t\t\t\t}\n\t\t\t},\n\t\t\tinteractionEnd: function(ev) {\n\t\t\t\t_this.dragListener = null;\n\t\t\t}\n\t\t});\n\n\t\treturn dragListener;\n\t},\n\n\n\t// Builds a listener that will track user-dragging on an event segment.\n\t// Generic enough to work with any type of Grid.\n\t// Has side effect of setting/unsetting `dragListener`\n\tbuildDragListener: function(seg) {\n\t\tvar _this = this;\n\t\tvar component = this.component;\n\t\tvar view = this.view;\n\t\tvar calendar = view.calendar;\n\t\tvar eventManager = calendar.eventManager;\n\t\tvar el = seg.el;\n\t\tvar eventDef = seg.footprint.eventDef;\n\t\tvar eventInstance = seg.footprint.eventInstance; // null for inverse-background events\n\t\tvar isDragging;\n\t\tvar mouseFollower; // A clone of the original element that will move with the mouse\n\t\tvar eventDefMutation;\n\n\t\tif (this.dragListener) {\n\t\t\treturn this.dragListener;\n\t\t}\n\n\t\t// Tracks mouse movement over the *view's* coordinate map. Allows dragging and dropping between subcomponents\n\t\t// of the view.\n\t\tvar dragListener = this.dragListener = new HitDragListener(view, {\n\t\t\tscroll: this.opt('dragScroll'),\n\t\t\tsubjectEl: el,\n\t\t\tsubjectCenter: true,\n\t\t\tinteractionStart: function(ev) {\n\t\t\t\tseg.component = component; // for renderDrag\n\t\t\t\tisDragging = false;\n\t\t\t\tmouseFollower = new MouseFollower(seg.el, {\n\t\t\t\t\tadditionalClass: 'fc-dragging',\n\t\t\t\t\tparentEl: view.el,\n\t\t\t\t\topacity: dragListener.isTouch ? null : _this.opt('dragOpacity'),\n\t\t\t\t\trevertDuration: _this.opt('dragRevertDuration'),\n\t\t\t\t\tzIndex: 2 // one above the .fc-view\n\t\t\t\t});\n\t\t\t\tmouseFollower.hide(); // don't show until we know this is a real drag\n\t\t\t\tmouseFollower.start(ev);\n\t\t\t},\n\t\t\tdragStart: function(ev) {\n\t\t\t\tif (\n\t\t\t\t\tdragListener.isTouch &&\n\t\t\t\t\t!view.isEventDefSelected(eventDef) &&\n\t\t\t\t\teventInstance\n\t\t\t\t) {\n\t\t\t\t\t// if not previously selected, will fire after a delay. then, select the event\n\t\t\t\t\tview.selectEventInstance(eventInstance);\n\t\t\t\t}\n\t\t\t\tisDragging = true;\n\n\t\t\t\t// ensure a mouseout on the manipulated event has been reported\n\t\t\t\t_this.eventPointing.handleMouseout(seg, ev);\n\n\t\t\t\t_this.segDragStart(seg, ev);\n\t\t\t\tview.hideEventsWithId(seg.footprint.eventDef.id);\n\t\t\t},\n\t\t\thitOver: function(hit, isOrig, origHit) {\n\t\t\t\tvar isAllowed = true;\n\t\t\t\tvar origFootprint;\n\t\t\t\tvar footprint;\n\t\t\t\tvar mutatedEventInstanceGroup;\n\n\t\t\t\t// starting hit could be forced (DayGrid.limit)\n\t\t\t\tif (seg.hit) {\n\t\t\t\t\torigHit = seg.hit;\n\t\t\t\t}\n\n\t\t\t\t// hit might not belong to this grid, so query origin grid\n\t\t\t\torigFootprint = origHit.component.getSafeHitFootprint(origHit);\n\t\t\t\tfootprint = hit.component.getSafeHitFootprint(hit);\n\n\t\t\t\tif (origFootprint && footprint) {\n\t\t\t\t\teventDefMutation = _this.computeEventDropMutation(origFootprint, footprint, eventDef);\n\n\t\t\t\t\tif (eventDefMutation) {\n\t\t\t\t\t\tmutatedEventInstanceGroup = eventManager.buildMutatedEventInstanceGroup(\n\t\t\t\t\t\t\teventDef.id,\n\t\t\t\t\t\t\teventDefMutation\n\t\t\t\t\t\t);\n\t\t\t\t\t\tisAllowed = component.isEventInstanceGroupAllowed(mutatedEventInstanceGroup);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tisAllowed = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tisAllowed = false;\n\t\t\t\t}\n\n\t\t\t\tif (!isAllowed) {\n\t\t\t\t\teventDefMutation = null;\n\t\t\t\t\tdisableCursor();\n\t\t\t\t}\n\n\t\t\t\t// if a valid drop location, have the subclass render a visual indication\n\t\t\t\tif (\n\t\t\t\t\teventDefMutation &&\n\t\t\t\t\tview.renderDrag( // truthy if rendered something\n\t\t\t\t\t\tcomponent.eventRangesToEventFootprints(\n\t\t\t\t\t\t\tmutatedEventInstanceGroup.sliceRenderRanges(component.dateProfile.renderUnzonedRange, calendar)\n\t\t\t\t\t\t),\n\t\t\t\t\t\tseg,\n\t\t\t\t\t\tdragListener.isTouch\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tmouseFollower.hide(); // if the subclass is already using a mock event \"helper\", hide our own\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmouseFollower.show(); // otherwise, have the helper follow the mouse (no snapping)\n\t\t\t\t}\n\n\t\t\t\tif (isOrig) {\n\t\t\t\t\t// needs to have moved hits to be a valid drop\n\t\t\t\t\teventDefMutation = null;\n\t\t\t\t}\n\t\t\t},\n\t\t\thitOut: function() { // called before mouse moves to a different hit OR moved out of all hits\n\t\t\t\tview.unrenderDrag(seg); // unrender whatever was done in renderDrag\n\t\t\t\tmouseFollower.show(); // show in case we are moving out of all hits\n\t\t\t\teventDefMutation = null;\n\t\t\t},\n\t\t\thitDone: function() { // Called after a hitOut OR before a dragEnd\n\t\t\t\tenableCursor();\n\t\t\t},\n\t\t\tinteractionEnd: function(ev) {\n\t\t\t\tdelete seg.component; // prevent side effects\n\n\t\t\t\t// do revert animation if hasn't changed. calls a callback when finished (whether animation or not)\n\t\t\t\tmouseFollower.stop(!eventDefMutation, function() {\n\t\t\t\t\tif (isDragging) {\n\t\t\t\t\t\tview.unrenderDrag(seg);\n\t\t\t\t\t\t_this.segDragStop(seg, ev);\n\t\t\t\t\t}\n\n\t\t\t\t\tview.showEventsWithId(seg.footprint.eventDef.id);\n\n\t\t\t\t\tif (eventDefMutation) {\n\t\t\t\t\t\t// no need to re-show original, will rerender all anyways. esp important if eventRenderWait\n\t\t\t\t\t\tview.reportEventDrop(eventInstance, eventDefMutation, el, ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t_this.dragListener = null;\n\t\t\t}\n\t\t});\n\n\t\treturn dragListener;\n\t},\n\n\n\t// Called before event segment dragging starts\n\tsegDragStart: function(seg, ev) {\n\t\tthis.isDragging = true;\n\t\tthis.component.publiclyTrigger('eventDragStart', {\n\t\t\tcontext: seg.el[0],\n\t\t\targs: [\n\t\t\t\tseg.footprint.getEventLegacy(),\n\t\t\t\tev,\n\t\t\t\t{}, // jqui dummy\n\t\t\t\tthis.view\n\t\t\t]\n\t\t});\n\t},\n\n\n\t// Called after event segment dragging stops\n\tsegDragStop: function(seg, ev) {\n\t\tthis.isDragging = false;\n\t\tthis.component.publiclyTrigger('eventDragStop', {\n\t\t\tcontext: seg.el[0],\n\t\t\targs: [\n\t\t\t\tseg.footprint.getEventLegacy(),\n\t\t\t\tev,\n\t\t\t\t{}, // jqui dummy\n\t\t\t\tthis.view\n\t\t\t]\n\t\t});\n\t},\n\n\n\t// DOES NOT consider overlap/constraint\n\tcomputeEventDropMutation: function(startFootprint, endFootprint, eventDef) {\n\t\tvar eventDefMutation = new EventDefMutation();\n\n\t\teventDefMutation.setDateMutation(\n\t\t\tthis.computeEventDateMutation(startFootprint, endFootprint)\n\t\t);\n\n\t\treturn eventDefMutation;\n\t},\n\n\n\tcomputeEventDateMutation: function(startFootprint, endFootprint) {\n\t\tvar date0 = startFootprint.unzonedRange.getStart();\n\t\tvar date1 = endFootprint.unzonedRange.getStart();\n\t\tvar clearEnd = false;\n\t\tvar forceTimed = false;\n\t\tvar forceAllDay = false;\n\t\tvar dateDelta;\n\t\tvar dateMutation;\n\n\t\tif (startFootprint.isAllDay !== endFootprint.isAllDay) {\n\t\t\tclearEnd = true;\n\n\t\t\tif (endFootprint.isAllDay) {\n\t\t\t\tforceAllDay = true;\n\t\t\t\tdate0.stripTime();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tforceTimed = true;\n\t\t\t}\n\t\t}\n\n\t\tdateDelta = this.component.diffDates(date1, date0);\n\n\t\tdateMutation = new EventDefDateMutation();\n\t\tdateMutation.clearEnd = clearEnd;\n\t\tdateMutation.forceTimed = forceTimed;\n\t\tdateMutation.forceAllDay = forceAllDay;\n\t\tdateMutation.setDateDelta(dateDelta);\n\n\t\treturn dateMutation;\n\t}\n\n});\n\n;;\n\nvar EventResizing = FC.EventResizing = Interaction.extend({\n\n\teventPointing: null,\n\tdragListener: null,\n\tisResizing: false,\n\n\n\t/*\n\tcomponent impements:\n\t\t- bindSegHandlerToEl\n\t\t- publiclyTrigger\n\t\t- diffDates\n\t\t- eventRangesToEventFootprints\n\t\t- isEventInstanceGroupAllowed\n\t\t- getSafeHitFootprint\n\t*/\n\n\n\tconstructor: function(component, eventPointing) {\n\t\tInteraction.call(this, component);\n\n\t\tthis.eventPointing = eventPointing;\n\t},\n\n\n\tend: function() {\n\t\tif (this.dragListener) {\n\t\t\tthis.dragListener.endInteraction();\n\t\t}\n\t},\n\n\n\tbindToEl: function(el) {\n\t\tvar component = this.component;\n\n\t\tcomponent.bindSegHandlerToEl(el, 'mousedown', this.handleMouseDown.bind(this));\n\t\tcomponent.bindSegHandlerToEl(el, 'touchstart', this.handleTouchStart.bind(this));\n\t},\n\n\n\thandleMouseDown: function(seg, ev) {\n\t\tif (this.component.canStartResize(seg, ev)) {\n\t\t\tthis.buildDragListener(seg, $(ev.target).is('.fc-start-resizer'))\n\t\t\t\t.startInteraction(ev, { distance: 5 });\n\t\t}\n\t},\n\n\n\thandleTouchStart: function(seg, ev) {\n\t\tif (this.component.canStartResize(seg, ev)) {\n\t\t\tthis.buildDragListener(seg, $(ev.target).is('.fc-start-resizer'))\n\t\t\t\t.startInteraction(ev);\n\t\t}\n\t},\n\n\n\t// Creates a listener that tracks the user as they resize an event segment.\n\t// Generic enough to work with any type of Grid.\n\tbuildDragListener: function(seg, isStart) {\n\t\tvar _this = this;\n\t\tvar component = this.component;\n\t\tvar view = this.view;\n\t\tvar calendar = view.calendar;\n\t\tvar eventManager = calendar.eventManager;\n\t\tvar el = seg.el;\n\t\tvar eventDef = seg.footprint.eventDef;\n\t\tvar eventInstance = seg.footprint.eventInstance;\n\t\tvar isDragging;\n\t\tvar resizeMutation; // zoned event date properties. falsy if invalid resize\n\n\t\t// Tracks mouse movement over the *grid's* coordinate map\n\t\tvar dragListener = this.dragListener = new HitDragListener(component, {\n\t\t\tscroll: this.opt('dragScroll'),\n\t\t\tsubjectEl: el,\n\t\t\tinteractionStart: function() {\n\t\t\t\tisDragging = false;\n\t\t\t},\n\t\t\tdragStart: function(ev) {\n\t\t\t\tisDragging = true;\n\n\t\t\t\t// ensure a mouseout on the manipulated event has been reported\n\t\t\t\t_this.eventPointing.handleMouseout(seg, ev);\n\n\t\t\t\t_this.segResizeStart(seg, ev);\n\t\t\t},\n\t\t\thitOver: function(hit, isOrig, origHit) {\n\t\t\t\tvar isAllowed = true;\n\t\t\t\tvar origHitFootprint = component.getSafeHitFootprint(origHit);\n\t\t\t\tvar hitFootprint = component.getSafeHitFootprint(hit);\n\t\t\t\tvar mutatedEventInstanceGroup;\n\n\t\t\t\tif (origHitFootprint && hitFootprint) {\n\t\t\t\t\tresizeMutation = isStart ?\n\t\t\t\t\t\t_this.computeEventStartResizeMutation(origHitFootprint, hitFootprint, seg.footprint) :\n\t\t\t\t\t\t_this.computeEventEndResizeMutation(origHitFootprint, hitFootprint, seg.footprint);\n\n\t\t\t\t\tif (resizeMutation) {\n\t\t\t\t\t\tmutatedEventInstanceGroup = eventManager.buildMutatedEventInstanceGroup(\n\t\t\t\t\t\t\teventDef.id,\n\t\t\t\t\t\t\tresizeMutation\n\t\t\t\t\t\t);\n\t\t\t\t\t\tisAllowed = component.isEventInstanceGroupAllowed(mutatedEventInstanceGroup);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tisAllowed = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tisAllowed = false;\n\t\t\t\t}\n\n\t\t\t\tif (!isAllowed) {\n\t\t\t\t\tresizeMutation = null;\n\t\t\t\t\tdisableCursor();\n\t\t\t\t}\n\t\t\t\telse if (resizeMutation.isEmpty()) {\n\t\t\t\t\t// no change. (FYI, event dates might have zones)\n\t\t\t\t\tresizeMutation = null;\n\t\t\t\t}\n\n\t\t\t\tif (resizeMutation) {\n\t\t\t\t\tview.hideEventsWithId(seg.footprint.eventDef.id);\n\t\t\t\t\tview.renderEventResize(\n\t\t\t\t\t\tcomponent.eventRangesToEventFootprints(\n\t\t\t\t\t\t\tmutatedEventInstanceGroup.sliceRenderRanges(component.dateProfile.renderUnzonedRange, calendar)\n\t\t\t\t\t\t),\n\t\t\t\t\t\tseg\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\thitOut: function() { // called before mouse moves to a different hit OR moved out of all hits\n\t\t\t\tresizeMutation = null;\n\t\t\t},\n\t\t\thitDone: function() { // resets the rendering to show the original event\n\t\t\t\tview.unrenderEventResize(seg);\n\t\t\t\tview.showEventsWithId(seg.footprint.eventDef.id);\n\t\t\t\tenableCursor();\n\t\t\t},\n\t\t\tinteractionEnd: function(ev) {\n\t\t\t\tif (isDragging) {\n\t\t\t\t\t_this.segResizeStop(seg, ev);\n\t\t\t\t}\n\n\t\t\t\tif (resizeMutation) { // valid date to resize to?\n\t\t\t\t\t// no need to re-show original, will rerender all anyways. esp important if eventRenderWait\n\t\t\t\t\tview.reportEventResize(eventInstance, resizeMutation, el, ev);\n\t\t\t\t}\n\n\t\t\t\t_this.dragListener = null;\n\t\t\t}\n\t\t});\n\n\t\treturn dragListener;\n\t},\n\n\n\t// Called before event segment resizing starts\n\tsegResizeStart: function(seg, ev) {\n\t\tthis.isResizing = true;\n\t\tthis.component.publiclyTrigger('eventResizeStart', {\n\t\t\tcontext: seg.el[0],\n\t\t\targs: [\n\t\t\t\tseg.footprint.getEventLegacy(),\n\t\t\t\tev,\n\t\t\t\t{}, // jqui dummy\n\t\t\t\tthis.view\n\t\t\t]\n\t\t});\n\t},\n\n\n\t// Called after event segment resizing stops\n\tsegResizeStop: function(seg, ev) {\n\t\tthis.isResizing = false;\n\t\tthis.component.publiclyTrigger('eventResizeStop', {\n\t\t\tcontext: seg.el[0],\n\t\t\targs: [\n\t\t\t\tseg.footprint.getEventLegacy(),\n\t\t\t\tev,\n\t\t\t\t{}, // jqui dummy\n\t\t\t\tthis.view\n\t\t\t]\n\t\t});\n\t},\n\n\n\t// Returns new date-information for an event segment being resized from its start\n\tcomputeEventStartResizeMutation: function(startFootprint, endFootprint, origEventFootprint) {\n\t\tvar origRange = origEventFootprint.componentFootprint.unzonedRange;\n\t\tvar startDelta = this.component.diffDates(\n\t\t\tendFootprint.unzonedRange.getStart(),\n\t\t\tstartFootprint.unzonedRange.getStart()\n\t\t);\n\t\tvar dateMutation;\n\t\tvar eventDefMutation;\n\n\t\tif (origRange.getStart().add(startDelta) < origRange.getEnd()) {\n\n\t\t\tdateMutation = new EventDefDateMutation();\n\t\t\tdateMutation.setStartDelta(startDelta);\n\n\t\t\teventDefMutation = new EventDefMutation();\n\t\t\teventDefMutation.setDateMutation(dateMutation);\n\n\t\t\treturn eventDefMutation;\n\t\t}\n\n\t\treturn false;\n\t},\n\n\n\t// Returns new date-information for an event segment being resized from its end\n\tcomputeEventEndResizeMutation: function(startFootprint, endFootprint, origEventFootprint) {\n\t\tvar origRange = origEventFootprint.componentFootprint.unzonedRange;\n\t\tvar endDelta = this.component.diffDates(\n\t\t\tendFootprint.unzonedRange.getEnd(),\n\t\t\tstartFootprint.unzonedRange.getEnd()\n\t\t);\n\t\tvar dateMutation;\n\t\tvar eventDefMutation;\n\n\t\tif (origRange.getEnd().add(endDelta) > origRange.getStart()) {\n\n\t\t\tdateMutation = new EventDefDateMutation();\n\t\t\tdateMutation.setEndDelta(endDelta);\n\n\t\t\teventDefMutation = new EventDefMutation();\n\t\t\teventDefMutation.setDateMutation(dateMutation);\n\n\t\t\treturn eventDefMutation;\n\t\t}\n\n\t\treturn false;\n\t}\n\n});\n\n;;\n\nvar ExternalDropping = FC.ExternalDropping = Interaction.extend(ListenerMixin, {\n\n\tdragListener: null,\n\tisDragging: false, // jqui-dragging an external element? boolean\n\n\n\t/*\n\tcomponent impements:\n\t\t- eventRangesToEventFootprints\n\t\t- isEventInstanceGroupAllowed\n\t\t- isExternalInstanceGroupAllowed\n\t\t- renderDrag\n\t\t- unrenderDrag\n\t*/\n\n\n\tend: function() {\n\t\tif (this.dragListener) {\n\t\t\tthis.dragListener.endInteraction();\n\t\t}\n\t},\n\n\n\tbindToDocument: function() {\n\t\tthis.listenTo($(document), {\n\t\t\tdragstart: this.handleDragStart, // jqui\n\t\t\tsortstart: this.handleDragStart // jqui\n\t\t});\n\t},\n\n\n\tunbindFromDocument: function() {\n\t\tthis.stopListeningTo($(document));\n\t},\n\n\n\t// Called when a jQuery UI drag is initiated anywhere in the DOM\n\thandleDragStart: function(ev, ui) {\n\t\tvar el;\n\t\tvar accept;\n\n\t\tif (this.opt('droppable')) { // only listen if this setting is on\n\t\t\tel = $((ui ? ui.item : null) || ev.target);\n\n\t\t\t// Test that the dragged element passes the dropAccept selector or filter function.\n\t\t\t// FYI, the default is \"*\" (matches all)\n\t\t\taccept = this.opt('dropAccept');\n\t\t\tif ($.isFunction(accept) ? accept.call(el[0], el) : el.is(accept)) {\n\t\t\t\tif (!this.isDragging) { // prevent double-listening if fired twice\n\t\t\t\t\tthis.listenToExternalDrag(el, ev, ui);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Called when a jQuery UI drag starts and it needs to be monitored for dropping\n\tlistenToExternalDrag: function(el, ev, ui) {\n\t\tvar _this = this;\n\t\tvar component = this.component;\n\t\tvar view = this.view;\n\t\tvar meta = getDraggedElMeta(el); // extra data about event drop, including possible event to create\n\t\tvar singleEventDef; // a null value signals an unsuccessful drag\n\n\t\t// listener that tracks mouse movement over date-associated pixel regions\n\t\tvar dragListener = _this.dragListener = new HitDragListener(component, {\n\t\t\tinteractionStart: function() {\n\t\t\t\t_this.isDragging = true;\n\t\t\t},\n\t\t\thitOver: function(hit) {\n\t\t\t\tvar isAllowed = true;\n\t\t\t\tvar hitFootprint = hit.component.getSafeHitFootprint(hit); // hit might not belong to this grid\n\t\t\t\tvar mutatedEventInstanceGroup;\n\n\t\t\t\tif (hitFootprint) {\n\t\t\t\t\tsingleEventDef = _this.computeExternalDrop(hitFootprint, meta);\n\n\t\t\t\t\tif (singleEventDef) {\n\t\t\t\t\t\tmutatedEventInstanceGroup = new EventInstanceGroup(\n\t\t\t\t\t\t\tsingleEventDef.buildInstances()\n\t\t\t\t\t\t);\n\t\t\t\t\t\tisAllowed = meta.eventProps ? // isEvent?\n\t\t\t\t\t\t\tcomponent.isEventInstanceGroupAllowed(mutatedEventInstanceGroup) :\n\t\t\t\t\t\t\tcomponent.isExternalInstanceGroupAllowed(mutatedEventInstanceGroup);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tisAllowed = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tisAllowed = false;\n\t\t\t\t}\n\n\t\t\t\tif (!isAllowed) {\n\t\t\t\t\tsingleEventDef = null;\n\t\t\t\t\tdisableCursor();\n\t\t\t\t}\n\n\t\t\t\tif (singleEventDef) {\n\t\t\t\t\tcomponent.renderDrag( // called without a seg parameter\n\t\t\t\t\t\tcomponent.eventRangesToEventFootprints(\n\t\t\t\t\t\t\tmutatedEventInstanceGroup.sliceRenderRanges(component.dateProfile.renderUnzonedRange, view.calendar)\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\thitOut: function() {\n\t\t\t\tsingleEventDef = null; // signal unsuccessful\n\t\t\t},\n\t\t\thitDone: function() { // Called after a hitOut OR before a dragEnd\n\t\t\t\tenableCursor();\n\t\t\t\tcomponent.unrenderDrag();\n\t\t\t},\n\t\t\tinteractionEnd: function(ev) {\n\n\t\t\t\tif (singleEventDef) { // element was dropped on a valid hit\n\t\t\t\t\tview.reportExternalDrop(\n\t\t\t\t\t\tsingleEventDef,\n\t\t\t\t\t\tBoolean(meta.eventProps), // isEvent\n\t\t\t\t\t\tBoolean(meta.stick), // isSticky\n\t\t\t\t\t\tel, ev, ui\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t_this.isDragging = false;\n\t\t\t\t_this.dragListener = null;\n\t\t\t}\n\t\t});\n\n\t\tdragListener.startDrag(ev); // start listening immediately\n\t},\n\n\n\t// Given a hit to be dropped upon, and misc data associated with the jqui drag (guaranteed to be a plain object),\n\t// returns the zoned start/end dates for the event that would result from the hypothetical drop. end might be null.\n\t// Returning a null value signals an invalid drop hit.\n\t// DOES NOT consider overlap/constraint.\n\t// Assumes both footprints are non-open-ended.\n\tcomputeExternalDrop: function(componentFootprint, meta) {\n\t\tvar calendar = this.view.calendar;\n\t\tvar start = FC.moment.utc(componentFootprint.unzonedRange.startMs).stripZone();\n\t\tvar end;\n\t\tvar eventDef;\n\n\t\tif (componentFootprint.isAllDay) {\n\t\t\t// if dropped on an all-day span, and element's metadata specified a time, set it\n\t\t\tif (meta.startTime) {\n\t\t\t\tstart.time(meta.startTime);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tstart.stripTime();\n\t\t\t}\n\t\t}\n\n\t\tif (meta.duration) {\n\t\t\tend = start.clone().add(meta.duration);\n\t\t}\n\n\t\tstart = calendar.applyTimezone(start);\n\n\t\tif (end) {\n\t\t\tend = calendar.applyTimezone(end);\n\t\t}\n\n\t\teventDef = SingleEventDef.parse(\n\t\t\t$.extend({}, meta.eventProps, {\n\t\t\t\tstart: start,\n\t\t\t\tend: end\n\t\t\t}),\n\t\t\tnew EventSource(calendar)\n\t\t);\n\n\t\treturn eventDef;\n\t}\n\n});\n\n\n/* External-Dragging-Element Data\n----------------------------------------------------------------------------------------------------------------------*/\n\n// Require all HTML5 data-* attributes used by FullCalendar to have this prefix.\n// A value of '' will query attributes like data-event. A value of 'fc' will query attributes like data-fc-event.\nFC.dataAttrPrefix = '';\n\n// Given a jQuery element that might represent a dragged FullCalendar event, returns an intermediate data structure\n// to be used for Event Object creation.\n// A defined `.eventProps`, even when empty, indicates that an event should be created.\nfunction getDraggedElMeta(el) {\n\tvar prefix = FC.dataAttrPrefix;\n\tvar eventProps; // properties for creating the event, not related to date/time\n\tvar startTime; // a Duration\n\tvar duration;\n\tvar stick;\n\n\tif (prefix) { prefix += '-'; }\n\teventProps = el.data(prefix + 'event') || null;\n\n\tif (eventProps) {\n\t\tif (typeof eventProps === 'object') {\n\t\t\teventProps = $.extend({}, eventProps); // make a copy\n\t\t}\n\t\telse { // something like 1 or true. still signal event creation\n\t\t\teventProps = {};\n\t\t}\n\n\t\t// pluck special-cased date/time properties\n\t\tstartTime = eventProps.start;\n\t\tif (startTime == null) { startTime = eventProps.time; } // accept 'time' as well\n\t\tduration = eventProps.duration;\n\t\tstick = eventProps.stick;\n\t\tdelete eventProps.start;\n\t\tdelete eventProps.time;\n\t\tdelete eventProps.duration;\n\t\tdelete eventProps.stick;\n\t}\n\n\t// fallback to standalone attribute values for each of the date/time properties\n\tif (startTime == null) { startTime = el.data(prefix + 'start'); }\n\tif (startTime == null) { startTime = el.data(prefix + 'time'); } // accept 'time' as well\n\tif (duration == null) { duration = el.data(prefix + 'duration'); }\n\tif (stick == null) { stick = el.data(prefix + 'stick'); }\n\n\t// massage into correct data types\n\tstartTime = startTime != null ? moment.duration(startTime) : null;\n\tduration = duration != null ? moment.duration(duration) : null;\n\tstick = Boolean(stick);\n\n\treturn { eventProps: eventProps, startTime: startTime, duration: duration, stick: stick };\n}\n\n;;\n\nvar EventPointing = FC.EventPointing = Interaction.extend({\n\n\tmousedOverSeg: null, // the segment object the user's mouse is over. null if over nothing\n\n\n\t/*\n\tcomponent must implement:\n\t\t- publiclyTrigger\n\t*/\n\n\n\tbindToEl: function(el) {\n\t\tvar component = this.component;\n\n\t\tcomponent.bindSegHandlerToEl(el, 'click', this.handleClick.bind(this));\n\t\tcomponent.bindSegHandlerToEl(el, 'mouseenter', this.handleMouseover.bind(this));\n\t\tcomponent.bindSegHandlerToEl(el, 'mouseleave', this.handleMouseout.bind(this));\n\t},\n\n\n\thandleClick: function(seg, ev) {\n\t\tvar res = this.component.publiclyTrigger('eventClick', { // can return `false` to cancel\n\t\t\tcontext: seg.el[0],\n\t\t\targs: [ seg.footprint.getEventLegacy(), ev, this.view ]\n\t\t});\n\n\t\tif (res === false) {\n\t\t\tev.preventDefault();\n\t\t}\n\t},\n\n\n\t// Updates internal state and triggers handlers for when an event element is moused over\n\thandleMouseover: function(seg, ev) {\n\t\tif (\n\t\t\t!GlobalEmitter.get().shouldIgnoreMouse() &&\n\t\t\t!this.mousedOverSeg\n\t\t) {\n\t\t\tthis.mousedOverSeg = seg;\n\n\t\t\t// TODO: move to EventSelecting's responsibility\n\t\t\tif (this.view.isEventDefResizable(seg.footprint.eventDef)) {\n\t\t\t\tseg.el.addClass('fc-allow-mouse-resize');\n\t\t\t}\n\n\t\t\tthis.component.publiclyTrigger('eventMouseover', {\n\t\t\t\tcontext: seg.el[0],\n\t\t\t\targs: [ seg.footprint.getEventLegacy(), ev, this.view ]\n\t\t\t});\n\t\t}\n\t},\n\n\n\t// Updates internal state and triggers handlers for when an event element is moused out.\n\t// Can be given no arguments, in which case it will mouseout the segment that was previously moused over.\n\thandleMouseout: function(seg, ev) {\n\t\tif (this.mousedOverSeg) {\n\t\t\tthis.mousedOverSeg = null;\n\n\t\t\t// TODO: move to EventSelecting's responsibility\n\t\t\tif (this.view.isEventDefResizable(seg.footprint.eventDef)) {\n\t\t\t\tseg.el.removeClass('fc-allow-mouse-resize');\n\t\t\t}\n\n\t\t\tthis.component.publiclyTrigger('eventMouseout', {\n\t\t\t\tcontext: seg.el[0],\n\t\t\t\targs: [\n\t\t\t\t\tseg.footprint.getEventLegacy(),\n\t\t\t\t\tev || {}, // if given no arg, make a mock mouse event\n\t\t\t\t\tthis.view\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\t},\n\n\n\tend: function() {\n\t\tif (this.mousedOverSeg) {\n\t\t\tthis.handleMouseout(this.mousedOverSeg);\n\t\t}\n\t}\n\n});\n\n;;\n\nvar StandardInteractionsMixin = FC.StandardInteractionsMixin = {\n\tdateClickingClass: DateClicking,\n\tdateSelectingClass: DateSelecting,\n\teventPointingClass: EventPointing,\n\teventDraggingClass: EventDragging,\n\teventResizingClass: EventResizing,\n\texternalDroppingClass: ExternalDropping\n};\n\n;;\n\nvar EventRenderer = FC.EventRenderer = Class.extend({\n\n\tview: null,\n\tcomponent: null,\n\tfillRenderer: null, // might remain null\n\n\tfgSegs: null,\n\tbgSegs: null,\n\n\t// derived from options\n\teventTimeFormat: null,\n\tdisplayEventTime: null,\n\tdisplayEventEnd: null,\n\n\n\tconstructor: function(component, fillRenderer) { // fillRenderer is optional\n\t\tthis.view = component._getView();\n\t\tthis.component = component;\n\t\tthis.fillRenderer = fillRenderer;\n\t},\n\n\n\topt: function(name) {\n\t\treturn this.view.opt(name);\n\t},\n\n\n\t// Updates values that rely on options and also relate to range\n\trangeUpdated: function() {\n\t\tvar displayEventTime;\n\t\tvar displayEventEnd;\n\n\t\tthis.eventTimeFormat =\n\t\t\tthis.opt('eventTimeFormat') ||\n\t\t\tthis.opt('timeFormat') || // deprecated\n\t\t\tthis.computeEventTimeFormat();\n\n\t\tdisplayEventTime = this.opt('displayEventTime');\n\t\tif (displayEventTime == null) {\n\t\t\tdisplayEventTime = this.computeDisplayEventTime(); // might be based off of range\n\t\t}\n\n\t\tdisplayEventEnd = this.opt('displayEventEnd');\n\t\tif (displayEventEnd == null) {\n\t\t\tdisplayEventEnd = this.computeDisplayEventEnd(); // might be based off of range\n\t\t}\n\n\t\tthis.displayEventTime = displayEventTime;\n\t\tthis.displayEventEnd = displayEventEnd;\n\t},\n\n\n\trender: function(eventsPayload) {\n\t\tvar dateProfile = this.component._getDateProfile();\n\t\tvar eventDefId;\n\t\tvar instanceGroup;\n\t\tvar eventRanges;\n\t\tvar bgRanges = [];\n\t\tvar fgRanges = [];\n\n\t\tfor (eventDefId in eventsPayload) {\n\t\t\tinstanceGroup = eventsPayload[eventDefId];\n\n\t\t\teventRanges = instanceGroup.sliceRenderRanges(\n\t\t\t\tdateProfile.activeUnzonedRange\n\t\t\t);\n\n\t\t\tif (instanceGroup.getEventDef().hasBgRendering()) {\n\t\t\t\tbgRanges.push.apply(bgRanges, eventRanges);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfgRanges.push.apply(fgRanges, eventRanges);\n\t\t\t}\n\t\t}\n\n\t\tthis.renderBgRanges(bgRanges);\n\t\tthis.renderFgRanges(fgRanges);\n\t},\n\n\n\tunrender: function() {\n\t\tthis.unrenderBgRanges();\n\t\tthis.unrenderFgRanges();\n\t},\n\n\n\trenderFgRanges: function(eventRanges) {\n\t\tvar eventFootprints = this.component.eventRangesToEventFootprints(eventRanges);\n\t\tvar segs = this.component.eventFootprintsToSegs(eventFootprints);\n\n\t\t// render an `.el` on each seg\n\t\t// returns a subset of the segs. segs that were actually rendered\n\t\tsegs = this.renderFgSegEls(segs);\n\n\t\tif (this.renderFgSegs(segs) !== false) { // no failure?\n\t\t\tthis.fgSegs = segs;\n\t\t}\n\t},\n\n\n\tunrenderFgRanges: function() {\n\t\tthis.unrenderFgSegs(this.fgSegs || []);\n\t\tthis.fgSegs = null;\n\t},\n\n\n\trenderBgRanges: function(eventRanges) {\n\t\tvar eventFootprints = this.component.eventRangesToEventFootprints(eventRanges);\n\t\tvar segs = this.component.eventFootprintsToSegs(eventFootprints);\n\n\t\tif (this.renderBgSegs(segs) !== false) { // no failure?\n\t\t\tthis.bgSegs = segs;\n\t\t}\n\t},\n\n\n\tunrenderBgRanges: function() {\n\t\tthis.unrenderBgSegs();\n\t\tthis.bgSegs = null;\n\t},\n\n\n\tgetSegs: function() {\n\t\treturn (this.bgSegs || []).concat(this.fgSegs || []);\n\t},\n\n\n\t// Renders foreground event segments onto the grid\n\trenderFgSegs: function(segs) {\n\t\t// subclasses must implement\n\t\t// segs already has rendered els, and has been filtered.\n\n\t\treturn false; // signal failure if not implemented\n\t},\n\n\n\t// Unrenders all currently rendered foreground segments\n\tunrenderFgSegs: function(segs) {\n\t\t// subclasses must implement\n\t},\n\n\n\trenderBgSegs: function(segs) {\n\t\tvar _this = this;\n\n\t\tif (this.fillRenderer) {\n\t\t\tthis.fillRenderer.renderSegs('bgEvent', segs, {\n\t\t\t\tgetClasses: function(seg) {\n\t\t\t\t\treturn _this.getBgClasses(seg.footprint.eventDef);\n\t\t\t\t},\n\t\t\t\tgetCss: function(seg) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'background-color': _this.getBgColor(seg.footprint.eventDef)\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tfilterEl: function(seg, el) {\n\t\t\t\t\treturn _this.filterEventRenderEl(seg.footprint, el);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\treturn false; // signal failure if no fillRenderer\n\t\t}\n\t},\n\n\n\tunrenderBgSegs: function() {\n\t\tif (this.fillRenderer) {\n\t\t\tthis.fillRenderer.unrender('bgEvent');\n\t\t}\n\t},\n\n\n\t// Renders and assigns an `el` property for each foreground event segment.\n\t// Only returns segments that successfully rendered.\n\trenderFgSegEls: function(segs, disableResizing) {\n\t\tvar _this = this;\n\t\tvar hasEventRenderHandlers = this.view.hasPublicHandlers('eventRender');\n\t\tvar html = '';\n\t\tvar renderedSegs = [];\n\t\tvar i;\n\n\t\tif (segs.length) { // don't build an empty html string\n\n\t\t\t// build a large concatenation of event segment HTML\n\t\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\t\tthis.beforeFgSegHtml(segs[i]);\n\t\t\t\thtml += this.fgSegHtml(segs[i], disableResizing);\n\t\t\t}\n\n\t\t\t// Grab individual elements from the combined HTML string. Use each as the default rendering.\n\t\t\t// Then, compute the 'el' for each segment. An el might be null if the eventRender callback returned false.\n\t\t\t$(html).each(function(i, node) {\n\t\t\t\tvar seg = segs[i];\n\t\t\t\tvar el = $(node);\n\n\t\t\t\tif (hasEventRenderHandlers) { // optimization\n\t\t\t\t\tel = _this.filterEventRenderEl(seg.footprint, el);\n\t\t\t\t}\n\n\t\t\t\tif (el) {\n\t\t\t\t\tel.data('fc-seg', seg); // used by handlers\n\t\t\t\t\tseg.el = el;\n\t\t\t\t\trenderedSegs.push(seg);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn renderedSegs;\n\t},\n\n\n\tbeforeFgSegHtml: function(seg) { // hack\n\t},\n\n\n\t// Generates the HTML for the default rendering of a foreground event segment. Used by renderFgSegEls()\n\tfgSegHtml: function(seg, disableResizing) {\n\t\t// subclasses should implement\n\t},\n\n\n\t// Generic utility for generating the HTML classNames for an event segment's element\n\tgetSegClasses: function(seg, isDraggable, isResizable) {\n\t\tvar classes = [\n\t\t\t'fc-event',\n\t\t\tseg.isStart ? 'fc-start' : 'fc-not-start',\n\t\t\tseg.isEnd ? 'fc-end' : 'fc-not-end'\n\t\t].concat(this.getClasses(seg.footprint.eventDef));\n\n\t\tif (isDraggable) {\n\t\t\tclasses.push('fc-draggable');\n\t\t}\n\t\tif (isResizable) {\n\t\t\tclasses.push('fc-resizable');\n\t\t}\n\n\t\t// event is currently selected? attach a className.\n\t\tif (this.view.isEventDefSelected(seg.footprint.eventDef)) {\n\t\t\tclasses.push('fc-selected');\n\t\t}\n\n\t\treturn classes;\n\t},\n\n\n\t// Given an event and the default element used for rendering, returns the element that should actually be used.\n\t// Basically runs events and elements through the eventRender hook.\n\tfilterEventRenderEl: function(eventFootprint, el) {\n\t\tvar legacy = eventFootprint.getEventLegacy();\n\n\t\tvar custom = this.view.publiclyTrigger('eventRender', {\n\t\t\tcontext: legacy,\n\t\t\targs: [ legacy, el, this.view ]\n\t\t});\n\n\t\tif (custom === false) { // means don't render at all\n\t\t\tel = null;\n\t\t}\n\t\telse if (custom && custom !== true) {\n\t\t\tel = $(custom);\n\t\t}\n\n\t\treturn el;\n\t},\n\n\n\t// Compute the text that should be displayed on an event's element.\n\t// `range` can be the Event object itself, or something range-like, with at least a `start`.\n\t// If event times are disabled, or the event has no time, will return a blank string.\n\t// If not specified, formatStr will default to the eventTimeFormat setting,\n\t// and displayEnd will default to the displayEventEnd setting.\n\tgetTimeText: function(eventFootprint, formatStr, displayEnd) {\n\t\treturn this._getTimeText(\n\t\t\teventFootprint.eventInstance.dateProfile.start,\n\t\t\teventFootprint.eventInstance.dateProfile.end,\n\t\t\teventFootprint.componentFootprint.isAllDay,\n\t\t\tformatStr,\n\t\t\tdisplayEnd\n\t\t);\n\t},\n\n\n\t_getTimeText: function(start, end, isAllDay, formatStr, displayEnd) {\n\t\tif (formatStr == null) {\n\t\t\tformatStr = this.eventTimeFormat;\n\t\t}\n\n\t\tif (displayEnd == null) {\n\t\t\tdisplayEnd = this.displayEventEnd;\n\t\t}\n\n\t\tif (this.displayEventTime && !isAllDay) {\n\t\t\tif (displayEnd && end) {\n\t\t\t\treturn this.view.formatRange(\n\t\t\t\t\t{ start: start, end: end },\n\t\t\t\t\tfalse, // allDay\n\t\t\t\t\tformatStr\n\t\t\t\t);\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn start.format(formatStr);\n\t\t\t}\n\t\t}\n\n\t\treturn '';\n\t},\n\n\n\tcomputeEventTimeFormat: function() {\n\t\treturn this.opt('smallTimeFormat');\n\t},\n\n\n\tcomputeDisplayEventTime: function() {\n\t\treturn true;\n\t},\n\n\n\tcomputeDisplayEventEnd: function() {\n\t\treturn true;\n\t},\n\n\n\tgetBgClasses: function(eventDef) {\n\t\tvar classNames = this.getClasses(eventDef);\n\t\tclassNames.push('fc-bgevent');\n\t\treturn classNames;\n\t},\n\n\n\tgetClasses: function(eventDef) {\n\t\tvar objs = this.getStylingObjs(eventDef);\n\t\tvar i;\n\t\tvar classNames = [];\n\n\t\tfor (i = 0; i < objs.length; i++) {\n\t\t\tclassNames.push.apply( // append\n\t\t\t\tclassNames,\n\t\t\t\tobjs[i].eventClassName || objs[i].className || []\n\t\t\t);\n\t\t}\n\n\t\treturn classNames;\n\t},\n\n\n\t// Utility for generating event skin-related CSS properties\n\tgetSkinCss: function(eventDef) {\n\t\treturn {\n\t\t\t'background-color': this.getBgColor(eventDef),\n\t\t\t'border-color': this.getBorderColor(eventDef),\n\t\t\tcolor: this.getTextColor(eventDef)\n\t\t};\n\t},\n\n\n\t// Queries for caller-specified color, then falls back to default\n\tgetBgColor: function(eventDef) {\n\t\tvar objs = this.getStylingObjs(eventDef);\n\t\tvar i;\n\t\tvar val;\n\n\t\tfor (i = 0; i < objs.length && !val; i++) {\n\t\t\tval = objs[i].eventBackgroundColor || objs[i].eventColor ||\n\t\t\t\tobjs[i].backgroundColor || objs[i].color;\n\t\t}\n\n\t\tif (!val) {\n\t\t\tval = this.opt('eventBackgroundColor') || this.opt('eventColor');\n\t\t}\n\n\t\treturn val;\n\t},\n\n\n\t// Queries for caller-specified color, then falls back to default\n\tgetBorderColor: function(eventDef) {\n\t\tvar objs = this.getStylingObjs(eventDef);\n\t\tvar i;\n\t\tvar val;\n\n\t\tfor (i = 0; i < objs.length && !val; i++) {\n\t\t\tval = objs[i].eventBorderColor || objs[i].eventColor ||\n\t\t\t\tobjs[i].borderColor || objs[i].color;\n\t\t}\n\n\t\tif (!val) {\n\t\t\tval = this.opt('eventBorderColor') || this.opt('eventColor');\n\t\t}\n\n\t\treturn val;\n\t},\n\n\n\t// Queries for caller-specified color, then falls back to default\n\tgetTextColor: function(eventDef) {\n\t\tvar objs = this.getStylingObjs(eventDef);\n\t\tvar i;\n\t\tvar val;\n\n\t\tfor (i = 0; i < objs.length && !val; i++) {\n\t\t\tval = objs[i].eventTextColor ||\n\t\t\t\tobjs[i].textColor;\n\t\t}\n\n\t\tif (!val) {\n\t\t\tval = this.opt('eventTextColor');\n\t\t}\n\n\t\treturn val;\n\t},\n\n\n\tgetStylingObjs: function(eventDef) {\n\t\tvar objs = this.getFallbackStylingObjs(eventDef);\n\t\tobjs.unshift(eventDef);\n\t\treturn objs;\n\t},\n\n\n\tgetFallbackStylingObjs: function(eventDef) {\n\t\treturn [ eventDef.source ];\n\t},\n\n\n\tsortEventSegs: function(segs) {\n\t\tsegs.sort(proxy(this, 'compareEventSegs'));\n\t},\n\n\n\t// A cmp function for determining which segments should take visual priority\n\tcompareEventSegs: function(seg1, seg2) {\n\t\tvar f1 = seg1.footprint.componentFootprint;\n\t\tvar r1 = f1.unzonedRange;\n\t\tvar f2 = seg2.footprint.componentFootprint;\n\t\tvar r2 = f2.unzonedRange;\n\n\t\treturn r1.startMs - r2.startMs || // earlier events go first\n\t\t\t(r2.endMs - r2.startMs) - (r1.endMs - r1.startMs) || // tie? longer events go first\n\t\t\tf2.isAllDay - f1.isAllDay || // tie? put all-day events first (booleans cast to 0/1)\n\t\t\tcompareByFieldSpecs(\n\t\t\t\tseg1.footprint.eventDef,\n\t\t\t\tseg2.footprint.eventDef,\n\t\t\t\tthis.view.eventOrderSpecs\n\t\t\t);\n\t}\n\n});\n\n;;\n\nvar BusinessHourRenderer = FC.BusinessHourRenderer = Class.extend({\n\n\tcomponent: null,\n\tfillRenderer: null,\n\tsegs: null,\n\n\n\t/*\n\tcomponent implements:\n\t\t- eventRangesToEventFootprints\n\t\t- eventFootprintsToSegs\n\t*/\n\tconstructor: function(component, fillRenderer) {\n\t\tthis.component = component;\n\t\tthis.fillRenderer = fillRenderer;\n\t},\n\n\n\trender: function(businessHourGenerator) {\n\t\tvar component = this.component;\n\t\tvar unzonedRange = component._getDateProfile().activeUnzonedRange;\n\n\t\tvar eventInstanceGroup = businessHourGenerator.buildEventInstanceGroup(\n\t\t\tcomponent.hasAllDayBusinessHours,\n\t\t\tunzonedRange\n\t\t);\n\n\t\tvar eventFootprints = eventInstanceGroup ?\n\t\t\tcomponent.eventRangesToEventFootprints(\n\t\t\t\teventInstanceGroup.sliceRenderRanges(unzonedRange)\n\t\t\t) :\n\t\t\t[];\n\n\t\tthis.renderEventFootprints(eventFootprints);\n\t},\n\n\n\trenderEventFootprints: function(eventFootprints) {\n\t\tvar segs = this.component.eventFootprintsToSegs(eventFootprints);\n\n\t\tthis.renderSegs(segs);\n\t\tthis.segs = segs;\n\t},\n\n\n\trenderSegs: function(segs) {\n\t\tif (this.fillRenderer) {\n\t\t\tthis.fillRenderer.renderSegs('businessHours', segs, {\n\t\t\t\tgetClasses: function(seg) {\n\t\t\t\t\treturn [ 'fc-nonbusiness', 'fc-bgevent' ];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\n\tunrender: function() {\n\t\tif (this.fillRenderer) {\n\t\t\tthis.fillRenderer.unrender('businessHours');\n\t\t}\n\n\t\tthis.segs = null;\n\t},\n\n\n\tgetSegs: function() {\n\t\treturn this.segs || [];\n\t}\n\n});\n\n;;\n\nvar FillRenderer = FC.FillRenderer = Class.extend({ // use for highlight, background events, business hours\n\n\tfillSegTag: 'div',\n\tcomponent: null,\n\telsByFill: null, // a hash of jQuery element sets used for rendering each fill. Keyed by fill name.\n\n\n\tconstructor: function(component) {\n\t\tthis.component = component;\n\t\tthis.elsByFill = {};\n\t},\n\n\n\trenderFootprint: function(type, componentFootprint, props) {\n\t\tthis.renderSegs(\n\t\t\ttype,\n\t\t\tthis.component.componentFootprintToSegs(componentFootprint),\n\t\t\tprops\n\t\t);\n\t},\n\n\n\trenderSegs: function(type, segs, props) {\n\t\tvar els;\n\n\t\tsegs = this.buildSegEls(type, segs, props); // assignes `.el` to each seg. returns successfully rendered segs\n\t\tels = this.attachSegEls(type, segs);\n\n\t\tif (els) {\n\t\t\tthis.reportEls(type, els);\n\t\t}\n\n\t\treturn segs;\n\t},\n\n\n\t// Unrenders a specific type of fill that is currently rendered on the grid\n\tunrender: function(type) {\n\t\tvar el = this.elsByFill[type];\n\n\t\tif (el) {\n\t\t\tel.remove();\n\t\t\tdelete this.elsByFill[type];\n\t\t}\n\t},\n\n\n\t// Renders and assigns an `el` property for each fill segment. Generic enough to work with different types.\n\t// Only returns segments that successfully rendered.\n\tbuildSegEls: function(type, segs, props) {\n\t\tvar _this = this;\n\t\tvar html = '';\n\t\tvar renderedSegs = [];\n\t\tvar i;\n\n\t\tif (segs.length) {\n\n\t\t\t// build a large concatenation of segment HTML\n\t\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\t\thtml += this.buildSegHtml(type, segs[i], props);\n\t\t\t}\n\n\t\t\t// Grab individual elements from the combined HTML string. Use each as the default rendering.\n\t\t\t// Then, compute the 'el' for each segment.\n\t\t\t$(html).each(function(i, node) {\n\t\t\t\tvar seg = segs[i];\n\t\t\t\tvar el = $(node);\n\n\t\t\t\t// allow custom filter methods per-type\n\t\t\t\tif (props.filterEl) {\n\t\t\t\t\tel = props.filterEl(seg, el);\n\t\t\t\t}\n\n\t\t\t\tif (el) { // custom filters did not cancel the render\n\t\t\t\t\tel = $(el); // allow custom filter to return raw DOM node\n\n\t\t\t\t\t// correct element type? (would be bad if a non-TD were inserted into a table for example)\n\t\t\t\t\tif (el.is(_this.fillSegTag)) {\n\t\t\t\t\t\tseg.el = el;\n\t\t\t\t\t\trenderedSegs.push(seg);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn renderedSegs;\n\t},\n\n\n\t// Builds the HTML needed for one fill segment. Generic enough to work with different types.\n\tbuildSegHtml: function(type, seg, props) {\n\t\t// custom hooks per-type\n\t\tvar classes = props.getClasses ? props.getClasses(seg) : [];\n\t\tvar css = cssToStr(props.getCss ? props.getCss(seg) : {});\n\n\t\treturn '<' + this.fillSegTag +\n\t\t\t(classes.length ? ' class=\"' + classes.join(' ') + '\"' : '') +\n\t\t\t(css ? ' style=\"' + css + '\"' : '') +\n\t\t\t' />';\n\t},\n\n\n\t// Should return wrapping DOM structure\n\tattachSegEls: function(type, segs) {\n\t\t// subclasses must implement\n\t},\n\n\n\treportEls: function(type, nodes) {\n\t\tif (this.elsByFill[type]) {\n\t\t\tthis.elsByFill[type] = this.elsByFill[type].add(nodes);\n\t\t}\n\t\telse {\n\t\t\tthis.elsByFill[type] = $(nodes);\n\t\t}\n\t}\n\n});\n\n;;\n\nvar HelperRenderer = FC.HelperRenderer = Class.extend({\n\n\tview: null,\n\tcomponent: null,\n\teventRenderer: null,\n\thelperEls: null,\n\n\n\tconstructor: function(component, eventRenderer) {\n\t\tthis.view = component._getView();\n\t\tthis.component = component;\n\t\tthis.eventRenderer = eventRenderer;\n\t},\n\n\n\trenderComponentFootprint: function(componentFootprint) {\n\t\tthis.renderEventFootprints([\n\t\t\tthis.fabricateEventFootprint(componentFootprint)\n\t\t]);\n\t},\n\n\n\trenderEventDraggingFootprints: function(eventFootprints, sourceSeg, isTouch) {\n\t\tthis.renderEventFootprints(\n\t\t\teventFootprints,\n\t\t\tsourceSeg,\n\t\t\t'fc-dragging',\n\t\t\tisTouch ? null : this.view.opt('dragOpacity')\n\t\t);\n\t},\n\n\n\trenderEventResizingFootprints: function(eventFootprints, sourceSeg, isTouch) {\n\t\tthis.renderEventFootprints(\n\t\t\teventFootprints,\n\t\t\tsourceSeg,\n\t\t\t'fc-resizing'\n\t\t);\n\t},\n\n\n\trenderEventFootprints: function(eventFootprints, sourceSeg, extraClassNames, opacity) {\n\t\tvar segs = this.component.eventFootprintsToSegs(eventFootprints);\n\t\tvar classNames = 'fc-helper ' + (extraClassNames || '');\n\t\tvar i;\n\n\t\t// assigns each seg's el and returns a subset of segs that were rendered\n\t\tsegs = this.eventRenderer.renderFgSegEls(segs);\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tsegs[i].el.addClass(classNames);\n\t\t}\n\n\t\tif (opacity != null) {\n\t\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\t\tsegs[i].el.css('opacity', opacity);\n\t\t\t}\n\t\t}\n\n\t\tthis.helperEls = this.renderSegs(segs, sourceSeg);\n\t},\n\n\n\t/*\n\tMust return all mock event elements\n\t*/\n\trenderSegs: function(segs, sourceSeg) {\n\t\t// Subclasses must implement\n\t},\n\n\n\tunrender: function() {\n\t\tif (this.helperEls) {\n\t\t\tthis.helperEls.remove();\n\t\t\tthis.helperEls = null;\n\t\t}\n\t},\n\n\n\tfabricateEventFootprint: function(componentFootprint) {\n\t\tvar calendar = this.view.calendar;\n\t\tvar eventDateProfile = calendar.footprintToDateProfile(componentFootprint);\n\t\tvar dummyEvent = new SingleEventDef(new EventSource(calendar));\n\t\tvar dummyInstance;\n\n\t\tdummyEvent.dateProfile = eventDateProfile;\n\t\tdummyInstance = dummyEvent.buildInstance();\n\n\t\treturn new EventFootprint(componentFootprint, dummyEvent, dummyInstance);\n\t}\n\n});\n\n;;\n\nvar Component = Model.extend({\n\n\tel: null,\n\n\n\tsetElement: function(el) {\n\t\tthis.el = el;\n\t\tthis.bindGlobalHandlers();\n\t\tthis.renderSkeleton();\n\t\tthis.set('isInDom', true);\n\t},\n\n\n\tremoveElement: function() {\n\t\tthis.unset('isInDom');\n\t\tthis.unrenderSkeleton();\n\t\tthis.unbindGlobalHandlers();\n\n\t\tthis.el.remove();\n\t\t// NOTE: don't null-out this.el in case the View was destroyed within an API callback.\n\t\t// We don't null-out the View's other jQuery element references upon destroy,\n\t\t//  so we shouldn't kill this.el either.\n\t},\n\n\n\tbindGlobalHandlers: function() {\n\t},\n\n\n\tunbindGlobalHandlers: function() {\n\t},\n\n\n\t/*\n\tNOTE: Can't have a `render` method. Read the deprecation notice in View::executeDateRender\n\t*/\n\n\n\t// Renders the basic structure of the view before any content is rendered\n\trenderSkeleton: function() {\n\t\t// subclasses should implement\n\t},\n\n\n\t// Unrenders the basic structure of the view\n\tunrenderSkeleton: function() {\n\t\t// subclasses should implement\n\t}\n\n});\n\n;;\n\nvar DateComponent = FC.DateComponent = Component.extend({\n\n\tuid: null,\n\tchildrenByUid: null,\n\tisRTL: false, // frequently accessed options\n\tnextDayThreshold: null, // \"\n\tdateProfile: null, // hack\n\n\teventRendererClass: null,\n\thelperRendererClass: null,\n\tbusinessHourRendererClass: null,\n\tfillRendererClass: null,\n\n\teventRenderer: null,\n\thelperRenderer: null,\n\tbusinessHourRenderer: null,\n\tfillRenderer: null,\n\n\thitsNeededDepth: 0, // necessary because multiple callers might need the same hits\n\n\thasAllDayBusinessHours: false, // TODO: unify with largeUnit and isTimeScale?\n\n\tisDatesRendered: false,\n\n\n\tconstructor: function() {\n\t\tComponent.call(this);\n\n\t\tthis.uid = String(DateComponent.guid++);\n\t\tthis.childrenByUid = {};\n\n\t\tthis.nextDayThreshold = moment.duration(this.opt('nextDayThreshold'));\n\t\tthis.isRTL = this.opt('isRTL');\n\n\t\tif (this.fillRendererClass) {\n\t\t\tthis.fillRenderer = new this.fillRendererClass(this);\n\t\t}\n\n\t\tif (this.eventRendererClass) { // fillRenderer is optional -----v\n\t\t\tthis.eventRenderer = new this.eventRendererClass(this, this.fillRenderer);\n\t\t}\n\n\t\tif (this.helperRendererClass && this.eventRenderer) {\n\t\t\tthis.helperRenderer = new this.helperRendererClass(this, this.eventRenderer);\n\t\t}\n\n\t\tif (this.businessHourRendererClass && this.fillRenderer) {\n\t\t\tthis.businessHourRenderer = new this.businessHourRendererClass(this, this.fillRenderer);\n\t\t}\n\t},\n\n\n\taddChild: function(child) {\n\t\tif (!this.childrenByUid[child.uid]) {\n\t\t\tthis.childrenByUid[child.uid] = child;\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n\n\n\tremoveChild: function(child) {\n\t\tif (this.childrenByUid[child.uid]) {\n\t\t\tdelete this.childrenByUid[child.uid];\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n\n\n\t// TODO: only do if isInDom?\n\t// TODO: make part of Component, along with children/batch-render system?\n\tupdateSize: function(totalHeight, isAuto, isResize) {\n\t\tthis.callChildren('updateSize', arguments);\n\t},\n\n\n\t// Options\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\topt: function(name) {\n\t\treturn this._getView().opt(name); // default implementation\n\t},\n\n\n\tpubliclyTrigger: function(/**/) {\n\t\tvar calendar = this._getCalendar();\n\n\t\treturn calendar.publiclyTrigger.apply(calendar, arguments);\n\t},\n\n\n\thasPublicHandlers: function(/**/) {\n\t\tvar calendar = this._getCalendar();\n\n\t\treturn calendar.hasPublicHandlers.apply(calendar, arguments);\n\t},\n\n\n\t// Date\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\texecuteDateRender: function(dateProfile) {\n\t\tthis.dateProfile = dateProfile; // for rendering\n\t\tthis.renderDates(dateProfile);\n\t\tthis.isDatesRendered = true;\n\t\tthis.callChildren('executeDateRender', arguments);\n\t},\n\n\n\texecuteDateUnrender: function() { // wrapper\n\t\tthis.callChildren('executeDateUnrender', arguments);\n\t\tthis.dateProfile = null;\n\t\tthis.unrenderDates();\n\t\tthis.isDatesRendered = false;\n\t},\n\n\n\t// date-cell content only\n\trenderDates: function(dateProfile) {\n\t\t// subclasses should implement\n\t},\n\n\n\t// date-cell content only\n\tunrenderDates: function() {\n\t\t// subclasses should override\n\t},\n\n\n\t// Now-Indicator\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\t// Returns a string unit, like 'second' or 'minute' that defined how often the current time indicator\n\t// should be refreshed. If something falsy is returned, no time indicator is rendered at all.\n\tgetNowIndicatorUnit: function() {\n\t\t// subclasses should implement\n\t},\n\n\n\t// Renders a current time indicator at the given datetime\n\trenderNowIndicator: function(date) {\n\t\tthis.callChildren('renderNowIndicator', arguments);\n\t},\n\n\n\t// Undoes the rendering actions from renderNowIndicator\n\tunrenderNowIndicator: function() {\n\t\tthis.callChildren('unrenderNowIndicator', arguments);\n\t},\n\n\n\t// Business Hours\n\t// ---------------------------------------------------------------------------------------------------------------\n\n\n\trenderBusinessHours: function(businessHourGenerator) {\n\t\tif (this.businessHourRenderer) {\n\t\t\tthis.businessHourRenderer.render(businessHourGenerator);\n\t\t}\n\n\t\tthis.callChildren('renderBusinessHours', arguments);\n\t},\n\n\n\t// Unrenders previously-rendered business-hours\n\tunrenderBusinessHours: function() {\n\t\tthis.callChildren('unrenderBusinessHours', arguments);\n\n\t\tif (this.businessHourRenderer) {\n\t\t\tthis.businessHourRenderer.unrender();\n\t\t}\n\t},\n\n\n\t// Event Displaying\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\texecuteEventRender: function(eventsPayload) {\n\t\tif (this.eventRenderer) {\n\t\t\tthis.eventRenderer.rangeUpdated(); // poorly named now\n\t\t\tthis.eventRenderer.render(eventsPayload);\n\t\t}\n\t\telse if (this.renderEvents) { // legacy\n\t\t\tthis.renderEvents(convertEventsPayloadToLegacyArray(eventsPayload));\n\t\t}\n\n\t\tthis.callChildren('executeEventRender', arguments);\n\t},\n\n\n\texecuteEventUnrender: function() {\n\t\tthis.callChildren('executeEventUnrender', arguments);\n\n\t\tif (this.eventRenderer) {\n\t\t\tthis.eventRenderer.unrender();\n\t\t}\n\t\telse if (this.destroyEvents) { // legacy\n\t\t\tthis.destroyEvents();\n\t\t}\n\t},\n\n\n\tgetBusinessHourSegs: function() { // recursive\n\t\tvar segs = this.getOwnBusinessHourSegs();\n\n\t\tthis.iterChildren(function(child) {\n\t\t\tsegs.push.apply(segs, child.getBusinessHourSegs());\n\t\t});\n\n\t\treturn segs;\n\t},\n\n\n\tgetOwnBusinessHourSegs: function() {\n\t\tif (this.businessHourRenderer) {\n\t\t\treturn this.businessHourRenderer.getSegs();\n\t\t}\n\n\t\treturn [];\n\t},\n\n\n\tgetEventSegs: function() { // recursive\n\t\tvar segs = this.getOwnEventSegs();\n\n\t\tthis.iterChildren(function(child) {\n\t\t\tsegs.push.apply(segs, child.getEventSegs());\n\t\t});\n\n\t\treturn segs;\n\t},\n\n\n\tgetOwnEventSegs: function() { // just for itself\n\t\tif (this.eventRenderer) {\n\t\t\treturn this.eventRenderer.getSegs();\n\t\t}\n\n\t\treturn [];\n\t},\n\n\n\t// Event Rendering Triggering\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\ttriggerAfterEventsRendered: function() {\n\t\tthis.triggerAfterEventSegsRendered(\n\t\t\tthis.getEventSegs()\n\t\t);\n\n\t\tthis.publiclyTrigger('eventAfterAllRender', {\n\t\t\tcontext: this,\n\t\t\targs: [ this ]\n\t\t});\n\t},\n\n\n\ttriggerAfterEventSegsRendered: function(segs) {\n\t\tvar _this = this;\n\n\t\t// an optimization, because getEventLegacy is expensive\n\t\tif (this.hasPublicHandlers('eventAfterRender')) {\n\t\t\tsegs.forEach(function(seg) {\n\t\t\t\tvar legacy;\n\n\t\t\t\tif (seg.el) { // necessary?\n\t\t\t\t\tlegacy = seg.footprint.getEventLegacy();\n\n\t\t\t\t\t_this.publiclyTrigger('eventAfterRender', {\n\t\t\t\t\t\tcontext: legacy,\n\t\t\t\t\t\targs: [ legacy, seg.el, _this ]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\n\ttriggerBeforeEventsDestroyed: function() {\n\t\tthis.triggerBeforeEventSegsDestroyed(\n\t\t\tthis.getEventSegs()\n\t\t);\n\t},\n\n\n\ttriggerBeforeEventSegsDestroyed: function(segs) {\n\t\tvar _this = this;\n\n\t\tif (this.hasPublicHandlers('eventDestroy')) {\n\t\t\tsegs.forEach(function(seg) {\n\t\t\t\tvar legacy;\n\n\t\t\t\tif (seg.el) { // necessary?\n\t\t\t\t\tlegacy = seg.footprint.getEventLegacy();\n\n\t\t\t\t\t_this.publiclyTrigger('eventDestroy', {\n\t\t\t\t\t\tcontext: legacy,\n\t\t\t\t\t\targs: [ legacy, seg.el, _this ]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\n\t// Event Rendering Utils\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\t// Hides all rendered event segments linked to the given event\n\t// RECURSIVE with subcomponents\n\tshowEventsWithId: function(eventDefId) {\n\n\t\tthis.getEventSegs().forEach(function(seg) {\n\t\t\tif (\n\t\t\t\tseg.footprint.eventDef.id === eventDefId &&\n\t\t\t\tseg.el // necessary?\n\t\t\t) {\n\t\t\t\tseg.el.css('visibility', '');\n\t\t\t}\n\t\t});\n\n\t\tthis.callChildren('showEventsWithId', arguments);\n\t},\n\n\n\t// Shows all rendered event segments linked to the given event\n\t// RECURSIVE with subcomponents\n\thideEventsWithId: function(eventDefId) {\n\n\t\tthis.getEventSegs().forEach(function(seg) {\n\t\t\tif (\n\t\t\t\tseg.footprint.eventDef.id === eventDefId &&\n\t\t\t\tseg.el // necessary?\n\t\t\t) {\n\t\t\t\tseg.el.css('visibility', 'hidden');\n\t\t\t}\n\t\t});\n\n\t\tthis.callChildren('hideEventsWithId', arguments);\n\t},\n\n\n\t// Drag-n-Drop Rendering (for both events and external elements)\n\t// ---------------------------------------------------------------------------------------------------------------\n\n\n\t// Renders a visual indication of a event or external-element drag over the given drop zone.\n\t// If an external-element, seg will be `null`.\n\t// Must return elements used for any mock events.\n\trenderDrag: function(eventFootprints, seg, isTouch) {\n\t\tvar renderedHelper = false;\n\n\t\tthis.iterChildren(function(child) {\n\t\t\tif (child.renderDrag(eventFootprints, seg, isTouch)) {\n\t\t\t\trenderedHelper = true;\n\t\t\t}\n\t\t});\n\n\t\treturn renderedHelper;\n\t},\n\n\n\t// Unrenders a visual indication of an event or external-element being dragged.\n\tunrenderDrag: function() {\n\t\tthis.callChildren('unrenderDrag', arguments);\n\t},\n\n\n\t// Event Resizing\n\t// ---------------------------------------------------------------------------------------------------------------\n\n\n\t// Renders a visual indication of an event being resized.\n\trenderEventResize: function(eventFootprints, seg, isTouch) {\n\t\tthis.callChildren('renderEventResize', arguments);\n\t},\n\n\n\t// Unrenders a visual indication of an event being resized.\n\tunrenderEventResize: function() {\n\t\tthis.callChildren('unrenderEventResize', arguments);\n\t},\n\n\n\t// Selection\n\t// ---------------------------------------------------------------------------------------------------------------\n\n\n\t// Renders a visual indication of the selection\n\t// TODO: rename to `renderSelection` after legacy is gone\n\trenderSelectionFootprint: function(componentFootprint) {\n\t\tthis.renderHighlight(componentFootprint);\n\n\t\tthis.callChildren('renderSelectionFootprint', arguments);\n\t},\n\n\n\t// Unrenders a visual indication of selection\n\tunrenderSelection: function() {\n\t\tthis.unrenderHighlight();\n\n\t\tthis.callChildren('unrenderSelection', arguments);\n\t},\n\n\n\t// Highlight\n\t// ---------------------------------------------------------------------------------------------------------------\n\n\n\t// Renders an emphasis on the given date range. Given a span (unzoned start/end and other misc data)\n\trenderHighlight: function(componentFootprint) {\n\t\tif (this.fillRenderer) {\n\t\t\tthis.fillRenderer.renderFootprint(\n\t\t\t\t'highlight',\n\t\t\t\tcomponentFootprint,\n\t\t\t\t{\n\t\t\t\t\tgetClasses: function() {\n\t\t\t\t\t\treturn [ 'fc-highlight' ];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.callChildren('renderHighlight', arguments);\n\t},\n\n\n\t// Unrenders the emphasis on a date range\n\tunrenderHighlight: function() {\n\t\tif (this.fillRenderer) {\n\t\t\tthis.fillRenderer.unrender('highlight');\n\t\t}\n\n\t\tthis.callChildren('unrenderHighlight', arguments);\n\t},\n\n\n\t// Hit Areas\n\t// ---------------------------------------------------------------------------------------------------------------\n\t// just because all DateComponents support this interface\n\t// doesn't mean they need to have their own internal coord system. they can defer to sub-components.\n\n\n\thitsNeeded: function() {\n\t\tif (!(this.hitsNeededDepth++)) {\n\t\t\tthis.prepareHits();\n\t\t}\n\n\t\tthis.callChildren('hitsNeeded', arguments);\n\t},\n\n\n\thitsNotNeeded: function() {\n\t\tif (this.hitsNeededDepth && !(--this.hitsNeededDepth)) {\n\t\t\tthis.releaseHits();\n\t\t}\n\n\t\tthis.callChildren('hitsNotNeeded', arguments);\n\t},\n\n\n\tprepareHits: function() {\n\t\t// subclasses can implement\n\t},\n\n\n\treleaseHits: function() {\n\t\t// subclasses can implement\n\t},\n\n\n\t// Given coordinates from the topleft of the document, return data about the date-related area underneath.\n\t// Can return an object with arbitrary properties (although top/right/left/bottom are encouraged).\n\t// Must have a `grid` property, a reference to this current grid. TODO: avoid this\n\t// The returned object will be processed by getHitFootprint and getHitEl.\n\tqueryHit: function(leftOffset, topOffset) {\n\t\tvar childrenByUid = this.childrenByUid;\n\t\tvar uid;\n\t\tvar hit;\n\n\t\tfor (uid in childrenByUid) {\n\t\t\thit = childrenByUid[uid].queryHit(leftOffset, topOffset);\n\n\t\t\tif (hit) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn hit;\n\t},\n\n\n\tgetSafeHitFootprint: function(hit) {\n\t\tvar footprint = this.getHitFootprint(hit);\n\n\t\tif (!this.dateProfile.activeUnzonedRange.containsRange(footprint.unzonedRange)) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn footprint;\n\t},\n\n\n\tgetHitFootprint: function(hit) {\n\t},\n\n\n\t// Given position-level information about a date-related area within the grid,\n\t// should return a jQuery element that best represents it. passed to dayClick callback.\n\tgetHitEl: function(hit) {\n\t},\n\n\n\t/* Converting eventRange -> eventFootprint\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\teventRangesToEventFootprints: function(eventRanges) {\n\t\tvar eventFootprints = [];\n\t\tvar i;\n\n\t\tfor (i = 0; i < eventRanges.length; i++) {\n\t\t\teventFootprints.push.apply( // append\n\t\t\t\teventFootprints,\n\t\t\t\tthis.eventRangeToEventFootprints(eventRanges[i])\n\t\t\t);\n\t\t}\n\n\t\treturn eventFootprints;\n\t},\n\n\n\teventRangeToEventFootprints: function(eventRange) {\n\t\treturn [ eventRangeToEventFootprint(eventRange) ];\n\t},\n\n\n\t/* Converting componentFootprint/eventFootprint -> segs\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\teventFootprintsToSegs: function(eventFootprints) {\n\t\tvar segs = [];\n\t\tvar i;\n\n\t\tfor (i = 0; i < eventFootprints.length; i++) {\n\t\t\tsegs.push.apply(segs,\n\t\t\t\tthis.eventFootprintToSegs(eventFootprints[i])\n\t\t\t);\n\t\t}\n\n\t\treturn segs;\n\t},\n\n\n\t// Given an event's span (unzoned start/end and other misc data), and the event itself,\n\t// slices into segments and attaches event-derived properties to them.\n\t// eventSpan - { start, end, isStart, isEnd, otherthings... }\n\teventFootprintToSegs: function(eventFootprint) {\n\t\tvar unzonedRange = eventFootprint.componentFootprint.unzonedRange;\n\t\tvar segs;\n\t\tvar i, seg;\n\n\t\tsegs = this.componentFootprintToSegs(eventFootprint.componentFootprint);\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tseg = segs[i];\n\n\t\t\tif (!unzonedRange.isStart) {\n\t\t\t\tseg.isStart = false;\n\t\t\t}\n\t\t\tif (!unzonedRange.isEnd) {\n\t\t\t\tseg.isEnd = false;\n\t\t\t}\n\n\t\t\tseg.footprint = eventFootprint;\n\t\t\t// TODO: rename to seg.eventFootprint\n\t\t}\n\n\t\treturn segs;\n\t},\n\n\n\tcomponentFootprintToSegs: function(componentFootprint) {\n\t\treturn [];\n\t},\n\n\n\t// Utils\n\t// ---------------------------------------------------------------------------------------------------------------\n\n\n\tcallChildren: function(methodName, args) {\n\t\tthis.iterChildren(function(child) {\n\t\t\tchild[methodName].apply(child, args);\n\t\t});\n\t},\n\n\n\titerChildren: function(func) {\n\t\tvar childrenByUid = this.childrenByUid;\n\t\tvar uid;\n\n\t\tfor (uid in childrenByUid) {\n\t\t\tfunc(childrenByUid[uid]);\n\t\t}\n\t},\n\n\n\t_getCalendar: function() { // TODO: strip out. move to generic parent.\n\t\treturn this.calendar || this.view.calendar;\n\t},\n\n\n\t_getView: function() { // TODO: strip out. move to generic parent.\n\t\treturn this.view;\n\t},\n\n\n\t_getDateProfile: function() {\n\t\treturn this._getView().get('dateProfile');\n\t}\n\n});\n\n\nDateComponent.guid = 0; // TODO: better system for this?\n\n\n// legacy\n\nfunction convertEventsPayloadToLegacyArray(eventsPayload) {\n\tvar eventDefId;\n\tvar eventInstances;\n\tvar legacyEvents = [];\n\tvar i;\n\n\tfor (eventDefId in eventsPayload) {\n\t\teventInstances = eventsPayload[eventDefId].eventInstances;\n\n\t\tfor (i = 0; i < eventInstances.length; i++) {\n\t\t\tlegacyEvents.push(\n\t\t\t\teventInstances[i].toLegacy()\n\t\t\t);\n\t\t}\n\t}\n\n\treturn legacyEvents;\n}\n\n;;\n\nDateComponent.mixin({\n\n\t// Generates HTML for an anchor to another view into the calendar.\n\t// Will either generate an <a> tag or a non-clickable <span> tag, depending on enabled settings.\n\t// `gotoOptions` can either be a moment input, or an object with the form:\n\t// { date, type, forceOff }\n\t// `type` is a view-type like \"day\" or \"week\". default value is \"day\".\n\t// `attrs` and `innerHtml` are use to generate the rest of the HTML tag.\n\tbuildGotoAnchorHtml: function(gotoOptions, attrs, innerHtml) {\n\t\tvar date, type, forceOff;\n\t\tvar finalOptions;\n\n\t\tif ($.isPlainObject(gotoOptions)) {\n\t\t\tdate = gotoOptions.date;\n\t\t\ttype = gotoOptions.type;\n\t\t\tforceOff = gotoOptions.forceOff;\n\t\t}\n\t\telse {\n\t\t\tdate = gotoOptions; // a single moment input\n\t\t}\n\t\tdate = FC.moment(date); // if a string, parse it\n\n\t\tfinalOptions = { // for serialization into the link\n\t\t\tdate: date.format('YYYY-MM-DD'),\n\t\t\ttype: type || 'day'\n\t\t};\n\n\t\tif (typeof attrs === 'string') {\n\t\t\tinnerHtml = attrs;\n\t\t\tattrs = null;\n\t\t}\n\n\t\tattrs = attrs ? ' ' + attrsToStr(attrs) : ''; // will have a leading space\n\t\tinnerHtml = innerHtml || '';\n\n\t\tif (!forceOff && this.opt('navLinks')) {\n\t\t\treturn '<a' + attrs +\n\t\t\t\t' data-goto=\"' + htmlEscape(JSON.stringify(finalOptions)) + '\">' +\n\t\t\t\tinnerHtml +\n\t\t\t\t'</a>';\n\t\t}\n\t\telse {\n\t\t\treturn '<span' + attrs + '>' +\n\t\t\t\tinnerHtml +\n\t\t\t\t'</span>';\n\t\t}\n\t},\n\n\n\tgetAllDayHtml: function() {\n\t\treturn this.opt('allDayHtml') || htmlEscape(this.opt('allDayText'));\n\t},\n\n\n\t// Computes HTML classNames for a single-day element\n\tgetDayClasses: function(date, noThemeHighlight) {\n\t\tvar view = this._getView();\n\t\tvar classes = [];\n\t\tvar today;\n\n\t\tif (!this.dateProfile.activeUnzonedRange.containsDate(date)) {\n\t\t\tclasses.push('fc-disabled-day'); // TODO: jQuery UI theme?\n\t\t}\n\t\telse {\n\t\t\tclasses.push('fc-' + dayIDs[date.day()]);\n\n\t\t\tif (view.isDateInOtherMonth(date, this.dateProfile)) { // TODO: use DateComponent subclass somehow\n\t\t\t\tclasses.push('fc-other-month');\n\t\t\t}\n\n\t\t\ttoday = view.calendar.getNow();\n\n\t\t\tif (date.isSame(today, 'day')) {\n\t\t\t\tclasses.push('fc-today');\n\n\t\t\t\tif (noThemeHighlight !== true) {\n\t\t\t\t\tclasses.push(view.calendar.theme.getClass('today'));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (date < today) {\n\t\t\t\tclasses.push('fc-past');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tclasses.push('fc-future');\n\t\t\t}\n\t\t}\n\n\t\treturn classes;\n\t},\n\n\n\t// Utility for formatting a range. Accepts a range object, formatting string, and optional separator.\n\t// Displays all-day ranges naturally, with an inclusive end. Takes the current isRTL into account.\n\t// The timezones of the dates within `range` will be respected.\n\tformatRange: function(range, isAllDay, formatStr, separator) {\n\t\tvar end = range.end;\n\n\t\tif (isAllDay) {\n\t\t\tend = end.clone().subtract(1); // convert to inclusive. last ms of previous day\n\t\t}\n\n\t\treturn formatRange(range.start, end, formatStr, separator, this.isRTL);\n\t},\n\n\n\t// Compute the number of the give units in the \"current\" range.\n\t// Will return a floating-point number. Won't round.\n\tcurrentRangeAs: function(unit) {\n\t\treturn this._getDateProfile().currentUnzonedRange.as(unit);\n\t},\n\n\n\t// Returns the date range of the full days the given range visually appears to occupy.\n\t// Returns a plain object with start/end, NOT an UnzonedRange!\n\tcomputeDayRange: function(unzonedRange) {\n\t\tvar calendar = this._getCalendar();\n\t\tvar startDay = calendar.msToUtcMoment(unzonedRange.startMs, true); // the beginning of the day the range starts\n\t\tvar end = calendar.msToUtcMoment(unzonedRange.endMs);\n\t\tvar endTimeMS = +end.time(); // # of milliseconds into `endDay`\n\t\tvar endDay = end.clone().stripTime(); // the beginning of the day the range exclusively ends\n\n\t\t// If the end time is actually inclusively part of the next day and is equal to or\n\t\t// beyond the next day threshold, adjust the end to be the exclusive end of `endDay`.\n\t\t// Otherwise, leaving it as inclusive will cause it to exclude `endDay`.\n\t\tif (endTimeMS && endTimeMS >= this.nextDayThreshold) {\n\t\t\tendDay.add(1, 'days');\n\t\t}\n\n\t\t// If end is within `startDay` but not past nextDayThreshold, assign the default duration of one day.\n\t\tif (endDay <= startDay) {\n\t\t\tendDay = startDay.clone().add(1, 'days');\n\t\t}\n\n\t\treturn { start: startDay, end: endDay };\n\t},\n\n\n\t// Does the given range visually appear to occupy more than one day?\n\tisMultiDayRange: function(unzonedRange) {\n\t\tvar dayRange = this.computeDayRange(unzonedRange);\n\n\t\treturn dayRange.end.diff(dayRange.start, 'days') > 1;\n\t}\n\n});\n\n;;\n\nvar InteractiveDateComponent = FC.InteractiveDateComponent = DateComponent.extend({\n\n\tdateClickingClass: null,\n\tdateSelectingClass: null,\n\teventPointingClass: null,\n\teventDraggingClass: null,\n\teventResizingClass: null,\n\texternalDroppingClass: null,\n\n\tdateClicking: null,\n\tdateSelecting: null,\n\teventPointing: null,\n\teventDragging: null,\n\teventResizing: null,\n\texternalDropping: null,\n\n\t// self-config, overridable by subclasses\n\tsegSelector: '.fc-event-container > *', // what constitutes an event element?\n\n\t// if defined, holds the unit identified (ex: \"year\" or \"month\") that determines the level of granularity\n\t// of the date areas. if not defined, assumes to be day and time granularity.\n\t// TODO: port isTimeScale into same system?\n\tlargeUnit: null,\n\n\n\tconstructor: function() {\n\t\tDateComponent.call(this);\n\n\t\tif (this.dateSelectingClass) {\n\t\t\tthis.dateClicking = new this.dateClickingClass(this);\n\t\t}\n\n\t\tif (this.dateSelectingClass) {\n\t\t\tthis.dateSelecting = new this.dateSelectingClass(this);\n\t\t}\n\n\t\tif (this.eventPointingClass) {\n\t\t\tthis.eventPointing = new this.eventPointingClass(this);\n\t\t}\n\n\t\tif (this.eventDraggingClass && this.eventPointing) {\n\t\t\tthis.eventDragging = new this.eventDraggingClass(this, this.eventPointing);\n\t\t}\n\n\t\tif (this.eventResizingClass && this.eventPointing) {\n\t\t\tthis.eventResizing = new this.eventResizingClass(this, this.eventPointing);\n\t\t}\n\n\t\tif (this.externalDroppingClass) {\n\t\t\tthis.externalDropping = new this.externalDroppingClass(this);\n\t\t}\n\t},\n\n\n\t// Sets the container element that the view should render inside of, does global DOM-related initializations,\n\t// and renders all the non-date-related content inside.\n\tsetElement: function(el) {\n\t\tDateComponent.prototype.setElement.apply(this, arguments);\n\n\t\tif (this.dateClicking) {\n\t\t\tthis.dateClicking.bindToEl(el);\n\t\t}\n\n\t\tif (this.dateSelecting) {\n\t\t\tthis.dateSelecting.bindToEl(el);\n\t\t}\n\n\t\tthis.bindAllSegHandlersToEl(el);\n\t},\n\n\n\tunrender: function() {\n\t\tthis.endInteractions();\n\n\t\tDateComponent.prototype.unrender.apply(this, arguments);\n\t},\n\n\n\texecuteEventUnrender: function() {\n\t\tthis.endInteractions();\n\n\t\tDateComponent.prototype.executeEventUnrender.apply(this, arguments);\n\t},\n\n\n\tbindGlobalHandlers: function() {\n\t\tDateComponent.prototype.bindGlobalHandlers.apply(this, arguments);\n\n\t\tif (this.externalDropping) {\n\t\t\tthis.externalDropping.bindToDocument();\n\t\t}\n\t},\n\n\n\tunbindGlobalHandlers: function() {\n\t\tDateComponent.prototype.unbindGlobalHandlers.apply(this, arguments);\n\n\t\tif (this.externalDropping) {\n\t\t\tthis.externalDropping.unbindFromDocument();\n\t\t}\n\t},\n\n\n\tbindDateHandlerToEl: function(el, name, handler) {\n\t\tvar _this = this;\n\n\t\t// attach a handler to the grid's root element.\n\t\t// jQuery will take care of unregistering them when removeElement gets called.\n\t\tthis.el.on(name, function(ev) {\n\t\t\tif (\n\t\t\t\t!$(ev.target).is(\n\t\t\t\t\t_this.segSelector + ',' + // directly on an event element\n\t\t\t\t\t_this.segSelector + ' *,' + // within an event element\n\t\t\t\t\t'.fc-more,' + // a \"more..\" link\n\t\t\t\t\t'a[data-goto]' // a clickable nav link\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn handler.call(_this, ev);\n\t\t\t}\n\t\t});\n\t},\n\n\n\tbindAllSegHandlersToEl: function(el) {\n\t\t[\n\t\t\tthis.eventPointing,\n\t\t\tthis.eventDragging,\n\t\t\tthis.eventResizing\n\t\t].forEach(function(eventInteraction) {\n\t\t\tif (eventInteraction) {\n\t\t\t\teventInteraction.bindToEl(el);\n\t\t\t}\n\t\t});\n\t},\n\n\n\tbindSegHandlerToEl: function(el, name, handler) {\n\t\tvar _this = this;\n\n\t\tel.on(name, this.segSelector, function(ev) {\n\t\t\tvar seg = $(this).data('fc-seg'); // grab segment data. put there by View::renderEventsPayload\n\n\t\t\tif (seg && !_this.shouldIgnoreEventPointing()) {\n\t\t\t\treturn handler.call(_this, seg, ev); // context will be the Grid\n\t\t\t}\n\t\t});\n\t},\n\n\n\tshouldIgnoreMouse: function() {\n\t\t// HACK\n\t\t// This will still work even though bindDateHandlerToEl doesn't use GlobalEmitter.\n\t\treturn GlobalEmitter.get().shouldIgnoreMouse();\n\t},\n\n\n\tshouldIgnoreTouch: function() {\n\t\tvar view = this._getView();\n\n\t\t// On iOS (and Android?) when a new selection is initiated overtop another selection,\n\t\t// the touchend never fires because the elements gets removed mid-touch-interaction (my theory).\n\t\t// HACK: simply don't allow this to happen.\n\t\t// ALSO: prevent selection when an *event* is already raised.\n\t\treturn view.isSelected || view.selectedEvent;\n\t},\n\n\n\tshouldIgnoreEventPointing: function() {\n\t\t// only call the handlers if there is not a drag/resize in progress\n\t\treturn (this.eventDragging && this.eventDragging.isDragging) ||\n\t\t\t(this.eventResizing && this.eventResizing.isResizing);\n\t},\n\n\n\tcanStartSelection: function(seg, ev) {\n\t\treturn getEvIsTouch(ev) &&\n\t\t\t!this.canStartResize(seg, ev) &&\n\t\t\t(this.isEventDefDraggable(seg.footprint.eventDef) ||\n\t\t\t this.isEventDefResizable(seg.footprint.eventDef));\n\t},\n\n\n\tcanStartDrag: function(seg, ev) {\n\t\treturn !this.canStartResize(seg, ev) &&\n\t\t\tthis.isEventDefDraggable(seg.footprint.eventDef);\n\t},\n\n\n\tcanStartResize: function(seg, ev) {\n\t\tvar view = this._getView();\n\t\tvar eventDef = seg.footprint.eventDef;\n\n\t\treturn (!getEvIsTouch(ev) || view.isEventDefSelected(eventDef)) &&\n\t\t\tthis.isEventDefResizable(eventDef) &&\n\t\t\t$(ev.target).is('.fc-resizer');\n\t},\n\n\n\t// Kills all in-progress dragging.\n\t// Useful for when public API methods that result in re-rendering are invoked during a drag.\n\t// Also useful for when touch devices misbehave and don't fire their touchend.\n\tendInteractions: function() {\n\t\t[\n\t\t\tthis.dateClicking,\n\t\t\tthis.dateSelecting,\n\t\t\tthis.eventPointing,\n\t\t\tthis.eventDragging,\n\t\t\tthis.eventResizing\n\t\t].forEach(function(interaction) {\n\t\t\tif (interaction) {\n\t\t\t\tinteraction.end();\n\t\t\t}\n\t\t});\n\t},\n\n\n\t// Event Drag-n-Drop\n\t// ---------------------------------------------------------------------------------------------------------------\n\n\n\t// Computes if the given event is allowed to be dragged by the user\n\tisEventDefDraggable: function(eventDef) {\n\t\treturn this.isEventDefStartEditable(eventDef);\n\t},\n\n\n\tisEventDefStartEditable: function(eventDef) {\n\t\tvar isEditable = eventDef.isStartExplicitlyEditable();\n\n\t\tif (isEditable == null) {\n\t\t\tisEditable = this.opt('eventStartEditable');\n\n\t\t\tif (isEditable == null) {\n\t\t\t\tisEditable = this.isEventDefGenerallyEditable(eventDef);\n\t\t\t}\n\t\t}\n\n\t\treturn isEditable;\n\t},\n\n\n\tisEventDefGenerallyEditable: function(eventDef) {\n\t\tvar isEditable = eventDef.isExplicitlyEditable();\n\n\t\tif (isEditable == null) {\n\t\t\tisEditable = this.opt('editable');\n\t\t}\n\n\t\treturn isEditable;\n\t},\n\n\n\t// Event Resizing\n\t// ---------------------------------------------------------------------------------------------------------------\n\n\n\t// Computes if the given event is allowed to be resized from its starting edge\n\tisEventDefResizableFromStart: function(eventDef) {\n\t\treturn this.opt('eventResizableFromStart') && this.isEventDefResizable(eventDef);\n\t},\n\n\n\t// Computes if the given event is allowed to be resized from its ending edge\n\tisEventDefResizableFromEnd: function(eventDef) {\n\t\treturn this.isEventDefResizable(eventDef);\n\t},\n\n\n\t// Computes if the given event is allowed to be resized by the user at all\n\tisEventDefResizable: function(eventDef) {\n\t\tvar isResizable = eventDef.isDurationExplicitlyEditable();\n\n\t\tif (isResizable == null) {\n\t\t\tisResizable = this.opt('eventDurationEditable');\n\n\t\t\tif (isResizable == null) {\n\t\t\t\tisResizable = this.isEventDefGenerallyEditable(eventDef);\n\t\t\t}\n\t\t}\n\t\treturn isResizable;\n\t},\n\n\n\t// Event Mutation / Constraints\n\t// ---------------------------------------------------------------------------------------------------------------\n\n\n\t// Diffs the two dates, returning a duration, based on granularity of the grid\n\t// TODO: port isTimeScale into this system?\n\tdiffDates: function(a, b) {\n\t\tif (this.largeUnit) {\n\t\t\treturn diffByUnit(a, b, this.largeUnit);\n\t\t}\n\t\telse {\n\t\t\treturn diffDayTime(a, b);\n\t\t}\n\t},\n\n\n\t// is it allowed, in relation to the view's validRange?\n\t// NOTE: very similar to isExternalInstanceGroupAllowed\n\tisEventInstanceGroupAllowed: function(eventInstanceGroup) {\n\t\tvar view = this._getView();\n\t\tvar dateProfile = this.dateProfile;\n\t\tvar eventFootprints = this.eventRangesToEventFootprints(eventInstanceGroup.getAllEventRanges());\n\t\tvar i;\n\n\t\tfor (i = 0; i < eventFootprints.length; i++) {\n\t\t\t// TODO: just use getAllEventRanges directly\n\t\t\tif (!dateProfile.validUnzonedRange.containsRange(eventFootprints[i].componentFootprint.unzonedRange)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn view.calendar.isEventInstanceGroupAllowed(eventInstanceGroup);\n\t},\n\n\n\t// NOTE: very similar to isEventInstanceGroupAllowed\n\t// when it's a completely anonymous external drag, no event.\n\tisExternalInstanceGroupAllowed: function(eventInstanceGroup) {\n\t\tvar view = this._getView();\n\t\tvar dateProfile = this.dateProfile;\n\t\tvar eventFootprints = this.eventRangesToEventFootprints(eventInstanceGroup.getAllEventRanges());\n\t\tvar i;\n\n\t\tfor (i = 0; i < eventFootprints.length; i++) {\n\t\t\tif (!dateProfile.validUnzonedRange.containsRange(eventFootprints[i].componentFootprint.unzonedRange)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0; i < eventFootprints.length; i++) {\n\t\t\t// treat it as a selection\n\t\t\t// TODO: pass in eventInstanceGroup instead\n\t\t\t//  because we don't want calendar's constraint system to depend on a component's\n\t\t\t//  determination of footprints.\n\t\t\tif (!view.calendar.isSelectionFootprintAllowed(eventFootprints[i].componentFootprint)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n});\n\n;;\n\n/*\nA set of rendering and date-related methods for a visual component comprised of one or more rows of day columns.\nPrerequisite: the object being mixed into needs to be a *Grid*\n*/\nvar DayTableMixin = FC.DayTableMixin = {\n\n\tbreakOnWeeks: false, // should create a new row for each week?\n\tdayDates: null, // whole-day dates for each column. left to right\n\tdayIndices: null, // for each day from start, the offset\n\tdaysPerRow: null,\n\trowCnt: null,\n\tcolCnt: null,\n\tcolHeadFormat: null,\n\n\n\t// Populates internal variables used for date calculation and rendering\n\tupdateDayTable: function() {\n\t\tvar view = this.view;\n\t\tvar calendar = view.calendar;\n\t\tvar date = calendar.msToUtcMoment(this.dateProfile.renderUnzonedRange.startMs, true);\n\t\tvar end = calendar.msToUtcMoment(this.dateProfile.renderUnzonedRange.endMs, true);\n\t\tvar dayIndex = -1;\n\t\tvar dayIndices = [];\n\t\tvar dayDates = [];\n\t\tvar daysPerRow;\n\t\tvar firstDay;\n\t\tvar rowCnt;\n\n\t\twhile (date.isBefore(end)) { // loop each day from start to end\n\t\t\tif (view.isHiddenDay(date)) {\n\t\t\t\tdayIndices.push(dayIndex + 0.5); // mark that it's between indices\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdayIndex++;\n\t\t\t\tdayIndices.push(dayIndex);\n\t\t\t\tdayDates.push(date.clone());\n\t\t\t}\n\t\t\tdate.add(1, 'days');\n\t\t}\n\n\t\tif (this.breakOnWeeks) {\n\t\t\t// count columns until the day-of-week repeats\n\t\t\tfirstDay = dayDates[0].day();\n\t\t\tfor (daysPerRow = 1; daysPerRow < dayDates.length; daysPerRow++) {\n\t\t\t\tif (dayDates[daysPerRow].day() == firstDay) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\trowCnt = Math.ceil(dayDates.length / daysPerRow);\n\t\t}\n\t\telse {\n\t\t\trowCnt = 1;\n\t\t\tdaysPerRow = dayDates.length;\n\t\t}\n\n\t\tthis.dayDates = dayDates;\n\t\tthis.dayIndices = dayIndices;\n\t\tthis.daysPerRow = daysPerRow;\n\t\tthis.rowCnt = rowCnt;\n\n\t\tthis.updateDayTableCols();\n\t},\n\n\n\t// Computes and assigned the colCnt property and updates any options that may be computed from it\n\tupdateDayTableCols: function() {\n\t\tthis.colCnt = this.computeColCnt();\n\t\tthis.colHeadFormat = this.opt('columnFormat') || this.computeColHeadFormat();\n\t},\n\n\n\t// Determines how many columns there should be in the table\n\tcomputeColCnt: function() {\n\t\treturn this.daysPerRow;\n\t},\n\n\n\t// Computes the ambiguously-timed moment for the given cell\n\tgetCellDate: function(row, col) {\n\t\treturn this.dayDates[\n\t\t\t\tthis.getCellDayIndex(row, col)\n\t\t\t].clone();\n\t},\n\n\n\t// Computes the ambiguously-timed date range for the given cell\n\tgetCellRange: function(row, col) {\n\t\tvar start = this.getCellDate(row, col);\n\t\tvar end = start.clone().add(1, 'days');\n\n\t\treturn { start: start, end: end };\n\t},\n\n\n\t// Returns the number of day cells, chronologically, from the first of the grid (0-based)\n\tgetCellDayIndex: function(row, col) {\n\t\treturn row * this.daysPerRow + this.getColDayIndex(col);\n\t},\n\n\n\t// Returns the numner of day cells, chronologically, from the first cell in *any given row*\n\tgetColDayIndex: function(col) {\n\t\tif (this.isRTL) {\n\t\t\treturn this.colCnt - 1 - col;\n\t\t}\n\t\telse {\n\t\t\treturn col;\n\t\t}\n\t},\n\n\n\t// Given a date, returns its chronolocial cell-index from the first cell of the grid.\n\t// If the date lies between cells (because of hiddenDays), returns a floating-point value between offsets.\n\t// If before the first offset, returns a negative number.\n\t// If after the last offset, returns an offset past the last cell offset.\n\t// Only works for *start* dates of cells. Will not work for exclusive end dates for cells.\n\tgetDateDayIndex: function(date) {\n\t\tvar dayIndices = this.dayIndices;\n\t\tvar dayOffset = date.diff(this.dayDates[0], 'days');\n\n\t\tif (dayOffset < 0) {\n\t\t\treturn dayIndices[0] - 1;\n\t\t}\n\t\telse if (dayOffset >= dayIndices.length) {\n\t\t\treturn dayIndices[dayIndices.length - 1] + 1;\n\t\t}\n\t\telse {\n\t\t\treturn dayIndices[dayOffset];\n\t\t}\n\t},\n\n\n\t/* Options\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Computes a default column header formatting string if `colFormat` is not explicitly defined\n\tcomputeColHeadFormat: function() {\n\t\t// if more than one week row, or if there are a lot of columns with not much space,\n\t\t// put just the day numbers will be in each cell\n\t\tif (this.rowCnt > 1 || this.colCnt > 10) {\n\t\t\treturn 'ddd'; // \"Sat\"\n\t\t}\n\t\t// multiple days, so full single date string WON'T be in title text\n\t\telse if (this.colCnt > 1) {\n\t\t\treturn this.opt('dayOfMonthFormat'); // \"Sat 12/10\"\n\t\t}\n\t\t// single day, so full single date string will probably be in title text\n\t\telse {\n\t\t\treturn 'dddd'; // \"Saturday\"\n\t\t}\n\t},\n\n\n\t/* Slicing\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Slices up a date range into a segment for every week-row it intersects with\n\tsliceRangeByRow: function(unzonedRange) {\n\t\tvar daysPerRow = this.daysPerRow;\n\t\tvar normalRange = this.view.computeDayRange(unzonedRange); // make whole-day range, considering nextDayThreshold\n\t\tvar rangeFirst = this.getDateDayIndex(normalRange.start); // inclusive first index\n\t\tvar rangeLast = this.getDateDayIndex(normalRange.end.clone().subtract(1, 'days')); // inclusive last index\n\t\tvar segs = [];\n\t\tvar row;\n\t\tvar rowFirst, rowLast; // inclusive day-index range for current row\n\t\tvar segFirst, segLast; // inclusive day-index range for segment\n\n\t\tfor (row = 0; row < this.rowCnt; row++) {\n\t\t\trowFirst = row * daysPerRow;\n\t\t\trowLast = rowFirst + daysPerRow - 1;\n\n\t\t\t// intersect segment's offset range with the row's\n\t\t\tsegFirst = Math.max(rangeFirst, rowFirst);\n\t\t\tsegLast = Math.min(rangeLast, rowLast);\n\n\t\t\t// deal with in-between indices\n\t\t\tsegFirst = Math.ceil(segFirst); // in-between starts round to next cell\n\t\t\tsegLast = Math.floor(segLast); // in-between ends round to prev cell\n\n\t\t\tif (segFirst <= segLast) { // was there any intersection with the current row?\n\t\t\t\tsegs.push({\n\t\t\t\t\trow: row,\n\n\t\t\t\t\t// normalize to start of row\n\t\t\t\t\tfirstRowDayIndex: segFirst - rowFirst,\n\t\t\t\t\tlastRowDayIndex: segLast - rowFirst,\n\n\t\t\t\t\t// must be matching integers to be the segment's start/end\n\t\t\t\t\tisStart: segFirst === rangeFirst,\n\t\t\t\t\tisEnd: segLast === rangeLast\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn segs;\n\t},\n\n\n\t// Slices up a date range into a segment for every day-cell it intersects with.\n\t// TODO: make more DRY with sliceRangeByRow somehow.\n\tsliceRangeByDay: function(unzonedRange) {\n\t\tvar daysPerRow = this.daysPerRow;\n\t\tvar normalRange = this.view.computeDayRange(unzonedRange); // make whole-day range, considering nextDayThreshold\n\t\tvar rangeFirst = this.getDateDayIndex(normalRange.start); // inclusive first index\n\t\tvar rangeLast = this.getDateDayIndex(normalRange.end.clone().subtract(1, 'days')); // inclusive last index\n\t\tvar segs = [];\n\t\tvar row;\n\t\tvar rowFirst, rowLast; // inclusive day-index range for current row\n\t\tvar i;\n\t\tvar segFirst, segLast; // inclusive day-index range for segment\n\n\t\tfor (row = 0; row < this.rowCnt; row++) {\n\t\t\trowFirst = row * daysPerRow;\n\t\t\trowLast = rowFirst + daysPerRow - 1;\n\n\t\t\tfor (i = rowFirst; i <= rowLast; i++) {\n\n\t\t\t\t// intersect segment's offset range with the row's\n\t\t\t\tsegFirst = Math.max(rangeFirst, i);\n\t\t\t\tsegLast = Math.min(rangeLast, i);\n\n\t\t\t\t// deal with in-between indices\n\t\t\t\tsegFirst = Math.ceil(segFirst); // in-between starts round to next cell\n\t\t\t\tsegLast = Math.floor(segLast); // in-between ends round to prev cell\n\n\t\t\t\tif (segFirst <= segLast) { // was there any intersection with the current row?\n\t\t\t\t\tsegs.push({\n\t\t\t\t\t\trow: row,\n\n\t\t\t\t\t\t// normalize to start of row\n\t\t\t\t\t\tfirstRowDayIndex: segFirst - rowFirst,\n\t\t\t\t\t\tlastRowDayIndex: segLast - rowFirst,\n\n\t\t\t\t\t\t// must be matching integers to be the segment's start/end\n\t\t\t\t\t\tisStart: segFirst === rangeFirst,\n\t\t\t\t\t\tisEnd: segLast === rangeLast\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn segs;\n\t},\n\n\n\t/* Header Rendering\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\trenderHeadHtml: function() {\n\t\tvar theme = this.view.calendar.theme;\n\n\t\treturn '' +\n\t\t\t'<div class=\"fc-row ' + theme.getClass('headerRow') + '\">' +\n\t\t\t\t'<table class=\"' + theme.getClass('tableGrid') + '\">' +\n\t\t\t\t\t'<thead>' +\n\t\t\t\t\t\tthis.renderHeadTrHtml() +\n\t\t\t\t\t'</thead>' +\n\t\t\t\t'</table>' +\n\t\t\t'</div>';\n\t},\n\n\n\trenderHeadIntroHtml: function() {\n\t\treturn this.renderIntroHtml(); // fall back to generic\n\t},\n\n\n\trenderHeadTrHtml: function() {\n\t\treturn '' +\n\t\t\t'<tr>' +\n\t\t\t\t(this.isRTL ? '' : this.renderHeadIntroHtml()) +\n\t\t\t\tthis.renderHeadDateCellsHtml() +\n\t\t\t\t(this.isRTL ? this.renderHeadIntroHtml() : '') +\n\t\t\t'</tr>';\n\t},\n\n\n\trenderHeadDateCellsHtml: function() {\n\t\tvar htmls = [];\n\t\tvar col, date;\n\n\t\tfor (col = 0; col < this.colCnt; col++) {\n\t\t\tdate = this.getCellDate(0, col);\n\t\t\thtmls.push(this.renderHeadDateCellHtml(date));\n\t\t}\n\n\t\treturn htmls.join('');\n\t},\n\n\n\t// TODO: when internalApiVersion, accept an object for HTML attributes\n\t// (colspan should be no different)\n\trenderHeadDateCellHtml: function(date, colspan, otherAttrs) {\n\t\tvar view = this.view;\n\t\tvar isDateValid = this.dateProfile.activeUnzonedRange.containsDate(date); // TODO: called too frequently. cache somehow.\n\t\tvar classNames = [\n\t\t\t'fc-day-header',\n\t\t\tview.calendar.theme.getClass('widgetHeader')\n\t\t];\n\t\tvar innerHtml = htmlEscape(date.format(this.colHeadFormat));\n\n\t\t// if only one row of days, the classNames on the header can represent the specific days beneath\n\t\tif (this.rowCnt === 1) {\n\t\t\tclassNames = classNames.concat(\n\t\t\t\t// includes the day-of-week class\n\t\t\t\t// noThemeHighlight=true (don't highlight the header)\n\t\t\t\tthis.getDayClasses(date, true)\n\t\t\t);\n\t\t}\n\t\telse {\n\t\t\tclassNames.push('fc-' + dayIDs[date.day()]); // only add the day-of-week class\n\t\t}\n\n\t\treturn '' +\n            '<th class=\"' + classNames.join(' ') + '\"' +\n\t\t\t\t((isDateValid && this.rowCnt) === 1 ?\n\t\t\t\t\t' data-date=\"' + date.format('YYYY-MM-DD') + '\"' :\n\t\t\t\t\t'') +\n\t\t\t\t(colspan > 1 ?\n\t\t\t\t\t' colspan=\"' + colspan + '\"' :\n\t\t\t\t\t'') +\n\t\t\t\t(otherAttrs ?\n\t\t\t\t\t' ' + otherAttrs :\n\t\t\t\t\t'') +\n\t\t\t\t'>' +\n\t\t\t\t(isDateValid ?\n\t\t\t\t\t// don't make a link if the heading could represent multiple days, or if there's only one day (forceOff)\n\t\t\t\t\tview.buildGotoAnchorHtml(\n\t\t\t\t\t\t{ date: date, forceOff: this.rowCnt > 1 || this.colCnt === 1 },\n\t\t\t\t\t\tinnerHtml\n\t\t\t\t\t) :\n\t\t\t\t\t// if not valid, display text, but no link\n\t\t\t\t\tinnerHtml\n\t\t\t\t) +\n\t\t\t'</th>';\n\t},\n\n\n\t/* Background Rendering\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\trenderBgTrHtml: function(row) {\n\t\treturn '' +\n\t\t\t'<tr>' +\n\t\t\t\t(this.isRTL ? '' : this.renderBgIntroHtml(row)) +\n\t\t\t\tthis.renderBgCellsHtml(row) +\n\t\t\t\t(this.isRTL ? this.renderBgIntroHtml(row) : '') +\n\t\t\t'</tr>';\n\t},\n\n\n\trenderBgIntroHtml: function(row) {\n\t\treturn this.renderIntroHtml(); // fall back to generic\n\t},\n\n\n\trenderBgCellsHtml: function(row) {\n\t\tvar htmls = [];\n\t\tvar col, date;\n\n\t\tfor (col = 0; col < this.colCnt; col++) {\n\t\t\tdate = this.getCellDate(row, col);\n\t\t\thtmls.push(this.renderBgCellHtml(date));\n\t\t}\n\n\t\treturn htmls.join('');\n\t},\n\n\n\trenderBgCellHtml: function(date, otherAttrs) {\n\t\tvar view = this.view;\n\t\tvar isDateValid = this.dateProfile.activeUnzonedRange.containsDate(date); // TODO: called too frequently. cache somehow.\n\t\tvar classes = this.getDayClasses(date);\n\n\t\tclasses.unshift('fc-day', view.calendar.theme.getClass('widgetContent'));\n\n\t\treturn '<td class=\"' + classes.join(' ') + '\"' +\n\t\t\t(isDateValid ?\n\t\t\t\t' data-date=\"' + date.format('YYYY-MM-DD') + '\"' : // if date has a time, won't format it\n\t\t\t\t'') +\n\t\t\t(otherAttrs ?\n\t\t\t\t' ' + otherAttrs :\n\t\t\t\t'') +\n\t\t\t'></td>';\n\t},\n\n\n\t/* Generic\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Generates the default HTML intro for any row. User classes should override\n\trenderIntroHtml: function() {\n\t},\n\n\n\t// TODO: a generic method for dealing with <tr>, RTL, intro\n\t// when increment internalApiVersion\n\t// wrapTr (scheduler)\n\n\n\t/* Utils\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Applies the generic \"intro\" and \"outro\" HTML to the given cells.\n\t// Intro means the leftmost cell when the calendar is LTR and the rightmost cell when RTL. Vice-versa for outro.\n\tbookendCells: function(trEl) {\n\t\tvar introHtml = this.renderIntroHtml();\n\n\t\tif (introHtml) {\n\t\t\tif (this.isRTL) {\n\t\t\t\ttrEl.append(introHtml);\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttrEl.prepend(introHtml);\n\t\t\t}\n\t\t}\n\t}\n\n};\n\n;;\n\n/* An abstract class from which other views inherit from\n----------------------------------------------------------------------------------------------------------------------*/\n\nvar View = FC.View = InteractiveDateComponent.extend({\n\n\ttype: null, // subclass' view name (string)\n\tname: null, // deprecated. use `type` instead\n\ttitle: null, // the text that will be displayed in the header's title\n\n\tcalendar: null, // owner Calendar object\n\tviewSpec: null,\n\toptions: null, // hash containing all options. already merged with view-specific-options\n\n\trenderQueue: null,\n\tbatchRenderDepth: 0,\n\tqueuedScroll: null,\n\n\tisSelected: false, // boolean whether a range of time is user-selected or not\n\tselectedEventInstance: null,\n\n\teventOrderSpecs: null, // criteria for ordering events when they have same date/time\n\n\t// for date utils, computed from options\n\tisHiddenDayHash: null,\n\n\t// now indicator\n\tisNowIndicatorRendered: null,\n\tinitialNowDate: null, // result first getNow call\n\tinitialNowQueriedMs: null, // ms time the getNow was called\n\tnowIndicatorTimeoutID: null, // for refresh timing of now indicator\n\tnowIndicatorIntervalID: null, // \"\n\n\tconstructor: function(calendar, viewSpec) {\n\t\tthis.calendar = calendar;\n\t\tthis.viewSpec = viewSpec;\n\n\t\t// shortcuts\n\t\tthis.type = viewSpec.type;\n\t\tthis.options = viewSpec.options;\n\n\t\t// .name is deprecated\n\t\tthis.name = this.type;\n\n\t\tInteractiveDateComponent.call(this);\n\n\t\tthis.initRenderQueue();\n\t\tthis.initHiddenDays();\n\t\tthis.bindBaseRenderHandlers();\n\t\tthis.eventOrderSpecs = parseFieldSpecs(this.opt('eventOrder'));\n\n\t\t// legacy\n\t\tif (this.initialize) {\n\t\t\tthis.initialize();\n\t\t}\n\t},\n\n\n\t_getView: function() {\n\t\treturn this;\n\t},\n\n\n\t// Retrieves an option with the given name\n\topt: function(name) {\n\t\treturn this.options[name];\n\t},\n\n\n\t/* Render Queue\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\tinitRenderQueue: function() {\n\t\tthis.renderQueue = new RenderQueue({\n\t\t\tevent: this.opt('eventRenderWait')\n\t\t});\n\n\t\tthis.renderQueue.on('start', this.onRenderQueueStart.bind(this));\n\t\tthis.renderQueue.on('stop', this.onRenderQueueStop.bind(this));\n\n\t\tthis.on('before:change', this.startBatchRender);\n\t\tthis.on('change', this.stopBatchRender);\n\t},\n\n\n\tonRenderQueueStart: function() {\n\t\tthis.calendar.freezeContentHeight();\n\t\tthis.addScroll(this.queryScroll());\n\t},\n\n\n\tonRenderQueueStop: function() {\n\t\tif (this.calendar.updateViewSize()) { // success?\n\t\t\tthis.popScroll();\n\t\t}\n\t\tthis.calendar.thawContentHeight();\n\t},\n\n\n\tstartBatchRender: function() {\n\t\tif (!(this.batchRenderDepth++)) {\n\t\t\tthis.renderQueue.pause();\n\t\t}\n\t},\n\n\n\tstopBatchRender: function() {\n\t\tif (!(--this.batchRenderDepth)) {\n\t\t\tthis.renderQueue.resume();\n\t\t}\n\t},\n\n\n\trequestRender: function(func, namespace, actionType) {\n\t\tthis.renderQueue.queue(func, namespace, actionType);\n\t},\n\n\n\t// given func will auto-bind to `this`\n\twhenSizeUpdated: function(func) {\n\t\tif (this.renderQueue.isRunning) {\n\t\t\tthis.renderQueue.one('stop', func.bind(this));\n\t\t}\n\t\telse {\n\t\t\tfunc.call(this);\n\t\t}\n\t},\n\n\n\t/* Title and Date Formatting\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Computes what the title at the top of the calendar should be for this view\n\tcomputeTitle: function(dateProfile) {\n\t\tvar unzonedRange;\n\n\t\t// for views that span a large unit of time, show the proper interval, ignoring stray days before and after\n\t\tif (/^(year|month)$/.test(dateProfile.currentRangeUnit)) {\n\t\t\tunzonedRange = dateProfile.currentUnzonedRange;\n\t\t}\n\t\telse { // for day units or smaller, use the actual day range\n\t\t\tunzonedRange = dateProfile.activeUnzonedRange;\n\t\t}\n\n\t\treturn this.formatRange(\n\t\t\t{\n\t\t\t\tstart: this.calendar.msToMoment(unzonedRange.startMs, dateProfile.isRangeAllDay),\n\t\t\t\tend: this.calendar.msToMoment(unzonedRange.endMs, dateProfile.isRangeAllDay)\n\t\t\t},\n\t\t\tdateProfile.isRangeAllDay,\n\t\t\tthis.opt('titleFormat') || this.computeTitleFormat(dateProfile),\n\t\t\tthis.opt('titleRangeSeparator')\n\t\t);\n\t},\n\n\n\t// Generates the format string that should be used to generate the title for the current date range.\n\t// Attempts to compute the most appropriate format if not explicitly specified with `titleFormat`.\n\tcomputeTitleFormat: function(dateProfile) {\n\t\tvar currentRangeUnit = dateProfile.currentRangeUnit;\n\n\t\tif (currentRangeUnit == 'year') {\n\t\t\treturn 'YYYY';\n\t\t}\n\t\telse if (currentRangeUnit == 'month') {\n\t\t\treturn this.opt('monthYearFormat'); // like \"September 2014\"\n\t\t}\n\t\telse if (dateProfile.currentUnzonedRange.as('days') > 1) {\n\t\t\treturn 'll'; // multi-day range. shorter, like \"Sep 9 - 10 2014\"\n\t\t}\n\t\telse {\n\t\t\treturn 'LL'; // one day. longer, like \"September 9 2014\"\n\t\t}\n\t},\n\n\n\t// Date Setting/Unsetting\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tsetDate: function(date) {\n\t\tvar currentDateProfile = this.get('dateProfile');\n\t\tvar newDateProfile = this.buildDateProfile(date, null, true); // forceToValid=true\n\n\t\tif (\n\t\t\t!currentDateProfile ||\n\t\t\t!currentDateProfile.activeUnzonedRange.equals(newDateProfile.activeUnzonedRange)\n\t\t) {\n\t\t\tthis.set('dateProfile', newDateProfile);\n\t\t}\n\t},\n\n\n\tunsetDate: function() {\n\t\tthis.unset('dateProfile');\n\t},\n\n\n\t// Event Data\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tfetchInitialEvents: function(dateProfile) {\n\t\tvar calendar = this.calendar;\n\t\tvar forceAllDay = dateProfile.isRangeAllDay && !this.usesMinMaxTime;\n\n\t\treturn calendar.requestEvents(\n\t\t\tcalendar.msToMoment(dateProfile.activeUnzonedRange.startMs, forceAllDay),\n\t\t\tcalendar.msToMoment(dateProfile.activeUnzonedRange.endMs, forceAllDay)\n\t\t);\n\t},\n\n\n\tbindEventChanges: function() {\n\t\tthis.listenTo(this.calendar, 'eventsReset', this.resetEvents); // TODO: make this a real event\n\t},\n\n\n\tunbindEventChanges: function() {\n\t\tthis.stopListeningTo(this.calendar, 'eventsReset');\n\t},\n\n\n\tsetEvents: function(eventsPayload) {\n\t\tthis.set('currentEvents', eventsPayload);\n\t\tthis.set('hasEvents', true);\n\t},\n\n\n\tunsetEvents: function() {\n\t\tthis.unset('currentEvents');\n\t\tthis.unset('hasEvents');\n\t},\n\n\n\tresetEvents: function(eventsPayload) {\n\t\tthis.startBatchRender();\n\t\tthis.unsetEvents();\n\t\tthis.setEvents(eventsPayload);\n\t\tthis.stopBatchRender();\n\t},\n\n\n\t// Date High-level Rendering\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\trequestDateRender: function(dateProfile) {\n\t\tvar _this = this;\n\n\t\tthis.requestRender(function() {\n\t\t\t_this.executeDateRender(dateProfile);\n\t\t}, 'date', 'init');\n\t},\n\n\n\trequestDateUnrender: function() {\n\t\tvar _this = this;\n\n\t\tthis.requestRender(function() {\n\t\t\t_this.executeDateUnrender();\n\t\t}, 'date', 'destroy');\n\t},\n\n\n\t// if dateProfile not specified, uses current\n\texecuteDateRender: function(dateProfile) {\n\t\tDateComponent.prototype.executeDateRender.apply(this, arguments);\n\n\t\tif (this.render) {\n\t\t\tthis.render(); // TODO: deprecate\n\t\t}\n\n\t\tthis.trigger('datesRendered');\n\t\tthis.addScroll({ isDateInit: true });\n\t\tthis.startNowIndicator(); // shouldn't render yet because updateSize will be called soon\n\t},\n\n\n\texecuteDateUnrender: function() {\n\t\tthis.unselect();\n\t\tthis.stopNowIndicator();\n\t\tthis.trigger('before:datesUnrendered');\n\n\t\tif (this.destroy) {\n\t\t\tthis.destroy(); // TODO: deprecate\n\t\t}\n\n\t\tDateComponent.prototype.executeDateUnrender.apply(this, arguments);\n\t},\n\n\n\t// \"Base\" rendering\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tbindBaseRenderHandlers: function() {\n\t\tvar _this = this;\n\n\t\tthis.on('datesRendered', function() {\n\t\t\t_this.whenSizeUpdated(\n\t\t\t\t_this.triggerViewRender\n\t\t\t);\n\t\t});\n\n\t\tthis.on('before:datesUnrendered', function() {\n\t\t\t_this.triggerViewDestroy();\n\t\t});\n\t},\n\n\n\ttriggerViewRender: function() {\n\t\tthis.publiclyTrigger('viewRender', {\n\t\t\tcontext: this,\n\t\t\targs: [ this, this.el ]\n\t\t});\n\t},\n\n\n\ttriggerViewDestroy: function() {\n\t\tthis.publiclyTrigger('viewDestroy', {\n\t\t\tcontext: this,\n\t\t\targs: [ this, this.el ]\n\t\t});\n\t},\n\n\n\t// Event High-level Rendering\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\trequestEventsRender: function(eventsPayload) {\n\t\tvar _this = this;\n\n\t\tthis.requestRender(function() {\n\t\t\t_this.executeEventRender(eventsPayload);\n\t\t\t_this.whenSizeUpdated(\n\t\t\t\t_this.triggerAfterEventsRendered\n\t\t\t);\n\t\t}, 'event', 'init');\n\t},\n\n\n\trequestEventsUnrender: function() {\n\t\tvar _this = this;\n\n\t\tthis.requestRender(function() {\n\t\t\t_this.triggerBeforeEventsDestroyed();\n\t\t\t_this.executeEventUnrender();\n\t\t}, 'event', 'destroy');\n\t},\n\n\n\t// Business Hour High-level Rendering\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\trequestBusinessHoursRender: function(businessHourGenerator) {\n\t\tvar _this = this;\n\n\t\tthis.requestRender(function() {\n\t\t\t_this.renderBusinessHours(businessHourGenerator);\n\t\t}, 'businessHours', 'init');\n\t},\n\n\trequestBusinessHoursUnrender: function() {\n\t\tvar _this = this;\n\n\t\tthis.requestRender(function() {\n\t\t\t_this.unrenderBusinessHours();\n\t\t}, 'businessHours', 'destroy');\n\t},\n\n\n\t// Misc view rendering utils\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\t// Binds DOM handlers to elements that reside outside the view container, such as the document\n\tbindGlobalHandlers: function() {\n\t\tInteractiveDateComponent.prototype.bindGlobalHandlers.apply(this, arguments);\n\n\t\tthis.listenTo(GlobalEmitter.get(), {\n\t\t\ttouchstart: this.processUnselect,\n\t\t\tmousedown: this.handleDocumentMousedown\n\t\t});\n\t},\n\n\n\t// Unbinds DOM handlers from elements that reside outside the view container\n\tunbindGlobalHandlers: function() {\n\t\tInteractiveDateComponent.prototype.unbindGlobalHandlers.apply(this, arguments);\n\n\t\tthis.stopListeningTo(GlobalEmitter.get());\n\t},\n\n\n\t/* Now Indicator\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Immediately render the current time indicator and begins re-rendering it at an interval,\n\t// which is defined by this.getNowIndicatorUnit().\n\t// TODO: somehow do this for the current whole day's background too\n\tstartNowIndicator: function() {\n\t\tvar _this = this;\n\t\tvar unit;\n\t\tvar update;\n\t\tvar delay; // ms wait value\n\n\t\tif (this.opt('nowIndicator')) {\n\t\t\tunit = this.getNowIndicatorUnit();\n\t\t\tif (unit) {\n\t\t\t\tupdate = proxy(this, 'updateNowIndicator'); // bind to `this`\n\n\t\t\t\tthis.initialNowDate = this.calendar.getNow();\n\t\t\t\tthis.initialNowQueriedMs = +new Date();\n\n\t\t\t\t// wait until the beginning of the next interval\n\t\t\t\tdelay = this.initialNowDate.clone().startOf(unit).add(1, unit) - this.initialNowDate;\n\t\t\t\tthis.nowIndicatorTimeoutID = setTimeout(function() {\n\t\t\t\t\t_this.nowIndicatorTimeoutID = null;\n\t\t\t\t\tupdate();\n\t\t\t\t\tdelay = +moment.duration(1, unit);\n\t\t\t\t\tdelay = Math.max(100, delay); // prevent too frequent\n\t\t\t\t\t_this.nowIndicatorIntervalID = setInterval(update, delay); // update every interval\n\t\t\t\t}, delay);\n\t\t\t}\n\n\t\t\t// rendering will be initiated in updateSize\n\t\t}\n\t},\n\n\n\t// rerenders the now indicator, computing the new current time from the amount of time that has passed\n\t// since the initial getNow call.\n\tupdateNowIndicator: function() {\n\t\tif (\n\t\t\tthis.isDatesRendered &&\n\t\t\tthis.initialNowDate // activated before?\n\t\t) {\n\t\t\tthis.unrenderNowIndicator(); // won't unrender if unnecessary\n\t\t\tthis.renderNowIndicator(\n\t\t\t\tthis.initialNowDate.clone().add(new Date() - this.initialNowQueriedMs) // add ms\n\t\t\t);\n\t\t\tthis.isNowIndicatorRendered = true;\n\t\t}\n\t},\n\n\n\t// Immediately unrenders the view's current time indicator and stops any re-rendering timers.\n\t// Won't cause side effects if indicator isn't rendered.\n\tstopNowIndicator: function() {\n\t\tif (this.isNowIndicatorRendered) {\n\n\t\t\tif (this.nowIndicatorTimeoutID) {\n\t\t\t\tclearTimeout(this.nowIndicatorTimeoutID);\n\t\t\t\tthis.nowIndicatorTimeoutID = null;\n\t\t\t}\n\t\t\tif (this.nowIndicatorIntervalID) {\n\t\t\t\tclearTimeout(this.nowIndicatorIntervalID);\n\t\t\t\tthis.nowIndicatorIntervalID = null;\n\t\t\t}\n\n\t\t\tthis.unrenderNowIndicator();\n\t\t\tthis.isNowIndicatorRendered = false;\n\t\t}\n\t},\n\n\n\t/* Dimensions\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\tupdateSize: function(totalHeight, isAuto, isResize) {\n\n\t\tif (this.setHeight) { // for legacy API\n\t\t\tthis.setHeight(totalHeight, isAuto);\n\t\t}\n\t\telse {\n\t\t\tInteractiveDateComponent.prototype.updateSize.apply(this, arguments);\n\t\t}\n\n\t\tthis.updateNowIndicator();\n\t},\n\n\n\t/* Scroller\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\taddScroll: function(scroll) {\n\t\tvar queuedScroll = this.queuedScroll || (this.queuedScroll = {});\n\n\t\t$.extend(queuedScroll, scroll);\n\t},\n\n\n\tpopScroll: function() {\n\t\tthis.applyQueuedScroll();\n\t\tthis.queuedScroll = null;\n\t},\n\n\n\tapplyQueuedScroll: function() {\n\t\tif (this.queuedScroll) {\n\t\t\tthis.applyScroll(this.queuedScroll);\n\t\t}\n\t},\n\n\n\tqueryScroll: function() {\n\t\tvar scroll = {};\n\n\t\tif (this.isDatesRendered) {\n\t\t\t$.extend(scroll, this.queryDateScroll());\n\t\t}\n\n\t\treturn scroll;\n\t},\n\n\n\tapplyScroll: function(scroll) {\n\t\tif (scroll.isDateInit && this.isDatesRendered) {\n\t\t\t$.extend(scroll, this.computeInitialDateScroll());\n\t\t}\n\n\t\tif (this.isDatesRendered) {\n\t\t\tthis.applyDateScroll(scroll);\n\t\t}\n\t},\n\n\n\tcomputeInitialDateScroll: function() {\n\t\treturn {}; // subclasses must implement\n\t},\n\n\n\tqueryDateScroll: function() {\n\t\treturn {}; // subclasses must implement\n\t},\n\n\n\tapplyDateScroll: function(scroll) {\n\t\t; // subclasses must implement\n\t},\n\n\n\t/* Event Drag-n-Drop\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\treportEventDrop: function(eventInstance, eventMutation, el, ev) {\n\t\tvar eventManager = this.calendar.eventManager;\n\t\tvar undoFunc = eventManager.mutateEventsWithId(\n\t\t\teventInstance.def.id,\n\t\t\teventMutation,\n\t\t\tthis.calendar\n\t\t);\n\t\tvar dateMutation = eventMutation.dateMutation;\n\n\t\t// update the EventInstance, for handlers\n\t\tif (dateMutation) {\n\t\t\teventInstance.dateProfile = dateMutation.buildNewDateProfile(\n\t\t\t\teventInstance.dateProfile,\n\t\t\t\tthis.calendar\n\t\t\t);\n\t\t}\n\n\t\tthis.triggerEventDrop(\n\t\t\teventInstance,\n\t\t\t// a drop doesn't necessarily mean a date mutation (ex: resource change)\n\t\t\t(dateMutation && dateMutation.dateDelta) || moment.duration(),\n\t\t\tundoFunc,\n\t\t\tel, ev\n\t\t);\n\t},\n\n\n\t// Triggers event-drop handlers that have subscribed via the API\n\ttriggerEventDrop: function(eventInstance, dateDelta, undoFunc, el, ev) {\n\t\tthis.publiclyTrigger('eventDrop', {\n\t\t\tcontext: el[0],\n\t\t\targs: [\n\t\t\t\teventInstance.toLegacy(),\n\t\t\t\tdateDelta,\n\t\t\t\tundoFunc,\n\t\t\t\tev,\n\t\t\t\t{}, // {} = jqui dummy\n\t\t\t\tthis\n\t\t\t]\n\t\t});\n\t},\n\n\n\t/* External Element Drag-n-Drop\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Must be called when an external element, via jQuery UI, has been dropped onto the calendar.\n\t// `meta` is the parsed data that has been embedded into the dragging event.\n\t// `dropLocation` is an object that contains the new zoned start/end/allDay values for the event.\n\treportExternalDrop: function(singleEventDef, isEvent, isSticky, el, ev, ui) {\n\n\t\tif (isEvent) {\n\t\t\tthis.calendar.eventManager.addEventDef(singleEventDef, isSticky);\n\t\t}\n\n\t\tthis.triggerExternalDrop(singleEventDef, isEvent, el, ev, ui);\n\t},\n\n\n\t// Triggers external-drop handlers that have subscribed via the API\n\ttriggerExternalDrop: function(singleEventDef, isEvent, el, ev, ui) {\n\n\t\t// trigger 'drop' regardless of whether element represents an event\n\t\tthis.publiclyTrigger('drop', {\n\t\t\tcontext: el[0],\n\t\t\targs: [\n\t\t\t\tsingleEventDef.dateProfile.start.clone(),\n\t\t\t\tev,\n\t\t\t\tui,\n\t\t\t\tthis\n\t\t\t]\n\t\t});\n\n\t\tif (isEvent) {\n\t\t\t// signal an external event landed\n\t\t\tthis.publiclyTrigger('eventReceive', {\n\t\t\t\tcontext: this,\n\t\t\t\targs: [\n\t\t\t\t\tsingleEventDef.buildInstance().toLegacy(),\n\t\t\t\t\tthis\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\t},\n\n\n\t/* Event Resizing\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Must be called when an event in the view has been resized to a new length\n\treportEventResize: function(eventInstance, eventMutation, el, ev) {\n\t\tvar eventManager = this.calendar.eventManager;\n\t\tvar undoFunc = eventManager.mutateEventsWithId(\n\t\t\teventInstance.def.id,\n\t\t\teventMutation,\n\t\t\tthis.calendar\n\t\t);\n\n\t\t// update the EventInstance, for handlers\n\t\teventInstance.dateProfile = eventMutation.dateMutation.buildNewDateProfile(\n\t\t\teventInstance.dateProfile,\n\t\t\tthis.calendar\n\t\t);\n\n\t\tthis.triggerEventResize(\n\t\t\teventInstance,\n\t\t\teventMutation.dateMutation.endDelta,\n\t\t\tundoFunc,\n\t\t\tel, ev\n\t\t);\n\t},\n\n\n\t// Triggers event-resize handlers that have subscribed via the API\n\ttriggerEventResize: function(eventInstance, durationDelta, undoFunc, el, ev) {\n\t\tthis.publiclyTrigger('eventResize', {\n\t\t\tcontext: el[0],\n\t\t\targs: [\n\t\t\t\teventInstance.toLegacy(),\n\t\t\t\tdurationDelta,\n\t\t\t\tundoFunc,\n\t\t\t\tev,\n\t\t\t\t{}, // {} = jqui dummy\n\t\t\t\tthis\n\t\t\t]\n\t\t});\n\t},\n\n\n\t/* Selection (time range)\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Selects a date span on the view. `start` and `end` are both Moments.\n\t// `ev` is the native mouse event that begin the interaction.\n\tselect: function(footprint, ev) {\n\t\tthis.unselect(ev);\n\t\tthis.renderSelectionFootprint(footprint);\n\t\tthis.reportSelection(footprint, ev);\n\t},\n\n\n\trenderSelectionFootprint: function(footprint, ev) {\n\t\tif (this.renderSelection) { // legacy method in custom view classes\n\t\t\tthis.renderSelection(\n\t\t\t\tfootprint.toLegacy(this.calendar)\n\t\t\t);\n\t\t}\n\t\telse {\n\t\t\tInteractiveDateComponent.prototype.renderSelectionFootprint.apply(this, arguments);\n\t\t}\n\t},\n\n\n\t// Called when a new selection is made. Updates internal state and triggers handlers.\n\treportSelection: function(footprint, ev) {\n\t\tthis.isSelected = true;\n\t\tthis.triggerSelect(footprint, ev);\n\t},\n\n\n\t// Triggers handlers to 'select'\n\ttriggerSelect: function(footprint, ev) {\n\t\tvar dateProfile = this.calendar.footprintToDateProfile(footprint); // abuse of \"Event\"DateProfile?\n\n\t\tthis.publiclyTrigger('select', {\n\t\t\tcontext: this,\n\t\t\targs: [\n\t\t\t\tdateProfile.start,\n\t\t\t\tdateProfile.end,\n\t\t\t\tev,\n\t\t\t\tthis\n\t\t\t]\n\t\t});\n\t},\n\n\n\t// Undoes a selection. updates in the internal state and triggers handlers.\n\t// `ev` is the native mouse event that began the interaction.\n\tunselect: function(ev) {\n\t\tif (this.isSelected) {\n\t\t\tthis.isSelected = false;\n\t\t\tif (this.destroySelection) {\n\t\t\t\tthis.destroySelection(); // TODO: deprecate\n\t\t\t}\n\t\t\tthis.unrenderSelection();\n\t\t\tthis.publiclyTrigger('unselect', {\n\t\t\t\tcontext: this,\n\t\t\t\targs: [ ev, this ]\n\t\t\t});\n\t\t}\n\t},\n\n\n\t/* Event Selection\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\tselectEventInstance: function(eventInstance) {\n\t\tif (\n\t\t\t!this.selectedEventInstance ||\n\t\t\tthis.selectedEventInstance !== eventInstance\n\t\t) {\n\t\t\tthis.unselectEventInstance();\n\n\t\t\tthis.getEventSegs().forEach(function(seg) {\n\t\t\t\tif (\n\t\t\t\t\tseg.footprint.eventInstance === eventInstance &&\n\t\t\t\t\tseg.el // necessary?\n\t\t\t\t) {\n\t\t\t\t\tseg.el.addClass('fc-selected');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.selectedEventInstance = eventInstance;\n\t\t}\n\t},\n\n\n\tunselectEventInstance: function() {\n\t\tif (this.selectedEventInstance) {\n\n\t\t\tthis.getEventSegs().forEach(function(seg) {\n\t\t\t\tif (seg.el) { // necessary?\n\t\t\t\t\tseg.el.removeClass('fc-selected');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.selectedEventInstance = null;\n\t\t}\n\t},\n\n\n\tisEventDefSelected: function(eventDef) {\n\t\t// event references might change on refetchEvents(), while selectedEventInstance doesn't,\n\t\t// so compare IDs\n\t\treturn this.selectedEventInstance && this.selectedEventInstance.def.id === eventDef.id;\n\t},\n\n\n\t/* Mouse / Touch Unselecting (time range & event unselection)\n\t------------------------------------------------------------------------------------------------------------------*/\n\t// TODO: move consistently to down/start or up/end?\n\t// TODO: don't kill previous selection if touch scrolling\n\n\n\thandleDocumentMousedown: function(ev) {\n\t\tif (isPrimaryMouseButton(ev)) {\n\t\t\tthis.processUnselect(ev);\n\t\t}\n\t},\n\n\n\tprocessUnselect: function(ev) {\n\t\tthis.processRangeUnselect(ev);\n\t\tthis.processEventUnselect(ev);\n\t},\n\n\n\tprocessRangeUnselect: function(ev) {\n\t\tvar ignore;\n\n\t\t// is there a time-range selection?\n\t\tif (this.isSelected && this.opt('unselectAuto')) {\n\t\t\t// only unselect if the clicked element is not identical to or inside of an 'unselectCancel' element\n\t\t\tignore = this.opt('unselectCancel');\n\t\t\tif (!ignore || !$(ev.target).closest(ignore).length) {\n\t\t\t\tthis.unselect(ev);\n\t\t\t}\n\t\t}\n\t},\n\n\n\tprocessEventUnselect: function(ev) {\n\t\tif (this.selectedEventInstance) {\n\t\t\tif (!$(ev.target).closest('.fc-selected').length) {\n\t\t\t\tthis.unselectEventInstance();\n\t\t\t}\n\t\t}\n\t},\n\n\n\t/* Triggers\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\ttriggerBaseRendered: function() {\n\t\tthis.publiclyTrigger('viewRender', {\n\t\t\tcontext: this,\n\t\t\targs: [ this, this.el ]\n\t\t});\n\t},\n\n\n\ttriggerBaseUnrendered: function() {\n\t\tthis.publiclyTrigger('viewDestroy', {\n\t\t\tcontext: this,\n\t\t\targs: [ this, this.el ]\n\t\t});\n\t},\n\n\n\t// Triggers handlers to 'dayClick'\n\t// Span has start/end of the clicked area. Only the start is useful.\n\ttriggerDayClick: function(footprint, dayEl, ev) {\n\t\tvar dateProfile = this.calendar.footprintToDateProfile(footprint); // abuse of \"Event\"DateProfile?\n\n\t\tthis.publiclyTrigger('dayClick', {\n\t\t\tcontext: dayEl,\n\t\t\targs: [ dateProfile.start, ev, this ]\n\t\t});\n\t}\n\n});\n\n\nView.watch('displayingDates', [ 'isInDom', 'dateProfile' ], function(deps) {\n\tthis.requestDateRender(deps.dateProfile);\n}, function() {\n\tthis.requestDateUnrender();\n});\n\n\nView.watch('displayingBusinessHours', [ 'displayingDates', 'businessHourGenerator' ], function(deps) {\n\tthis.requestBusinessHoursRender(deps.businessHourGenerator);\n}, function() {\n\tthis.requestBusinessHoursUnrender();\n});\n\n\nView.watch('initialEvents', [ 'dateProfile' ], function(deps) {\n\treturn this.fetchInitialEvents(deps.dateProfile);\n});\n\n\nView.watch('bindingEvents', [ 'initialEvents' ], function(deps) {\n\tthis.setEvents(deps.initialEvents);\n\tthis.bindEventChanges();\n}, function() {\n\tthis.unbindEventChanges();\n\tthis.unsetEvents();\n});\n\n\nView.watch('displayingEvents', [ 'displayingDates', 'hasEvents' ], function() {\n\tthis.requestEventsRender(this.get('currentEvents'));\n}, function() {\n\tthis.requestEventsUnrender();\n});\n\n\nView.watch('title', [ 'dateProfile' ], function(deps) {\n\treturn (this.title = this.computeTitle(deps.dateProfile)); // assign to View for legacy reasons\n});\n\n\nView.watch('legacyDateProps', [ 'dateProfile' ], function(deps) {\n\tvar calendar = this.calendar;\n\tvar dateProfile = deps.dateProfile;\n\n\t// DEPRECATED, but we need to keep it updated...\n\tthis.start = calendar.msToMoment(dateProfile.activeUnzonedRange.startMs, dateProfile.isRangeAllDay);\n\tthis.end = calendar.msToMoment(dateProfile.activeUnzonedRange.endMs, dateProfile.isRangeAllDay);\n\tthis.intervalStart = calendar.msToMoment(dateProfile.currentUnzonedRange.startMs, dateProfile.isRangeAllDay);\n\tthis.intervalEnd = calendar.msToMoment(dateProfile.currentUnzonedRange.endMs, dateProfile.isRangeAllDay);\n});\n\n;;\n\nView.mixin({\n\n\tusesMinMaxTime: false, // whether minTime/maxTime will affect the activeUnzonedRange. Views must opt-in.\n\n\t// DEPRECATED\n\tstart: null, // use activeUnzonedRange\n\tend: null, // use activeUnzonedRange\n\tintervalStart: null, // use currentUnzonedRange\n\tintervalEnd: null, // use currentUnzonedRange\n\n\n\t/* Date Range Computation\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Builds a structure with info about what the dates/ranges will be for the \"prev\" view.\n\tbuildPrevDateProfile: function(date) {\n\t\tvar dateProfile = this.get('dateProfile');\n\t\tvar prevDate = date.clone().startOf(dateProfile.currentRangeUnit)\n\t\t\t.subtract(dateProfile.dateIncrement);\n\n\t\treturn this.buildDateProfile(prevDate, -1);\n\t},\n\n\n\t// Builds a structure with info about what the dates/ranges will be for the \"next\" view.\n\tbuildNextDateProfile: function(date) {\n\t\tvar dateProfile = this.get('dateProfile');\n\t\tvar nextDate = date.clone().startOf(dateProfile.currentRangeUnit)\n\t\t\t.add(dateProfile.dateIncrement);\n\n\t\treturn this.buildDateProfile(nextDate, 1);\n\t},\n\n\n\t// Builds a structure holding dates/ranges for rendering around the given date.\n\t// Optional direction param indicates whether the date is being incremented/decremented\n\t// from its previous value. decremented = -1, incremented = 1 (default).\n\tbuildDateProfile: function(date, direction, forceToValid) {\n\t\tvar isDateAllDay = !date.hasTime();\n\t\tvar validUnzonedRange;\n\t\tvar minTime = null;\n\t\tvar maxTime = null;\n\t\tvar currentInfo;\n\t\tvar isRangeAllDay;\n\t\tvar renderUnzonedRange;\n\t\tvar activeUnzonedRange;\n\t\tvar isValid;\n\n\t\tvalidUnzonedRange = this.buildValidRange();\n\t\tvalidUnzonedRange = this.trimHiddenDays(validUnzonedRange);\n\n\t\tif (forceToValid) {\n\t\t\tdate = this.calendar.msToUtcMoment(\n\t\t\t\tvalidUnzonedRange.constrainDate(date), // returns MS\n\t\t\t\tisDateAllDay\n\t\t\t);\n\t\t}\n\n\t\tcurrentInfo = this.buildCurrentRangeInfo(date, direction);\n\t\tisRangeAllDay = /^(year|month|week|day)$/.test(currentInfo.unit);\n\t\trenderUnzonedRange = this.buildRenderRange(\n\t\t\tthis.trimHiddenDays(currentInfo.unzonedRange),\n\t\t\tcurrentInfo.unit,\n\t\t\tisRangeAllDay\n\t\t);\n\t\trenderUnzonedRange = this.trimHiddenDays(renderUnzonedRange);\n\t\tactiveUnzonedRange = renderUnzonedRange.clone();\n\n\t\tif (!this.opt('showNonCurrentDates')) {\n\t\t\tactiveUnzonedRange = activeUnzonedRange.intersect(currentInfo.unzonedRange);\n\t\t}\n\n\t\tminTime = moment.duration(this.opt('minTime'));\n\t\tmaxTime = moment.duration(this.opt('maxTime'));\n\t\tactiveUnzonedRange = this.adjustActiveRange(activeUnzonedRange, minTime, maxTime);\n\t\tactiveUnzonedRange = activeUnzonedRange.intersect(validUnzonedRange); // might return null\n\n\t\tif (activeUnzonedRange) {\n\t\t\tdate = this.calendar.msToUtcMoment(\n\t\t\t\tactiveUnzonedRange.constrainDate(date), // returns MS\n\t\t\t\tisDateAllDay\n\t\t\t);\n\t\t}\n\n\t\t// it's invalid if the originally requested date is not contained,\n\t\t// or if the range is completely outside of the valid range.\n\t\tisValid = currentInfo.unzonedRange.intersectsWith(validUnzonedRange);\n\n\t\treturn {\n\t\t\t// constraint for where prev/next operations can go and where events can be dragged/resized to.\n\t\t\t// an object with optional start and end properties.\n\t\t\tvalidUnzonedRange: validUnzonedRange,\n\n\t\t\t// range the view is formally responsible for.\n\t\t\t// for example, a month view might have 1st-31st, excluding padded dates\n\t\t\tcurrentUnzonedRange: currentInfo.unzonedRange,\n\n\t\t\t// name of largest unit being displayed, like \"month\" or \"week\"\n\t\t\tcurrentRangeUnit: currentInfo.unit,\n\n\t\t\tisRangeAllDay: isRangeAllDay,\n\n\t\t\t// dates that display events and accept drag-n-drop\n\t\t\t// will be `null` if no dates accept events\n\t\t\tactiveUnzonedRange: activeUnzonedRange,\n\n\t\t\t// date range with a rendered skeleton\n\t\t\t// includes not-active days that need some sort of DOM\n\t\t\trenderUnzonedRange: renderUnzonedRange,\n\n\t\t\t// Duration object that denotes the first visible time of any given day\n\t\t\tminTime: minTime,\n\n\t\t\t// Duration object that denotes the exclusive visible end time of any given day\n\t\t\tmaxTime: maxTime,\n\n\t\t\tisValid: isValid,\n\n\t\t\tdate: date,\n\n\t\t\t// how far the current date will move for a prev/next operation\n\t\t\tdateIncrement: this.buildDateIncrement(currentInfo.duration)\n\t\t\t\t// pass a fallback (might be null) ^\n\t\t};\n\t},\n\n\n\t// Builds an object with optional start/end properties.\n\t// Indicates the minimum/maximum dates to display.\n\t// not responsible for trimming hidden days.\n\tbuildValidRange: function() {\n\t\treturn this.getUnzonedRangeOption('validRange', this.calendar.getNow()) ||\n\t\t\tnew UnzonedRange(); // completely open-ended\n\t},\n\n\n\t// Builds a structure with info about the \"current\" range, the range that is\n\t// highlighted as being the current month for example.\n\t// See buildDateProfile for a description of `direction`.\n\t// Guaranteed to have `range` and `unit` properties. `duration` is optional.\n\t// TODO: accept a MS-time instead of a moment `date`?\n\tbuildCurrentRangeInfo: function(date, direction) {\n\t\tvar duration = null;\n\t\tvar unit = null;\n\t\tvar unzonedRange = null;\n\t\tvar dayCount;\n\n\t\tif (this.viewSpec.duration) {\n\t\t\tduration = this.viewSpec.duration;\n\t\t\tunit = this.viewSpec.durationUnit;\n\t\t\tunzonedRange = this.buildRangeFromDuration(date, direction, duration, unit);\n\t\t}\n\t\telse if ((dayCount = this.opt('dayCount'))) {\n\t\t\tunit = 'day';\n\t\t\tunzonedRange = this.buildRangeFromDayCount(date, direction, dayCount);\n\t\t}\n\t\telse if ((unzonedRange = this.buildCustomVisibleRange(date))) {\n\t\t\tunit = computeGreatestUnit(unzonedRange.getStart(), unzonedRange.getEnd());\n\t\t}\n\t\telse {\n\t\t\tduration = this.getFallbackDuration();\n\t\t\tunit = computeGreatestUnit(duration);\n\t\t\tunzonedRange = this.buildRangeFromDuration(date, direction, duration, unit);\n\t\t}\n\n\t\treturn { duration: duration, unit: unit, unzonedRange: unzonedRange };\n\t},\n\n\n\tgetFallbackDuration: function() {\n\t\treturn moment.duration({ days: 1 });\n\t},\n\n\n\t// Returns a new activeUnzonedRange to have time values (un-ambiguate)\n\t// minTime or maxTime causes the range to expand.\n\tadjustActiveRange: function(unzonedRange, minTime, maxTime) {\n\t\tvar start = unzonedRange.getStart();\n\t\tvar end = unzonedRange.getEnd();\n\n\t\tif (this.usesMinMaxTime) {\n\n\t\t\tif (minTime < 0) {\n\t\t\t\tstart.time(0).add(minTime);\n\t\t\t}\n\n\t\t\tif (maxTime > 24 * 60 * 60 * 1000) { // beyond 24 hours?\n\t\t\t\tend.time(maxTime - (24 * 60 * 60 * 1000));\n\t\t\t}\n\t\t}\n\n\t\treturn new UnzonedRange(start, end);\n\t},\n\n\n\t// Builds the \"current\" range when it is specified as an explicit duration.\n\t// `unit` is the already-computed computeGreatestUnit value of duration.\n\t// TODO: accept a MS-time instead of a moment `date`?\n\tbuildRangeFromDuration: function(date, direction, duration, unit) {\n\t\tvar alignment = this.opt('dateAlignment');\n\t\tvar start = date.clone();\n\t\tvar end;\n\t\tvar dateIncrementInput;\n\t\tvar dateIncrementDuration;\n\n\t\t// if the view displays a single day or smaller\n\t\tif (duration.as('days') <= 1) {\n\t\t\tif (this.isHiddenDay(start)) {\n\t\t\t\tstart = this.skipHiddenDays(start, direction);\n\t\t\t\tstart.startOf('day');\n\t\t\t}\n\t\t}\n\n\t\t// compute what the alignment should be\n\t\tif (!alignment) {\n\t\t\tdateIncrementInput = this.opt('dateIncrement');\n\n\t\t\tif (dateIncrementInput) {\n\t\t\t\tdateIncrementDuration = moment.duration(dateIncrementInput);\n\n\t\t\t\t// use the smaller of the two units\n\t\t\t\tif (dateIncrementDuration < duration) {\n\t\t\t\t\talignment = computeDurationGreatestUnit(dateIncrementDuration, dateIncrementInput);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\talignment = unit;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\talignment = unit;\n\t\t\t}\n\t\t}\n\n\t\tstart.startOf(alignment);\n\t\tend = start.clone().add(duration);\n\n\t\treturn new UnzonedRange(start, end);\n\t},\n\n\n\t// Builds the \"current\" range when a dayCount is specified.\n\t// TODO: accept a MS-time instead of a moment `date`?\n\tbuildRangeFromDayCount: function(date, direction, dayCount) {\n\t\tvar customAlignment = this.opt('dateAlignment');\n\t\tvar runningCount = 0;\n\t\tvar start = date.clone();\n\t\tvar end;\n\n\t\tif (customAlignment) {\n\t\t\tstart.startOf(customAlignment);\n\t\t}\n\n\t\tstart.startOf('day');\n\t\tstart = this.skipHiddenDays(start, direction);\n\n\t\tend = start.clone();\n\t\tdo {\n\t\t\tend.add(1, 'day');\n\t\t\tif (!this.isHiddenDay(end)) {\n\t\t\t\trunningCount++;\n\t\t\t}\n\t\t} while (runningCount < dayCount);\n\n\t\treturn new UnzonedRange(start, end);\n\t},\n\n\n\t// Builds a normalized range object for the \"visible\" range,\n\t// which is a way to define the currentUnzonedRange and activeUnzonedRange at the same time.\n\t// TODO: accept a MS-time instead of a moment `date`?\n\tbuildCustomVisibleRange: function(date) {\n\t\tvar visibleUnzonedRange = this.getUnzonedRangeOption(\n\t\t\t'visibleRange',\n\t\t\tthis.calendar.applyTimezone(date) // correct zone. also generates new obj that avoids mutations\n\t\t);\n\n\t\tif (visibleUnzonedRange && (visibleUnzonedRange.startMs === null || visibleUnzonedRange.endMs === null)) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn visibleUnzonedRange;\n\t},\n\n\n\t// Computes the range that will represent the element/cells for *rendering*,\n\t// but which may have voided days/times.\n\t// not responsible for trimming hidden days.\n\tbuildRenderRange: function(currentUnzonedRange, currentRangeUnit, isRangeAllDay) {\n\t\treturn currentUnzonedRange.clone();\n\t},\n\n\n\t// Compute the duration value that should be added/substracted to the current date\n\t// when a prev/next operation happens.\n\tbuildDateIncrement: function(fallback) {\n\t\tvar dateIncrementInput = this.opt('dateIncrement');\n\t\tvar customAlignment;\n\n\t\tif (dateIncrementInput) {\n\t\t\treturn moment.duration(dateIncrementInput);\n\t\t}\n\t\telse if ((customAlignment = this.opt('dateAlignment'))) {\n\t\t\treturn moment.duration(1, customAlignment);\n\t\t}\n\t\telse if (fallback) {\n\t\t\treturn fallback;\n\t\t}\n\t\telse {\n\t\t\treturn moment.duration({ days: 1 });\n\t\t}\n\t},\n\n\n\t// Remove days from the beginning and end of the range that are computed as hidden.\n\ttrimHiddenDays: function(inputUnzonedRange) {\n\t\tvar start = inputUnzonedRange.getStart();\n\t\tvar end = inputUnzonedRange.getEnd();\n\n\t\tif (start) {\n\t\t\tstart = this.skipHiddenDays(start);\n\t\t}\n\n\t\tif (end) {\n\t\t\tend = this.skipHiddenDays(end, -1, true);\n\t\t}\n\n\t\treturn new UnzonedRange(start, end);\n\t},\n\n\n\t// For DateComponent::getDayClasses\n\tisDateInOtherMonth: function(date, dateProfile) {\n\t\treturn false;\n\t},\n\n\n\t// Arguments after name will be forwarded to a hypothetical function value\n\t// WARNING: passed-in arguments will be given to generator functions as-is and can cause side-effects.\n\t// Always clone your objects if you fear mutation.\n\tgetUnzonedRangeOption: function(name) {\n\t\tvar val = this.opt(name);\n\n\t\tif (typeof val === 'function') {\n\t\t\tval = val.apply(\n\t\t\t\tnull,\n\t\t\t\tArray.prototype.slice.call(arguments, 1)\n\t\t\t);\n\t\t}\n\n\t\tif (val) {\n\t\t\treturn this.calendar.parseUnzonedRange(val);\n\t\t}\n\t},\n\n\n\t/* Hidden Days\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Initializes internal variables related to calculating hidden days-of-week\n\tinitHiddenDays: function() {\n\t\tvar hiddenDays = this.opt('hiddenDays') || []; // array of day-of-week indices that are hidden\n\t\tvar isHiddenDayHash = []; // is the day-of-week hidden? (hash with day-of-week-index -> bool)\n\t\tvar dayCnt = 0;\n\t\tvar i;\n\n\t\tif (this.opt('weekends') === false) {\n\t\t\thiddenDays.push(0, 6); // 0=sunday, 6=saturday\n\t\t}\n\n\t\tfor (i = 0; i < 7; i++) {\n\t\t\tif (\n\t\t\t\t!(isHiddenDayHash[i] = $.inArray(i, hiddenDays) !== -1)\n\t\t\t) {\n\t\t\t\tdayCnt++;\n\t\t\t}\n\t\t}\n\n\t\tif (!dayCnt) {\n\t\t\tthrow 'invalid hiddenDays'; // all days were hidden? bad.\n\t\t}\n\n\t\tthis.isHiddenDayHash = isHiddenDayHash;\n\t},\n\n\n\t// Is the current day hidden?\n\t// `day` is a day-of-week index (0-6), or a Moment\n\tisHiddenDay: function(day) {\n\t\tif (moment.isMoment(day)) {\n\t\t\tday = day.day();\n\t\t}\n\t\treturn this.isHiddenDayHash[day];\n\t},\n\n\n\t// Incrementing the current day until it is no longer a hidden day, returning a copy.\n\t// DOES NOT CONSIDER validUnzonedRange!\n\t// If the initial value of `date` is not a hidden day, don't do anything.\n\t// Pass `isExclusive` as `true` if you are dealing with an end date.\n\t// `inc` defaults to `1` (increment one day forward each time)\n\tskipHiddenDays: function(date, inc, isExclusive) {\n\t\tvar out = date.clone();\n\t\tinc = inc || 1;\n\t\twhile (\n\t\t\tthis.isHiddenDayHash[(out.day() + (isExclusive ? inc : 0) + 7) % 7]\n\t\t) {\n\t\t\tout.add(inc, 'days');\n\t\t}\n\t\treturn out;\n\t}\n\n});\n\n;;\n\n/* Toolbar with buttons and title\n----------------------------------------------------------------------------------------------------------------------*/\n\nfunction Toolbar(calendar, toolbarOptions) {\n\tvar t = this;\n\n\t// exports\n\tt.setToolbarOptions = setToolbarOptions;\n\tt.render = render;\n\tt.removeElement = removeElement;\n\tt.updateTitle = updateTitle;\n\tt.activateButton = activateButton;\n\tt.deactivateButton = deactivateButton;\n\tt.disableButton = disableButton;\n\tt.enableButton = enableButton;\n\tt.getViewsWithButtons = getViewsWithButtons;\n\tt.el = null; // mirrors local `el`\n\n\t// locals\n\tvar el;\n\tvar viewsWithButtons = [];\n\n\t// method to update toolbar-specific options, not calendar-wide options\n\tfunction setToolbarOptions(newToolbarOptions) {\n\t\ttoolbarOptions = newToolbarOptions;\n\t}\n\n\t// can be called repeatedly and will rerender\n\tfunction render() {\n\t\tvar sections = toolbarOptions.layout;\n\n\t\tif (sections) {\n\t\t\tif (!el) {\n\t\t\t\tel = this.el = $(\"<div class='fc-toolbar \"+ toolbarOptions.extraClasses + \"'/>\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\tel.empty();\n\t\t\t}\n\t\t\tel.append(renderSection('left'))\n\t\t\t\t.append(renderSection('right'))\n\t\t\t\t.append(renderSection('center'))\n\t\t\t\t.append('<div class=\"fc-clear\"/>');\n\t\t}\n\t\telse {\n\t\t\tremoveElement();\n\t\t}\n\t}\n\n\n\tfunction removeElement() {\n\t\tif (el) {\n\t\t\tel.remove();\n\t\t\tel = t.el = null;\n\t\t}\n\t}\n\n\n\tfunction renderSection(position) {\n\t\tvar theme = calendar.theme;\n\t\tvar sectionEl = $('<div class=\"fc-' + position + '\"/>');\n\t\tvar buttonStr = toolbarOptions.layout[position];\n\t\tvar calendarCustomButtons = calendar.opt('customButtons') || {};\n\t\tvar calendarButtonTextOverrides = calendar.overrides.buttonText || {};\n\t\tvar calendarButtonText = calendar.opt('buttonText') || {};\n\n\t\tif (buttonStr) {\n\t\t\t$.each(buttonStr.split(' '), function(i) {\n\t\t\t\tvar groupChildren = $();\n\t\t\t\tvar isOnlyButtons = true;\n\t\t\t\tvar groupEl;\n\n\t\t\t\t$.each(this.split(','), function(j, buttonName) {\n\t\t\t\t\tvar customButtonProps;\n\t\t\t\t\tvar viewSpec;\n\t\t\t\t\tvar buttonClick;\n\t\t\t\t\tvar buttonIcon; // only one of these will be set\n\t\t\t\t\tvar buttonText; // \"\n\t\t\t\t\tvar buttonInnerHtml;\n\t\t\t\t\tvar buttonClasses;\n\t\t\t\t\tvar buttonEl;\n\n\t\t\t\t\tif (buttonName == 'title') {\n\t\t\t\t\t\tgroupChildren = groupChildren.add($('<h2>&nbsp;</h2>')); // we always want it to take up height\n\t\t\t\t\t\tisOnlyButtons = false;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\n\t\t\t\t\t\tif ((customButtonProps = calendarCustomButtons[buttonName])) {\n\t\t\t\t\t\t\tbuttonClick = function(ev) {\n\t\t\t\t\t\t\t\tif (customButtonProps.click) {\n\t\t\t\t\t\t\t\t\tcustomButtonProps.click.call(buttonEl[0], ev);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t(buttonIcon = theme.getCustomButtonIconClass(customButtonProps)) ||\n\t\t\t\t\t\t\t(buttonIcon = theme.getIconClass(buttonName)) ||\n\t\t\t\t\t\t\t(buttonText = customButtonProps.text); // jshint ignore:line\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if ((viewSpec = calendar.getViewSpec(buttonName))) {\n\t\t\t\t\t\t\tviewsWithButtons.push(buttonName);\n\t\t\t\t\t\t\tbuttonClick = function() {\n\t\t\t\t\t\t\t\tcalendar.changeView(buttonName);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t(buttonText = viewSpec.buttonTextOverride) ||\n\t\t\t\t\t\t\t(buttonIcon = theme.getIconClass(buttonName)) ||\n\t\t\t\t\t\t\t(buttonText = viewSpec.buttonTextDefault); // jshint ignore:line\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (calendar[buttonName]) { // a calendar method\n\t\t\t\t\t\t\tbuttonClick = function() {\n\t\t\t\t\t\t\t\tcalendar[buttonName]();\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t(buttonText = calendarButtonTextOverrides[buttonName]) ||\n\t\t\t\t\t\t\t(buttonIcon = theme.getIconClass(buttonName)) ||\n\t\t\t\t\t\t\t(buttonText = calendarButtonText[buttonName]); // jshint ignore:line\n\t\t\t\t\t\t\t//            ^ everything else is considered default\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (buttonClick) {\n\n\t\t\t\t\t\t\tbuttonClasses = [\n\t\t\t\t\t\t\t\t'fc-' + buttonName + '-button',\n\t\t\t\t\t\t\t\ttheme.getClass('button'),\n\t\t\t\t\t\t\t\ttheme.getClass('stateDefault')\n\t\t\t\t\t\t\t];\n\n\t\t\t\t\t\t\tif (buttonText) {\n\t\t\t\t\t\t\t\tbuttonInnerHtml = htmlEscape(buttonText);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (buttonIcon) {\n\t\t\t\t\t\t\t\tbuttonInnerHtml = \"<span class='\" + buttonIcon + \"'></span>\";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbuttonEl = $( // type=\"button\" so that it doesn't submit a form\n\t\t\t\t\t\t\t\t'<button type=\"button\" class=\"' + buttonClasses.join(' ') + '\">' +\n\t\t\t\t\t\t\t\t\tbuttonInnerHtml +\n\t\t\t\t\t\t\t\t'</button>'\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.click(function(ev) {\n\t\t\t\t\t\t\t\t\t// don't process clicks for disabled buttons\n\t\t\t\t\t\t\t\t\tif (!buttonEl.hasClass(theme.getClass('stateDisabled'))) {\n\n\t\t\t\t\t\t\t\t\t\tbuttonClick(ev);\n\n\t\t\t\t\t\t\t\t\t\t// after the click action, if the button becomes the \"active\" tab, or disabled,\n\t\t\t\t\t\t\t\t\t\t// it should never have a hover class, so remove it now.\n\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\tbuttonEl.hasClass(theme.getClass('stateActive')) ||\n\t\t\t\t\t\t\t\t\t\t\tbuttonEl.hasClass(theme.getClass('stateDisabled'))\n\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\tbuttonEl.removeClass(theme.getClass('stateHover'));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.mousedown(function() {\n\t\t\t\t\t\t\t\t\t// the *down* effect (mouse pressed in).\n\t\t\t\t\t\t\t\t\t// only on buttons that are not the \"active\" tab, or disabled\n\t\t\t\t\t\t\t\t\tbuttonEl\n\t\t\t\t\t\t\t\t\t\t.not('.' + theme.getClass('stateActive'))\n\t\t\t\t\t\t\t\t\t\t.not('.' + theme.getClass('stateDisabled'))\n\t\t\t\t\t\t\t\t\t\t.addClass(theme.getClass('stateDown'));\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.mouseup(function() {\n\t\t\t\t\t\t\t\t\t// undo the *down* effect\n\t\t\t\t\t\t\t\t\tbuttonEl.removeClass(theme.getClass('stateDown'));\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.hover(\n\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\t// the *hover* effect.\n\t\t\t\t\t\t\t\t\t\t// only on buttons that are not the \"active\" tab, or disabled\n\t\t\t\t\t\t\t\t\t\tbuttonEl\n\t\t\t\t\t\t\t\t\t\t\t.not('.' + theme.getClass('stateActive'))\n\t\t\t\t\t\t\t\t\t\t\t.not('.' + theme.getClass('stateDisabled'))\n\t\t\t\t\t\t\t\t\t\t\t.addClass(theme.getClass('stateHover'));\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\t// undo the *hover* effect\n\t\t\t\t\t\t\t\t\t\tbuttonEl\n\t\t\t\t\t\t\t\t\t\t\t.removeClass(theme.getClass('stateHover'))\n\t\t\t\t\t\t\t\t\t\t\t.removeClass(theme.getClass('stateDown')); // if mouseleave happens before mouseup\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tgroupChildren = groupChildren.add(buttonEl);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (isOnlyButtons) {\n\t\t\t\t\tgroupChildren\n\t\t\t\t\t\t.first().addClass(theme.getClass('cornerLeft')).end()\n\t\t\t\t\t\t.last().addClass(theme.getClass('cornerRight')).end();\n\t\t\t\t}\n\n\t\t\t\tif (groupChildren.length > 1) {\n\t\t\t\t\tgroupEl = $('<div/>');\n\t\t\t\t\tif (isOnlyButtons) {\n\t\t\t\t\t\tgroupEl.addClass(theme.getClass('buttonGroup'));\n\t\t\t\t\t}\n\t\t\t\t\tgroupEl.append(groupChildren);\n\t\t\t\t\tsectionEl.append(groupEl);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tsectionEl.append(groupChildren); // 1 or 0 children\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn sectionEl;\n\t}\n\n\n\tfunction updateTitle(text) {\n\t\tif (el) {\n\t\t\tel.find('h2').text(text);\n\t\t}\n\t}\n\n\n\tfunction activateButton(buttonName) {\n\t\tif (el) {\n\t\t\tel.find('.fc-' + buttonName + '-button')\n\t\t\t\t.addClass(calendar.theme.getClass('stateActive'));\n\t\t}\n\t}\n\n\n\tfunction deactivateButton(buttonName) {\n\t\tif (el) {\n\t\t\tel.find('.fc-' + buttonName + '-button')\n\t\t\t\t.removeClass(calendar.theme.getClass('stateActive'));\n\t\t}\n\t}\n\n\n\tfunction disableButton(buttonName) {\n\t\tif (el) {\n\t\t\tel.find('.fc-' + buttonName + '-button')\n\t\t\t\t.prop('disabled', true)\n\t\t\t\t.addClass(calendar.theme.getClass('stateDisabled'));\n\t\t}\n\t}\n\n\n\tfunction enableButton(buttonName) {\n\t\tif (el) {\n\t\t\tel.find('.fc-' + buttonName + '-button')\n\t\t\t\t.prop('disabled', false)\n\t\t\t\t.removeClass(calendar.theme.getClass('stateDisabled'));\n\t\t}\n\t}\n\n\n\tfunction getViewsWithButtons() {\n\t\treturn viewsWithButtons;\n\t}\n\n}\n\n;;\n\nvar Calendar = FC.Calendar = Class.extend(EmitterMixin, ListenerMixin, {\n\n\tview: null, // current View object\n\tviewsByType: null, // holds all instantiated view instances, current or not\n\tcurrentDate: null, // unzoned moment. private (public API should use getDate instead)\n\ttheme: null,\n\tbusinessHourGenerator: null,\n\tloadingLevel: 0, // number of simultaneous loading tasks\n\n\n\tconstructor: function(el, overrides) {\n\n\t\t// declare the current calendar instance relies on GlobalEmitter. needed for garbage collection.\n\t\t// unneeded() is called in destroy.\n\t\tGlobalEmitter.needed();\n\n\t\tthis.el = el;\n\t\tthis.viewsByType = {};\n\t\tthis.viewSpecCache = {};\n\n\t\tthis.initOptionsInternals(overrides);\n\t\tthis.initMomentInternals(); // needs to happen after options hash initialized\n\t\tthis.initCurrentDate();\n\t\tthis.initEventManager();\n\n\t\tthis.constructed();\n\t},\n\n\n\t// useful for monkeypatching. TODO: BaseClass?\n\tconstructed: function() {\n\t},\n\n\n\t// Public API\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tgetView: function() {\n\t\treturn this.view;\n\t},\n\n\n\tpubliclyTrigger: function(name, triggerInfo) {\n\t\tvar optHandler = this.opt(name);\n\t\tvar context;\n\t\tvar args;\n\n\t\tif ($.isPlainObject(triggerInfo)) {\n\t\t\tcontext = triggerInfo.context;\n\t\t\targs = triggerInfo.args;\n\t\t}\n\t\telse if ($.isArray(triggerInfo)) {\n\t\t\targs = triggerInfo;\n\t\t}\n\n\t\tif (context == null) {\n\t\t\tcontext = this.el[0]; // fallback context\n\t\t}\n\n\t\tif (!args) {\n\t\t\targs = [];\n\t\t}\n\n\t\tthis.triggerWith(name, context, args); // Emitter's method\n\n\t\tif (optHandler) {\n\t\t\treturn optHandler.apply(context, args);\n\t\t}\n\t},\n\n\n\thasPublicHandlers: function(name) {\n\t\treturn this.hasHandlers(name) ||\n\t\t\tthis.opt(name); // handler specified in options\n\t},\n\n\n\t// View\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\t// Given a view name for a custom view or a standard view, creates a ready-to-go View object\n\tinstantiateView: function(viewType) {\n\t\tvar spec = this.getViewSpec(viewType);\n\n\t\treturn new spec['class'](this, spec);\n\t},\n\n\n\t// Returns a boolean about whether the view is okay to instantiate at some point\n\tisValidViewType: function(viewType) {\n\t\treturn Boolean(this.getViewSpec(viewType));\n\t},\n\n\n\tchangeView: function(viewName, dateOrRange) {\n\n\t\tif (dateOrRange) {\n\n\t\t\tif (dateOrRange.start && dateOrRange.end) { // a range\n\t\t\t\tthis.recordOptionOverrides({ // will not rerender\n\t\t\t\t\tvisibleRange: dateOrRange\n\t\t\t\t});\n\t\t\t}\n\t\t\telse { // a date\n\t\t\t\tthis.currentDate = this.moment(dateOrRange).stripZone(); // just like gotoDate\n\t\t\t}\n\t\t}\n\n\t\tthis.renderView(viewName);\n\t},\n\n\n\t// Forces navigation to a view for the given date.\n\t// `viewType` can be a specific view name or a generic one like \"week\" or \"day\".\n\tzoomTo: function(newDate, viewType) {\n\t\tvar spec;\n\n\t\tviewType = viewType || 'day'; // day is default zoom\n\t\tspec = this.getViewSpec(viewType) || this.getUnitViewSpec(viewType);\n\n\t\tthis.currentDate = newDate.clone();\n\t\tthis.renderView(spec ? spec.type : null);\n\t},\n\n\n\t// Current Date\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tinitCurrentDate: function() {\n\t\tvar defaultDateInput = this.opt('defaultDate');\n\n\t\t// compute the initial ambig-timezone date\n\t\tif (defaultDateInput != null) {\n\t\t\tthis.currentDate = this.moment(defaultDateInput).stripZone();\n\t\t}\n\t\telse {\n\t\t\tthis.currentDate = this.getNow(); // getNow already returns unzoned\n\t\t}\n\t},\n\n\n\tprev: function() {\n\t\tvar prevInfo = this.view.buildPrevDateProfile(this.currentDate);\n\n\t\tif (prevInfo.isValid) {\n\t\t\tthis.currentDate = prevInfo.date;\n\t\t\tthis.renderView();\n\t\t}\n\t},\n\n\n\tnext: function() {\n\t\tvar nextInfo = this.view.buildNextDateProfile(this.currentDate);\n\n\t\tif (nextInfo.isValid) {\n\t\t\tthis.currentDate = nextInfo.date;\n\t\t\tthis.renderView();\n\t\t}\n\t},\n\n\n\tprevYear: function() {\n\t\tthis.currentDate.add(-1, 'years');\n\t\tthis.renderView();\n\t},\n\n\n\tnextYear: function() {\n\t\tthis.currentDate.add(1, 'years');\n\t\tthis.renderView();\n\t},\n\n\n\ttoday: function() {\n\t\tthis.currentDate = this.getNow(); // should deny like prev/next?\n\t\tthis.renderView();\n\t},\n\n\n\tgotoDate: function(zonedDateInput) {\n\t\tthis.currentDate = this.moment(zonedDateInput).stripZone();\n\t\tthis.renderView();\n\t},\n\n\n\tincrementDate: function(delta) {\n\t\tthis.currentDate.add(moment.duration(delta));\n\t\tthis.renderView();\n\t},\n\n\n\t// for external API\n\tgetDate: function() {\n\t\treturn this.applyTimezone(this.currentDate); // infuse the calendar's timezone\n\t},\n\n\n\t// Loading Triggering\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\t// Should be called when any type of async data fetching begins\n\tpushLoading: function() {\n\t\tif (!(this.loadingLevel++)) {\n\t\t\tthis.publiclyTrigger('loading', [ true, this.view ]);\n\t\t}\n\t},\n\n\n\t// Should be called when any type of async data fetching completes\n\tpopLoading: function() {\n\t\tif (!(--this.loadingLevel)) {\n\t\t\tthis.publiclyTrigger('loading', [ false, this.view ]);\n\t\t}\n\t},\n\n\n\t// Selection\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\t// this public method receives start/end dates in any format, with any timezone\n\tselect: function(zonedStartInput, zonedEndInput) {\n\t\tthis.view.select(\n\t\t\tthis.buildSelectFootprint.apply(this, arguments)\n\t\t);\n\t},\n\n\n\tunselect: function() { // safe to be called before renderView\n\t\tif (this.view) {\n\t\t\tthis.view.unselect();\n\t\t}\n\t},\n\n\n\t// Given arguments to the select method in the API, returns a span (unzoned start/end and other info)\n\tbuildSelectFootprint: function(zonedStartInput, zonedEndInput) {\n\t\tvar start = this.moment(zonedStartInput).stripZone();\n\t\tvar end;\n\n\t\tif (zonedEndInput) {\n\t\t\tend = this.moment(zonedEndInput).stripZone();\n\t\t}\n\t\telse if (start.hasTime()) {\n\t\t\tend = start.clone().add(this.defaultTimedEventDuration);\n\t\t}\n\t\telse {\n\t\t\tend = start.clone().add(this.defaultAllDayEventDuration);\n\t\t}\n\n\t\treturn new ComponentFootprint(\n\t\t\tnew UnzonedRange(start, end),\n\t\t\t!start.hasTime()\n\t\t);\n\t},\n\n\n\t// Misc\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\t// will return `null` if invalid range\n\tparseUnzonedRange: function(rangeInput) {\n\t\tvar start = null;\n\t\tvar end = null;\n\n\t\tif (rangeInput.start) {\n\t\t\tstart = this.moment(rangeInput.start).stripZone();\n\t\t}\n\n\t\tif (rangeInput.end) {\n\t\t\tend = this.moment(rangeInput.end).stripZone();\n\t\t}\n\n\t\tif (!start && !end) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (start && end && end.isBefore(start)) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new UnzonedRange(start, end);\n\t},\n\n\n\trerenderEvents: function() { // API method. destroys old events if previously rendered.\n\t\tthis.view.flash('displayingEvents');\n\t},\n\n\n\tinitEventManager: function() {\n\t\tvar _this = this;\n\t\tvar eventManager = new EventManager(this);\n\t\tvar rawSources = this.opt('eventSources') || [];\n\t\tvar singleRawSource = this.opt('events');\n\n\t\tthis.eventManager = eventManager;\n\n\t\tif (singleRawSource) {\n\t\t\trawSources.unshift(singleRawSource);\n\t\t}\n\n\t\teventManager.on('release', function(eventsPayload) {\n\t\t\t_this.trigger('eventsReset', eventsPayload);\n\t\t});\n\n\t\teventManager.freeze();\n\n\t\trawSources.forEach(function(rawSource) {\n\t\t\tvar source = EventSourceParser.parse(rawSource, _this);\n\n\t\t\tif (source) {\n\t\t\t\teventManager.addSource(source);\n\t\t\t}\n\t\t});\n\n\t\teventManager.thaw();\n\t},\n\n\n\trequestEvents: function(start, end) {\n\t\treturn this.eventManager.requestEvents(\n\t\t\tstart,\n\t\t\tend,\n\t\t\tthis.opt('timezone'),\n\t\t\t!this.opt('lazyFetching')\n\t\t);\n\t}\n\n});\n\n;;\n/*\nOptions binding/triggering system.\n*/\nCalendar.mixin({\n\n\tdirDefaults: null, // option defaults related to LTR or RTL\n\tlocaleDefaults: null, // option defaults related to current locale\n\toverrides: null, // option overrides given to the fullCalendar constructor\n\tdynamicOverrides: null, // options set with dynamic setter method. higher precedence than view overrides.\n\toptionsModel: null, // all defaults combined with overrides\n\n\n\tinitOptionsInternals: function(overrides) {\n\t\tthis.overrides = $.extend({}, overrides); // make a copy\n\t\tthis.dynamicOverrides = {};\n\t\tthis.optionsModel = new Model();\n\n\t\tthis.populateOptionsHash();\n\t},\n\n\n\t// public getter/setter\n\toption: function(name, value) {\n\t\tvar newOptionHash;\n\n\t\tif (typeof name === 'string') {\n\t\t\tif (value === undefined) { // getter\n\t\t\t\treturn this.optionsModel.get(name);\n\t\t\t}\n\t\t\telse { // setter for individual option\n\t\t\t\tnewOptionHash = {};\n\t\t\t\tnewOptionHash[name] = value;\n\t\t\t\tthis.setOptions(newOptionHash);\n\t\t\t}\n\t\t}\n\t\telse if (typeof name === 'object') { // compound setter with object input\n\t\t\tthis.setOptions(name);\n\t\t}\n\t},\n\n\n\t// private getter\n\topt: function(name) {\n\t\treturn this.optionsModel.get(name);\n\t},\n\n\n\tsetOptions: function(newOptionHash) {\n\t\tvar optionCnt = 0;\n\t\tvar optionName;\n\n\t\tthis.recordOptionOverrides(newOptionHash); // will trigger optionsModel watchers\n\n\t\tfor (optionName in newOptionHash) {\n\t\t\toptionCnt++;\n\t\t}\n\n\t\t// special-case handling of single option change.\n\t\t// if only one option change, `optionName` will be its name.\n\t\tif (optionCnt === 1) {\n\t\t\tif (optionName === 'height' || optionName === 'contentHeight' || optionName === 'aspectRatio') {\n\t\t\t\tthis.updateViewSize(true); // isResize=true\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if (optionName === 'defaultDate') {\n\t\t\t\treturn; // can't change date this way. use gotoDate instead\n\t\t\t}\n\t\t\telse if (optionName === 'businessHours') {\n\t\t\t\treturn; // optionsModel already reacts to this\n\t\t\t}\n\t\t\telse if (optionName === 'timezone') {\n\t\t\t\tthis.view.flash('initialEvents');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// catch-all. rerender the header and footer and rebuild/rerender the current view\n\t\tthis.renderHeader();\n\t\tthis.renderFooter();\n\n\t\t// even non-current views will be affected by this option change. do before rerender\n\t\t// TODO: detangle\n\t\tthis.viewsByType = {};\n\n\t\tthis.reinitView();\n\t},\n\n\n\t// Computes the flattened options hash for the calendar and assigns to `this.options`.\n\t// Assumes this.overrides and this.dynamicOverrides have already been initialized.\n\tpopulateOptionsHash: function() {\n\t\tvar locale, localeDefaults;\n\t\tvar isRTL, dirDefaults;\n\t\tvar rawOptions;\n\n\t\tlocale = firstDefined( // explicit locale option given?\n\t\t\tthis.dynamicOverrides.locale,\n\t\t\tthis.overrides.locale\n\t\t);\n\t\tlocaleDefaults = localeOptionHash[locale];\n\t\tif (!localeDefaults) { // explicit locale option not given or invalid?\n\t\t\tlocale = Calendar.defaults.locale;\n\t\t\tlocaleDefaults = localeOptionHash[locale] || {};\n\t\t}\n\n\t\tisRTL = firstDefined( // based on options computed so far, is direction RTL?\n\t\t\tthis.dynamicOverrides.isRTL,\n\t\t\tthis.overrides.isRTL,\n\t\t\tlocaleDefaults.isRTL,\n\t\t\tCalendar.defaults.isRTL\n\t\t);\n\t\tdirDefaults = isRTL ? Calendar.rtlDefaults : {};\n\n\t\tthis.dirDefaults = dirDefaults;\n\t\tthis.localeDefaults = localeDefaults;\n\n\t\trawOptions = mergeOptions([ // merge defaults and overrides. lowest to highest precedence\n\t\t\tCalendar.defaults, // global defaults\n\t\t\tdirDefaults,\n\t\t\tlocaleDefaults,\n\t\t\tthis.overrides,\n\t\t\tthis.dynamicOverrides\n\t\t]);\n\t\tpopulateInstanceComputableOptions(rawOptions); // fill in gaps with computed options\n\n\t\tthis.optionsModel.reset(rawOptions);\n\t},\n\n\n\t// stores the new options internally, but does not rerender anything.\n\trecordOptionOverrides: function(newOptionHash) {\n\t\tvar optionName;\n\n\t\tfor (optionName in newOptionHash) {\n\t\t\tthis.dynamicOverrides[optionName] = newOptionHash[optionName];\n\t\t}\n\n\t\tthis.viewSpecCache = {}; // the dynamic override invalidates the options in this cache, so just clear it\n\t\tthis.populateOptionsHash(); // this.options needs to be recomputed after the dynamic override\n\t}\n\n});\n\n;;\n\nCalendar.mixin({\n\n\tdefaultAllDayEventDuration: null,\n\tdefaultTimedEventDuration: null,\n\tlocaleData: null,\n\n\n\tinitMomentInternals: function() {\n\t\tvar _this = this;\n\n\t\tthis.defaultAllDayEventDuration = moment.duration(this.opt('defaultAllDayEventDuration'));\n\t\tthis.defaultTimedEventDuration = moment.duration(this.opt('defaultTimedEventDuration'));\n\n\t\t// Called immediately, and when any of the options change.\n\t\t// Happens before any internal objects rebuild or rerender, because this is very core.\n\t\tthis.optionsModel.watch('buildingMomentLocale', [\n\t\t\t'?locale', '?monthNames', '?monthNamesShort', '?dayNames', '?dayNamesShort',\n\t\t\t'?firstDay', '?weekNumberCalculation'\n\t\t], function(opts) {\n\t\t\tvar weekNumberCalculation = opts.weekNumberCalculation;\n\t\t\tvar firstDay = opts.firstDay;\n\t\t\tvar _week;\n\n\t\t\t// normalize\n\t\t\tif (weekNumberCalculation === 'iso') {\n\t\t\t\tweekNumberCalculation = 'ISO'; // normalize\n\t\t\t}\n\n\t\t\tvar localeData = Object.create( // make a cheap copy\n\t\t\t\tgetMomentLocaleData(opts.locale) // will fall back to en\n\t\t\t);\n\n\t\t\tif (opts.monthNames) {\n\t\t\t\tlocaleData._months = opts.monthNames;\n\t\t\t}\n\t\t\tif (opts.monthNamesShort) {\n\t\t\t\tlocaleData._monthsShort = opts.monthNamesShort;\n\t\t\t}\n\t\t\tif (opts.dayNames) {\n\t\t\t\tlocaleData._weekdays = opts.dayNames;\n\t\t\t}\n\t\t\tif (opts.dayNamesShort) {\n\t\t\t\tlocaleData._weekdaysShort = opts.dayNamesShort;\n\t\t\t}\n\n\t\t\tif (firstDay == null && weekNumberCalculation === 'ISO') {\n\t\t\t\tfirstDay = 1;\n\t\t\t}\n\t\t\tif (firstDay != null) {\n\t\t\t\t_week = Object.create(localeData._week); // _week: { dow: # }\n\t\t\t\t_week.dow = firstDay;\n\t\t\t\tlocaleData._week = _week;\n\t\t\t}\n\n\t\t\tif ( // whitelist certain kinds of input\n\t\t\t\tweekNumberCalculation === 'ISO' ||\n\t\t\t\tweekNumberCalculation === 'local' ||\n\t\t\t\ttypeof weekNumberCalculation === 'function'\n\t\t\t) {\n\t\t\t\tlocaleData._fullCalendar_weekCalc = weekNumberCalculation; // moment-ext will know what to do with it\n\t\t\t}\n\n\t\t\t_this.localeData = localeData;\n\n\t\t\t// If the internal current date object already exists, move to new locale.\n\t\t\t// We do NOT need to do this technique for event dates, because this happens when converting to \"segments\".\n\t\t\tif (_this.currentDate) {\n\t\t\t\t_this.localizeMoment(_this.currentDate); // sets to localeData\n\t\t\t}\n\t\t});\n\t},\n\n\n\t// Builds a moment using the settings of the current calendar: timezone and locale.\n\t// Accepts anything the vanilla moment() constructor accepts.\n\tmoment: function() {\n\t\tvar mom;\n\n\t\tif (this.opt('timezone') === 'local') {\n\t\t\tmom = FC.moment.apply(null, arguments);\n\n\t\t\t// Force the moment to be local, because FC.moment doesn't guarantee it.\n\t\t\tif (mom.hasTime()) { // don't give ambiguously-timed moments a local zone\n\t\t\t\tmom.local();\n\t\t\t}\n\t\t}\n\t\telse if (this.opt('timezone') === 'UTC') {\n\t\t\tmom = FC.moment.utc.apply(null, arguments); // process as UTC\n\t\t}\n\t\telse {\n\t\t\tmom = FC.moment.parseZone.apply(null, arguments); // let the input decide the zone\n\t\t}\n\n\t\tthis.localizeMoment(mom); // TODO\n\n\t\treturn mom;\n\t},\n\n\n\tmsToMoment: function(ms, forceAllDay) {\n\t\tvar mom = FC.moment.utc(ms); // TODO: optimize by using Date.UTC\n\n\t\tif (forceAllDay) {\n\t\t\tmom.stripTime();\n\t\t}\n\t\telse {\n\t\t\tmom = this.applyTimezone(mom); // may or may not apply locale\n\t\t}\n\n\t\tthis.localizeMoment(mom);\n\n\t\treturn mom;\n\t},\n\n\n\tmsToUtcMoment: function(ms, forceAllDay) {\n\t\tvar mom = FC.moment.utc(ms); // TODO: optimize by using Date.UTC\n\n\t\tif (forceAllDay) {\n\t\t\tmom.stripTime();\n\t\t}\n\n\t\tthis.localizeMoment(mom);\n\n\t\treturn mom;\n\t},\n\n\n\t// Updates the given moment's locale settings to the current calendar locale settings.\n\tlocalizeMoment: function(mom) {\n\t\tmom._locale = this.localeData;\n\t},\n\n\n\t// Returns a boolean about whether or not the calendar knows how to calculate\n\t// the timezone offset of arbitrary dates in the current timezone.\n\tgetIsAmbigTimezone: function() {\n\t\treturn this.opt('timezone') !== 'local' && this.opt('timezone') !== 'UTC';\n\t},\n\n\n\t// Returns a copy of the given date in the current timezone. Has no effect on dates without times.\n\tapplyTimezone: function(date) {\n\t\tif (!date.hasTime()) {\n\t\t\treturn date.clone();\n\t\t}\n\n\t\tvar zonedDate = this.moment(date.toArray());\n\t\tvar timeAdjust = date.time() - zonedDate.time();\n\t\tvar adjustedZonedDate;\n\n\t\t// Safari sometimes has problems with this coersion when near DST. Adjust if necessary. (bug #2396)\n\t\tif (timeAdjust) { // is the time result different than expected?\n\t\t\tadjustedZonedDate = zonedDate.clone().add(timeAdjust); // add milliseconds\n\t\t\tif (date.time() - adjustedZonedDate.time() === 0) { // does it match perfectly now?\n\t\t\t\tzonedDate = adjustedZonedDate;\n\t\t\t}\n\t\t}\n\n\t\treturn zonedDate;\n\t},\n\n\n\t/*\n\tAssumes the footprint is non-open-ended.\n\t*/\n\tfootprintToDateProfile: function(componentFootprint, ignoreEnd) {\n\t\tvar start = FC.moment.utc(componentFootprint.unzonedRange.startMs);\n\t\tvar end;\n\n\t\tif (!ignoreEnd) {\n\t\t\tend = FC.moment.utc(componentFootprint.unzonedRange.endMs);\n\t\t}\n\n\t\tif (componentFootprint.isAllDay) {\n\t\t\tstart.stripTime();\n\n\t\t\tif (end) {\n\t\t\t\tend.stripTime();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tstart = this.applyTimezone(start);\n\n\t\t\tif (end) {\n\t\t\t\tend = this.applyTimezone(end);\n\t\t\t}\n\t\t}\n\n\t\treturn new EventDateProfile(start, end, this);\n\t},\n\n\n\t// Returns a moment for the current date, as defined by the client's computer or from the `now` option.\n\t// Will return an moment with an ambiguous timezone.\n\tgetNow: function() {\n\t\tvar now = this.opt('now');\n\t\tif (typeof now === 'function') {\n\t\t\tnow = now();\n\t\t}\n\t\treturn this.moment(now).stripZone();\n\t},\n\n\n\t// Produces a human-readable string for the given duration.\n\t// Side-effect: changes the locale of the given duration.\n\thumanizeDuration: function(duration) {\n\t\treturn duration.locale(this.opt('locale')).humanize();\n\t},\n\n\n\n\t// Event-Specific Date Utilities. TODO: move\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\t// Get an event's normalized end date. If not present, calculate it from the defaults.\n\tgetEventEnd: function(event) {\n\t\tif (event.end) {\n\t\t\treturn event.end.clone();\n\t\t}\n\t\telse {\n\t\t\treturn this.getDefaultEventEnd(event.allDay, event.start);\n\t\t}\n\t},\n\n\n\t// Given an event's allDay status and start date, return what its fallback end date should be.\n\t// TODO: rename to computeDefaultEventEnd\n\tgetDefaultEventEnd: function(allDay, zonedStart) {\n\t\tvar end = zonedStart.clone();\n\n\t\tif (allDay) {\n\t\t\tend.stripTime().add(this.defaultAllDayEventDuration);\n\t\t}\n\t\telse {\n\t\t\tend.add(this.defaultTimedEventDuration);\n\t\t}\n\n\t\tif (this.getIsAmbigTimezone()) {\n\t\t\tend.stripZone(); // we don't know what the tzo should be\n\t\t}\n\n\t\treturn end;\n\t}\n\n});\n\n;;\n\nCalendar.mixin({\n\n\tviewSpecCache: null, // cache of view definitions (initialized in Calendar.js)\n\n\n\t// Gets information about how to create a view. Will use a cache.\n\tgetViewSpec: function(viewType) {\n\t\tvar cache = this.viewSpecCache;\n\n\t\treturn cache[viewType] || (cache[viewType] = this.buildViewSpec(viewType));\n\t},\n\n\n\t// Given a duration singular unit, like \"week\" or \"day\", finds a matching view spec.\n\t// Preference is given to views that have corresponding buttons.\n\tgetUnitViewSpec: function(unit) {\n\t\tvar viewTypes;\n\t\tvar i;\n\t\tvar spec;\n\n\t\tif ($.inArray(unit, unitsDesc) != -1) {\n\n\t\t\t// put views that have buttons first. there will be duplicates, but oh well\n\t\t\tviewTypes = this.header.getViewsWithButtons(); // TODO: include footer as well?\n\t\t\t$.each(FC.views, function(viewType) { // all views\n\t\t\t\tviewTypes.push(viewType);\n\t\t\t});\n\n\t\t\tfor (i = 0; i < viewTypes.length; i++) {\n\t\t\t\tspec = this.getViewSpec(viewTypes[i]);\n\t\t\t\tif (spec) {\n\t\t\t\t\tif (spec.singleUnit == unit) {\n\t\t\t\t\t\treturn spec;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Builds an object with information on how to create a given view\n\tbuildViewSpec: function(requestedViewType) {\n\t\tvar viewOverrides = this.overrides.views || {};\n\t\tvar specChain = []; // for the view. lowest to highest priority\n\t\tvar defaultsChain = []; // for the view. lowest to highest priority\n\t\tvar overridesChain = []; // for the view. lowest to highest priority\n\t\tvar viewType = requestedViewType;\n\t\tvar spec; // for the view\n\t\tvar overrides; // for the view\n\t\tvar durationInput;\n\t\tvar duration;\n\t\tvar unit;\n\n\t\t// iterate from the specific view definition to a more general one until we hit an actual View class\n\t\twhile (viewType) {\n\t\t\tspec = fcViews[viewType];\n\t\t\toverrides = viewOverrides[viewType];\n\t\t\tviewType = null; // clear. might repopulate for another iteration\n\n\t\t\tif (typeof spec === 'function') { // TODO: deprecate\n\t\t\t\tspec = { 'class': spec };\n\t\t\t}\n\n\t\t\tif (spec) {\n\t\t\t\tspecChain.unshift(spec);\n\t\t\t\tdefaultsChain.unshift(spec.defaults || {});\n\t\t\t\tdurationInput = durationInput || spec.duration;\n\t\t\t\tviewType = viewType || spec.type;\n\t\t\t}\n\n\t\t\tif (overrides) {\n\t\t\t\toverridesChain.unshift(overrides); // view-specific option hashes have options at zero-level\n\t\t\t\tdurationInput = durationInput || overrides.duration;\n\t\t\t\tviewType = viewType || overrides.type;\n\t\t\t}\n\t\t}\n\n\t\tspec = mergeProps(specChain);\n\t\tspec.type = requestedViewType;\n\t\tif (!spec['class']) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// fall back to top-level `duration` option\n\t\tdurationInput = durationInput ||\n\t\t\tthis.dynamicOverrides.duration ||\n\t\t\tthis.overrides.duration;\n\n\t\tif (durationInput) {\n\t\t\tduration = moment.duration(durationInput);\n\n\t\t\tif (duration.valueOf()) { // valid?\n\n\t\t\t\tunit = computeDurationGreatestUnit(duration, durationInput);\n\n\t\t\t\tspec.duration = duration;\n\t\t\t\tspec.durationUnit = unit;\n\n\t\t\t\t// view is a single-unit duration, like \"week\" or \"day\"\n\t\t\t\t// incorporate options for this. lowest priority\n\t\t\t\tif (duration.as(unit) === 1) {\n\t\t\t\t\tspec.singleUnit = unit;\n\t\t\t\t\toverridesChain.unshift(viewOverrides[unit] || {});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tspec.defaults = mergeOptions(defaultsChain);\n\t\tspec.overrides = mergeOptions(overridesChain);\n\n\t\tthis.buildViewSpecOptions(spec);\n\t\tthis.buildViewSpecButtonText(spec, requestedViewType);\n\n\t\treturn spec;\n\t},\n\n\n\t// Builds and assigns a view spec's options object from its already-assigned defaults and overrides\n\tbuildViewSpecOptions: function(spec) {\n\t\tspec.options = mergeOptions([ // lowest to highest priority\n\t\t\tCalendar.defaults, // global defaults\n\t\t\tspec.defaults, // view's defaults (from ViewSubclass.defaults)\n\t\t\tthis.dirDefaults,\n\t\t\tthis.localeDefaults, // locale and dir take precedence over view's defaults!\n\t\t\tthis.overrides, // calendar's overrides (options given to constructor)\n\t\t\tspec.overrides, // view's overrides (view-specific options)\n\t\t\tthis.dynamicOverrides // dynamically set via setter. highest precedence\n\t\t]);\n\t\tpopulateInstanceComputableOptions(spec.options);\n\t},\n\n\n\t// Computes and assigns a view spec's buttonText-related options\n\tbuildViewSpecButtonText: function(spec, requestedViewType) {\n\n\t\t// given an options object with a possible `buttonText` hash, lookup the buttonText for the\n\t\t// requested view, falling back to a generic unit entry like \"week\" or \"day\"\n\t\tfunction queryButtonText(options) {\n\t\t\tvar buttonText = options.buttonText || {};\n\t\t\treturn buttonText[requestedViewType] ||\n\t\t\t\t// view can decide to look up a certain key\n\t\t\t\t(spec.buttonTextKey ? buttonText[spec.buttonTextKey] : null) ||\n\t\t\t\t// a key like \"month\"\n\t\t\t\t(spec.singleUnit ? buttonText[spec.singleUnit] : null);\n\t\t}\n\n\t\t// highest to lowest priority\n\t\tspec.buttonTextOverride =\n\t\t\tqueryButtonText(this.dynamicOverrides) ||\n\t\t\tqueryButtonText(this.overrides) || // constructor-specified buttonText lookup hash takes precedence\n\t\t\tspec.overrides.buttonText; // `buttonText` for view-specific options is a string\n\n\t\t// highest to lowest priority. mirrors buildViewSpecOptions\n\t\tspec.buttonTextDefault =\n\t\t\tqueryButtonText(this.localeDefaults) ||\n\t\t\tqueryButtonText(this.dirDefaults) ||\n\t\t\tspec.defaults.buttonText || // a single string. from ViewSubclass.defaults\n\t\t\tqueryButtonText(Calendar.defaults) ||\n\t\t\t(spec.duration ? this.humanizeDuration(spec.duration) : null) || // like \"3 days\"\n\t\t\trequestedViewType; // fall back to given view name\n\t}\n\n});\n\n;;\n\nCalendar.mixin({\n\n\tel: null,\n\tcontentEl: null,\n\tsuggestedViewHeight: null,\n\tignoreUpdateViewSize: 0,\n\tfreezeContentHeightDepth: 0,\n\twindowResizeProxy: null,\n\n\n\trender: function() {\n\t\tif (!this.contentEl) {\n\t\t\tthis.initialRender();\n\t\t}\n\t\telse if (this.elementVisible()) {\n\t\t\t// mainly for the public API\n\t\t\tthis.calcSize();\n\t\t\tthis.renderView();\n\t\t}\n\t},\n\n\n\tinitialRender: function() {\n\t\tvar _this = this;\n\t\tvar el = this.el;\n\n\t\tel.addClass('fc');\n\n\t\t// event delegation for nav links\n\t\tel.on('click.fc', 'a[data-goto]', function(ev) {\n\t\t\tvar anchorEl = $(this);\n\t\t\tvar gotoOptions = anchorEl.data('goto'); // will automatically parse JSON\n\t\t\tvar date = _this.moment(gotoOptions.date);\n\t\t\tvar viewType = gotoOptions.type;\n\n\t\t\t// property like \"navLinkDayClick\". might be a string or a function\n\t\t\tvar customAction = _this.view.opt('navLink' + capitaliseFirstLetter(viewType) + 'Click');\n\n\t\t\tif (typeof customAction === 'function') {\n\t\t\t\tcustomAction(date, ev);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (typeof customAction === 'string') {\n\t\t\t\t\tviewType = customAction;\n\t\t\t\t}\n\t\t\t\t_this.zoomTo(date, viewType);\n\t\t\t}\n\t\t});\n\n\t\t// called immediately, and upon option change\n\t\tthis.optionsModel.watch('settingTheme', [ '?theme', '?themeSystem' ], function(opts) {\n\t\t\tvar themeClass = ThemeRegistry.getThemeClass(opts.themeSystem || opts.theme);\n\t\t\tvar theme = new themeClass(_this.optionsModel);\n\t\t\tvar widgetClass = theme.getClass('widget');\n\n\t\t\t_this.theme = theme;\n\n\t\t\tif (widgetClass) {\n\t\t\t\tel.addClass(widgetClass);\n\t\t\t}\n\t\t}, function() {\n\t\t\tvar widgetClass = _this.theme.getClass('widget');\n\n\t\t\t_this.theme = null;\n\n\t\t\tif (widgetClass) {\n\t\t\t\tel.removeClass(widgetClass);\n\t\t\t}\n\t\t});\n\n\t\tthis.optionsModel.watch('settingBusinessHourGenerator', [ '?businessHours' ], function(deps) {\n\t\t\t_this.businessHourGenerator = new BusinessHourGenerator(deps.businessHours, _this);\n\n\t\t\tif (_this.view) {\n\t\t\t\t_this.view.set('businessHourGenerator', _this.businessHourGenerator);\n\t\t\t}\n\t\t}, function() {\n\t\t\t_this.businessHourGenerator = null;\n\t\t});\n\n\t\t// called immediately, and upon option change.\n\t\t// HACK: locale often affects isRTL, so we explicitly listen to that too.\n\t\tthis.optionsModel.watch('applyingDirClasses', [ '?isRTL', '?locale' ], function(opts) {\n\t\t\tel.toggleClass('fc-ltr', !opts.isRTL);\n\t\t\tel.toggleClass('fc-rtl', opts.isRTL);\n\t\t});\n\n\t\tthis.contentEl = $(\"<div class='fc-view-container'/>\").prependTo(el);\n\n\t\tthis.initToolbars();\n\t\tthis.renderHeader();\n\t\tthis.renderFooter();\n\t\tthis.renderView(this.opt('defaultView'));\n\n\t\tif (this.opt('handleWindowResize')) {\n\t\t\t$(window).resize(\n\t\t\t\tthis.windowResizeProxy = debounce( // prevents rapid calls\n\t\t\t\t\tthis.windowResize.bind(this),\n\t\t\t\t\tthis.opt('windowResizeDelay')\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t},\n\n\n\tdestroy: function() {\n\t\tif (this.view) {\n\t\t\tthis.clearView();\n\t\t}\n\n\t\tthis.toolbarsManager.proxyCall('removeElement');\n\t\tthis.contentEl.remove();\n\t\tthis.el.removeClass('fc fc-ltr fc-rtl');\n\n\t\t// removes theme-related root className\n\t\tthis.optionsModel.unwatch('settingTheme');\n\t\tthis.optionsModel.unwatch('settingBusinessHourGenerator');\n\n\t\tthis.el.off('.fc'); // unbind nav link handlers\n\n\t\tif (this.windowResizeProxy) {\n\t\t\t$(window).unbind('resize', this.windowResizeProxy);\n\t\t\tthis.windowResizeProxy = null;\n\t\t}\n\n\t\tGlobalEmitter.unneeded();\n\t},\n\n\n\telementVisible: function() {\n\t\treturn this.el.is(':visible');\n\t},\n\n\n\t// Render Queue\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tbindViewHandlers: function(view) {\n\t\tvar _this = this;\n\n\t\tview.watch('titleForCalendar', [ 'title' ], function(deps) { // TODO: better system\n\t\t\tif (view === _this.view) { // hack\n\t\t\t\t_this.setToolbarsTitle(deps.title);\n\t\t\t}\n\t\t});\n\n\t\tview.watch('dateProfileForCalendar', [ 'dateProfile' ], function(deps) {\n\t\t\tif (view === _this.view) { // hack\n\t\t\t\t_this.currentDate = deps.dateProfile.date; // might have been constrained by view dates\n\t\t\t\t_this.updateToolbarButtons(deps.dateProfile);\n\t\t\t}\n\t\t});\n\t},\n\n\n\tunbindViewHandlers: function(view) {\n\t\tthis.stopListeningTo(view);\n\n\t\tview.unwatch('titleForCalendar');\n\t\tview.unwatch('dateProfileForCalendar');\n\t},\n\n\n\t// View Rendering\n\t// -----------------------------------------------------------------------------------\n\n\n\t// Renders a view because of a date change, view-type change, or for the first time.\n\t// If not given a viewType, keep the current view but render different dates.\n\t// Accepts an optional scroll state to restore to.\n\trenderView: function(viewType) {\n\t\tvar oldView = this.view;\n\t\tvar newView;\n\n\t\tthis.freezeContentHeight();\n\n\t\tif (oldView && viewType && oldView.type !== viewType) {\n\t\t\tthis.clearView();\n\t\t}\n\n\t\t// if viewType changed, or the view was never created, create a fresh view\n\t\tif (!this.view && viewType) {\n\t\t\tnewView = this.view =\n\t\t\t\tthis.viewsByType[viewType] ||\n\t\t\t\t(this.viewsByType[viewType] = this.instantiateView(viewType));\n\n\t\t\tthis.bindViewHandlers(newView);\n\n\t\t\tnewView.setElement(\n\t\t\t\t$(\"<div class='fc-view fc-\" + viewType + \"-view' />\").appendTo(this.contentEl)\n\t\t\t);\n\n\t\t\tthis.toolbarsManager.proxyCall('activateButton', viewType);\n\t\t}\n\n\t\tif (this.view) {\n\n\t\t\t// prevent unnecessary change firing\n\t\t\tif (this.view.get('businessHourGenerator') !== this.businessHourGenerator) {\n\t\t\t\tthis.view.set('businessHourGenerator', this.businessHourGenerator);\n\t\t\t}\n\n\t\t\tthis.view.setDate(this.currentDate);\n\t\t}\n\n\t\tthis.thawContentHeight();\n\t},\n\n\n\t// Unrenders the current view and reflects this change in the Header.\n\t// Unregsiters the `view`, but does not remove from viewByType hash.\n\tclearView: function() {\n\t\tvar currentView = this.view;\n\n\t\tthis.toolbarsManager.proxyCall('deactivateButton', currentView.type);\n\n\t\tthis.unbindViewHandlers(currentView);\n\n\t\tcurrentView.removeElement();\n\n\t\tthis.view = null;\n\t},\n\n\n\t// Destroys the view, including the view object. Then, re-instantiates it and renders it.\n\t// Maintains the same scroll state.\n\t// TODO: maintain any other user-manipulated state.\n\treinitView: function() {\n\t\tvar oldView = this.view;\n\t\tvar scroll = oldView.queryScroll(); // wouldn't be so complicated if Calendar owned the scroll\n\t\tthis.freezeContentHeight();\n\n\t\tthis.clearView();\n\t\tthis.calcSize();\n\t\tthis.renderView(oldView.type); // needs the type to freshly render\n\n\t\tthis.view.applyScroll(scroll);\n\t\tthis.thawContentHeight();\n\t},\n\n\n\t// Resizing\n\t// -----------------------------------------------------------------------------------\n\n\n\tgetSuggestedViewHeight: function() {\n\t\tif (this.suggestedViewHeight === null) {\n\t\t\tthis.calcSize();\n\t\t}\n\t\treturn this.suggestedViewHeight;\n\t},\n\n\n\tisHeightAuto: function() {\n\t\treturn this.opt('contentHeight') === 'auto' || this.opt('height') === 'auto';\n\t},\n\n\n\tupdateViewSize: function(isResize) {\n\t\tvar view = this.view;\n\t\tvar scroll;\n\n\t\tif (!this.ignoreUpdateViewSize && view) {\n\n\t\t\tif (isResize) {\n\t\t\t\tthis.calcSize();\n\t\t\t\tscroll = view.queryScroll();\n\t\t\t}\n\n\t\t\tthis.ignoreUpdateViewSize++;\n\n\t\t\tview.updateSize(\n\t\t\t\tthis.getSuggestedViewHeight(),\n\t\t\t\tthis.isHeightAuto(),\n\t\t\t\tisResize\n\t\t\t);\n\n\t\t\tthis.ignoreUpdateViewSize--;\n\n\t\t\tif (isResize) {\n\t\t\t\tview.applyScroll(scroll);\n\t\t\t}\n\n\t\t\treturn true; // signal success\n\t\t}\n\t},\n\n\n\tcalcSize: function() {\n\t\tif (this.elementVisible()) {\n\t\t\tthis._calcSize();\n\t\t}\n\t},\n\n\n\t_calcSize: function() { // assumes elementVisible\n\t\tvar contentHeightInput = this.opt('contentHeight');\n\t\tvar heightInput = this.opt('height');\n\n\t\tif (typeof contentHeightInput === 'number') { // exists and not 'auto'\n\t\t\tthis.suggestedViewHeight = contentHeightInput;\n\t\t}\n\t\telse if (typeof contentHeightInput === 'function') { // exists and is a function\n\t\t\tthis.suggestedViewHeight = contentHeightInput();\n\t\t}\n\t\telse if (typeof heightInput === 'number') { // exists and not 'auto'\n\t\t\tthis.suggestedViewHeight = heightInput - this.queryToolbarsHeight();\n\t\t}\n\t\telse if (typeof heightInput === 'function') { // exists and is a function\n\t\t\tthis.suggestedViewHeight = heightInput() - this.queryToolbarsHeight();\n\t\t}\n\t\telse if (heightInput === 'parent') { // set to height of parent element\n\t\t\tthis.suggestedViewHeight = this.el.parent().height() - this.queryToolbarsHeight();\n\t\t}\n\t\telse {\n\t\t\tthis.suggestedViewHeight = Math.round(\n\t\t\t\tthis.contentEl.width() /\n\t\t\t\tMath.max(this.opt('aspectRatio'), .5)\n\t\t\t);\n\t\t}\n\t},\n\n\n\twindowResize: function(ev) {\n\t\tif (\n\t\t\tev.target === window && // so we don't process jqui \"resize\" events that have bubbled up\n\t\t\tthis.view &&\n\t\t\tthis.view.isDatesRendered\n\t\t) {\n\t\t\tif (this.updateViewSize(true)) { // isResize=true, returns true on success\n\t\t\t\tthis.publiclyTrigger('windowResize', [ this.view ]);\n\t\t\t}\n\t\t}\n\t},\n\n\n\t/* Height \"Freezing\"\n\t-----------------------------------------------------------------------------*/\n\n\n\tfreezeContentHeight: function() {\n\t\tif (!(this.freezeContentHeightDepth++)) {\n\t\t\tthis.forceFreezeContentHeight();\n\t\t}\n\t},\n\n\n\tforceFreezeContentHeight: function() {\n\t\tthis.contentEl.css({\n\t\t\twidth: '100%',\n\t\t\theight: this.contentEl.height(),\n\t\t\toverflow: 'hidden'\n\t\t});\n\t},\n\n\n\tthawContentHeight: function() {\n\t\tthis.freezeContentHeightDepth--;\n\n\t\t// always bring back to natural height\n\t\tthis.contentEl.css({\n\t\t\twidth: '',\n\t\t\theight: '',\n\t\t\toverflow: ''\n\t\t});\n\n\t\t// but if there are future thaws, re-freeze\n\t\tif (this.freezeContentHeightDepth) {\n\t\t\tthis.forceFreezeContentHeight();\n\t\t}\n\t}\n\n});\n\n;;\n\nCalendar.mixin({\n\n\theader: null,\n\tfooter: null,\n\ttoolbarsManager: null,\n\n\n\tinitToolbars: function() {\n\t\tthis.header = new Toolbar(this, this.computeHeaderOptions());\n\t\tthis.footer = new Toolbar(this, this.computeFooterOptions());\n\t\tthis.toolbarsManager = new Iterator([ this.header, this.footer ]);\n\t},\n\n\n\tcomputeHeaderOptions: function() {\n\t\treturn {\n\t\t\textraClasses: 'fc-header-toolbar',\n\t\t\tlayout: this.opt('header')\n\t\t};\n\t},\n\n\n\tcomputeFooterOptions: function() {\n\t\treturn {\n\t\t\textraClasses: 'fc-footer-toolbar',\n\t\t\tlayout: this.opt('footer')\n\t\t};\n\t},\n\n\n\t// can be called repeatedly and Header will rerender\n\trenderHeader: function() {\n\t\tvar header = this.header;\n\n\t\theader.setToolbarOptions(this.computeHeaderOptions());\n\t\theader.render();\n\n\t\tif (header.el) {\n\t\t\tthis.el.prepend(header.el);\n\t\t}\n\t},\n\n\n\t// can be called repeatedly and Footer will rerender\n\trenderFooter: function() {\n\t\tvar footer = this.footer;\n\n\t\tfooter.setToolbarOptions(this.computeFooterOptions());\n\t\tfooter.render();\n\n\t\tif (footer.el) {\n\t\t\tthis.el.append(footer.el);\n\t\t}\n\t},\n\n\n\tsetToolbarsTitle: function(title) {\n\t\tthis.toolbarsManager.proxyCall('updateTitle', title);\n\t},\n\n\n\tupdateToolbarButtons: function(dateProfile) {\n\t\tvar now = this.getNow();\n\t\tvar view = this.view;\n\t\tvar todayInfo = view.buildDateProfile(now);\n\t\tvar prevInfo = view.buildPrevDateProfile(this.currentDate);\n\t\tvar nextInfo = view.buildNextDateProfile(this.currentDate);\n\n\t\tthis.toolbarsManager.proxyCall(\n\t\t\t(todayInfo.isValid && !dateProfile.currentUnzonedRange.containsDate(now)) ?\n\t\t\t\t'enableButton' :\n\t\t\t\t'disableButton',\n\t\t\t'today'\n\t\t);\n\n\t\tthis.toolbarsManager.proxyCall(\n\t\t\tprevInfo.isValid ?\n\t\t\t\t'enableButton' :\n\t\t\t\t'disableButton',\n\t\t\t'prev'\n\t\t);\n\n\t\tthis.toolbarsManager.proxyCall(\n\t\t\tnextInfo.isValid ?\n\t\t\t\t'enableButton' :\n\t\t\t\t'disableButton',\n\t\t\t'next'\n\t\t);\n\t},\n\n\n\tqueryToolbarsHeight: function() {\n\t\treturn this.toolbarsManager.items.reduce(function(accumulator, toolbar) {\n\t\t\tvar toolbarHeight = toolbar.el ? toolbar.el.outerHeight(true) : 0; // includes margin\n\t\t\treturn accumulator + toolbarHeight;\n\t\t}, 0);\n\t}\n\n});\n\n;;\n\n/*\ndetermines if eventInstanceGroup is allowed,\nin relation to other EVENTS and business hours.\n*/\nCalendar.prototype.isEventInstanceGroupAllowed = function(eventInstanceGroup) {\n\tvar eventDef = eventInstanceGroup.getEventDef();\n\tvar eventFootprints = this.eventRangesToEventFootprints(eventInstanceGroup.getAllEventRanges());\n\tvar i;\n\n\tvar peerEventInstances = this.getPeerEventInstances(eventDef);\n\tvar peerEventRanges = peerEventInstances.map(eventInstanceToEventRange);\n\tvar peerEventFootprints = this.eventRangesToEventFootprints(peerEventRanges);\n\n\tvar constraintVal = eventDef.getConstraint();\n\tvar overlapVal = eventDef.getOverlap();\n\n\tvar eventAllowFunc = this.opt('eventAllow');\n\n\tfor (i = 0; i < eventFootprints.length; i++) {\n\t\tif (\n\t\t\t!this.isFootprintAllowed(\n\t\t\t\teventFootprints[i].componentFootprint,\n\t\t\t\tpeerEventFootprints,\n\t\t\t\tconstraintVal,\n\t\t\t\toverlapVal,\n\t\t\t\teventFootprints[i].eventInstance\n\t\t\t)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tif (eventAllowFunc) {\n\t\tfor (i = 0; i < eventFootprints.length; i++) {\n\t\t\tif (\n\t\t\t\teventAllowFunc(\n\t\t\t\t\teventFootprints[i].componentFootprint.toLegacy(this),\n\t\t\t\t\teventFootprints[i].getEventLegacy()\n\t\t\t\t) === false\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n};\n\n\nCalendar.prototype.getPeerEventInstances = function(eventDef) {\n\treturn this.eventManager.getEventInstancesWithoutId(eventDef.id);\n};\n\n\nCalendar.prototype.isSelectionFootprintAllowed = function(componentFootprint) {\n\tvar peerEventInstances = this.eventManager.getEventInstances();\n\tvar peerEventRanges = peerEventInstances.map(eventInstanceToEventRange);\n\tvar peerEventFootprints = this.eventRangesToEventFootprints(peerEventRanges);\n\n\tvar selectAllowFunc;\n\n\tif (\n\t\tthis.isFootprintAllowed(\n\t\t\tcomponentFootprint,\n\t\t\tpeerEventFootprints,\n\t\t\tthis.opt('selectConstraint'),\n\t\t\tthis.opt('selectOverlap')\n\t\t)\n\t) {\n\t\tselectAllowFunc = this.opt('selectAllow');\n\n\t\tif (selectAllowFunc) {\n\t\t\treturn selectAllowFunc(componentFootprint.toLegacy(this)) !== false;\n\t\t}\n\t\telse {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\n\nCalendar.prototype.isFootprintAllowed = function(\n\tcomponentFootprint,\n\tpeerEventFootprints,\n\tconstraintVal,\n\toverlapVal,\n\tsubjectEventInstance // optional\n) {\n\tvar constraintFootprints; // ComponentFootprint[]\n\tvar overlapEventFootprints; // EventFootprint[]\n\n\tif (constraintVal != null) {\n\t\tconstraintFootprints = this.constraintValToFootprints(constraintVal, componentFootprint.isAllDay);\n\n\t\tif (!this.isFootprintWithinConstraints(componentFootprint, constraintFootprints)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\toverlapEventFootprints = this.collectOverlapEventFootprints(peerEventFootprints, componentFootprint);\n\n\tif (overlapVal === false) {\n\t\tif (overlapEventFootprints.length) {\n\t\t\treturn false;\n\t\t}\n\t}\n\telse if (typeof overlapVal === 'function') {\n\t\tif (!isOverlapsAllowedByFunc(overlapEventFootprints, overlapVal, subjectEventInstance)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tif (subjectEventInstance) {\n\t\tif (!isOverlapEventInstancesAllowed(overlapEventFootprints, subjectEventInstance)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n};\n\n\n// Constraint\n// ------------------------------------------------------------------------------------------------\n\n\nCalendar.prototype.isFootprintWithinConstraints = function(componentFootprint, constraintFootprints) {\n\tvar i;\n\n\tfor (i = 0; i < constraintFootprints.length; i++) {\n\t\tif (this.footprintContainsFootprint(constraintFootprints[i], componentFootprint)) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\n\nCalendar.prototype.constraintValToFootprints = function(constraintVal, isAllDay) {\n\tvar eventInstances;\n\n\tif (constraintVal === 'businessHours') {\n\t\treturn this.buildCurrentBusinessFootprints(isAllDay);\n\t}\n\telse if (typeof constraintVal === 'object') {\n\t\teventInstances = this.parseEventDefToInstances(constraintVal); // handles recurring events\n\n\t\tif (!eventInstances) { // invalid input. fallback to parsing footprint directly\n\t\t\treturn this.parseFootprints(constraintVal);\n\t\t}\n\t\telse {\n\t\t\treturn this.eventInstancesToFootprints(eventInstances);\n\t\t}\n\t}\n\telse if (constraintVal != null) { // an ID\n\t\teventInstances = this.eventManager.getEventInstancesWithId(constraintVal);\n\n\t\treturn this.eventInstancesToFootprints(eventInstances);\n\t}\n};\n\n\n// returns ComponentFootprint[]\n// uses current view's range\nCalendar.prototype.buildCurrentBusinessFootprints = function(isAllDay) {\n\tvar view = this.view;\n\tvar businessHourGenerator = view.get('businessHourGenerator');\n\tvar unzonedRange = view.dateProfile.activeUnzonedRange;\n\tvar eventInstanceGroup = businessHourGenerator.buildEventInstanceGroup(isAllDay, unzonedRange);\n\n\tif (eventInstanceGroup) {\n\t\treturn this.eventInstancesToFootprints(eventInstanceGroup.eventInstances);\n\t}\n\telse {\n\t\treturn [];\n\t}\n};\n\n\n// conversion util\nCalendar.prototype.eventInstancesToFootprints = function(eventInstances) {\n\tvar eventRanges = eventInstances.map(eventInstanceToEventRange);\n\tvar eventFootprints = this.eventRangesToEventFootprints(eventRanges);\n\n\treturn eventFootprints.map(eventFootprintToComponentFootprint);\n};\n\n\n// Overlap\n// ------------------------------------------------------------------------------------------------\n\n\nCalendar.prototype.collectOverlapEventFootprints = function(peerEventFootprints, targetFootprint) {\n\tvar overlapEventFootprints = [];\n\tvar i;\n\n\tfor (i = 0; i < peerEventFootprints.length; i++) {\n\t\tif (\n\t\t\tthis.footprintsIntersect(\n\t\t\t\ttargetFootprint,\n\t\t\t\tpeerEventFootprints[i].componentFootprint\n\t\t\t)\n\t\t) {\n\t\t\toverlapEventFootprints.push(peerEventFootprints[i]);\n\t\t}\n\t}\n\n\treturn overlapEventFootprints;\n};\n\n\n// optional subjectEventInstance\nfunction isOverlapsAllowedByFunc(overlapEventFootprints, overlapFunc, subjectEventInstance) {\n\tvar i;\n\n\tfor (i = 0; i < overlapEventFootprints.length; i++) {\n\t\tif (\n\t\t\t!overlapFunc(\n\t\t\t\toverlapEventFootprints[i].eventInstance.toLegacy(),\n\t\t\t\tsubjectEventInstance ? subjectEventInstance.toLegacy() : null\n\t\t\t)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n\nfunction isOverlapEventInstancesAllowed(overlapEventFootprints, subjectEventInstance) {\n\tvar subjectLegacyInstance = subjectEventInstance.toLegacy();\n\tvar i;\n\tvar overlapEventInstance;\n\tvar overlapEventDef;\n\tvar overlapVal;\n\n\tfor (i = 0; i < overlapEventFootprints.length; i++) {\n\t\toverlapEventInstance = overlapEventFootprints[i].eventInstance;\n\t\toverlapEventDef = overlapEventInstance.def;\n\n\t\t// don't need to pass in calendar, because don't want to consider global eventOverlap property,\n\t\t// because we already considered that earlier in the process.\n\t\toverlapVal = overlapEventDef.getOverlap();\n\n\t\tif (overlapVal === false) {\n\t\t\treturn false;\n\t\t}\n\t\telse if (typeof overlapVal === 'function') {\n\t\t\tif (\n\t\t\t\t!overlapVal(\n\t\t\t\t\toverlapEventInstance.toLegacy(),\n\t\t\t\t\tsubjectLegacyInstance\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\n\n// Conversion: eventDefs -> eventInstances -> eventRanges -> eventFootprints -> componentFootprints\n// ------------------------------------------------------------------------------------------------\n// NOTE: this might seem like repetitive code with the Grid class, however, this code is related to\n// constraints whereas the Grid code is related to rendering. Each approach might want to convert\n// eventRanges -> eventFootprints in a different way. Regardless, there are opportunities to make\n// this more DRY.\n\n\n/*\nReturns false on invalid input.\n*/\nCalendar.prototype.parseEventDefToInstances = function(eventInput) {\n\tvar eventManager = this.eventManager;\n\tvar eventDef = EventDefParser.parse(eventInput, new EventSource(this));\n\n\tif (!eventDef) { // invalid\n\t\treturn false;\n\t}\n\n\treturn eventDef.buildInstances(eventManager.currentPeriod.unzonedRange);\n};\n\n\nCalendar.prototype.eventRangesToEventFootprints = function(eventRanges) {\n\tvar i;\n\tvar eventFootprints = [];\n\n\tfor (i = 0; i < eventRanges.length; i++) {\n\t\teventFootprints.push.apply( // footprints\n\t\t\teventFootprints,\n\t\t\tthis.eventRangeToEventFootprints(eventRanges[i])\n\t\t);\n\t}\n\n\treturn eventFootprints;\n};\n\n\nCalendar.prototype.eventRangeToEventFootprints = function(eventRange) {\n\treturn [ eventRangeToEventFootprint(eventRange) ];\n};\n\n\n/*\nParses footprints directly.\nVery similar to EventDateProfile::parse :(\n*/\nCalendar.prototype.parseFootprints = function(rawInput) {\n\tvar start, end;\n\n\tif (rawInput.start) {\n\t\tstart = this.moment(rawInput.start);\n\n\t\tif (!start.isValid()) {\n\t\t\tstart = null;\n\t\t}\n\t}\n\n\tif (rawInput.end) {\n\t\tend = this.moment(rawInput.end);\n\n\t\tif (!end.isValid()) {\n\t\t\tend = null;\n\t\t}\n\t}\n\n\treturn [\n\t\tnew ComponentFootprint(\n\t\t\tnew UnzonedRange(start, end),\n\t\t\t(start && !start.hasTime()) || (end && !end.hasTime()) // isAllDay\n\t\t)\n\t];\n};\n\n\n// Footprint Utils\n// ----------------------------------------------------------------------------------------\n\n\nCalendar.prototype.footprintContainsFootprint = function(outerFootprint, innerFootprint) {\n\treturn outerFootprint.unzonedRange.containsRange(innerFootprint.unzonedRange);\n};\n\n\nCalendar.prototype.footprintsIntersect = function(footprint0, footprint1) {\n\treturn footprint0.unzonedRange.intersectsWith(footprint1.unzonedRange);\n};\n\n;;\n\nCalendar.mixin({\n\n\t// Sources\n\t// ------------------------------------------------------------------------------------\n\n\n\tgetEventSources: function() {\n\t\treturn this.eventManager.otherSources.slice(); // clone\n\t},\n\n\n\tgetEventSourceById: function(id) {\n\t\treturn this.eventManager.getSourceById(\n\t\t\tEventSource.normalizeId(id)\n\t\t);\n\t},\n\n\n\taddEventSource: function(sourceInput) {\n\t\tvar source = EventSourceParser.parse(sourceInput, this);\n\n\t\tif (source) {\n\t\t\tthis.eventManager.addSource(source);\n\t\t}\n\t},\n\n\n\tremoveEventSources: function(sourceMultiQuery) {\n\t\tvar eventManager = this.eventManager;\n\t\tvar sources;\n\t\tvar i;\n\n\t\tif (sourceMultiQuery == null) {\n\t\t\tthis.eventManager.removeAllSources();\n\t\t}\n\t\telse {\n\t\t\tsources = eventManager.multiQuerySources(sourceMultiQuery);\n\n\t\t\teventManager.freeze();\n\n\t\t\tfor (i = 0; i < sources.length; i++) {\n\t\t\t\teventManager.removeSource(sources[i]);\n\t\t\t}\n\n\t\t\teventManager.thaw();\n\t\t}\n\t},\n\n\n\tremoveEventSource: function(sourceQuery) {\n\t\tvar eventManager = this.eventManager;\n\t\tvar sources = eventManager.querySources(sourceQuery);\n\t\tvar i;\n\n\t\teventManager.freeze();\n\n\t\tfor (i = 0; i < sources.length; i++) {\n\t\t\teventManager.removeSource(sources[i]);\n\t\t}\n\n\t\teventManager.thaw();\n\t},\n\n\n\trefetchEventSources: function(sourceMultiQuery) {\n\t\tvar eventManager = this.eventManager;\n\t\tvar sources = eventManager.multiQuerySources(sourceMultiQuery);\n\t\tvar i;\n\n\t\teventManager.freeze();\n\n\t\tfor (i = 0; i < sources.length; i++) {\n\t\t\teventManager.refetchSource(sources[i]);\n\t\t}\n\n\t\teventManager.thaw();\n\t},\n\n\n\t// Events\n\t// ------------------------------------------------------------------------------------\n\n\n\trefetchEvents: function() {\n\t\tthis.eventManager.refetchAllSources();\n\t},\n\n\n\trenderEvents: function(eventInputs, isSticky) {\n\t\tthis.eventManager.freeze();\n\n\t\tfor (var i = 0; i < eventInputs.length; i++) {\n\t\t\tthis.renderEvent(eventInputs[i], isSticky);\n\t\t}\n\n\t\tthis.eventManager.thaw();\n\t},\n\n\n\trenderEvent: function(eventInput, isSticky) {\n\t\tvar eventManager = this.eventManager;\n\t\tvar eventDef = EventDefParser.parse(\n\t\t\teventInput,\n\t\t\teventInput.source || eventManager.stickySource\n\t\t);\n\n\t\tif (eventDef) {\n\t\t\teventManager.addEventDef(eventDef, isSticky);\n\t\t}\n\t},\n\n\n\t// legacyQuery operates on legacy event instance objects\n\tremoveEvents: function(legacyQuery) {\n\t\tvar eventManager = this.eventManager;\n\t\tvar legacyInstances = [];\n\t\tvar idMap = {};\n\t\tvar eventDef;\n\t\tvar i;\n\n\t\tif (legacyQuery == null) { // shortcut for removing all\n\t\t\teventManager.removeAllEventDefs(true); // persist=true\n\t\t}\n\t\telse {\n\t\t\teventManager.getEventInstances().forEach(function(eventInstance) {\n\t\t\t\tlegacyInstances.push(eventInstance.toLegacy());\n\t\t\t});\n\n\t\t\tlegacyInstances = filterLegacyEventInstances(legacyInstances, legacyQuery);\n\n\t\t\t// compute unique IDs\n\t\t\tfor (i = 0; i < legacyInstances.length; i++) {\n\t\t\t\teventDef = this.eventManager.getEventDefByUid(legacyInstances[i]._id);\n\t\t\t\tidMap[eventDef.id] = true;\n\t\t\t}\n\n\t\t\teventManager.freeze();\n\n\t\t\tfor (i in idMap) { // reuse `i` as an \"id\"\n\t\t\t\teventManager.removeEventDefsById(i, true); // persist=true\n\t\t\t}\n\n\t\t\teventManager.thaw();\n\t\t}\n\t},\n\n\n\t// legacyQuery operates on legacy event instance objects\n\tclientEvents: function(legacyQuery) {\n\t\tvar legacyEventInstances = [];\n\n\t\tthis.eventManager.getEventInstances().forEach(function(eventInstance) {\n\t\t\tlegacyEventInstances.push(eventInstance.toLegacy());\n\t\t});\n\n\t\treturn filterLegacyEventInstances(legacyEventInstances, legacyQuery);\n\t},\n\n\n\tupdateEvents: function(eventPropsArray) {\n\t\tthis.eventManager.freeze();\n\n\t\tfor (var i = 0; i < eventPropsArray.length; i++) {\n\t\t\tthis.updateEvent(eventPropsArray[i]);\n\t\t}\n\n\t\tthis.eventManager.thaw();\n\t},\n\n\n\tupdateEvent: function(eventProps) {\n\t\tvar eventDef = this.eventManager.getEventDefByUid(eventProps._id);\n\t\tvar eventInstance;\n\t\tvar eventDefMutation;\n\n\t\tif (eventDef instanceof SingleEventDef) {\n\t\t\teventInstance = eventDef.buildInstance();\n\n\t\t\teventDefMutation = EventDefMutation.createFromRawProps(\n\t\t\t\teventInstance,\n\t\t\t\teventProps, // raw props\n\t\t\t\tnull // largeUnit -- who uses it?\n\t\t\t);\n\n\t\t\tthis.eventManager.mutateEventsWithId(eventDef.id, eventDefMutation); // will release\n\t\t}\n\t}\n\n});\n\n\nfunction filterLegacyEventInstances(legacyEventInstances, legacyQuery) {\n\tif (legacyQuery == null) {\n\t\treturn legacyEventInstances;\n\t}\n\telse if ($.isFunction(legacyQuery)) {\n\t\treturn legacyEventInstances.filter(legacyQuery);\n\t}\n\telse { // an event ID\n\t\tlegacyQuery += ''; // normalize to string\n\n\t\treturn legacyEventInstances.filter(function(legacyEventInstance) {\n\t\t\t// soft comparison because id not be normalized to string\n\t\t\treturn legacyEventInstance.id == legacyQuery ||\n\t\t\t\tlegacyEventInstance._id === legacyQuery; // can specify internal id, but must exactly match\n\t\t});\n\t}\n}\n\n;;\n\nCalendar.defaults = {\n\n\ttitleRangeSeparator: ' \\u2013 ', // en dash\n\tmonthYearFormat: 'MMMM YYYY', // required for en. other locales rely on datepicker computable option\n\n\tdefaultTimedEventDuration: '02:00:00',\n\tdefaultAllDayEventDuration: { days: 1 },\n\tforceEventDuration: false,\n\tnextDayThreshold: '09:00:00', // 9am\n\n\t// display\n\tcolumnHeader: true,\n\tdefaultView: 'month',\n\taspectRatio: 1.35,\n\theader: {\n\t\tleft: 'title',\n\t\tcenter: '',\n\t\tright: 'today prev,next'\n\t},\n\tweekends: true,\n\tweekNumbers: false,\n\n\tweekNumberTitle: 'W',\n\tweekNumberCalculation: 'local',\n\t\n\t//editable: false,\n\n\t//nowIndicator: false,\n\n\tscrollTime: '06:00:00',\n\tminTime: '00:00:00',\n\tmaxTime: '24:00:00',\n\tshowNonCurrentDates: true,\n\t\n\t// event ajax\n\tlazyFetching: true,\n\tstartParam: 'start',\n\tendParam: 'end',\n\ttimezoneParam: 'timezone',\n\n\ttimezone: false,\n\n\t//allDayDefault: undefined,\n\n\t// locale\n\tisRTL: false,\n\tbuttonText: {\n\t\tprev: \"prev\",\n\t\tnext: \"next\",\n\t\tprevYear: \"prev year\",\n\t\tnextYear: \"next year\",\n\t\tyear: 'year', // TODO: locale files need to specify this\n\t\ttoday: 'today',\n\t\tmonth: 'month',\n\t\tweek: 'week',\n\t\tday: 'day'\n\t},\n\t//buttonIcons: null,\n\n\tallDayText: 'all-day',\n\n\t// allows setting a min-height to the event segment to prevent short events overlapping each other\n\tagendaEventMinHeight: 0,\n\t\n\t// jquery-ui theming\n\ttheme: false,\n\t//themeButtonIcons: null,\n\n\t//eventResizableFromStart: false,\n\tdragOpacity: .75,\n\tdragRevertDuration: 500,\n\tdragScroll: true,\n\t\n\t//selectable: false,\n\tunselectAuto: true,\n\t//selectMinDistance: 0,\n\t\n\tdropAccept: '*',\n\n\teventOrder: 'title',\n\t//eventRenderWait: null,\n\n\teventLimit: false,\n\teventLimitText: 'more',\n\teventLimitClick: 'popover',\n\tdayPopoverFormat: 'LL',\n\t\n\thandleWindowResize: true,\n\twindowResizeDelay: 100, // milliseconds before an updateSize happens\n\n\tlongPressDelay: 1000\n\t\n};\n\n\nCalendar.englishDefaults = { // used by locale.js\n\tdayPopoverFormat: 'dddd, MMMM D'\n};\n\n\nCalendar.rtlDefaults = { // right-to-left defaults\n\theader: { // TODO: smarter solution (first/center/last ?)\n\t\tleft: 'next,prev today',\n\t\tcenter: '',\n\t\tright: 'title'\n\t},\n\tbuttonIcons: {\n\t\tprev: 'right-single-arrow',\n\t\tnext: 'left-single-arrow',\n\t\tprevYear: 'right-double-arrow',\n\t\tnextYear: 'left-double-arrow'\n\t},\n\tthemeButtonIcons: {\n\t\tprev: 'circle-triangle-e',\n\t\tnext: 'circle-triangle-w',\n\t\tnextYear: 'seek-prev',\n\t\tprevYear: 'seek-next'\n\t}\n};\n\n;;\n\nvar localeOptionHash = FC.locales = {}; // initialize and expose\n\n\n// TODO: document the structure and ordering of a FullCalendar locale file\n\n\n// Initialize jQuery UI datepicker translations while using some of the translations\n// Will set this as the default locales for datepicker.\nFC.datepickerLocale = function(localeCode, dpLocaleCode, dpOptions) {\n\n\t// get the FullCalendar internal option hash for this locale. create if necessary\n\tvar fcOptions = localeOptionHash[localeCode] || (localeOptionHash[localeCode] = {});\n\n\t// transfer some simple options from datepicker to fc\n\tfcOptions.isRTL = dpOptions.isRTL;\n\tfcOptions.weekNumberTitle = dpOptions.weekHeader;\n\n\t// compute some more complex options from datepicker\n\t$.each(dpComputableOptions, function(name, func) {\n\t\tfcOptions[name] = func(dpOptions);\n\t});\n\n\t// is jQuery UI Datepicker is on the page?\n\tif ($.datepicker) {\n\n\t\t// Register the locale data.\n\t\t// FullCalendar and MomentJS use locale codes like \"pt-br\" but Datepicker\n\t\t// does it like \"pt-BR\" or if it doesn't have the locale, maybe just \"pt\".\n\t\t// Make an alias so the locale can be referenced either way.\n\t\t$.datepicker.regional[dpLocaleCode] =\n\t\t\t$.datepicker.regional[localeCode] = // alias\n\t\t\t\tdpOptions;\n\n\t\t// Alias 'en' to the default locale data. Do this every time.\n\t\t$.datepicker.regional.en = $.datepicker.regional[''];\n\n\t\t// Set as Datepicker's global defaults.\n\t\t$.datepicker.setDefaults(dpOptions);\n\t}\n};\n\n\n// Sets FullCalendar-specific translations. Will set the locales as the global default.\nFC.locale = function(localeCode, newFcOptions) {\n\tvar fcOptions;\n\tvar momOptions;\n\n\t// get the FullCalendar internal option hash for this locale. create if necessary\n\tfcOptions = localeOptionHash[localeCode] || (localeOptionHash[localeCode] = {});\n\n\t// provided new options for this locales? merge them in\n\tif (newFcOptions) {\n\t\tfcOptions = localeOptionHash[localeCode] = mergeOptions([ fcOptions, newFcOptions ]);\n\t}\n\n\t// compute locale options that weren't defined.\n\t// always do this. newFcOptions can be undefined when initializing from i18n file,\n\t// so no way to tell if this is an initialization or a default-setting.\n\tmomOptions = getMomentLocaleData(localeCode); // will fall back to en\n\t$.each(momComputableOptions, function(name, func) {\n\t\tif (fcOptions[name] == null) {\n\t\t\tfcOptions[name] = func(momOptions, fcOptions);\n\t\t}\n\t});\n\n\t// set it as the default locale for FullCalendar\n\tCalendar.defaults.locale = localeCode;\n};\n\n\n// NOTE: can't guarantee any of these computations will run because not every locale has datepicker\n// configs, so make sure there are English fallbacks for these in the defaults file.\nvar dpComputableOptions = {\n\n\tbuttonText: function(dpOptions) {\n\t\treturn {\n\t\t\t// the translations sometimes wrongly contain HTML entities\n\t\t\tprev: stripHtmlEntities(dpOptions.prevText),\n\t\t\tnext: stripHtmlEntities(dpOptions.nextText),\n\t\t\ttoday: stripHtmlEntities(dpOptions.currentText)\n\t\t};\n\t},\n\n\t// Produces format strings like \"MMMM YYYY\" -> \"September 2014\"\n\tmonthYearFormat: function(dpOptions) {\n\t\treturn dpOptions.showMonthAfterYear ?\n\t\t\t'YYYY[' + dpOptions.yearSuffix + '] MMMM' :\n\t\t\t'MMMM YYYY[' + dpOptions.yearSuffix + ']';\n\t}\n\n};\n\nvar momComputableOptions = {\n\n\t// Produces format strings like \"ddd M/D\" -> \"Fri 9/15\"\n\tdayOfMonthFormat: function(momOptions, fcOptions) {\n\t\tvar format = momOptions.longDateFormat('l'); // for the format like \"M/D/YYYY\"\n\n\t\t// strip the year off the edge, as well as other misc non-whitespace chars\n\t\tformat = format.replace(/^Y+[^\\w\\s]*|[^\\w\\s]*Y+$/g, '');\n\n\t\tif (fcOptions.isRTL) {\n\t\t\tformat += ' ddd'; // for RTL, add day-of-week to end\n\t\t}\n\t\telse {\n\t\t\tformat = 'ddd ' + format; // for LTR, add day-of-week to beginning\n\t\t}\n\t\treturn format;\n\t},\n\n\t// Produces format strings like \"h:mma\" -> \"6:00pm\"\n\tmediumTimeFormat: function(momOptions) { // can't be called `timeFormat` because collides with option\n\t\treturn momOptions.longDateFormat('LT')\n\t\t\t.replace(/\\s*a$/i, 'a'); // convert AM/PM/am/pm to lowercase. remove any spaces beforehand\n\t},\n\n\t// Produces format strings like \"h(:mm)a\" -> \"6pm\" / \"6:30pm\"\n\tsmallTimeFormat: function(momOptions) {\n\t\treturn momOptions.longDateFormat('LT')\n\t\t\t.replace(':mm', '(:mm)')\n\t\t\t.replace(/(\\Wmm)$/, '($1)') // like above, but for foreign locales\n\t\t\t.replace(/\\s*a$/i, 'a'); // convert AM/PM/am/pm to lowercase. remove any spaces beforehand\n\t},\n\n\t// Produces format strings like \"h(:mm)t\" -> \"6p\" / \"6:30p\"\n\textraSmallTimeFormat: function(momOptions) {\n\t\treturn momOptions.longDateFormat('LT')\n\t\t\t.replace(':mm', '(:mm)')\n\t\t\t.replace(/(\\Wmm)$/, '($1)') // like above, but for foreign locales\n\t\t\t.replace(/\\s*a$/i, 't'); // convert to AM/PM/am/pm to lowercase one-letter. remove any spaces beforehand\n\t},\n\n\t// Produces format strings like \"ha\" / \"H\" -> \"6pm\" / \"18\"\n\thourFormat: function(momOptions) {\n\t\treturn momOptions.longDateFormat('LT')\n\t\t\t.replace(':mm', '')\n\t\t\t.replace(/(\\Wmm)$/, '') // like above, but for foreign locales\n\t\t\t.replace(/\\s*a$/i, 'a'); // convert AM/PM/am/pm to lowercase. remove any spaces beforehand\n\t},\n\n\t// Produces format strings like \"h:mm\" -> \"6:30\" (with no AM/PM)\n\tnoMeridiemTimeFormat: function(momOptions) {\n\t\treturn momOptions.longDateFormat('LT')\n\t\t\t.replace(/\\s*a$/i, ''); // remove trailing AM/PM\n\t}\n\n};\n\n\n// options that should be computed off live calendar options (considers override options)\n// TODO: best place for this? related to locale?\n// TODO: flipping text based on isRTL is a bad idea because the CSS `direction` might want to handle it\nvar instanceComputableOptions = {\n\n\t// Produces format strings for results like \"Mo 16\"\n\tsmallDayDateFormat: function(options) {\n\t\treturn options.isRTL ?\n\t\t\t'D dd' :\n\t\t\t'dd D';\n\t},\n\n\t// Produces format strings for results like \"Wk 5\"\n\tweekFormat: function(options) {\n\t\treturn options.isRTL ?\n\t\t\t'w[ ' + options.weekNumberTitle + ']' :\n\t\t\t'[' + options.weekNumberTitle + ' ]w';\n\t},\n\n\t// Produces format strings for results like \"Wk5\"\n\tsmallWeekFormat: function(options) {\n\t\treturn options.isRTL ?\n\t\t\t'w[' + options.weekNumberTitle + ']' :\n\t\t\t'[' + options.weekNumberTitle + ']w';\n\t}\n\n};\n\n// TODO: make these computable properties in optionsModel\nfunction populateInstanceComputableOptions(options) {\n\t$.each(instanceComputableOptions, function(name, func) {\n\t\tif (options[name] == null) {\n\t\t\toptions[name] = func(options);\n\t\t}\n\t});\n}\n\n\n// Returns moment's internal locale data. If doesn't exist, returns English.\nfunction getMomentLocaleData(localeCode) {\n\treturn moment.localeData(localeCode) || moment.localeData('en');\n}\n\n\n// Initialize English by forcing computation of moment-derived options.\n// Also, sets it as the default.\nFC.locale('en', Calendar.englishDefaults);\n\n;;\n\nvar UnzonedRange = FC.UnzonedRange = Class.extend({\n\n\tstartMs: null, // if null, no start constraint\n\tendMs: null, // if null, no end constraint\n\n\t// TODO: move these into footprint.\n\t// Especially, doesn't make sense for null startMs/endMs.\n\tisStart: true,\n\tisEnd: true,\n\n\tconstructor: function(startInput, endInput) {\n\n\t\tif (moment.isMoment(startInput)) {\n\t\t\tstartInput = startInput.clone().stripZone();\n\t\t}\n\n\t\tif (moment.isMoment(endInput)) {\n\t\t\tendInput = endInput.clone().stripZone();\n\t\t}\n\n\t\tif (startInput) {\n\t\t\tthis.startMs = startInput.valueOf();\n\t\t}\n\n\t\tif (endInput) {\n\t\t\tthis.endMs = endInput.valueOf();\n\t\t}\n\t},\n\n\tintersect: function(otherRange) {\n\t\tvar startMs = this.startMs;\n\t\tvar endMs = this.endMs;\n\t\tvar newRange = null;\n\n\t\tif (otherRange.startMs !== null) {\n\t\t\tif (startMs === null) {\n\t\t\t\tstartMs = otherRange.startMs;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tstartMs = Math.max(startMs, otherRange.startMs);\n\t\t\t}\n\t\t}\n\n\t\tif (otherRange.endMs !== null) {\n\t\t\tif (endMs === null) {\n\t\t\t\tendMs = otherRange.endMs;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tendMs = Math.min(endMs, otherRange.endMs);\n\t\t\t}\n\t\t}\n\n\t\tif (startMs === null || endMs === null || startMs < endMs) {\n\t\t\tnewRange = new UnzonedRange(startMs, endMs);\n\t\t\tnewRange.isStart = this.isStart && startMs === this.startMs;\n\t\t\tnewRange.isEnd = this.isEnd && endMs === this.endMs;\n\t\t}\n\n\t\treturn newRange;\n\t},\n\n\n\tintersectsWith: function(otherRange) {\n\t\treturn (this.endMs === null || otherRange.startMs === null || this.endMs > otherRange.startMs) &&\n\t\t\t(this.startMs === null || otherRange.endMs === null || this.startMs < otherRange.endMs);\n\t},\n\n\n\tcontainsRange: function(innerRange) {\n\t\treturn (this.startMs === null || (innerRange.startMs !== null && innerRange.startMs >= this.startMs)) &&\n\t\t\t(this.endMs === null || (innerRange.endMs !== null && innerRange.endMs <= this.endMs));\n\t},\n\n\n\t// `date` can be a moment, a Date, or a millisecond time.\n\tcontainsDate: function(date) {\n\t\tvar ms = date.valueOf();\n\n\t\treturn (this.startMs === null || ms >= this.startMs) &&\n\t\t\t(this.endMs === null || ms < this.endMs);\n\t},\n\n\n\t// If the given date is not within the given range, move it inside.\n\t// (If it's past the end, make it one millisecond before the end).\n\t// `date` can be a moment, a Date, or a millisecond time.\n\t// Returns a MS-time.\n\tconstrainDate: function(date) {\n\t\tvar ms = date.valueOf();\n\n\t\tif (this.startMs !== null && ms < this.startMs) {\n\t\t\tms = this.startMs;\n\t\t}\n\n\t\tif (this.endMs !== null && ms >= this.endMs) {\n\t\t\tms = this.endMs - 1;\n\t\t}\n\n\t\treturn ms;\n\t},\n\n\n\tequals: function(otherRange) {\n\t\treturn this.startMs === otherRange.startMs && this.endMs === otherRange.endMs;\n\t},\n\n\n\tclone: function() {\n\t\tvar range = new UnzonedRange(this.startMs, this.endMs);\n\n\t\trange.isStart = this.isStart;\n\t\trange.isEnd = this.isEnd;\n\n\t\treturn range;\n\t},\n\n\n\t// Returns an ambig-zoned moment from startMs.\n\t// BEWARE: returned moment is not localized.\n\t// Formatting and start-of-week will be default.\n\tgetStart: function() {\n\t\tif (this.startMs !== null) {\n\t\t\treturn FC.moment.utc(this.startMs).stripZone();\n\t\t}\n\t},\n\n\t// Returns an ambig-zoned moment from startMs.\n\t// BEWARE: returned moment is not localized.\n\t// Formatting and start-of-week will be default.\n\tgetEnd: function() {\n\t\tif (this.endMs !== null) {\n\t\t\treturn FC.moment.utc(this.endMs).stripZone();\n\t\t}\n\t},\n\n\n\tas: function(unit) {\n\t\treturn moment.utc(this.endMs).diff(\n\t\t\tmoment.utc(this.startMs),\n\t\t\tunit,\n\t\t\ttrue\n\t\t);\n\t}\n\n});\n\n\n/*\nSIDEEFFECT: will mutate eventRanges.\nWill return a new array result.\nOnly works for non-open-ended ranges.\n*/\nfunction invertUnzonedRanges(ranges, constraintRange) {\n\tvar invertedRanges = [];\n\tvar startMs = constraintRange.startMs; // the end of the previous range. the start of the new range\n\tvar i;\n\tvar dateRange;\n\n\t// ranges need to be in order. required for our date-walking algorithm\n\tranges.sort(compareUnzonedRanges);\n\n\tfor (i = 0; i < ranges.length; i++) {\n\t\tdateRange = ranges[i];\n\n\t\t// add the span of time before the event (if there is any)\n\t\tif (dateRange.startMs > startMs) { // compare millisecond time (skip any ambig logic)\n\t\t\tinvertedRanges.push(\n\t\t\t\tnew UnzonedRange(startMs, dateRange.startMs)\n\t\t\t);\n\t\t}\n\n\t\tif (dateRange.endMs > startMs) {\n\t\t\tstartMs = dateRange.endMs;\n\t\t}\n\t}\n\n\t// add the span of time after the last event (if there is any)\n\tif (startMs < constraintRange.endMs) { // compare millisecond time (skip any ambig logic)\n\t\tinvertedRanges.push(\n\t\t\tnew UnzonedRange(startMs, constraintRange.endMs)\n\t\t);\n\t}\n\n\treturn invertedRanges;\n}\n\n\n/*\nOnly works for non-open-ended ranges.\n*/\nfunction compareUnzonedRanges(range1, range2) {\n\treturn range1.startMs - range2.startMs; // earlier ranges go first\n}\n\n;;\n\n/*\nMeant to be immutable\n*/\nvar ComponentFootprint = FC.ComponentFootprint = Class.extend({\n\n\tunzonedRange: null,\n\tisAllDay: false, // component can choose to ignore this\n\n\n\tconstructor: function(unzonedRange, isAllDay) {\n\t\tthis.unzonedRange = unzonedRange;\n\t\tthis.isAllDay = isAllDay;\n\t},\n\n\n\t/*\n\tOnly works for non-open-ended ranges.\n\t*/\n\ttoLegacy: function(calendar) {\n\t\treturn {\n\t\t\tstart: calendar.msToMoment(this.unzonedRange.startMs, this.isAllDay),\n\t\t\tend: calendar.msToMoment(this.unzonedRange.endMs, this.isAllDay)\n\t\t};\n\t}\n\n});\n\n;;\n\nvar EventPeriod = Class.extend(EmitterMixin, {\n\n\tstart: null,\n\tend: null,\n\ttimezone: null,\n\n\tunzonedRange: null,\n\n\trequestsByUid: null,\n\tpendingCnt: 0,\n\n\tfreezeDepth: 0,\n\tstuntedReleaseCnt: 0,\n\treleaseCnt: 0,\n\n\teventDefsByUid: null,\n\teventDefsById: null,\n\teventInstanceGroupsById: null,\n\n\n\tconstructor: function(start, end, timezone) {\n\t\tthis.start = start;\n\t\tthis.end = end;\n\t\tthis.timezone = timezone;\n\n\t\tthis.unzonedRange = new UnzonedRange(\n\t\t\tstart.clone().stripZone(),\n\t\t\tend.clone().stripZone()\n\t\t);\n\n\t\tthis.requestsByUid = {};\n\t\tthis.eventDefsByUid = {};\n\t\tthis.eventDefsById = {};\n\t\tthis.eventInstanceGroupsById = {};\n\t},\n\n\n\tisWithinRange: function(start, end) {\n\t\t// TODO: use a range util function?\n\t\treturn !start.isBefore(this.start) && !end.isAfter(this.end);\n\t},\n\n\n\t// Requesting and Purging\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\trequestSources: function(sources) {\n\t\tthis.freeze();\n\n\t\tfor (var i = 0; i < sources.length; i++) {\n\t\t\tthis.requestSource(sources[i]);\n\t\t}\n\n\t\tthis.thaw();\n\t},\n\n\n\trequestSource: function(source) {\n\t\tvar _this = this;\n\t\tvar request = { source: source, status: 'pending' };\n\n\t\tthis.requestsByUid[source.uid] = request;\n\t\tthis.pendingCnt += 1;\n\n\t\tsource.fetch(this.start, this.end, this.timezone).then(function(eventDefs) {\n\t\t\tif (request.status !== 'cancelled') {\n\t\t\t\trequest.status = 'completed';\n\t\t\t\trequest.eventDefs = eventDefs;\n\n\t\t\t\t_this.addEventDefs(eventDefs);\n\t\t\t\t_this.pendingCnt--;\n\t\t\t\t_this.tryRelease();\n\t\t\t}\n\t\t}, function() { // failure\n\t\t\tif (request.status !== 'cancelled') {\n\t\t\t\trequest.status = 'failed';\n\n\t\t\t\t_this.pendingCnt--;\n\t\t\t\t_this.tryRelease();\n\t\t\t}\n\t\t});\n\t},\n\n\n\tpurgeSource: function(source) {\n\t\tvar request = this.requestsByUid[source.uid];\n\n\t\tif (request) {\n\t\t\tdelete this.requestsByUid[source.uid];\n\n\t\t\tif (request.status === 'pending') {\n\t\t\t\trequest.status = 'cancelled';\n\t\t\t\tthis.pendingCnt--;\n\t\t\t\tthis.tryRelease();\n\t\t\t}\n\t\t\telse if (request.status === 'completed') {\n\t\t\t\trequest.eventDefs.forEach(this.removeEventDef.bind(this));\n\t\t\t}\n\t\t}\n\t},\n\n\n\tpurgeAllSources: function() {\n\t\tvar requestsByUid = this.requestsByUid;\n\t\tvar uid, request;\n\t\tvar completedCnt = 0;\n\n\t\tfor (uid in requestsByUid) {\n\t\t\trequest = requestsByUid[uid];\n\n\t\t\tif (request.status === 'pending') {\n\t\t\t\trequest.status = 'cancelled';\n\t\t\t}\n\t\t\telse if (request.status === 'completed') {\n\t\t\t\tcompletedCnt++;\n\t\t\t}\n\t\t}\n\n\t\tthis.requestsByUid = {};\n\t\tthis.pendingCnt = 0;\n\n\t\tif (completedCnt) {\n\t\t\tthis.removeAllEventDefs(); // might release\n\t\t}\n\t},\n\n\n\t// Event Definitions\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tgetEventDefByUid: function(eventDefUid) {\n\t\treturn this.eventDefsByUid[eventDefUid];\n\t},\n\n\n\tgetEventDefsById: function(eventDefId) {\n\t\tvar a = this.eventDefsById[eventDefId];\n\n\t\tif (a) {\n\t\t\treturn a.slice(); // clone\n\t\t}\n\n\t\treturn [];\n\t},\n\n\n\taddEventDefs: function(eventDefs) {\n\t\tfor (var i = 0; i < eventDefs.length; i++) {\n\t\t\tthis.addEventDef(eventDefs[i]);\n\t\t}\n\t},\n\n\n\taddEventDef: function(eventDef) {\n\t\tvar eventDefsById = this.eventDefsById;\n\t\tvar eventDefId = eventDef.id;\n\t\tvar eventDefs = eventDefsById[eventDefId] || (eventDefsById[eventDefId] = []);\n\t\tvar eventInstances = eventDef.buildInstances(this.unzonedRange);\n\t\tvar i;\n\n\t\teventDefs.push(eventDef);\n\n\t\tthis.eventDefsByUid[eventDef.uid] = eventDef;\n\n\t\tfor (i = 0; i < eventInstances.length; i++) {\n\t\t\tthis.addEventInstance(eventInstances[i], eventDefId);\n\t\t}\n\t},\n\n\n\tremoveEventDefsById: function(eventDefId) {\n\t\tvar _this = this;\n\n\t\tthis.getEventDefsById(eventDefId).forEach(function(eventDef) {\n\t\t\t_this.removeEventDef(eventDef);\n\t\t});\n\t},\n\n\n\tremoveAllEventDefs: function() {\n\t\tvar isEmpty = $.isEmptyObject(this.eventDefsByUid);\n\n\t\tthis.eventDefsByUid = {};\n\t\tthis.eventDefsById = {};\n\t\tthis.eventInstanceGroupsById = {};\n\n\t\tif (!isEmpty) {\n\t\t\tthis.tryRelease();\n\t\t}\n\t},\n\n\n\tremoveEventDef: function(eventDef) {\n\t\tvar eventDefsById = this.eventDefsById;\n\t\tvar eventDefs = eventDefsById[eventDef.id];\n\n\t\tdelete this.eventDefsByUid[eventDef.uid];\n\n\t\tif (eventDefs) {\n\t\t\tremoveExact(eventDefs, eventDef);\n\n\t\t\tif (!eventDefs.length) {\n\t\t\t\tdelete eventDefsById[eventDef.id];\n\t\t\t}\n\n\t\t\tthis.removeEventInstancesForDef(eventDef);\n\t\t}\n\t},\n\n\n\t// Event Instances\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tgetEventInstances: function() { // TODO: consider iterator\n\t\tvar eventInstanceGroupsById = this.eventInstanceGroupsById;\n\t\tvar eventInstances = [];\n\t\tvar id;\n\n\t\tfor (id in eventInstanceGroupsById) {\n\t\t\teventInstances.push.apply(eventInstances, // append\n\t\t\t\teventInstanceGroupsById[id].eventInstances\n\t\t\t);\n\t\t}\n\n\t\treturn eventInstances;\n\t},\n\n\n\tgetEventInstancesWithId: function(eventDefId) {\n\t\tvar eventInstanceGroup = this.eventInstanceGroupsById[eventDefId];\n\n\t\tif (eventInstanceGroup) {\n\t\t\treturn eventInstanceGroup.eventInstances.slice(); // clone\n\t\t}\n\n\t\treturn [];\n\t},\n\n\n\tgetEventInstancesWithoutId: function(eventDefId) { // TODO: consider iterator\n\t\tvar eventInstanceGroupsById = this.eventInstanceGroupsById;\n\t\tvar matchingInstances = [];\n\t\tvar id;\n\n\t\tfor (id in eventInstanceGroupsById) {\n\t\t\tif (id !== eventDefId) {\n\t\t\t\tmatchingInstances.push.apply(matchingInstances, // append\n\t\t\t\t\teventInstanceGroupsById[id].eventInstances\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn matchingInstances;\n\t},\n\n\n\taddEventInstance: function(eventInstance, eventDefId) {\n\t\tvar eventInstanceGroupsById = this.eventInstanceGroupsById;\n\t\tvar eventInstanceGroup = eventInstanceGroupsById[eventDefId] ||\n\t\t\t(eventInstanceGroupsById[eventDefId] = new EventInstanceGroup());\n\n\t\teventInstanceGroup.eventInstances.push(eventInstance);\n\n\t\tthis.tryRelease();\n\t},\n\n\n\tremoveEventInstancesForDef: function(eventDef) {\n\t\tvar eventInstanceGroupsById = this.eventInstanceGroupsById;\n\t\tvar eventInstanceGroup = eventInstanceGroupsById[eventDef.id];\n\t\tvar removeCnt;\n\n\t\tif (eventInstanceGroup) {\n\t\t\tremoveCnt = removeMatching(eventInstanceGroup.eventInstances, function(currentEventInstance) {\n\t\t\t\treturn currentEventInstance.def === eventDef;\n\t\t\t});\n\n\t\t\tif (!eventInstanceGroup.eventInstances.length) {\n\t\t\t\tdelete eventInstanceGroupsById[eventDef.id];\n\t\t\t}\n\n\t\t\tif (removeCnt) {\n\t\t\t\tthis.tryRelease();\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Releasing and Freezing\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\ttryRelease: function() {\n\t\tif (!this.pendingCnt) {\n\t\t\tif (!this.freezeDepth) {\n\t\t\t\tthis.release();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.stuntedReleaseCnt++;\n\t\t\t}\n\t\t}\n\t},\n\n\n\trelease: function() {\n\t\tthis.releaseCnt++;\n\t\tthis.trigger('release', this.eventInstanceGroupsById);\n\t},\n\n\n\twhenReleased: function() {\n\t\tvar _this = this;\n\n\t\tif (this.releaseCnt) {\n\t\t\treturn Promise.resolve(this.eventInstanceGroupsById);\n\t\t}\n\t\telse {\n\t\t\treturn Promise.construct(function(onResolve) {\n\t\t\t\t_this.one('release', onResolve);\n\t\t\t});\n\t\t}\n\t},\n\n\n\tfreeze: function() {\n\t\tif (!(this.freezeDepth++)) {\n\t\t\tthis.stuntedReleaseCnt = 0;\n\t\t}\n\t},\n\n\n\tthaw: function() {\n\t\tif (!(--this.freezeDepth) && this.stuntedReleaseCnt && !this.pendingCnt) {\n\t\t\tthis.release();\n\t\t}\n\t}\n\n});\n\n;;\n\nvar EventManager = Class.extend(EmitterMixin, ListenerMixin, {\n\n\tcurrentPeriod: null,\n\n\tcalendar: null,\n\tstickySource: null,\n\totherSources: null, // does not include sticky source\n\n\n\tconstructor: function(calendar) {\n\t\tthis.calendar = calendar;\n\t\tthis.stickySource = new ArrayEventSource(calendar);\n\t\tthis.otherSources = [];\n\t},\n\n\n\trequestEvents: function(start, end, timezone, force) {\n\t\tif (\n\t\t\tforce ||\n\t\t\t!this.currentPeriod ||\n\t\t\t!this.currentPeriod.isWithinRange(start, end) ||\n\t\t\ttimezone !== this.currentPeriod.timezone\n\t\t) {\n\t\t\tthis.setPeriod( // will change this.currentPeriod\n\t\t\t\tnew EventPeriod(start, end, timezone)\n\t\t\t);\n\t\t}\n\n\t\treturn this.currentPeriod.whenReleased();\n\t},\n\n\n\t// Source Adding/Removing\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\taddSource: function(eventSource) {\n\t\tthis.otherSources.push(eventSource);\n\n\t\tif (this.currentPeriod) {\n\t\t\tthis.currentPeriod.requestSource(eventSource); // might release\n\t\t}\n\t},\n\n\n\tremoveSource: function(doomedSource) {\n\t\tremoveExact(this.otherSources, doomedSource);\n\n\t\tif (this.currentPeriod) {\n\t\t\tthis.currentPeriod.purgeSource(doomedSource); // might release\n\t\t}\n\t},\n\n\n\tremoveAllSources: function() {\n\t\tthis.otherSources = [];\n\n\t\tif (this.currentPeriod) {\n\t\t\tthis.currentPeriod.purgeAllSources(); // might release\n\t\t}\n\t},\n\n\n\t// Source Refetching\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\trefetchSource: function(eventSource) {\n\t\tvar currentPeriod = this.currentPeriod;\n\n\t\tif (currentPeriod) {\n\t\t\tcurrentPeriod.freeze();\n\t\t\tcurrentPeriod.purgeSource(eventSource);\n\t\t\tcurrentPeriod.requestSource(eventSource);\n\t\t\tcurrentPeriod.thaw();\n\t\t}\n\t},\n\n\n\trefetchAllSources: function() {\n\t\tvar currentPeriod = this.currentPeriod;\n\n\t\tif (currentPeriod) {\n\t\t\tcurrentPeriod.freeze();\n\t\t\tcurrentPeriod.purgeAllSources();\n\t\t\tcurrentPeriod.requestSources(this.getSources());\n\t\t\tcurrentPeriod.thaw();\n\t\t}\n\t},\n\n\n\t// Source Querying\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tgetSources: function() {\n\t\treturn [ this.stickySource ].concat(this.otherSources);\n\t},\n\n\n\t// like querySources, but accepts multple match criteria (like multiple IDs)\n\tmultiQuerySources: function(matchInputs) {\n\n\t\t// coerce into an array\n\t\tif (!matchInputs) {\n\t\t\tmatchInputs = [];\n\t\t}\n\t\telse if (!$.isArray(matchInputs)) {\n\t\t\tmatchInputs = [ matchInputs ];\n\t\t}\n\n\t\tvar matchingSources = [];\n\t\tvar i;\n\n\t\t// resolve raw inputs to real event source objects\n\t\tfor (i = 0; i < matchInputs.length; i++) {\n\t\t\tmatchingSources.push.apply( // append\n\t\t\t\tmatchingSources,\n\t\t\t\tthis.querySources(matchInputs[i])\n\t\t\t);\n\t\t}\n\n\t\treturn matchingSources;\n\t},\n\n\n\t// matchInput can either by a real event source object, an ID, or the function/URL for the source.\n\t// returns an array of matching source objects.\n\tquerySources: function(matchInput) {\n\t\tvar sources = this.otherSources;\n\t\tvar i, source;\n\n\t\t// given a proper event source object\n\t\tfor (i = 0; i < sources.length; i++) {\n\t\t\tsource = sources[i];\n\n\t\t\tif (source === matchInput) {\n\t\t\t\treturn [ source ];\n\t\t\t}\n\t\t}\n\n\t\t// an ID match\n\t\tsource = this.getSourceById(EventSource.normalizeId(matchInput));\n\t\tif (source) {\n\t\t\treturn [ source ];\n\t\t}\n\n\t\t// parse as an event source\n\t\tmatchInput = EventSourceParser.parse(matchInput, this.calendar);\n\t\tif (matchInput) {\n\n\t\t\treturn $.grep(sources, function(source) {\n\t\t\t\treturn isSourcesEquivalent(matchInput, source);\n\t\t\t});\n\t\t}\n\t},\n\n\n\t/*\n\tID assumed to already be normalized\n\t*/\n\tgetSourceById: function(id) {\n\t\treturn $.grep(this.otherSources, function(source) {\n\t\t\treturn source.id && source.id === id;\n\t\t})[0];\n\t},\n\n\n\t// Event-Period\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tsetPeriod: function(eventPeriod) {\n\t\tif (this.currentPeriod) {\n\t\t\tthis.unbindPeriod(this.currentPeriod);\n\t\t\tthis.currentPeriod = null;\n\t\t}\n\n\t\tthis.currentPeriod = eventPeriod;\n\t\tthis.bindPeriod(eventPeriod);\n\n\t\teventPeriod.requestSources(this.getSources());\n\t},\n\n\n\tbindPeriod: function(eventPeriod) {\n\t\tthis.listenTo(eventPeriod, 'release', function(eventsPayload) {\n\t\t\tthis.trigger('release', eventsPayload);\n\t\t});\n\t},\n\n\n\tunbindPeriod: function(eventPeriod) {\n\t\tthis.stopListeningTo(eventPeriod);\n\t},\n\n\n\t// Event Getting/Adding/Removing\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tgetEventDefByUid: function(uid) {\n\t\tif (this.currentPeriod) {\n\t\t\treturn this.currentPeriod.getEventDefByUid(uid);\n\t\t}\n\t},\n\n\n\taddEventDef: function(eventDef, isSticky) {\n\t\tif (isSticky) {\n\t\t\tthis.stickySource.addEventDef(eventDef);\n\t\t}\n\n\t\tif (this.currentPeriod) {\n\t\t\tthis.currentPeriod.addEventDef(eventDef); // might release\n\t\t}\n\t},\n\n\n\tremoveEventDefsById: function(eventId) {\n\t\tthis.getSources().forEach(function(eventSource) {\n\t\t\teventSource.removeEventDefsById(eventId);\n\t\t});\n\n\t\tif (this.currentPeriod) {\n\t\t\tthis.currentPeriod.removeEventDefsById(eventId); // might release\n\t\t}\n\t},\n\n\n\tremoveAllEventDefs: function() {\n\t\tthis.getSources().forEach(function(eventSource) {\n\t\t\teventSource.removeAllEventDefs();\n\t\t});\n\n\t\tif (this.currentPeriod) {\n\t\t\tthis.currentPeriod.removeAllEventDefs();\n\t\t}\n\t},\n\n\n\t// Event Mutating\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\t/*\n\tReturns an undo function.\n\t*/\n\tmutateEventsWithId: function(eventDefId, eventDefMutation) {\n\t\tvar currentPeriod = this.currentPeriod;\n\t\tvar eventDefs;\n\t\tvar undoFuncs = [];\n\n\t\tif (currentPeriod) {\n\n\t\t\tcurrentPeriod.freeze();\n\n\t\t\teventDefs = currentPeriod.getEventDefsById(eventDefId);\n\t\t\teventDefs.forEach(function(eventDef) {\n\t\t\t\t// add/remove esp because id might change\n\t\t\t\tcurrentPeriod.removeEventDef(eventDef);\n\t\t\t\tundoFuncs.push(eventDefMutation.mutateSingle(eventDef));\n\t\t\t\tcurrentPeriod.addEventDef(eventDef);\n\t\t\t});\n\n\t\t\tcurrentPeriod.thaw();\n\n\t\t\treturn function() {\n\t\t\t\tcurrentPeriod.freeze();\n\n\t\t\t\tfor (var i = 0; i < eventDefs.length; i++) {\n\t\t\t\t\tcurrentPeriod.removeEventDef(eventDefs[i]);\n\t\t\t\t\tundoFuncs[i]();\n\t\t\t\t\tcurrentPeriod.addEventDef(eventDefs[i]);\n\t\t\t\t}\n\n\t\t\t\tcurrentPeriod.thaw();\n\t\t\t};\n\t\t}\n\n\t\treturn function() { };\n\t},\n\n\n\t/*\n\tcopies and then mutates\n\t*/\n\tbuildMutatedEventInstanceGroup: function(eventDefId, eventDefMutation) {\n\t\tvar eventDefs = this.getEventDefsById(eventDefId);\n\t\tvar i;\n\t\tvar defCopy;\n\t\tvar allInstances = [];\n\n\t\tfor (i = 0; i < eventDefs.length; i++) {\n\t\t\tdefCopy = eventDefs[i].clone();\n\n\t\t\tif (defCopy instanceof SingleEventDef) {\n\t\t\t\teventDefMutation.mutateSingle(defCopy);\n\n\t\t\t\tallInstances.push.apply(allInstances, // append\n\t\t\t\t\tdefCopy.buildInstances()\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn new EventInstanceGroup(allInstances);\n\t},\n\n\n\t// Freezing\n\t// -----------------------------------------------------------------------------------------------------------------\n\n\n\tfreeze: function() {\n\t\tif (this.currentPeriod) {\n\t\t\tthis.currentPeriod.freeze();\n\t\t}\n\t},\n\n\n\tthaw: function() {\n\t\tif (this.currentPeriod) {\n\t\t\tthis.currentPeriod.thaw();\n\t\t}\n\t}\n\n});\n\n\n// Methods that straight-up query the current EventPeriod for an array of results.\n[\n\t'getEventDefsById',\n\t'getEventInstances',\n\t'getEventInstancesWithId',\n\t'getEventInstancesWithoutId'\n].forEach(function(methodName) {\n\n\tEventManager.prototype[methodName] = function() {\n\t\tvar currentPeriod = this.currentPeriod;\n\n\t\tif (currentPeriod) {\n\t\t\treturn currentPeriod[methodName].apply(currentPeriod, arguments);\n\t\t}\n\n\t\treturn [];\n\t};\n});\n\n\nfunction isSourcesEquivalent(source0, source1) {\n\treturn source0.getPrimitive() == source1.getPrimitive();\n}\n\n;;\n\nvar BUSINESS_HOUR_EVENT_DEFAULTS = {\n\tstart: '09:00',\n\tend: '17:00',\n\tdow: [ 1, 2, 3, 4, 5 ], // monday - friday\n\trendering: 'inverse-background'\n\t// classNames are defined in businessHoursSegClasses\n};\n\n\nvar BusinessHourGenerator = FC.BusinessHourGenerator = Class.extend({\n\n\trawComplexDef: null,\n\tcalendar: null, // for anonymous EventSource\n\n\n\tconstructor: function(rawComplexDef, calendar) {\n\t\tthis.rawComplexDef = rawComplexDef;\n\t\tthis.calendar = calendar;\n\t},\n\n\n\tbuildEventInstanceGroup: function(isAllDay, unzonedRange) {\n\t\tvar eventDefs = this.buildEventDefs(isAllDay);\n\t\tvar eventInstanceGroup;\n\n\t\tif (eventDefs.length) {\n\t\t\teventInstanceGroup = new EventInstanceGroup(\n\t\t\t\teventDefsToEventInstances(eventDefs, unzonedRange)\n\t\t\t);\n\n\t\t\t// so that inverse-background rendering can happen even when no eventRanges in view\n\t\t\teventInstanceGroup.explicitEventDef = eventDefs[0];\n\n\t\t\treturn eventInstanceGroup;\n\t\t}\n\t},\n\n\n\tbuildEventDefs: function(isAllDay) {\n\t\tvar rawComplexDef = this.rawComplexDef;\n\t\tvar rawDefs = [];\n\t\tvar requireDow = false;\n\t\tvar i;\n\t\tvar defs = [];\n\n\t\tif (rawComplexDef === true) {\n\t\t\trawDefs = [ {} ]; // will get BUSINESS_HOUR_EVENT_DEFAULTS verbatim\n\t\t}\n\t\telse if ($.isPlainObject(rawComplexDef)) {\n\t\t\trawDefs = [ rawComplexDef ];\n\t\t}\n\t\telse if ($.isArray(rawComplexDef)) {\n\t\t\trawDefs = rawComplexDef;\n\t\t\trequireDow = true; // every sub-definition NEEDS a day-of-week\n\t\t}\n\n\t\tfor (i = 0; i < rawDefs.length; i++) {\n\t\t\tif (!requireDow || rawDefs[i].dow) {\n\t\t\t\tdefs.push(\n\t\t\t\t\tthis.buildEventDef(isAllDay, rawDefs[i])\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn defs;\n\t},\n\n\n\tbuildEventDef: function(isAllDay, rawDef) {\n\t\tvar fullRawDef = $.extend({}, BUSINESS_HOUR_EVENT_DEFAULTS, rawDef);\n\n\t\tif (isAllDay) {\n\t\t\tfullRawDef.start = null;\n\t\t\tfullRawDef.end = null;\n\t\t}\n\n\t\treturn RecurringEventDef.parse(\n\t\t\tfullRawDef,\n\t\t\tnew EventSource(this.calendar) // dummy source\n\t\t);\n\t}\n\n});\n\n;;\n\nvar EventDefParser = {\n\n\tparse: function(eventInput, source) {\n\t\tif (\n\t\t\tisTimeString(eventInput.start) || moment.isDuration(eventInput.start) ||\n\t\t\tisTimeString(eventInput.end) || moment.isDuration(eventInput.end)\n\t\t) {\n\t\t\treturn RecurringEventDef.parse(eventInput, source);\n\t\t}\n\t\telse {\n\t\t\treturn SingleEventDef.parse(eventInput, source);\n\t\t}\n\t}\n\n};\n\n;;\n\nvar EventDef = FC.EventDef = Class.extend(ParsableModelMixin, {\n\n\tsource: null, // required\n\n\tid: null, // normalized supplied ID\n\trawId: null, // unnormalized supplied ID\n\tuid: null, // internal ID. new ID for every definition\n\n\t// NOTE: eventOrder sorting relies on these\n\ttitle: null,\n\turl: null,\n\trendering: null,\n\tconstraint: null,\n\toverlap: null,\n\teditable: null,\n\tstartEditable: null,\n\tdurationEditable: null,\n\tcolor: null,\n\tbackgroundColor: null,\n\tborderColor: null,\n\ttextColor: null,\n\n\tclassName: null, // an array. TODO: rename to className*s* (API breakage)\n\tmiscProps: null,\n\n\n\tconstructor: function(source) {\n\t\tthis.source = source;\n\t\tthis.className = [];\n\t\tthis.miscProps = {};\n\t},\n\n\n\tisAllDay: function() {\n\t\t// subclasses must implement\n\t},\n\n\n\tbuildInstances: function(unzonedRange) {\n\t\t// subclasses must implement\n\t},\n\n\n\tclone: function() {\n\t\tvar copy = new this.constructor(this.source);\n\n\t\tcopy.id = this.id;\n\t\tcopy.rawId = this.rawId;\n\t\tcopy.uid = this.uid; // not really unique anymore :(\n\n\t\tEventDef.copyVerbatimStandardProps(this, copy);\n\n\t\tcopy.className = this.className.slice(); // copy\n\t\tcopy.miscProps = $.extend({}, this.miscProps);\n\n\t\treturn copy;\n\t},\n\n\n\thasInverseRendering: function() {\n\t\treturn this.getRendering() === 'inverse-background';\n\t},\n\n\n\thasBgRendering: function() {\n\t\tvar rendering = this.getRendering();\n\n\t\treturn rendering === 'inverse-background' || rendering === 'background';\n\t},\n\n\n\tgetRendering: function() {\n\t\tif (this.rendering != null) {\n\t\t\treturn this.rendering;\n\t\t}\n\n\t\treturn this.source.rendering;\n\t},\n\n\n\tgetConstraint: function() {\n\t\tif (this.constraint != null) {\n\t\t\treturn this.constraint;\n\t\t}\n\n\t\tif (this.source.constraint != null) {\n\t\t\treturn this.source.constraint;\n\t\t}\n\n\t\treturn this.source.calendar.opt('eventConstraint'); // what about View option?\n\t},\n\n\n\tgetOverlap: function() {\n\t\tif (this.overlap != null) {\n\t\t\treturn this.overlap;\n\t\t}\n\n\t\tif (this.source.overlap != null) {\n\t\t\treturn this.source.overlap;\n\t\t}\n\n\t\treturn this.source.calendar.opt('eventOverlap'); // what about View option?\n\t},\n\n\n\tisStartExplicitlyEditable: function() {\n\t\tif (this.startEditable !== null) {\n\t\t\treturn this.startEditable;\n\t\t}\n\n\t\treturn this.source.startEditable;\n\t},\n\n\n\tisDurationExplicitlyEditable: function() {\n\t\tif (this.durationEditable !== null) {\n\t\t\treturn this.durationEditable;\n\t\t}\n\n\t\treturn this.source.durationEditable;\n\t},\n\n\n\tisExplicitlyEditable: function() {\n\t\tif (this.editable !== null) {\n\t\t\treturn this.editable;\n\t\t}\n\n\t\treturn this.source.editable;\n\t},\n\n\n\ttoLegacy: function() {\n\t\tvar obj = $.extend({}, this.miscProps);\n\n\t\tobj._id = this.uid;\n\t\tobj.source = this.source;\n\t\tobj.className = this.className.slice(); // copy\n\t\tobj.allDay = this.isAllDay();\n\n\t\tif (this.rawId != null) {\n\t\t\tobj.id = this.rawId;\n\t\t}\n\n\t\tEventDef.copyVerbatimStandardProps(this, obj);\n\n\t\treturn obj;\n\t},\n\n\n\tapplyManualStandardProps: function(rawProps) {\n\n\t\tif (rawProps.id != null) {\n\t\t\tthis.id = EventDef.normalizeId((this.rawId = rawProps.id));\n\t\t}\n\t\telse {\n\t\t\tthis.id = EventDef.generateId();\n\t\t}\n\n\t\tif (rawProps._id != null) { // accept this prop, even tho somewhat internal\n\t\t\tthis.uid = String(rawProps._id);\n\t\t}\n\t\telse {\n\t\t\tthis.uid = EventDef.generateId();\n\t\t}\n\n\t\t// TODO: converge with EventSource\n\t\tif ($.isArray(rawProps.className)) {\n\t\t\tthis.className = rawProps.className;\n\t\t}\n\t\tif (typeof rawProps.className === 'string') {\n\t\t\tthis.className = rawProps.className.split(/\\s+/);\n\t\t}\n\n\t\treturn true;\n\t},\n\n\n\tapplyMiscProps: function(rawProps) {\n\t\t$.extend(this.miscProps, rawProps);\n\t}\n\n});\n\n// finish initializing the mixin\nEventDef.defineStandardProps = ParsableModelMixin_defineStandardProps;\nEventDef.copyVerbatimStandardProps = ParsableModelMixin_copyVerbatimStandardProps;\n\n\n// IDs\n// ---------------------------------------------------------------------------------------------------------------------\n// TODO: converge with EventSource\n\n\nEventDef.uuid = 0;\n\n\nEventDef.normalizeId = function(id) {\n\treturn String(id);\n};\n\n\nEventDef.generateId = function() {\n\treturn '_fc' + (EventDef.uuid++);\n};\n\n\n// Parsing\n// ---------------------------------------------------------------------------------------------------------------------\n\n\nEventDef.defineStandardProps({\n\t// not automatically assigned (`false`)\n\t_id: false,\n\tid: false,\n\tclassName: false,\n\tsource: false, // will ignored\n\n\t// automatically assigned (`true`)\n\ttitle: true,\n\turl: true,\n\trendering: true,\n\tconstraint: true,\n\toverlap: true,\n\teditable: true,\n\tstartEditable: true,\n\tdurationEditable: true,\n\tcolor: true,\n\tbackgroundColor: true,\n\tborderColor: true,\n\ttextColor: true\n});\n\n\nEventDef.parse = function(rawInput, source) {\n\tvar def = new this(source);\n\tvar calendarTransform = source.calendar.opt('eventDataTransform');\n\tvar sourceTransform = source.eventDataTransform;\n\n\tif (calendarTransform) {\n\t\trawInput = calendarTransform(rawInput);\n\t}\n\tif (sourceTransform) {\n\t\trawInput = sourceTransform(rawInput);\n\t}\n\n\tif (def.applyProps(rawInput)) {\n\t\treturn def;\n\t}\n\n\treturn false;\n};\n\n;;\n\nvar SingleEventDef = EventDef.extend({\n\n\tdateProfile: null,\n\n\n\t/*\n\tWill receive start/end params, but will be ignored.\n\t*/\n\tbuildInstances: function() {\n\t\treturn [ this.buildInstance() ];\n\t},\n\n\n\tbuildInstance: function() {\n\t\treturn new EventInstance(\n\t\t\tthis, // definition\n\t\t\tthis.dateProfile\n\t\t);\n\t},\n\n\n\tisAllDay: function() {\n\t\treturn this.dateProfile.isAllDay();\n\t},\n\n\n\tclone: function() {\n\t\tvar def = EventDef.prototype.clone.call(this);\n\n\t\tdef.dateProfile = this.dateProfile;\n\n\t\treturn def;\n\t},\n\n\n\trezone: function() {\n\t\tvar calendar = this.source.calendar;\n\t\tvar dateProfile = this.dateProfile;\n\n\t\tthis.dateProfile = new EventDateProfile(\n\t\t\tcalendar.moment(dateProfile.start),\n\t\t\tdateProfile.end ? calendar.moment(dateProfile.end) : null,\n\t\t\tcalendar\n\t\t);\n\t},\n\n\n\t/*\n\tNOTE: if super-method fails, should still attempt to apply\n\t*/\n\tapplyManualStandardProps: function(rawProps) {\n\t\tvar superSuccess = EventDef.prototype.applyManualStandardProps.apply(this, arguments);\n\t\tvar dateProfile = EventDateProfile.parse(rawProps, this.source); // returns null on failure\n\n\t\tif (dateProfile) {\n\t\t\tthis.dateProfile = dateProfile;\n\n\t\t\t// make sure `date` shows up in the legacy event objects as-is\n\t\t\tif (rawProps.date != null) {\n\t\t\t\tthis.miscProps.date = rawProps.date;\n\t\t\t}\n\n\t\t\treturn superSuccess;\n\t\t}\n\t\telse {\n\t\t\treturn false;\n\t\t}\n\t}\n\n});\n\n\n// Parsing\n// ---------------------------------------------------------------------------------------------------------------------\n\n\nSingleEventDef.defineStandardProps({ // false = manually process\n\tstart: false,\n\tdate: false, // alias for 'start'\n\tend: false,\n\tallDay: false\n});\n\n;;\n\nvar RecurringEventDef = EventDef.extend({\n\n\tstartTime: null, // duration\n\tendTime: null, // duration, or null\n\tdowHash: null, // object hash, or null\n\n\n\tisAllDay: function() {\n\t\treturn !this.startTime && !this.endTime;\n\t},\n\n\n\tbuildInstances: function(unzonedRange) {\n\t\tvar calendar = this.source.calendar;\n\t\tvar unzonedDate = unzonedRange.getStart();\n\t\tvar unzonedEnd = unzonedRange.getEnd();\n\t\tvar zonedDayStart;\n\t\tvar instanceStart, instanceEnd;\n\t\tvar instances = [];\n\n\t\twhile (unzonedDate.isBefore(unzonedEnd)) {\n\n\t\t\t// if everyday, or this particular day-of-week\n\t\t\tif (!this.dowHash || this.dowHash[unzonedDate.day()]) {\n\n\t\t\t\tzonedDayStart = calendar.applyTimezone(unzonedDate);\n\t\t\t\tinstanceStart = zonedDayStart.clone();\n\t\t\t\tinstanceEnd = null;\n\n\t\t\t\tif (this.startTime) {\n\t\t\t\t\tinstanceStart.time(this.startTime);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tinstanceStart.stripTime();\n\t\t\t\t}\n\n\t\t\t\tif (this.endTime) {\n\t\t\t\t\tinstanceEnd = zonedDayStart.clone().time(this.endTime);\n\t\t\t\t}\n\n\t\t\t\tinstances.push(\n\t\t\t\t\tnew EventInstance(\n\t\t\t\t\t\tthis, // definition\n\t\t\t\t\t\tnew EventDateProfile(instanceStart, instanceEnd, calendar)\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tunzonedDate.add(1, 'days');\n\t\t}\n\n\t\treturn instances;\n\t},\n\n\n\tsetDow: function(dowNumbers) {\n\n\t\tif (!this.dowHash) {\n\t\t\tthis.dowHash = {};\n\t\t}\n\n\t\tfor (var i = 0; i < dowNumbers.length; i++) {\n\t\t\tthis.dowHash[dowNumbers[i]] = true;\n\t\t}\n\t},\n\n\n\tclone: function() {\n\t\tvar def = EventDef.prototype.clone.call(this);\n\n\t\tif (def.startTime) {\n\t\t\tdef.startTime = moment.duration(this.startTime);\n\t\t}\n\n\t\tif (def.endTime) {\n\t\t\tdef.endTime = moment.duration(this.endTime);\n\t\t}\n\n\t\tif (this.dowHash) {\n\t\t\tdef.dowHash = $.extend({}, this.dowHash);\n\t\t}\n\n\t\treturn def;\n\t},\n\n\n\t/*\n\tNOTE: if super-method fails, should still attempt to apply\n\t*/\n\tapplyProps: function(rawProps) {\n\t\tvar superSuccess = EventDef.prototype.applyProps.apply(this, arguments);\n\n\t\tif (rawProps.start) {\n\t\t\tthis.startTime = moment.duration(rawProps.start);\n\t\t}\n\n\t\tif (rawProps.end) {\n\t\t\tthis.endTime = moment.duration(rawProps.end);\n\t\t}\n\n\t\tif (rawProps.dow) {\n\t\t\tthis.setDow(rawProps.dow);\n\t\t}\n\n\t\treturn superSuccess;\n\t}\n\n});\n\n\n// Parsing\n// ---------------------------------------------------------------------------------------------------------------------\n\n\nRecurringEventDef.defineStandardProps({ // false = manually process\n\tstart: false,\n\tend: false,\n\tdow: false\n});\n\n;;\n\nvar EventInstance = Class.extend({\n\n\tdef: null, // EventDef\n\tdateProfile: null, // EventDateProfile\n\n\n\tconstructor: function(def, dateProfile) {\n\t\tthis.def = def;\n\t\tthis.dateProfile = dateProfile;\n\t},\n\n\n\ttoLegacy: function() {\n\t\tvar dateProfile = this.dateProfile;\n\t\tvar obj = this.def.toLegacy();\n\n\t\tobj.start = dateProfile.start.clone();\n\t\tobj.end = dateProfile.end ? dateProfile.end.clone() : null;\n\n\t\treturn obj;\n\t}\n\n});\n\n;;\n\n/*\nIt's expected that there will be at least one EventInstance,\nOR that an explicitEventDef is assigned.\n*/\nvar EventInstanceGroup = FC.EventInstanceGroup = Class.extend({\n\n\teventInstances: null,\n\texplicitEventDef: null, // optional\n\n\n\tconstructor: function(eventInstances) {\n\t\tthis.eventInstances = eventInstances || [];\n\t},\n\n\n\tgetAllEventRanges: function(constraintRange) {\n\t\tif (constraintRange) {\n\t\t\treturn this.sliceNormalRenderRanges(constraintRange);\n\t\t}\n\t\telse {\n\t\t\treturn this.eventInstances.map(eventInstanceToEventRange);\n\t\t}\n\t},\n\n\n\tsliceRenderRanges: function(constraintRange) {\n\t\tif (this.isInverse()) {\n\t\t\treturn this.sliceInverseRenderRanges(constraintRange);\n\t\t}\n\t\telse {\n\t\t\treturn this.sliceNormalRenderRanges(constraintRange);\n\t\t}\n\t},\n\n\n\tsliceNormalRenderRanges: function(constraintRange) {\n\t\tvar eventInstances = this.eventInstances;\n\t\tvar i, eventInstance;\n\t\tvar slicedRange;\n\t\tvar slicedEventRanges = [];\n\n\t\tfor (i = 0; i < eventInstances.length; i++) {\n\t\t\teventInstance = eventInstances[i];\n\n\t\t\tslicedRange = eventInstance.dateProfile.unzonedRange.intersect(constraintRange);\n\n\t\t\tif (slicedRange) {\n\t\t\t\tslicedEventRanges.push(\n\t\t\t\t\tnew EventRange(\n\t\t\t\t\t\tslicedRange,\n\t\t\t\t\t\teventInstance.def,\n\t\t\t\t\t\teventInstance\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn slicedEventRanges;\n\t},\n\n\n\tsliceInverseRenderRanges: function(constraintRange) {\n\t\tvar unzonedRanges = this.eventInstances.map(eventInstanceToUnzonedRange);\n\t\tvar ownerDef = this.getEventDef();\n\n\t\tunzonedRanges = invertUnzonedRanges(unzonedRanges, constraintRange);\n\n\t\treturn unzonedRanges.map(function(unzonedRange) {\n\t\t\treturn new EventRange(unzonedRange, ownerDef); // don't give an EventInstance\n\t\t});\n\t},\n\n\n\tisInverse: function() {\n\t\treturn this.getEventDef().hasInverseRendering();\n\t},\n\n\n\tgetEventDef: function() {\n\t\treturn this.explicitEventDef || this.eventInstances[0].def;\n\t}\n\n});\n\n;;\n\n/*\nMeant to be immutable\n*/\nvar EventDateProfile = Class.extend({\n\n\tstart: null,\n\tend: null,\n\tunzonedRange: null,\n\n\n\tconstructor: function(start, end, calendar) {\n\t\tthis.start = start;\n\t\tthis.end = end || null;\n\t\tthis.unzonedRange = this.buildUnzonedRange(calendar);\n\t},\n\n\n\tisAllDay: function() { // why recompute this every time?\n\t\treturn !(this.start.hasTime() || (this.end && this.end.hasTime()));\n\t},\n\n\n\t/*\n\tNeeds a Calendar object\n\t*/\n\tbuildUnzonedRange: function(calendar) {\n\t\tvar startMs = this.start.clone().stripZone().valueOf();\n\t\tvar endMs = this.getEnd(calendar).stripZone().valueOf();\n\n\t\treturn new UnzonedRange(startMs, endMs);\n\t},\n\n\n\t/*\n\tNeeds a Calendar object\n\t*/\n\tgetEnd: function(calendar) {\n\t\treturn this.end ?\n\t\t\tthis.end.clone() :\n\t\t\t// derive the end from the start and allDay. compute allDay if necessary\n\t\t\tcalendar.getDefaultEventEnd(\n\t\t\t\tthis.isAllDay(),\n\t\t\t\tthis.start\n\t\t\t);\n\t}\n\n});\n\n\nEventDateProfile.isStandardProp = function(propName) {\n\treturn propName === 'start' || propName === 'date' || propName === 'end' || propName === 'allDay';\n};\n\n\n/*\nNeeds an EventSource object\n*/\nEventDateProfile.parse = function(rawProps, source) {\n\tvar startInput = rawProps.start || rawProps.date;\n\tvar endInput = rawProps.end;\n\n\tif (!startInput) {\n\t\treturn false;\n\t}\n\n\tvar calendar = source.calendar;\n\tvar start = calendar.moment(startInput);\n\tvar end = endInput ? calendar.moment(endInput) : null;\n\tvar forcedAllDay = rawProps.allDay;\n\tvar forceEventDuration = calendar.opt('forceEventDuration');\n\n\tif (!start.isValid()) {\n\t\treturn false;\n\t}\n\n\tif (end && (!end.isValid() || !end.isAfter(start))) {\n\t\tend = null;\n\t}\n\n\tif (forcedAllDay == null) {\n\t\tforcedAllDay = source.allDayDefault;\n\t\tif (forcedAllDay == null) {\n\t\t\tforcedAllDay = calendar.opt('allDayDefault');\n\t\t}\n\t}\n\n\tif (forcedAllDay === true) {\n\t\tstart.stripTime();\n\t\tif (end) {\n\t\t\tend.stripTime();\n\t\t}\n\t}\n\telse if (forcedAllDay === false) {\n\t\tif (!start.hasTime()) {\n\t\t\tstart.time(0);\n\t\t}\n\t\tif (end && !end.hasTime()) {\n\t\t\tend.time(0);\n\t\t}\n\t}\n\n\tif (!end && forceEventDuration) {\n\t\tend = calendar.getDefaultEventEnd(!start.hasTime(), start);\n\t}\n\n\treturn new EventDateProfile(start, end, calendar);\n};\n\n;;\n\nvar EventRange = Class.extend({\n\n\tunzonedRange: null,\n\teventDef: null,\n\teventInstance: null, // optional\n\n\n\tconstructor: function(unzonedRange, eventDef, eventInstance) {\n\t\tthis.unzonedRange = unzonedRange;\n\t\tthis.eventDef = eventDef;\n\n\t\tif (eventInstance) {\n\t\t\tthis.eventInstance = eventInstance;\n\t\t}\n\t}\n\n});\n\n;;\n\nvar EventFootprint = FC.EventFootprint = Class.extend({\n\n\tcomponentFootprint: null,\n\teventDef: null,\n\teventInstance: null, // optional\n\n\n\tconstructor: function(componentFootprint, eventDef, eventInstance) {\n\t\tthis.componentFootprint = componentFootprint;\n\t\tthis.eventDef = eventDef;\n\n\t\tif (eventInstance) {\n\t\t\tthis.eventInstance = eventInstance;\n\t\t}\n\t},\n\n\n\tgetEventLegacy: function() {\n\t\treturn (this.eventInstance || this.eventDef).toLegacy();\n\t}\n\n});\n\n;;\n\nvar EventDefMutation = FC.EventDefMutation = Class.extend({\n\n\t// won't ever be empty. will be null instead.\n\t// callers should use setDateMutation for setting.\n\tdateMutation: null,\n\n\t// hacks to get updateEvent/createFromRawProps to work.\n\t// not undo-able and not considered in isEmpty.\n\teventDefId: null, // standard manual props\n\tclassName: null, // \"\n\tverbatimStandardProps: null,\n\tmiscProps: null,\n\n\n\t/*\n\teventDef assumed to be a SingleEventDef.\n\treturns an undo function.\n\t*/\n\tmutateSingle: function(eventDef) {\n\t\tvar origDateProfile;\n\n\t\tif (this.dateMutation) {\n\t\t\torigDateProfile = eventDef.dateProfile;\n\n\t\t\teventDef.dateProfile = this.dateMutation.buildNewDateProfile(\n\t\t\t\torigDateProfile,\n\t\t\t\teventDef.source.calendar\n\t\t\t);\n\t\t}\n\n\t\t// can't undo\n\t\t// TODO: more DRY with EventDef::applyManualStandardProps\n\t\tif (this.eventDefId != null) {\n\t\t\teventDef.id = EventDef.normalizeId((eventDef.rawId = this.eventDefId));\n\t\t}\n\n\t\t// can't undo\n\t\t// TODO: more DRY with EventDef::applyManualStandardProps\n\t\tif (this.className) {\n\t\t\teventDef.className = this.className;\n\t\t}\n\n\t\t// can't undo\n\t\tif (this.verbatimStandardProps) {\n\t\t\tSingleEventDef.copyVerbatimStandardProps(\n\t\t\t\tthis.verbatimStandardProps, // src\n\t\t\t\teventDef // dest\n\t\t\t);\n\t\t}\n\n\t\t// can't undo\n\t\tif (this.miscProps) {\n\t\t\teventDef.applyMiscProps(this.miscProps);\n\t\t}\n\n\t\tif (origDateProfile) {\n\t\t\treturn function() {\n\t\t\t\teventDef.dateProfile = origDateProfile;\n\t\t\t};\n\t\t}\n\t\telse {\n\t\t\treturn function() { };\n\t\t}\n\t},\n\n\n\tsetDateMutation: function(dateMutation) {\n\t\tif (dateMutation && !dateMutation.isEmpty()) {\n\t\t\tthis.dateMutation = dateMutation;\n\t\t}\n\t\telse {\n\t\t\tthis.dateMutation = null;\n\t\t}\n\t},\n\n\n\tisEmpty: function() {\n\t\treturn !this.dateMutation;\n\t}\n\n});\n\n\nEventDefMutation.createFromRawProps = function(eventInstance, rawProps, largeUnit) {\n\tvar eventDef = eventInstance.def;\n\tvar dateProps = {};\n\tvar standardProps = {};\n\tvar miscProps = {};\n\tvar verbatimStandardProps = {};\n\tvar eventDefId = null;\n\tvar className = null;\n\tvar propName;\n\tvar dateProfile;\n\tvar dateMutation;\n\tvar defMutation;\n\n\tfor (propName in rawProps) {\n\t\tif (EventDateProfile.isStandardProp(propName)) {\n\t\t\tdateProps[propName] = rawProps[propName];\n\t\t}\n\t\telse if (eventDef.isStandardProp(propName)) {\n\t\t\tstandardProps[propName] = rawProps[propName];\n\t\t}\n\t\telse if (eventDef.miscProps[propName] !== rawProps[propName]) { // only if changed\n\t\t\tmiscProps[propName] = rawProps[propName];\n\t\t}\n\t}\n\n\tdateProfile = EventDateProfile.parse(dateProps, eventDef.source);\n\n\tif (dateProfile) { // no failure?\n\t\tdateMutation = EventDefDateMutation.createFromDiff(\n\t\t\teventInstance.dateProfile,\n\t\t\tdateProfile,\n\t\t\tlargeUnit\n\t\t);\n\t}\n\n\tif (standardProps.id !== eventDef.id) {\n\t\teventDefId = standardProps.id; // only apply if there's a change\n\t}\n\n\tif (!isArraysEqual(standardProps.className, eventDef.className)) {\n\t\tclassName = standardProps.className; // only apply if there's a change\n\t}\n\n\tEventDef.copyVerbatimStandardProps(\n\t\tstandardProps, // src\n\t\tverbatimStandardProps // dest\n\t);\n\n\tdefMutation = new EventDefMutation();\n\tdefMutation.eventDefId = eventDefId;\n\tdefMutation.className = className;\n\tdefMutation.verbatimStandardProps = verbatimStandardProps;\n\tdefMutation.miscProps = miscProps;\n\n\tif (dateMutation) {\n\t\tdefMutation.dateMutation = dateMutation;\n\t}\n\n\treturn defMutation;\n};\n\n;;\n\nvar EventDefDateMutation = Class.extend({\n\n\tclearEnd: false,\n\tforceTimed: false,\n\tforceAllDay: false,\n\n\t// Durations. if 0-ms duration, will be null instead.\n\t// Callers should not set this directly.\n\tdateDelta: null,\n\tstartDelta: null,\n\tendDelta: null,\n\n\n\t/*\n\treturns an undo function.\n\t*/\n\tbuildNewDateProfile: function(eventDateProfile, calendar) {\n\t\tvar start = eventDateProfile.start.clone();\n\t\tvar end = null;\n\t\tvar shouldRezone = false;\n\n\t\tif (eventDateProfile.end && !this.clearEnd) {\n\t\t\tend = eventDateProfile.end.clone();\n\t\t}\n\t\t// if there will be an end-date mutation, guarantee an end,\n\t\t// ambigously-zoned according to the original allDay\n\t\telse if (this.endDelta && !end) {\n\t\t\tend = calendar.getDefaultEventEnd(eventDateProfile.isAllDay(), start);\n\t\t}\n\n\t\tif (this.forceTimed) {\n\t\t\tshouldRezone = true;\n\n\t\t\tif (!start.hasTime()) {\n\t\t\t\tstart.time(0);\n\t\t\t}\n\n\t\t\tif (end && !end.hasTime()) {\n\t\t\t\tend.time(0);\n\t\t\t}\n\t\t}\n\t\telse if (this.forceAllDay) {\n\n\t\t\tif (start.hasTime()) {\n\t\t\t\tstart.stripTime();\n\t\t\t}\n\n\t\t\tif (end && end.hasTime()) {\n\t\t\t\tend.stripTime();\n\t\t\t}\n\t\t}\n\n\t\tif (this.dateDelta) {\n\t\t\tshouldRezone = true;\n\n\t\t\tstart.add(this.dateDelta);\n\n\t\t\tif (end) {\n\t\t\t\tend.add(this.dateDelta);\n\t\t\t}\n\t\t}\n\n\t\t// do this before adding startDelta to start, so we can work off of start\n\t\tif (this.endDelta) {\n\t\t\tshouldRezone = true;\n\n\t\t\tend.add(this.endDelta);\n\t\t}\n\n\t\tif (this.startDelta) {\n\t\t\tshouldRezone = true;\n\n\t\t\tstart.add(this.startDelta);\n\t\t}\n\n\t\tif (shouldRezone) {\n\t\t\tstart = calendar.applyTimezone(start);\n\n\t\t\tif (end) {\n\t\t\t\tend = calendar.applyTimezone(end);\n\t\t\t}\n\t\t}\n\n\t\t// TODO: okay to access calendar option?\n\t\tif (!end && calendar.opt('forceEventDuration')) {\n\t\t\tend = calendar.getDefaultEventEnd(eventDateProfile.isAllDay(), start);\n\t\t}\n\n\t\treturn new EventDateProfile(start, end, calendar);\n\t},\n\n\n\tsetDateDelta: function(dateDelta) {\n\t\tif (dateDelta && dateDelta.valueOf()) {\n\t\t\tthis.dateDelta = dateDelta;\n\t\t}\n\t\telse {\n\t\t\tthis.dateDelta = null;\n\t\t}\n\t},\n\n\n\tsetStartDelta: function(startDelta) {\n\t\tif (startDelta && startDelta.valueOf()) {\n\t\t\tthis.startDelta = startDelta;\n\t\t}\n\t\telse {\n\t\t\tthis.startDelta = null;\n\t\t}\n\t},\n\n\n\tsetEndDelta: function(endDelta) {\n\t\tif (endDelta && endDelta.valueOf()) {\n\t\t\tthis.endDelta = endDelta;\n\t\t}\n\t\telse {\n\t\t\tthis.endDelta = null;\n\t\t}\n\t},\n\n\n\tisEmpty: function() {\n\t\treturn !this.clearEnd && !this.forceTimed && !this.forceAllDay &&\n\t\t\t!this.dateDelta && !this.startDelta && !this.endDelta;\n\t}\n\n});\n\n\nEventDefDateMutation.createFromDiff = function(dateProfile0, dateProfile1, largeUnit) {\n\tvar clearEnd = dateProfile0.end && !dateProfile1.end;\n\tvar forceTimed = dateProfile0.isAllDay() && !dateProfile1.isAllDay();\n\tvar forceAllDay = !dateProfile0.isAllDay() && dateProfile1.isAllDay();\n\tvar dateDelta;\n\tvar endDiff;\n\tvar endDelta;\n\tvar mutation;\n\n\t// subtracts the dates in the appropriate way, returning a duration\n\tfunction subtractDates(date1, date0) { // date1 - date0\n\t\tif (largeUnit) {\n\t\t\treturn diffByUnit(date1, date0, largeUnit); // poorly named\n\t\t}\n\t\telse if (dateProfile1.isAllDay()) {\n\t\t\treturn diffDay(date1, date0); // poorly named\n\t\t}\n\t\telse {\n\t\t\treturn diffDayTime(date1, date0); // poorly named\n\t\t}\n\t}\n\n\tdateDelta = subtractDates(dateProfile1.start, dateProfile0.start);\n\n\tif (dateProfile1.end) {\n\t\t// use unzonedRanges because dateProfile0.end might be null\n\t\tendDiff = subtractDates(\n\t\t\tdateProfile1.unzonedRange.getEnd(),\n\t\t\tdateProfile0.unzonedRange.getEnd()\n\t\t);\n\t\tendDelta = endDiff.subtract(dateDelta);\n\t}\n\n\tmutation = new EventDefDateMutation();\n\tmutation.clearEnd = clearEnd;\n\tmutation.forceTimed = forceTimed;\n\tmutation.forceAllDay = forceAllDay;\n\tmutation.setDateDelta(dateDelta);\n\tmutation.setEndDelta(endDelta);\n\n\treturn mutation;\n};\n\n;;\n\nfunction eventDefsToEventInstances(eventDefs, unzonedRange) {\n\tvar eventInstances = [];\n\tvar i;\n\n\tfor (i = 0; i < eventDefs.length; i++) {\n\t\teventInstances.push.apply(eventInstances, // append\n\t\t\teventDefs[i].buildInstances(unzonedRange)\n\t\t);\n\t}\n\n\treturn eventInstances;\n}\n\n\nfunction eventInstanceToEventRange(eventInstance) {\n\treturn new EventRange(\n\t\teventInstance.dateProfile.unzonedRange,\n\t\teventInstance.def,\n\t\teventInstance\n\t);\n}\n\n\nfunction eventRangeToEventFootprint(eventRange) {\n\treturn new EventFootprint(\n\t\tnew ComponentFootprint(\n\t\t\teventRange.unzonedRange,\n\t\t\teventRange.eventDef.isAllDay()\n\t\t),\n\t\teventRange.eventDef,\n\t\teventRange.eventInstance // might not exist\n\t);\n}\n\n\nfunction eventInstanceToUnzonedRange(eventInstance) {\n\treturn eventInstance.dateProfile.unzonedRange;\n}\n\n\nfunction eventFootprintToComponentFootprint(eventFootprint) {\n\treturn eventFootprint.componentFootprint;\n}\n\n;;\n\nvar EventSource = Class.extend(ParsableModelMixin, {\n\n\tcalendar: null,\n\n\tid: null, // can stay null\n\tuid: null,\n\tcolor: null,\n\tbackgroundColor: null,\n\tborderColor: null,\n\ttextColor: null,\n\tclassName: null, // array\n\teditable: null,\n\tstartEditable: null,\n\tdurationEditable: null,\n\trendering: null,\n\toverlap: null,\n\tconstraint: null,\n\tallDayDefault: null,\n\teventDataTransform: null, // optional function\n\n\n\t// can we do away with calendar? at least for the abstract?\n\t// useful for buildEventDef\n\tconstructor: function(calendar) {\n\t\tthis.calendar = calendar;\n\t\tthis.className = [];\n\t\tthis.uid = String(EventSource.uuid++);\n\t},\n\n\n\tfetch: function(start, end, timezone) {\n\t\t// subclasses must implement. must return a promise.\n\t},\n\n\n\tremoveEventDefsById: function(eventDefId) {\n\t\t// optional for subclasses to implement\n\t},\n\n\n\tremoveAllEventDefs: function() {\n\t\t// optional for subclasses to implement\n\t},\n\n\n\t/*\n\tFor compairing/matching\n\t*/\n\tgetPrimitive: function(otherSource) {\n\t\t// subclasses must implement\n\t},\n\n\n\tparseEventDefs: function(rawEventDefs) {\n\t\tvar i;\n\t\tvar eventDef;\n\t\tvar eventDefs = [];\n\n\t\tfor (i = 0; i < rawEventDefs.length; i++) {\n\t\t\teventDef = EventDefParser.parse(\n\t\t\t\trawEventDefs[i],\n\t\t\t\tthis // source\n\t\t\t);\n\n\t\t\tif (eventDef) {\n\t\t\t\teventDefs.push(eventDef);\n\t\t\t}\n\t\t}\n\n\t\treturn eventDefs;\n\t},\n\n\n\tapplyManualStandardProps: function(rawProps) {\n\n\t\tif (rawProps.id != null) {\n\t\t\tthis.id = EventSource.normalizeId(rawProps.id);\n\t\t}\n\n\t\t// TODO: converge with EventDef\n\t\tif ($.isArray(rawProps.className)) {\n\t\t\tthis.className = rawProps.className;\n\t\t}\n\t\telse if (typeof rawProps.className === 'string') {\n\t\t\tthis.className = rawProps.className.split(/\\s+/);\n\t\t}\n\n\t\treturn true;\n\t}\n\n});\n\n\n// finish initializing the mixin\nEventSource.defineStandardProps = ParsableModelMixin_defineStandardProps;\n\n\n// IDs\n// ---------------------------------------------------------------------------------------------------------------------\n// TODO: converge with EventDef\n\n\nEventSource.uuid = 0;\n\n\nEventSource.normalizeId = function(id) {\n\tif (id) {\n\t\treturn String(id);\n\t}\n\n\treturn null;\n};\n\n\n// Parsing\n// ---------------------------------------------------------------------------------------------------------------------\n\n\nEventSource.defineStandardProps({\n\t// manually process...\n\tid: false,\n\tclassName: false,\n\n\t// automatically transfer...\n\tcolor: true,\n\tbackgroundColor: true,\n\tborderColor: true,\n\ttextColor: true,\n\teditable: true,\n\tstartEditable: true,\n\tdurationEditable: true,\n\trendering: true,\n\toverlap: true,\n\tconstraint: true,\n\tallDayDefault: true,\n\teventDataTransform: true\n});\n\n\n/*\nrawInput can be any data type!\n*/\nEventSource.parse = function(rawInput, calendar) {\n\tvar source = new this(calendar);\n\n\tif (typeof rawInput === 'object') {\n\t\tif (source.applyProps(rawInput)) {\n\t\t\treturn source;\n\t\t}\n\t}\n\n\treturn false;\n};\n\n\nFC.EventSource = EventSource;\n\n;;\n\nvar EventSourceParser = {\n\n\tsourceClasses: [],\n\n\n\tregisterClass: function(EventSourceClass) {\n\t\tthis.sourceClasses.unshift(EventSourceClass); // give highest priority\n\t},\n\n\n\tparse: function(rawInput, calendar) {\n\t\tvar sourceClasses = this.sourceClasses;\n\t\tvar i;\n\t\tvar eventSource;\n\n\t\tfor (i = 0; i < sourceClasses.length; i++) {\n\t\t\teventSource = sourceClasses[i].parse(rawInput, calendar);\n\n\t\t\tif (eventSource) {\n\t\t\t\treturn eventSource;\n\t\t\t}\n\t\t}\n\t}\n\n};\n\n\nFC.EventSourceParser = EventSourceParser;\n\n;;\n\nvar ArrayEventSource = EventSource.extend({\n\n\trawEventDefs: null, // unparsed\n\teventDefs: null,\n\tcurrentTimezone: null,\n\n\n\tconstructor: function(calendar) {\n\t\tEventSource.apply(this, arguments); // super-constructor\n\t\tthis.eventDefs = []; // for if setRawEventDefs is never called\n\t},\n\n\n\tsetRawEventDefs: function(rawEventDefs) {\n\t\tthis.rawEventDefs = rawEventDefs;\n\t\tthis.eventDefs = this.parseEventDefs(rawEventDefs);\n\t},\n\n\n\tfetch: function(start, end, timezone) {\n\t\tvar eventDefs = this.eventDefs;\n\t\tvar i;\n\n\t\tif (\n\t\t\tthis.currentTimezone !== null &&\n\t\t\tthis.currentTimezone !== timezone\n\t\t) {\n\t\t\tfor (i = 0; i < eventDefs.length; i++) {\n\t\t\t\tif (eventDefs[i] instanceof SingleEventDef) {\n\t\t\t\t\teventDefs[i].rezone();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.currentTimezone = timezone;\n\n\t\treturn Promise.resolve(eventDefs);\n\t},\n\n\n\taddEventDef: function(eventDef) {\n\t\tthis.eventDefs.push(eventDef);\n\t},\n\n\n\t/*\n\teventDefId already normalized to a string\n\t*/\n\tremoveEventDefsById: function(eventDefId) {\n\t\treturn removeMatching(this.eventDefs, function(eventDef) {\n\t\t\treturn eventDef.id === eventDefId;\n\t\t});\n\t},\n\n\n\tremoveAllEventDefs: function() {\n\t\tthis.eventDefs = [];\n\t},\n\n\n\tgetPrimitive: function() {\n\t\treturn this.rawEventDefs;\n\t},\n\n\n\tapplyManualStandardProps: function(rawProps) {\n\t\tvar superSuccess = EventSource.prototype.applyManualStandardProps.apply(this, arguments);\n\n\t\tthis.setRawEventDefs(rawProps.events);\n\n\t\treturn superSuccess;\n\t}\n\n});\n\n\nArrayEventSource.defineStandardProps({\n\tevents: false // don't automatically transfer\n});\n\n\nArrayEventSource.parse = function(rawInput, calendar) {\n\tvar rawProps;\n\n\t// normalize raw input\n\tif ($.isArray(rawInput.events)) { // extended form\n\t\trawProps = rawInput;\n\t}\n\telse if ($.isArray(rawInput)) { // short form\n\t\trawProps = { events: rawInput };\n\t}\n\n\tif (rawProps) {\n\t\treturn EventSource.parse.call(this, rawProps, calendar);\n\t}\n\n\treturn false;\n};\n\n\nEventSourceParser.registerClass(ArrayEventSource);\n\nFC.ArrayEventSource = ArrayEventSource;\n\n;;\n\nvar FuncEventSource = EventSource.extend({\n\n\tfunc: null,\n\n\n\tfetch: function(start, end, timezone) {\n\t\tvar _this = this;\n\n\t\tthis.calendar.pushLoading();\n\n\t\treturn Promise.construct(function(onResolve) {\n\t\t\t_this.func.call(\n\t\t\t\t_this.calendar,\n\t\t\t\tstart.clone(),\n\t\t\t\tend.clone(),\n\t\t\t\ttimezone,\n\t\t\t\tfunction(rawEventDefs) {\n\t\t\t\t\t_this.calendar.popLoading();\n\n\t\t\t\t\tonResolve(_this.parseEventDefs(rawEventDefs));\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t},\n\n\n\tgetPrimitive: function() {\n\t\treturn this.func;\n\t},\n\n\n\tapplyManualStandardProps: function(rawProps) {\n\t\tvar superSuccess = EventSource.prototype.applyManualStandardProps.apply(this, arguments);\n\n\t\tthis.func = rawProps.events;\n\n\t\treturn superSuccess;\n\t}\n\n});\n\n\nFuncEventSource.defineStandardProps({\n\tevents: false // don't automatically transfer\n});\n\n\nFuncEventSource.parse = function(rawInput, calendar) {\n\tvar rawProps;\n\n\t// normalize raw input\n\tif ($.isFunction(rawInput.events)) { // extended form\n\t\trawProps = rawInput;\n\t}\n\telse if ($.isFunction(rawInput)) { // short form\n\t\trawProps = { events: rawInput };\n\t}\n\n\tif (rawProps) {\n\t\treturn EventSource.parse.call(this, rawProps, calendar);\n\t}\n\n\treturn false;\n};\n\n\nEventSourceParser.registerClass(FuncEventSource);\n\nFC.FuncEventSource = FuncEventSource;\n\n;;\n\nvar JsonFeedEventSource = EventSource.extend({\n\n\t// these props must all be manually set before calling fetch\n\turl: null,\n\tstartParam: null,\n\tendParam: null,\n\ttimezoneParam: null,\n\tajaxSettings: null, // does not include url\n\n\n\tfetch: function(start, end, timezone) {\n\t\tvar _this = this;\n\t\tvar ajaxSettings = this.ajaxSettings;\n\t\tvar onSuccess = ajaxSettings.success;\n\t\tvar onError = ajaxSettings.error;\n\t\tvar requestParams = this.buildRequestParams(start, end, timezone);\n\n\t\t// todo: eventually handle the promise's then,\n\t\t// don't intercept success/error\n\t\t// tho will be a breaking API change\n\n\t\tthis.calendar.pushLoading();\n\n\t\treturn Promise.construct(function(onResolve, onReject) {\n\t\t\t$.ajax($.extend(\n\t\t\t\t{}, // destination\n\t\t\t\tJsonFeedEventSource.AJAX_DEFAULTS,\n\t\t\t\tajaxSettings,\n\t\t\t\t{\n\t\t\t\t\turl: _this.url,\n\t\t\t\t\tdata: requestParams,\n\t\t\t\t\tsuccess: function(rawEventDefs) {\n\t\t\t\t\t\tvar callbackRes;\n\n\t\t\t\t\t\t_this.calendar.popLoading();\n\n\t\t\t\t\t\tif (rawEventDefs) {\n\t\t\t\t\t\t\tcallbackRes = applyAll(onSuccess, this, arguments); // redirect `this`\n\n\t\t\t\t\t\t\tif ($.isArray(callbackRes)) {\n\t\t\t\t\t\t\t\trawEventDefs = callbackRes;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tonResolve(_this.parseEventDefs(rawEventDefs));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tonReject();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\terror: function() {\n\t\t\t\t\t\t_this.calendar.popLoading();\n\n\t\t\t\t\t\tapplyAll(onError, this, arguments); // redirect `this`\n\t\t\t\t\t\tonReject();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t));\n\t\t});\n\t},\n\n\n\tbuildRequestParams: function(start, end, timezone) {\n\t\tvar calendar = this.calendar;\n\t\tvar ajaxSettings = this.ajaxSettings;\n\t\tvar startParam, endParam, timezoneParam;\n\t\tvar customRequestParams;\n\t\tvar params = {};\n\n\t\tstartParam = this.startParam;\n\t\tif (startParam == null) {\n\t\t\tstartParam = calendar.opt('startParam');\n\t\t}\n\n\t\tendParam = this.endParam;\n\t\tif (endParam == null) {\n\t\t\tendParam = calendar.opt('endParam');\n\t\t}\n\n\t\ttimezoneParam = this.timezoneParam;\n\t\tif (timezoneParam == null) {\n\t\t\ttimezoneParam = calendar.opt('timezoneParam');\n\t\t}\n\n\t\t// retrieve any outbound GET/POST $.ajax data from the options\n\t\tif ($.isFunction(ajaxSettings.data)) {\n\t\t\t// supplied as a function that returns a key/value object\n\t\t\tcustomRequestParams = ajaxSettings.data();\n\t\t}\n\t\telse {\n\t\t\t// probably supplied as a straight key/value object\n\t\t\tcustomRequestParams = ajaxSettings.data || {};\n\t\t}\n\n\t\t$.extend(params, customRequestParams);\n\n\t\tparams[startParam] = start.format();\n\t\tparams[endParam] = end.format();\n\n\t\tif (timezone && timezone !== 'local') {\n\t\t\tparams[timezoneParam] = timezone;\n\t\t}\n\n\t\treturn params;\n\t},\n\n\n\tgetPrimitive: function() {\n\t\treturn this.url;\n\t},\n\n\n\tapplyMiscProps: function(rawProps) {\n\t\tEventSource.prototype.applyMiscProps.apply(this, arguments);\n\n\t\tthis.ajaxSettings = rawProps;\n\t}\n\n});\n\n\nJsonFeedEventSource.AJAX_DEFAULTS = {\n\tdataType: 'json',\n\tcache: false\n};\n\n\nJsonFeedEventSource.defineStandardProps({\n\t// automatically transfer (true)...\n\turl: true,\n\tstartParam: true,\n\tendParam: true,\n\ttimezoneParam: true\n});\n\n\nJsonFeedEventSource.parse = function(rawInput, calendar) {\n\tvar rawProps;\n\n\t// normalize raw input\n\tif (typeof rawInput.url === 'string') { // extended form\n\t\trawProps = rawInput;\n\t}\n\telse if (typeof rawInput === 'string') { // short form\n\t\trawProps = { url: rawInput };\n\t}\n\n\tif (rawProps) {\n\t\treturn EventSource.parse.call(this, rawProps, calendar);\n\t}\n\n\treturn false;\n};\n\n\nEventSourceParser.registerClass(JsonFeedEventSource);\n\nFC.JsonFeedEventSource = JsonFeedEventSource;\n\n;;\n\nvar ThemeRegistry = FC.ThemeRegistry = {\n\n\tthemeClassHash: {},\n\n\n\tregister: function(themeName, themeClass) {\n\t\tthis.themeClassHash[themeName] = themeClass;\n\t},\n\n\n\tgetThemeClass: function(themeSetting) {\n\t\tif (!themeSetting) {\n\t\t\treturn StandardTheme;\n\t\t}\n\t\telse if (themeSetting === true) {\n\t\t\treturn JqueryUiTheme;\n\t\t}\n\t\telse {\n\t\t\treturn this.themeClassHash[themeSetting];\n\t\t}\n\t}\n\n};\n\n;;\n\nvar Theme = FC.Theme = Class.extend({\n\n\tclasses: {},\n\ticonClasses: {},\n\tbaseIconClass: '',\n\ticonOverrideOption: null,\n\ticonOverrideCustomButtonOption: null,\n\ticonOverridePrefix: '',\n\n\n\tconstructor: function(optionsModel) {\n\t\tthis.optionsModel = optionsModel;\n\t\tthis.processIconOverride();\n\t},\n\n\n\tprocessIconOverride: function() {\n\t\tif (this.iconOverrideOption) {\n\t\t\tthis.setIconOverride(\n\t\t\t\tthis.optionsModel.get(this.iconOverrideOption)\n\t\t\t);\n\t\t}\n\t},\n\n\n\tsetIconOverride: function(iconOverrideHash) {\n\t\tvar iconClassesCopy;\n\t\tvar buttonName;\n\n\t\tif ($.isPlainObject(iconOverrideHash)) {\n\t\t\ticonClassesCopy = $.extend({}, this.iconClasses);\n\n\t\t\tfor (buttonName in iconOverrideHash) {\n\t\t\t\ticonClassesCopy[buttonName] = this.applyIconOverridePrefix(\n\t\t\t\t\ticonOverrideHash[buttonName]\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.iconClasses = iconClassesCopy;\n\t\t}\n\t\telse if (iconOverrideHash === false) {\n\t\t\tthis.iconClasses = {};\n\t\t}\n\t},\n\n\n\tapplyIconOverridePrefix: function(className) {\n\t\tvar prefix = this.iconOverridePrefix;\n\n\t\tif (prefix && className.indexOf(prefix) !== 0) { // if not already present\n\t\t\tclassName = prefix + className;\n\t\t}\n\n\t\treturn className;\n\t},\n\n\n\tgetClass: function(key) {\n\t\treturn this.classes[key] || '';\n\t},\n\n\n\tgetIconClass: function(buttonName) {\n\t\tvar className = this.iconClasses[buttonName];\n\n\t\tif (className) {\n\t\t\treturn this.baseIconClass + ' ' + className;\n\t\t}\n\n\t\treturn '';\n\t},\n\n\n\tgetCustomButtonIconClass: function(customButtonProps) {\n\t\tvar className;\n\n\t\tif (this.iconOverrideCustomButtonOption) {\n\t\t\tclassName = customButtonProps[this.iconOverrideCustomButtonOption];\n\n\t\t\tif (className) {\n\t\t\t\treturn this.baseIconClass + ' ' + this.applyIconOverridePrefix(className);\n\t\t\t}\n\t\t}\n\n\t\treturn '';\n\t}\n\n});\n\n;;\n\nvar StandardTheme = Theme.extend({\n\n\tclasses: {\n\t\twidget: 'fc-unthemed',\n\t\twidgetHeader: 'fc-widget-header',\n\t\twidgetContent: 'fc-widget-content',\n\n\t\tbuttonGroup: 'fc-button-group',\n\t\tbutton: 'fc-button',\n\t\tcornerLeft: 'fc-corner-left',\n\t\tcornerRight: 'fc-corner-right',\n\t\tstateDefault: 'fc-state-default',\n\t\tstateActive: 'fc-state-active',\n\t\tstateDisabled: 'fc-state-disabled',\n\t\tstateHover: 'fc-state-hover',\n\t\tstateDown: 'fc-state-down',\n\n\t\tpopoverHeader: 'fc-widget-header',\n\t\tpopoverContent: 'fc-widget-content',\n\n\t\t// day grid\n\t\theaderRow: 'fc-widget-header',\n\t\tdayRow: 'fc-widget-content',\n\n\t\t// list view\n\t\tlistView: 'fc-widget-content'\n\t},\n\n\tbaseIconClass: 'fc-icon',\n\ticonClasses: {\n\t\tclose: 'fc-icon-x',\n\t\tprev: 'fc-icon-left-single-arrow',\n\t\tnext: 'fc-icon-right-single-arrow',\n\t\tprevYear: 'fc-icon-left-double-arrow',\n\t\tnextYear: 'fc-icon-right-double-arrow'\n\t},\n\n\ticonOverrideOption: 'buttonIcons',\n\ticonOverrideCustomButtonOption: 'icon',\n\ticonOverridePrefix: 'fc-icon-'\n\n});\n\nThemeRegistry.register('standard', StandardTheme);\n\n;;\n\nvar JqueryUiTheme = Theme.extend({\n\n\tclasses: {\n\t\twidget: 'ui-widget',\n\t\twidgetHeader: 'ui-widget-header',\n\t\twidgetContent: 'ui-widget-content',\n\n\t\tbuttonGroup: 'fc-button-group',\n\t\tbutton: 'ui-button',\n\t\tcornerLeft: 'ui-corner-left',\n\t\tcornerRight: 'ui-corner-right',\n\t\tstateDefault: 'ui-state-default',\n\t\tstateActive: 'ui-state-active',\n\t\tstateDisabled: 'ui-state-disabled',\n\t\tstateHover: 'ui-state-hover',\n\t\tstateDown: 'ui-state-down',\n\n\t\ttoday: 'ui-state-highlight',\n\n\t\tpopoverHeader: 'ui-widget-header',\n\t\tpopoverContent: 'ui-widget-content',\n\n\t\t// day grid\n\t\theaderRow: 'ui-widget-header',\n\t\tdayRow: 'ui-widget-content',\n\n\t\t// list view\n\t\tlistView: 'ui-widget-content'\n\t},\n\n\tbaseIconClass: 'ui-icon',\n\ticonClasses: {\n\t\tclose: 'ui-icon-closethick',\n\t\tprev: 'ui-icon-circle-triangle-w',\n\t\tnext: 'ui-icon-circle-triangle-e',\n\t\tprevYear: 'ui-icon-seek-prev',\n\t\tnextYear: 'ui-icon-seek-next'\n\t},\n\n\ticonOverrideOption: 'themeButtonIcons',\n\ticonOverrideCustomButtonOption: 'themeIcon',\n\ticonOverridePrefix: 'ui-icon-'\n\n});\n\nThemeRegistry.register('jquery-ui', JqueryUiTheme);\n\n;;\n\nvar BootstrapTheme = Theme.extend({\n\n\tclasses: {\n\t\twidget: 'fc-bootstrap3',\n\n\t\ttableGrid: 'table-bordered', // avoid `table` class b/c don't want margins. only border color\n\t\ttableList: 'table table-striped', // `table` class creates bottom margin but who cares\n\n\t\tbuttonGroup: 'btn-group',\n\t\tbutton: 'btn btn-default',\n\t\tstateActive: 'active',\n\t\tstateDisabled: 'disabled',\n\n\t\ttoday: 'alert alert-info', // the plain `info` class requires `.table`, too much to ask\n\n\t\tpopover: 'panel panel-default',\n\t\tpopoverHeader: 'panel-heading',\n\t\tpopoverContent: 'panel-body',\n\n\t\t// day grid\n\t\theaderRow: 'panel-default', // avoid `panel` class b/c don't want margins/radius. only border color\n\t\tdayRow: 'panel-default', // \"\n\n\t\t// list view\n\t\tlistView: 'panel panel-default'\n\t},\n\n\tbaseIconClass: 'glyphicon',\n\ticonClasses: {\n\t\tclose: 'glyphicon-remove',\n\t\tprev: 'glyphicon-chevron-left',\n\t\tnext: 'glyphicon-chevron-right',\n\t\tprevYear: 'glyphicon-backward',\n\t\tnextYear: 'glyphicon-forward'\n\t},\n\n\ticonOverrideOption: 'bootstrapGlyphicons',\n\ticonOverrideCustomButtonOption: 'bootstrapGlyphicon',\n\ticonOverridePrefix: 'glyphicon-'\n\n});\n\nThemeRegistry.register('bootstrap3', BootstrapTheme);\n\n;;\n\nvar DayGridFillRenderer = FillRenderer.extend({\n\n\tfillSegTag: 'td', // override the default tag name\n\n\n\tattachSegEls: function(type, segs) {\n\t\tvar nodes = [];\n\t\tvar i, seg;\n\t\tvar skeletonEl;\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tseg = segs[i];\n\t\t\tskeletonEl = this.renderFillRow(type, seg);\n\t\t\tthis.component.rowEls.eq(seg.row).append(skeletonEl);\n\t\t\tnodes.push(skeletonEl[0]);\n\t\t}\n\n\t\treturn nodes;\n\t},\n\n\n\t// Generates the HTML needed for one row of a fill. Requires the seg's el to be rendered.\n\trenderFillRow: function(type, seg) {\n\t\tvar colCnt = this.component.colCnt;\n\t\tvar startCol = seg.leftCol;\n\t\tvar endCol = seg.rightCol + 1;\n\t\tvar className;\n\t\tvar skeletonEl;\n\t\tvar trEl;\n\n\t\tif (type === 'businessHours') {\n\t\t\tclassName = 'bgevent';\n\t\t}\n\t\telse {\n\t\t\tclassName = type.toLowerCase();\n\t\t}\n\n\t\tskeletonEl = $(\n\t\t\t'<div class=\"fc-' + className + '-skeleton\">' +\n\t\t\t\t'<table><tr/></table>' +\n\t\t\t'</div>'\n\t\t);\n\t\ttrEl = skeletonEl.find('tr');\n\n\t\tif (startCol > 0) {\n\t\t\ttrEl.append('<td colspan=\"' + startCol + '\"/>');\n\t\t}\n\n\t\ttrEl.append(\n\t\t\tseg.el.attr('colspan', endCol - startCol)\n\t\t);\n\n\t\tif (endCol < colCnt) {\n\t\t\ttrEl.append('<td colspan=\"' + (colCnt - endCol) + '\"/>');\n\t\t}\n\n\t\tthis.component.bookendCells(trEl);\n\n\t\treturn skeletonEl;\n\t}\n});\n\n;;\n\n/* Event-rendering methods for the DayGrid class\n----------------------------------------------------------------------------------------------------------------------*/\n\nvar DayGridEventRenderer = EventRenderer.extend({\n\n\tdayGrid: null,\n\trowStructs: null, // an array of objects, each holding information about a row's foreground event-rendering\n\n\n\tconstructor: function(dayGrid) {\n\t\tEventRenderer.apply(this, arguments);\n\n\t\tthis.dayGrid = dayGrid;\n\t},\n\n\n\trenderBgRanges: function(eventRanges) {\n\t\t// don't render timed background events\n\t\teventRanges = $.grep(eventRanges, function(eventRange) {\n\t\t\treturn eventRange.eventDef.isAllDay();\n\t\t});\n\n\t\tEventRenderer.prototype.renderBgRanges.call(this, eventRanges);\n\t},\n\n\n\t// Renders the given foreground event segments onto the grid\n\trenderFgSegs: function(segs) {\n\t\tvar rowStructs = this.rowStructs = this.renderSegRows(segs);\n\n\t\t// append to each row's content skeleton\n\t\tthis.dayGrid.rowEls.each(function(i, rowNode) {\n\t\t\t$(rowNode).find('.fc-content-skeleton > table').append(\n\t\t\t\trowStructs[i].tbodyEl\n\t\t\t);\n\t\t});\n\t},\n\n\n\t// Unrenders all currently rendered foreground event segments\n\tunrenderFgSegs: function() {\n\t\tvar rowStructs = this.rowStructs || [];\n\t\tvar rowStruct;\n\n\t\twhile ((rowStruct = rowStructs.pop())) {\n\t\t\trowStruct.tbodyEl.remove();\n\t\t}\n\n\t\tthis.rowStructs = null;\n\t},\n\n\n\t// Uses the given events array to generate <tbody> elements that should be appended to each row's content skeleton.\n\t// Returns an array of rowStruct objects (see the bottom of `renderSegRow`).\n\t// PRECONDITION: each segment shoud already have a rendered and assigned `.el`\n\trenderSegRows: function(segs) {\n\t\tvar rowStructs = [];\n\t\tvar segRows;\n\t\tvar row;\n\n\t\tsegRows = this.groupSegRows(segs); // group into nested arrays\n\n\t\t// iterate each row of segment groupings\n\t\tfor (row = 0; row < segRows.length; row++) {\n\t\t\trowStructs.push(\n\t\t\t\tthis.renderSegRow(row, segRows[row])\n\t\t\t);\n\t\t}\n\n\t\treturn rowStructs;\n\t},\n\n\n\t// Given a row # and an array of segments all in the same row, render a <tbody> element, a skeleton that contains\n\t// the segments. Returns object with a bunch of internal data about how the render was calculated.\n\t// NOTE: modifies rowSegs\n\trenderSegRow: function(row, rowSegs) {\n\t\tvar colCnt = this.dayGrid.colCnt;\n\t\tvar segLevels = this.buildSegLevels(rowSegs); // group into sub-arrays of levels\n\t\tvar levelCnt = Math.max(1, segLevels.length); // ensure at least one level\n\t\tvar tbody = $('<tbody/>');\n\t\tvar segMatrix = []; // lookup for which segments are rendered into which level+col cells\n\t\tvar cellMatrix = []; // lookup for all <td> elements of the level+col matrix\n\t\tvar loneCellMatrix = []; // lookup for <td> elements that only take up a single column\n\t\tvar i, levelSegs;\n\t\tvar col;\n\t\tvar tr;\n\t\tvar j, seg;\n\t\tvar td;\n\n\t\t// populates empty cells from the current column (`col`) to `endCol`\n\t\tfunction emptyCellsUntil(endCol) {\n\t\t\twhile (col < endCol) {\n\t\t\t\t// try to grab a cell from the level above and extend its rowspan. otherwise, create a fresh cell\n\t\t\t\ttd = (loneCellMatrix[i - 1] || [])[col];\n\t\t\t\tif (td) {\n\t\t\t\t\ttd.attr(\n\t\t\t\t\t\t'rowspan',\n\t\t\t\t\t\tparseInt(td.attr('rowspan') || 1, 10) + 1\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\ttd = $('<td/>');\n\t\t\t\t\ttr.append(td);\n\t\t\t\t}\n\t\t\t\tcellMatrix[i][col] = td;\n\t\t\t\tloneCellMatrix[i][col] = td;\n\t\t\t\tcol++;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0; i < levelCnt; i++) { // iterate through all levels\n\t\t\tlevelSegs = segLevels[i];\n\t\t\tcol = 0;\n\t\t\ttr = $('<tr/>');\n\n\t\t\tsegMatrix.push([]);\n\t\t\tcellMatrix.push([]);\n\t\t\tloneCellMatrix.push([]);\n\n\t\t\t// levelCnt might be 1 even though there are no actual levels. protect against this.\n\t\t\t// this single empty row is useful for styling.\n\t\t\tif (levelSegs) {\n\t\t\t\tfor (j = 0; j < levelSegs.length; j++) { // iterate through segments in level\n\t\t\t\t\tseg = levelSegs[j];\n\n\t\t\t\t\temptyCellsUntil(seg.leftCol);\n\n\t\t\t\t\t// create a container that occupies or more columns. append the event element.\n\t\t\t\t\ttd = $('<td class=\"fc-event-container\"/>').append(seg.el);\n\t\t\t\t\tif (seg.leftCol != seg.rightCol) {\n\t\t\t\t\t\ttd.attr('colspan', seg.rightCol - seg.leftCol + 1);\n\t\t\t\t\t}\n\t\t\t\t\telse { // a single-column segment\n\t\t\t\t\t\tloneCellMatrix[i][col] = td;\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (col <= seg.rightCol) {\n\t\t\t\t\t\tcellMatrix[i][col] = td;\n\t\t\t\t\t\tsegMatrix[i][col] = seg;\n\t\t\t\t\t\tcol++;\n\t\t\t\t\t}\n\n\t\t\t\t\ttr.append(td);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\temptyCellsUntil(colCnt); // finish off the row\n\t\t\tthis.dayGrid.bookendCells(tr);\n\t\t\ttbody.append(tr);\n\t\t}\n\n\t\treturn { // a \"rowStruct\"\n\t\t\trow: row, // the row number\n\t\t\ttbodyEl: tbody,\n\t\t\tcellMatrix: cellMatrix,\n\t\t\tsegMatrix: segMatrix,\n\t\t\tsegLevels: segLevels,\n\t\t\tsegs: rowSegs\n\t\t};\n\t},\n\n\n\t// Stacks a flat array of segments, which are all assumed to be in the same row, into subarrays of vertical levels.\n\t// NOTE: modifies segs\n\tbuildSegLevels: function(segs) {\n\t\tvar levels = [];\n\t\tvar i, seg;\n\t\tvar j;\n\n\t\t// Give preference to elements with certain criteria, so they have\n\t\t// a chance to be closer to the top.\n\t\tthis.sortEventSegs(segs);\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tseg = segs[i];\n\n\t\t\t// loop through levels, starting with the topmost, until the segment doesn't collide with other segments\n\t\t\tfor (j = 0; j < levels.length; j++) {\n\t\t\t\tif (!isDaySegCollision(seg, levels[j])) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// `j` now holds the desired subrow index\n\t\t\tseg.level = j;\n\n\t\t\t// create new level array if needed and append segment\n\t\t\t(levels[j] || (levels[j] = [])).push(seg);\n\t\t}\n\n\t\t// order segments left-to-right. very important if calendar is RTL\n\t\tfor (j = 0; j < levels.length; j++) {\n\t\t\tlevels[j].sort(compareDaySegCols);\n\t\t}\n\n\t\treturn levels;\n\t},\n\n\n\t// Given a flat array of segments, return an array of sub-arrays, grouped by each segment's row\n\tgroupSegRows: function(segs) {\n\t\tvar segRows = [];\n\t\tvar i;\n\n\t\tfor (i = 0; i < this.dayGrid.rowCnt; i++) {\n\t\t\tsegRows.push([]);\n\t\t}\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tsegRows[segs[i].row].push(segs[i]);\n\t\t}\n\n\t\treturn segRows;\n\t},\n\n\n\t// Computes a default event time formatting string if `timeFormat` is not explicitly defined\n\tcomputeEventTimeFormat: function() {\n\t\treturn this.opt('extraSmallTimeFormat'); // like \"6p\" or \"6:30p\"\n\t},\n\n\n\t// Computes a default `displayEventEnd` value if one is not expliclty defined\n\tcomputeDisplayEventEnd: function() {\n\t\treturn this.dayGrid.colCnt === 1; // we'll likely have space if there's only one day\n\t},\n\n\n\t// Builds the HTML to be used for the default element for an individual segment\n\tfgSegHtml: function(seg, disableResizing) {\n\t\tvar view = this.view;\n\t\tvar eventDef = seg.footprint.eventDef;\n\t\tvar isAllDay = seg.footprint.componentFootprint.isAllDay;\n\t\tvar isDraggable = view.isEventDefDraggable(eventDef);\n\t\tvar isResizableFromStart = !disableResizing && isAllDay &&\n\t\t\tseg.isStart && view.isEventDefResizableFromStart(eventDef);\n\t\tvar isResizableFromEnd = !disableResizing && isAllDay &&\n\t\t\tseg.isEnd && view.isEventDefResizableFromEnd(eventDef);\n\t\tvar classes = this.getSegClasses(seg, isDraggable, isResizableFromStart || isResizableFromEnd);\n\t\tvar skinCss = cssToStr(this.getSkinCss(eventDef));\n\t\tvar timeHtml = '';\n\t\tvar timeText;\n\t\tvar titleHtml;\n\n\t\tclasses.unshift('fc-day-grid-event', 'fc-h-event');\n\n\t\t// Only display a timed events time if it is the starting segment\n\t\tif (seg.isStart) {\n\t\t\ttimeText = this.getTimeText(seg.footprint);\n\t\t\tif (timeText) {\n\t\t\t\ttimeHtml = '<span class=\"fc-time\">' + htmlEscape(timeText) + '</span>';\n\t\t\t}\n\t\t}\n\n\t\ttitleHtml =\n\t\t\t'<span class=\"fc-title\">' +\n\t\t\t\t(htmlEscape(eventDef.title || '') || '&nbsp;') + // we always want one line of height\n\t\t\t'</span>';\n\n\t\treturn '<a class=\"' + classes.join(' ') + '\"' +\n\t\t\t\t(eventDef.url ?\n\t\t\t\t\t' href=\"' + htmlEscape(eventDef.url) + '\"' :\n\t\t\t\t\t''\n\t\t\t\t\t) +\n\t\t\t\t(skinCss ?\n\t\t\t\t\t' style=\"' + skinCss + '\"' :\n\t\t\t\t\t''\n\t\t\t\t\t) +\n\t\t\t'>' +\n\t\t\t\t'<div class=\"fc-content\">' +\n\t\t\t\t\t(this.isRTL ?\n\t\t\t\t\t\ttitleHtml + ' ' + timeHtml : // put a natural space in between\n\t\t\t\t\t\ttimeHtml + ' ' + titleHtml   //\n\t\t\t\t\t\t) +\n\t\t\t\t'</div>' +\n\t\t\t\t(isResizableFromStart ?\n\t\t\t\t\t'<div class=\"fc-resizer fc-start-resizer\" />' :\n\t\t\t\t\t''\n\t\t\t\t\t) +\n\t\t\t\t(isResizableFromEnd ?\n\t\t\t\t\t'<div class=\"fc-resizer fc-end-resizer\" />' :\n\t\t\t\t\t''\n\t\t\t\t\t) +\n\t\t\t'</a>';\n\t}\n\n});\n\n\n// Computes whether two segments' columns collide. They are assumed to be in the same row.\nfunction isDaySegCollision(seg, otherSegs) {\n\tvar i, otherSeg;\n\n\tfor (i = 0; i < otherSegs.length; i++) {\n\t\totherSeg = otherSegs[i];\n\n\t\tif (\n\t\t\totherSeg.leftCol <= seg.rightCol &&\n\t\t\totherSeg.rightCol >= seg.leftCol\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\n\n// A cmp function for determining the leftmost event\nfunction compareDaySegCols(a, b) {\n\treturn a.leftCol - b.leftCol;\n}\n\n;;\n\nvar DayGridHelperRenderer = HelperRenderer.extend({\n\n\n\t// Renders a mock \"helper\" event. `sourceSeg` is the associated internal segment object. It can be null.\n\trenderSegs: function(segs, sourceSeg) {\n\t\tvar helperNodes = [];\n\t\tvar rowStructs;\n\n\t\t// TODO: not good to call eventRenderer this way\n\t\trowStructs = this.eventRenderer.renderSegRows(segs);\n\n\t\t// inject each new event skeleton into each associated row\n\t\tthis.component.rowEls.each(function(row, rowNode) {\n\t\t\tvar rowEl = $(rowNode); // the .fc-row\n\t\t\tvar skeletonEl = $('<div class=\"fc-helper-skeleton\"><table/></div>'); // will be absolutely positioned\n\t\t\tvar skeletonTopEl;\n\t\t\tvar skeletonTop;\n\n\t\t\t// If there is an original segment, match the top position. Otherwise, put it at the row's top level\n\t\t\tif (sourceSeg && sourceSeg.row === row) {\n\t\t\t\tskeletonTop = sourceSeg.el.position().top;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tskeletonTopEl = rowEl.find('.fc-content-skeleton tbody');\n\t\t\t\tif (!skeletonTopEl.length) { // when no events\n\t\t\t\t\tskeletonTopEl = rowEl.find('.fc-content-skeleton table');\n\t\t\t\t}\n\n\t\t\t\tskeletonTop = skeletonTopEl.position().top;\n\t\t\t}\n\n\t\t\tskeletonEl.css('top', skeletonTop)\n\t\t\t\t.find('table')\n\t\t\t\t\t.append(rowStructs[row].tbodyEl);\n\n\t\t\trowEl.append(skeletonEl);\n\t\t\thelperNodes.push(skeletonEl[0]);\n\t\t});\n\n\t\treturn $(helperNodes); // must return the elements rendered\n\t}\n\n});\n\n;;\n\n/* A component that renders a grid of whole-days that runs horizontally. There can be multiple rows, one per week.\n----------------------------------------------------------------------------------------------------------------------*/\n\nvar DayGrid = FC.DayGrid = InteractiveDateComponent.extend(StandardInteractionsMixin, DayTableMixin, {\n\n\teventRendererClass: DayGridEventRenderer,\n\tbusinessHourRendererClass: BusinessHourRenderer,\n\thelperRendererClass: DayGridHelperRenderer,\n\tfillRendererClass: DayGridFillRenderer,\n\n\tview: null, // TODO: make more general and/or remove\n\thelperRenderer: null,\n\n\tcellWeekNumbersVisible: false, // display week numbers in day cell?\n\n\tbottomCoordPadding: 0, // hack for extending the hit area for the last row of the coordinate grid\n\n\theadContainerEl: null, // div that hold's the date header\n\trowEls: null, // set of fake row elements\n\tcellEls: null, // set of whole-day elements comprising the row's background\n\n\trowCoordCache: null,\n\tcolCoordCache: null,\n\n\t// isRigid determines whether the individual rows should ignore the contents and be a constant height.\n\t// Relies on the view's colCnt and rowCnt. In the future, this component should probably be self-sufficient.\n\tisRigid: false,\n\n\thasAllDayBusinessHours: true,\n\n\n\tconstructor: function(view) {\n\t\tthis.view = view; // do first, for opt calls during initialization\n\n\t\tInteractiveDateComponent.call(this);\n\t},\n\n\n\t// Slices up the given span (unzoned start/end with other misc data) into an array of segments\n\tcomponentFootprintToSegs: function(componentFootprint) {\n\t\tvar segs = this.sliceRangeByRow(componentFootprint.unzonedRange);\n\t\tvar i, seg;\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tseg = segs[i];\n\n\t\t\tif (this.isRTL) {\n\t\t\t\tseg.leftCol = this.daysPerRow - 1 - seg.lastRowDayIndex;\n\t\t\t\tseg.rightCol = this.daysPerRow - 1 - seg.firstRowDayIndex;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tseg.leftCol = seg.firstRowDayIndex;\n\t\t\t\tseg.rightCol = seg.lastRowDayIndex;\n\t\t\t}\n\t\t}\n\n\t\treturn segs;\n\t},\n\n\n\t/* Date Rendering\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\trenderDates: function(dateProfile) {\n\t\tthis.dateProfile = dateProfile;\n\t\tthis.updateDayTable();\n\t\tthis.renderGrid();\n\t},\n\n\n\tunrenderDates: function() {\n\t\tthis.removeSegPopover();\n\t},\n\n\n\t// Renders the rows and columns into the component's `this.el`, which should already be assigned.\n\trenderGrid: function() {\n\t\tvar view = this.view;\n\t\tvar rowCnt = this.rowCnt;\n\t\tvar colCnt = this.colCnt;\n\t\tvar html = '';\n\t\tvar row;\n\t\tvar col;\n\n\t\tif (this.headContainerEl) {\n\t\t\tthis.headContainerEl.html(this.renderHeadHtml());\n\t\t}\n\n\t\tfor (row = 0; row < rowCnt; row++) {\n\t\t\thtml += this.renderDayRowHtml(row, this.isRigid);\n\t\t}\n\t\tthis.el.html(html);\n\n\t\tthis.rowEls = this.el.find('.fc-row');\n\t\tthis.cellEls = this.el.find('.fc-day, .fc-disabled-day');\n\n\t\tthis.rowCoordCache = new CoordCache({\n\t\t\tels: this.rowEls,\n\t\t\tisVertical: true\n\t\t});\n\t\tthis.colCoordCache = new CoordCache({\n\t\t\tels: this.cellEls.slice(0, this.colCnt), // only the first row\n\t\t\tisHorizontal: true\n\t\t});\n\n\t\t// trigger dayRender with each cell's element\n\t\tfor (row = 0; row < rowCnt; row++) {\n\t\t\tfor (col = 0; col < colCnt; col++) {\n\t\t\t\tthis.publiclyTrigger('dayRender', {\n\t\t\t\t\tcontext: view,\n\t\t\t\t\targs: [\n\t\t\t\t\t\tthis.getCellDate(row, col),\n\t\t\t\t\t\tthis.getCellEl(row, col),\n\t\t\t\t\t\tview\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Generates the HTML for a single row, which is a div that wraps a table.\n\t// `row` is the row number.\n\trenderDayRowHtml: function(row, isRigid) {\n\t\tvar theme = this.view.calendar.theme;\n\t\tvar classes = [ 'fc-row', 'fc-week', theme.getClass('dayRow') ];\n\n\t\tif (isRigid) {\n\t\t\tclasses.push('fc-rigid');\n\t\t}\n\n\t\treturn '' +\n\t\t\t'<div class=\"' + classes.join(' ') + '\">' +\n\t\t\t\t'<div class=\"fc-bg\">' +\n\t\t\t\t\t'<table class=\"' + theme.getClass('tableGrid') + '\">' +\n\t\t\t\t\t\tthis.renderBgTrHtml(row) +\n\t\t\t\t\t'</table>' +\n\t\t\t\t'</div>' +\n\t\t\t\t'<div class=\"fc-content-skeleton\">' +\n\t\t\t\t\t'<table>' +\n\t\t\t\t\t\t(this.getIsNumbersVisible() ?\n\t\t\t\t\t\t\t'<thead>' +\n\t\t\t\t\t\t\t\tthis.renderNumberTrHtml(row) +\n\t\t\t\t\t\t\t'</thead>' :\n\t\t\t\t\t\t\t''\n\t\t\t\t\t\t\t) +\n\t\t\t\t\t'</table>' +\n\t\t\t\t'</div>' +\n\t\t\t'</div>';\n\t},\n\n\n\tgetIsNumbersVisible: function() {\n\t\treturn this.getIsDayNumbersVisible() || this.cellWeekNumbersVisible;\n\t},\n\n\n\tgetIsDayNumbersVisible: function() {\n\t\treturn this.rowCnt > 1;\n\t},\n\n\n\t/* Grid Number Rendering\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\trenderNumberTrHtml: function(row) {\n\t\treturn '' +\n\t\t\t'<tr>' +\n\t\t\t\t(this.isRTL ? '' : this.renderNumberIntroHtml(row)) +\n\t\t\t\tthis.renderNumberCellsHtml(row) +\n\t\t\t\t(this.isRTL ? this.renderNumberIntroHtml(row) : '') +\n\t\t\t'</tr>';\n\t},\n\n\n\trenderNumberIntroHtml: function(row) {\n\t\treturn this.renderIntroHtml();\n\t},\n\n\n\trenderNumberCellsHtml: function(row) {\n\t\tvar htmls = [];\n\t\tvar col, date;\n\n\t\tfor (col = 0; col < this.colCnt; col++) {\n\t\t\tdate = this.getCellDate(row, col);\n\t\t\thtmls.push(this.renderNumberCellHtml(date));\n\t\t}\n\n\t\treturn htmls.join('');\n\t},\n\n\n\t// Generates the HTML for the <td>s of the \"number\" row in the DayGrid's content skeleton.\n\t// The number row will only exist if either day numbers or week numbers are turned on.\n\trenderNumberCellHtml: function(date) {\n\t\tvar view = this.view;\n\t\tvar html = '';\n\t\tvar isDateValid = this.dateProfile.activeUnzonedRange.containsDate(date); // TODO: called too frequently. cache somehow.\n\t\tvar isDayNumberVisible = this.getIsDayNumbersVisible() && isDateValid;\n\t\tvar classes;\n\t\tvar weekCalcFirstDoW;\n\n\t\tif (!isDayNumberVisible && !this.cellWeekNumbersVisible) {\n\t\t\t// no numbers in day cell (week number must be along the side)\n\t\t\treturn '<td/>'; //  will create an empty space above events :(\n\t\t}\n\n\t\tclasses = this.getDayClasses(date);\n\t\tclasses.unshift('fc-day-top');\n\n\t\tif (this.cellWeekNumbersVisible) {\n\t\t\t// To determine the day of week number change under ISO, we cannot\n\t\t\t// rely on moment.js methods such as firstDayOfWeek() or weekday(),\n\t\t\t// because they rely on the locale's dow (possibly overridden by\n\t\t\t// our firstDay option), which may not be Monday. We cannot change\n\t\t\t// dow, because that would affect the calendar start day as well.\n\t\t\tif (date._locale._fullCalendar_weekCalc === 'ISO') {\n\t\t\t\tweekCalcFirstDoW = 1;  // Monday by ISO 8601 definition\n\t\t\t}\n\t\t\telse {\n\t\t\t\tweekCalcFirstDoW = date._locale.firstDayOfWeek();\n\t\t\t}\n\t\t}\n\n\t\thtml += '<td class=\"' + classes.join(' ') + '\"' +\n\t\t\t(isDateValid ?\n\t\t\t\t' data-date=\"' + date.format() + '\"' :\n\t\t\t\t''\n\t\t\t\t) +\n\t\t\t'>';\n\n\t\tif (this.cellWeekNumbersVisible && (date.day() == weekCalcFirstDoW)) {\n\t\t\thtml += view.buildGotoAnchorHtml(\n\t\t\t\t{ date: date, type: 'week' },\n\t\t\t\t{ 'class': 'fc-week-number' },\n\t\t\t\tdate.format('w') // inner HTML\n\t\t\t);\n\t\t}\n\n\t\tif (isDayNumberVisible) {\n\t\t\thtml += view.buildGotoAnchorHtml(\n\t\t\t\tdate,\n\t\t\t\t{ 'class': 'fc-day-number' },\n\t\t\t\tdate.date() // inner HTML\n\t\t\t);\n\t\t}\n\n\t\thtml += '</td>';\n\n\t\treturn html;\n\t},\n\n\n\t/* Hit System\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\tprepareHits: function() {\n\t\tthis.colCoordCache.build();\n\t\tthis.rowCoordCache.build();\n\t\tthis.rowCoordCache.bottoms[this.rowCnt - 1] += this.bottomCoordPadding; // hack\n\t},\n\n\n\treleaseHits: function() {\n\t\tthis.colCoordCache.clear();\n\t\tthis.rowCoordCache.clear();\n\t},\n\n\n\tqueryHit: function(leftOffset, topOffset) {\n\t\tif (this.colCoordCache.isLeftInBounds(leftOffset) && this.rowCoordCache.isTopInBounds(topOffset)) {\n\t\t\tvar col = this.colCoordCache.getHorizontalIndex(leftOffset);\n\t\t\tvar row = this.rowCoordCache.getVerticalIndex(topOffset);\n\n\t\t\tif (row != null && col != null) {\n\t\t\t\treturn this.getCellHit(row, col);\n\t\t\t}\n\t\t}\n\t},\n\n\n\tgetHitFootprint: function(hit) {\n\t\tvar range = this.getCellRange(hit.row, hit.col);\n\n\t\treturn new ComponentFootprint(\n\t\t\tnew UnzonedRange(range.start, range.end),\n\t\t\ttrue // all-day?\n\t\t);\n\t},\n\n\n\tgetHitEl: function(hit) {\n\t\treturn this.getCellEl(hit.row, hit.col);\n\t},\n\n\n\t/* Cell System\n\t------------------------------------------------------------------------------------------------------------------*/\n\t// FYI: the first column is the leftmost column, regardless of date\n\n\n\tgetCellHit: function(row, col) {\n\t\treturn {\n\t\t\trow: row,\n\t\t\tcol: col,\n\t\t\tcomponent: this, // needed unfortunately :(\n\t\t\tleft: this.colCoordCache.getLeftOffset(col),\n\t\t\tright: this.colCoordCache.getRightOffset(col),\n\t\t\ttop: this.rowCoordCache.getTopOffset(row),\n\t\t\tbottom: this.rowCoordCache.getBottomOffset(row)\n\t\t};\n\t},\n\n\n\tgetCellEl: function(row, col) {\n\t\treturn this.cellEls.eq(row * this.colCnt + col);\n\t},\n\n\n\t/* Event Rendering\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Unrenders all events currently rendered on the grid\n\tunrenderEvents: function() {\n\t\tthis.removeSegPopover(); // removes the \"more..\" events popover\n\n\t\tInteractiveDateComponent.prototype.unrenderEvents.apply(this, arguments);\n\t},\n\n\n\t// Retrieves all rendered segment objects currently rendered on the grid\n\tgetOwnEventSegs: function() {\n\t\treturn InteractiveDateComponent.prototype.getOwnEventSegs.apply(this, arguments) // get the segments from the super-method\n\t\t\t.concat(this.popoverSegs || []); // append the segments from the \"more...\" popover\n\t},\n\n\n\t/* Event Drag Visualization\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Renders a visual indication of an event or external element being dragged.\n\t// `eventLocation` has zoned start and end (optional)\n\trenderDrag: function(eventFootprints, seg, isTouch) {\n\t\tvar i;\n\n\t\tfor (i = 0; i < eventFootprints.length; i++) {\n\t\t\tthis.renderHighlight(eventFootprints[i].componentFootprint);\n\t\t}\n\n\t\t// render drags from OTHER components as helpers\n\t\tif (eventFootprints.length && seg && seg.component !== this) {\n\t\t\tthis.helperRenderer.renderEventDraggingFootprints(eventFootprints, seg, isTouch);\n\n\t\t\treturn true; // signal helpers rendered\n\t\t}\n\t},\n\n\n\t// Unrenders any visual indication of a hovering event\n\tunrenderDrag: function(seg) {\n\t\tthis.unrenderHighlight();\n\t\tthis.helperRenderer.unrender();\n\t},\n\n\n\t/* Event Resize Visualization\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Renders a visual indication of an event being resized\n\trenderEventResize: function(eventFootprints, seg, isTouch) {\n\t\tvar i;\n\n\t\tfor (i = 0; i < eventFootprints.length; i++) {\n\t\t\tthis.renderHighlight(eventFootprints[i].componentFootprint);\n\t\t}\n\n\t\tthis.helperRenderer.renderEventResizingFootprints(eventFootprints, seg, isTouch);\n\t},\n\n\n\t// Unrenders a visual indication of an event being resized\n\tunrenderEventResize: function(seg) {\n\t\tthis.unrenderHighlight();\n\t\tthis.helperRenderer.unrender();\n\t}\n\n});\n\n;;\n\n/* Methods relate to limiting the number events for a given day on a DayGrid\n----------------------------------------------------------------------------------------------------------------------*/\n// NOTE: all the segs being passed around in here are foreground segs\n\nDayGrid.mixin({\n\n\tsegPopover: null, // the Popover that holds events that can't fit in a cell. null when not visible\n\tpopoverSegs: null, // an array of segment objects that the segPopover holds. null when not visible\n\n\n\tremoveSegPopover: function() {\n\t\tif (this.segPopover) {\n\t\t\tthis.segPopover.hide(); // in handler, will call segPopover's removeElement\n\t\t}\n\t},\n\n\n\t// Limits the number of \"levels\" (vertically stacking layers of events) for each row of the grid.\n\t// `levelLimit` can be false (don't limit), a number, or true (should be computed).\n\tlimitRows: function(levelLimit) {\n\t\tvar rowStructs = this.eventRenderer.rowStructs || [];\n\t\tvar row; // row #\n\t\tvar rowLevelLimit;\n\n\t\tfor (row = 0; row < rowStructs.length; row++) {\n\t\t\tthis.unlimitRow(row);\n\n\t\t\tif (!levelLimit) {\n\t\t\t\trowLevelLimit = false;\n\t\t\t}\n\t\t\telse if (typeof levelLimit === 'number') {\n\t\t\t\trowLevelLimit = levelLimit;\n\t\t\t}\n\t\t\telse {\n\t\t\t\trowLevelLimit = this.computeRowLevelLimit(row);\n\t\t\t}\n\n\t\t\tif (rowLevelLimit !== false) {\n\t\t\t\tthis.limitRow(row, rowLevelLimit);\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Computes the number of levels a row will accomodate without going outside its bounds.\n\t// Assumes the row is \"rigid\" (maintains a constant height regardless of what is inside).\n\t// `row` is the row number.\n\tcomputeRowLevelLimit: function(row) {\n\t\tvar rowEl = this.rowEls.eq(row); // the containing \"fake\" row div\n\t\tvar rowHeight = rowEl.height(); // TODO: cache somehow?\n\t\tvar trEls = this.eventRenderer.rowStructs[row].tbodyEl.children();\n\t\tvar i, trEl;\n\t\tvar trHeight;\n\n\t\tfunction iterInnerHeights(i, childNode) {\n\t\t\ttrHeight = Math.max(trHeight, $(childNode).outerHeight());\n\t\t}\n\n\t\t// Reveal one level <tr> at a time and stop when we find one out of bounds\n\t\tfor (i = 0; i < trEls.length; i++) {\n\t\t\ttrEl = trEls.eq(i).removeClass('fc-limited'); // reset to original state (reveal)\n\n\t\t\t// with rowspans>1 and IE8, trEl.outerHeight() would return the height of the largest cell,\n\t\t\t// so instead, find the tallest inner content element.\n\t\t\ttrHeight = 0;\n\t\t\ttrEl.find('> td > :first-child').each(iterInnerHeights);\n\n\t\t\tif (trEl.position().top + trHeight > rowHeight) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn false; // should not limit at all\n\t},\n\n\n\t// Limits the given grid row to the maximum number of levels and injects \"more\" links if necessary.\n\t// `row` is the row number.\n\t// `levelLimit` is a number for the maximum (inclusive) number of levels allowed.\n\tlimitRow: function(row, levelLimit) {\n\t\tvar _this = this;\n\t\tvar rowStruct = this.eventRenderer.rowStructs[row];\n\t\tvar moreNodes = []; // array of \"more\" <a> links and <td> DOM nodes\n\t\tvar col = 0; // col #, left-to-right (not chronologically)\n\t\tvar levelSegs; // array of segment objects in the last allowable level, ordered left-to-right\n\t\tvar cellMatrix; // a matrix (by level, then column) of all <td> jQuery elements in the row\n\t\tvar limitedNodes; // array of temporarily hidden level <tr> and segment <td> DOM nodes\n\t\tvar i, seg;\n\t\tvar segsBelow; // array of segment objects below `seg` in the current `col`\n\t\tvar totalSegsBelow; // total number of segments below `seg` in any of the columns `seg` occupies\n\t\tvar colSegsBelow; // array of segment arrays, below seg, one for each column (offset from segs's first column)\n\t\tvar td, rowspan;\n\t\tvar segMoreNodes; // array of \"more\" <td> cells that will stand-in for the current seg's cell\n\t\tvar j;\n\t\tvar moreTd, moreWrap, moreLink;\n\n\t\t// Iterates through empty level cells and places \"more\" links inside if need be\n\t\tfunction emptyCellsUntil(endCol) { // goes from current `col` to `endCol`\n\t\t\twhile (col < endCol) {\n\t\t\t\tsegsBelow = _this.getCellSegs(row, col, levelLimit);\n\t\t\t\tif (segsBelow.length) {\n\t\t\t\t\ttd = cellMatrix[levelLimit - 1][col];\n\t\t\t\t\tmoreLink = _this.renderMoreLink(row, col, segsBelow);\n\t\t\t\t\tmoreWrap = $('<div/>').append(moreLink);\n\t\t\t\t\ttd.append(moreWrap);\n\t\t\t\t\tmoreNodes.push(moreWrap[0]);\n\t\t\t\t}\n\t\t\t\tcol++;\n\t\t\t}\n\t\t}\n\n\t\tif (levelLimit && levelLimit < rowStruct.segLevels.length) { // is it actually over the limit?\n\t\t\tlevelSegs = rowStruct.segLevels[levelLimit - 1];\n\t\t\tcellMatrix = rowStruct.cellMatrix;\n\n\t\t\tlimitedNodes = rowStruct.tbodyEl.children().slice(levelLimit) // get level <tr> elements past the limit\n\t\t\t\t.addClass('fc-limited').get(); // hide elements and get a simple DOM-nodes array\n\n\t\t\t// iterate though segments in the last allowable level\n\t\t\tfor (i = 0; i < levelSegs.length; i++) {\n\t\t\t\tseg = levelSegs[i];\n\t\t\t\temptyCellsUntil(seg.leftCol); // process empty cells before the segment\n\n\t\t\t\t// determine *all* segments below `seg` that occupy the same columns\n\t\t\t\tcolSegsBelow = [];\n\t\t\t\ttotalSegsBelow = 0;\n\t\t\t\twhile (col <= seg.rightCol) {\n\t\t\t\t\tsegsBelow = this.getCellSegs(row, col, levelLimit);\n\t\t\t\t\tcolSegsBelow.push(segsBelow);\n\t\t\t\t\ttotalSegsBelow += segsBelow.length;\n\t\t\t\t\tcol++;\n\t\t\t\t}\n\n\t\t\t\tif (totalSegsBelow) { // do we need to replace this segment with one or many \"more\" links?\n\t\t\t\t\ttd = cellMatrix[levelLimit - 1][seg.leftCol]; // the segment's parent cell\n\t\t\t\t\trowspan = td.attr('rowspan') || 1;\n\t\t\t\t\tsegMoreNodes = [];\n\n\t\t\t\t\t// make a replacement <td> for each column the segment occupies. will be one for each colspan\n\t\t\t\t\tfor (j = 0; j < colSegsBelow.length; j++) {\n\t\t\t\t\t\tmoreTd = $('<td class=\"fc-more-cell\"/>').attr('rowspan', rowspan);\n\t\t\t\t\t\tsegsBelow = colSegsBelow[j];\n\t\t\t\t\t\tmoreLink = this.renderMoreLink(\n\t\t\t\t\t\t\trow,\n\t\t\t\t\t\t\tseg.leftCol + j,\n\t\t\t\t\t\t\t[ seg ].concat(segsBelow) // count seg as hidden too\n\t\t\t\t\t\t);\n\t\t\t\t\t\tmoreWrap = $('<div/>').append(moreLink);\n\t\t\t\t\t\tmoreTd.append(moreWrap);\n\t\t\t\t\t\tsegMoreNodes.push(moreTd[0]);\n\t\t\t\t\t\tmoreNodes.push(moreTd[0]);\n\t\t\t\t\t}\n\n\t\t\t\t\ttd.addClass('fc-limited').after($(segMoreNodes)); // hide original <td> and inject replacements\n\t\t\t\t\tlimitedNodes.push(td[0]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\temptyCellsUntil(this.colCnt); // finish off the level\n\t\t\trowStruct.moreEls = $(moreNodes); // for easy undoing later\n\t\t\trowStruct.limitedEls = $(limitedNodes); // for easy undoing later\n\t\t}\n\t},\n\n\n\t// Reveals all levels and removes all \"more\"-related elements for a grid's row.\n\t// `row` is a row number.\n\tunlimitRow: function(row) {\n\t\tvar rowStruct = this.eventRenderer.rowStructs[row];\n\n\t\tif (rowStruct.moreEls) {\n\t\t\trowStruct.moreEls.remove();\n\t\t\trowStruct.moreEls = null;\n\t\t}\n\n\t\tif (rowStruct.limitedEls) {\n\t\t\trowStruct.limitedEls.removeClass('fc-limited');\n\t\t\trowStruct.limitedEls = null;\n\t\t}\n\t},\n\n\n\t// Renders an <a> element that represents hidden event element for a cell.\n\t// Responsible for attaching click handler as well.\n\trenderMoreLink: function(row, col, hiddenSegs) {\n\t\tvar _this = this;\n\t\tvar view = this.view;\n\n\t\treturn $('<a class=\"fc-more\"/>')\n\t\t\t.text(\n\t\t\t\tthis.getMoreLinkText(hiddenSegs.length)\n\t\t\t)\n\t\t\t.on('click', function(ev) {\n\t\t\t\tvar clickOption = _this.opt('eventLimitClick');\n\t\t\t\tvar date = _this.getCellDate(row, col);\n\t\t\t\tvar moreEl = $(this);\n\t\t\t\tvar dayEl = _this.getCellEl(row, col);\n\t\t\t\tvar allSegs = _this.getCellSegs(row, col);\n\n\t\t\t\t// rescope the segments to be within the cell's date\n\t\t\t\tvar reslicedAllSegs = _this.resliceDaySegs(allSegs, date);\n\t\t\t\tvar reslicedHiddenSegs = _this.resliceDaySegs(hiddenSegs, date);\n\n\t\t\t\tif (typeof clickOption === 'function') {\n\t\t\t\t\t// the returned value can be an atomic option\n\t\t\t\t\tclickOption = _this.publiclyTrigger('eventLimitClick', {\n\t\t\t\t\t\tcontext: view,\n\t\t\t\t\t\targs: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdate: date.clone(),\n\t\t\t\t\t\t\t\tdayEl: dayEl,\n\t\t\t\t\t\t\t\tmoreEl: moreEl,\n\t\t\t\t\t\t\t\tsegs: reslicedAllSegs,\n\t\t\t\t\t\t\t\thiddenSegs: reslicedHiddenSegs\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tev,\n\t\t\t\t\t\t\tview\n\t\t\t\t\t\t]\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (clickOption === 'popover') {\n\t\t\t\t\t_this.showSegPopover(row, col, moreEl, reslicedAllSegs);\n\t\t\t\t}\n\t\t\t\telse if (typeof clickOption === 'string') { // a view name\n\t\t\t\t\tview.calendar.zoomTo(date, clickOption);\n\t\t\t\t}\n\t\t\t});\n\t},\n\n\n\t// Reveals the popover that displays all events within a cell\n\tshowSegPopover: function(row, col, moreLink, segs) {\n\t\tvar _this = this;\n\t\tvar view = this.view;\n\t\tvar moreWrap = moreLink.parent(); // the <div> wrapper around the <a>\n\t\tvar topEl; // the element we want to match the top coordinate of\n\t\tvar options;\n\n\t\tif (this.rowCnt == 1) {\n\t\t\ttopEl = view.el; // will cause the popover to cover any sort of header\n\t\t}\n\t\telse {\n\t\t\ttopEl = this.rowEls.eq(row); // will align with top of row\n\t\t}\n\n\t\toptions = {\n\t\t\tclassName: 'fc-more-popover ' + view.calendar.theme.getClass('popover'),\n\t\t\tcontent: this.renderSegPopoverContent(row, col, segs),\n\t\t\tparentEl: view.el, // attach to root of view. guarantees outside of scrollbars.\n\t\t\ttop: topEl.offset().top,\n\t\t\tautoHide: true, // when the user clicks elsewhere, hide the popover\n\t\t\tviewportConstrain: this.opt('popoverViewportConstrain'),\n\t\t\thide: function() {\n\t\t\t\t// kill everything when the popover is hidden\n\t\t\t\t// notify events to be removed\n\t\t\t\tif (_this.popoverSegs) {\n\t\t\t\t\t_this.triggerBeforeEventSegsDestroyed(_this.popoverSegs);\n\t\t\t\t}\n\t\t\t\t_this.segPopover.removeElement();\n\t\t\t\t_this.segPopover = null;\n\t\t\t\t_this.popoverSegs = null;\n\t\t\t}\n\t\t};\n\n\t\t// Determine horizontal coordinate.\n\t\t// We use the moreWrap instead of the <td> to avoid border confusion.\n\t\tif (this.isRTL) {\n\t\t\toptions.right = moreWrap.offset().left + moreWrap.outerWidth() + 1; // +1 to be over cell border\n\t\t}\n\t\telse {\n\t\t\toptions.left = moreWrap.offset().left - 1; // -1 to be over cell border\n\t\t}\n\n\t\tthis.segPopover = new Popover(options);\n\t\tthis.segPopover.show();\n\n\t\t// the popover doesn't live within the grid's container element, and thus won't get the event\n\t\t// delegated-handlers for free. attach event-related handlers to the popover.\n\t\tthis.bindAllSegHandlersToEl(this.segPopover.el);\n\n\t\tthis.triggerAfterEventSegsRendered(segs);\n\t},\n\n\n\t// Builds the inner DOM contents of the segment popover\n\trenderSegPopoverContent: function(row, col, segs) {\n\t\tvar view = this.view;\n\t\tvar theme = view.calendar.theme;\n\t\tvar title = this.getCellDate(row, col).format(this.opt('dayPopoverFormat'));\n\t\tvar content = $(\n\t\t\t'<div class=\"fc-header ' + theme.getClass('popoverHeader') + '\">' +\n\t\t\t\t'<span class=\"fc-close ' + theme.getIconClass('close') + '\"></span>' +\n\t\t\t\t'<span class=\"fc-title\">' +\n\t\t\t\t\thtmlEscape(title) +\n\t\t\t\t'</span>' +\n\t\t\t\t'<div class=\"fc-clear\"/>' +\n\t\t\t'</div>' +\n\t\t\t'<div class=\"fc-body ' + theme.getClass('popoverContent') + '\">' +\n\t\t\t\t'<div class=\"fc-event-container\"></div>' +\n\t\t\t'</div>'\n\t\t);\n\t\tvar segContainer = content.find('.fc-event-container');\n\t\tvar i;\n\n\t\t// render each seg's `el` and only return the visible segs\n\t\tsegs = this.eventRenderer.renderFgSegEls(segs, true); // disableResizing=true\n\t\tthis.popoverSegs = segs;\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\n\t\t\t// because segments in the popover are not part of a grid coordinate system, provide a hint to any\n\t\t\t// grids that want to do drag-n-drop about which cell it came from\n\t\t\tthis.hitsNeeded();\n\t\t\tsegs[i].hit = this.getCellHit(row, col);\n\t\t\tthis.hitsNotNeeded();\n\n\t\t\tsegContainer.append(segs[i].el);\n\t\t}\n\n\t\treturn content;\n\t},\n\n\n\t// Given the events within an array of segment objects, reslice them to be in a single day\n\tresliceDaySegs: function(segs, dayDate) {\n\t\tvar dayStart = dayDate.clone();\n\t\tvar dayEnd = dayStart.clone().add(1, 'days');\n\t\tvar dayRange = new UnzonedRange(dayStart, dayEnd);\n\t\tvar newSegs = [];\n\t\tvar i, seg;\n\t\tvar slicedRange;\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tseg = segs[i];\n\t\t\tslicedRange = seg.footprint.componentFootprint.unzonedRange.intersect(dayRange);\n\n\t\t\tif (slicedRange) {\n\t\t\t\tnewSegs.push(\n\t\t\t\t\t$.extend({}, seg, {\n\t\t\t\t\t\tfootprint: new EventFootprint(\n\t\t\t\t\t\t\tnew ComponentFootprint(\n\t\t\t\t\t\t\t\tslicedRange,\n\t\t\t\t\t\t\t\tseg.footprint.componentFootprint.isAllDay\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tseg.footprint.eventDef,\n\t\t\t\t\t\t\tseg.footprint.eventInstance\n\t\t\t\t\t\t),\n\t\t\t\t\t\tisStart: seg.isStart && slicedRange.isStart,\n\t\t\t\t\t\tisEnd: seg.isEnd && slicedRange.isEnd\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// force an order because eventsToSegs doesn't guarantee one\n\t\t// TODO: research if still needed\n\t\tthis.eventRenderer.sortEventSegs(newSegs);\n\n\t\treturn newSegs;\n\t},\n\n\n\t// Generates the text that should be inside a \"more\" link, given the number of events it represents\n\tgetMoreLinkText: function(num) {\n\t\tvar opt = this.opt('eventLimitText');\n\n\t\tif (typeof opt === 'function') {\n\t\t\treturn opt(num);\n\t\t}\n\t\telse {\n\t\t\treturn '+' + num + ' ' + opt;\n\t\t}\n\t},\n\n\n\t// Returns segments within a given cell.\n\t// If `startLevel` is specified, returns only events including and below that level. Otherwise returns all segs.\n\tgetCellSegs: function(row, col, startLevel) {\n\t\tvar segMatrix = this.eventRenderer.rowStructs[row].segMatrix;\n\t\tvar level = startLevel || 0;\n\t\tvar segs = [];\n\t\tvar seg;\n\n\t\twhile (level < segMatrix.length) {\n\t\t\tseg = segMatrix[level][col];\n\t\t\tif (seg) {\n\t\t\t\tsegs.push(seg);\n\t\t\t}\n\t\t\tlevel++;\n\t\t}\n\n\t\treturn segs;\n\t}\n\n});\n\n;;\n\n/* An abstract class for the \"basic\" views, as well as month view. Renders one or more rows of day cells.\n----------------------------------------------------------------------------------------------------------------------*/\n// It is a manager for a DayGrid subcomponent, which does most of the heavy lifting.\n// It is responsible for managing width/height.\n\nvar BasicView = FC.BasicView = View.extend({\n\n\tscroller: null,\n\n\tdayGridClass: DayGrid, // class the dayGrid will be instantiated from (overridable by subclasses)\n\tdayGrid: null, // the main subcomponent that does most of the heavy lifting\n\n\tweekNumberWidth: null, // width of all the week-number cells running down the side\n\n\n\tconstructor: function() {\n\t\tView.apply(this, arguments);\n\n\t\tthis.dayGrid = this.instantiateDayGrid();\n\t\tthis.dayGrid.isRigid = this.hasRigidRows();\n\n\t\tif (this.opt('weekNumbers')) {\n\t\t\tif (this.opt('weekNumbersWithinDays')) {\n\t\t\t\tthis.dayGrid.cellWeekNumbersVisible = true;\n\t\t\t\tthis.dayGrid.colWeekNumbersVisible = false;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.dayGrid.cellWeekNumbersVisible = false;\n\t\t\t\tthis.dayGrid.colWeekNumbersVisible = true;\n\t\t\t};\n\t\t}\n\n\t\tthis.addChild(this.dayGrid);\n\n\t\tthis.scroller = new Scroller({\n\t\t\toverflowX: 'hidden',\n\t\t\toverflowY: 'auto'\n\t\t});\n\t},\n\n\n\t// Generates the DayGrid object this view needs. Draws from this.dayGridClass\n\tinstantiateDayGrid: function() {\n\t\t// generate a subclass on the fly with BasicView-specific behavior\n\t\t// TODO: cache this subclass\n\t\tvar subclass = this.dayGridClass.extend(basicDayGridMethods);\n\n\t\treturn new subclass(this);\n\t},\n\n\n\t// Computes the date range that will be rendered.\n\tbuildRenderRange: function(currentUnzonedRange, currentRangeUnit, isRangeAllDay) {\n\t\tvar renderUnzonedRange = View.prototype.buildRenderRange.apply(this, arguments); // an UnzonedRange\n\t\tvar start = this.calendar.msToUtcMoment(renderUnzonedRange.startMs, isRangeAllDay);\n\t\tvar end = this.calendar.msToUtcMoment(renderUnzonedRange.endMs, isRangeAllDay);\n\n\t\t// year and month views should be aligned with weeks. this is already done for week\n\t\tif (/^(year|month)$/.test(currentRangeUnit)) {\n\t\t\tstart.startOf('week');\n\n\t\t\t// make end-of-week if not already\n\t\t\tif (end.weekday()) {\n\t\t\t\tend.add(1, 'week').startOf('week'); // exclusively move backwards\n\t\t\t}\n\t\t}\n\n\t\treturn new UnzonedRange(start, end);\n\t},\n\n\n\texecuteDateRender: function(dateProfile) {\n\t\tthis.dayGrid.breakOnWeeks = /year|month|week/.test(dateProfile.currentRangeUnit);\n\n\t\tView.prototype.executeDateRender.apply(this, arguments);\n\t},\n\n\n\trenderSkeleton: function() {\n\t\tvar dayGridContainerEl;\n\t\tvar dayGridEl;\n\n\t\tthis.el.addClass('fc-basic-view').html(this.renderSkeletonHtml());\n\n\t\tthis.scroller.render();\n\n\t\tdayGridContainerEl = this.scroller.el.addClass('fc-day-grid-container');\n\t\tdayGridEl = $('<div class=\"fc-day-grid\" />').appendTo(dayGridContainerEl);\n\n\t\tthis.el.find('.fc-body > tr > td').append(dayGridContainerEl);\n\n\t\tthis.dayGrid.headContainerEl = this.el.find('.fc-head-container');\n\t\tthis.dayGrid.setElement(dayGridEl);\n\t},\n\n\n\tunrenderSkeleton: function() {\n\t\tthis.dayGrid.removeElement();\n\t\tthis.scroller.destroy();\n\t},\n\n\n\t// Builds the HTML skeleton for the view.\n\t// The day-grid component will render inside of a container defined by this HTML.\n\trenderSkeletonHtml: function() {\n\t\tvar theme = this.calendar.theme;\n\n\t\treturn '' +\n\t\t\t'<table class=\"' + theme.getClass('tableGrid') + '\">' +\n\t\t\t\t(this.opt('columnHeader') ?\n\t\t\t\t\t'<thead class=\"fc-head\">' +\n\t\t\t\t\t\t'<tr>' +\n\t\t\t\t\t\t\t'<td class=\"fc-head-container ' + theme.getClass('widgetHeader') + '\">&nbsp;</td>' +\n\t\t\t\t\t\t'</tr>' +\n\t\t\t\t\t'</thead>' :\n\t\t\t\t\t''\n\t\t\t\t\t) +\n\t\t\t\t'<tbody class=\"fc-body\">' +\n\t\t\t\t\t'<tr>' +\n\t\t\t\t\t\t'<td class=\"' + theme.getClass('widgetContent') + '\"></td>' +\n\t\t\t\t\t'</tr>' +\n\t\t\t\t'</tbody>' +\n\t\t\t'</table>';\n\t},\n\n\n\t// Generates an HTML attribute string for setting the width of the week number column, if it is known\n\tweekNumberStyleAttr: function() {\n\t\tif (this.weekNumberWidth !== null) {\n\t\t\treturn 'style=\"width:' + this.weekNumberWidth + 'px\"';\n\t\t}\n\t\treturn '';\n\t},\n\n\n\t// Determines whether each row should have a constant height\n\thasRigidRows: function() {\n\t\tvar eventLimit = this.opt('eventLimit');\n\n\t\treturn eventLimit && typeof eventLimit !== 'number';\n\t},\n\n\n\t/* Dimensions\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Refreshes the horizontal dimensions of the view\n\tupdateSize: function(totalHeight, isAuto, isResize) {\n\t\tvar eventLimit = this.opt('eventLimit');\n\t\tvar headRowEl = this.dayGrid.headContainerEl.find('.fc-row');\n\t\tvar scrollerHeight;\n\t\tvar scrollbarWidths;\n\n\t\t// hack to give the view some height prior to dayGrid's columns being rendered\n\t\t// TODO: separate setting height from scroller VS dayGrid.\n\t\tif (!this.dayGrid.rowEls) {\n\t\t\tif (!isAuto) {\n\t\t\t\tscrollerHeight = this.computeScrollerHeight(totalHeight);\n\t\t\t\tthis.scroller.setHeight(scrollerHeight);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tView.prototype.updateSize.apply(this, arguments);\n\n\t\tif (this.dayGrid.colWeekNumbersVisible) {\n\t\t\t// Make sure all week number cells running down the side have the same width.\n\t\t\t// Record the width for cells created later.\n\t\t\tthis.weekNumberWidth = matchCellWidths(\n\t\t\t\tthis.el.find('.fc-week-number')\n\t\t\t);\n\t\t}\n\n\t\t// reset all heights to be natural\n\t\tthis.scroller.clear();\n\t\tuncompensateScroll(headRowEl);\n\n\t\tthis.dayGrid.removeSegPopover(); // kill the \"more\" popover if displayed\n\n\t\t// is the event limit a constant level number?\n\t\tif (eventLimit && typeof eventLimit === 'number') {\n\t\t\tthis.dayGrid.limitRows(eventLimit); // limit the levels first so the height can redistribute after\n\t\t}\n\n\t\t// distribute the height to the rows\n\t\t// (totalHeight is a \"recommended\" value if isAuto)\n\t\tscrollerHeight = this.computeScrollerHeight(totalHeight);\n\t\tthis.setGridHeight(scrollerHeight, isAuto);\n\n\t\t// is the event limit dynamically calculated?\n\t\tif (eventLimit && typeof eventLimit !== 'number') {\n\t\t\tthis.dayGrid.limitRows(eventLimit); // limit the levels after the grid's row heights have been set\n\t\t}\n\n\t\tif (!isAuto) { // should we force dimensions of the scroll container?\n\n\t\t\tthis.scroller.setHeight(scrollerHeight);\n\t\t\tscrollbarWidths = this.scroller.getScrollbarWidths();\n\n\t\t\tif (scrollbarWidths.left || scrollbarWidths.right) { // using scrollbars?\n\n\t\t\t\tcompensateScroll(headRowEl, scrollbarWidths);\n\n\t\t\t\t// doing the scrollbar compensation might have created text overflow which created more height. redo\n\t\t\t\tscrollerHeight = this.computeScrollerHeight(totalHeight);\n\t\t\t\tthis.scroller.setHeight(scrollerHeight);\n\t\t\t}\n\n\t\t\t// guarantees the same scrollbar widths\n\t\t\tthis.scroller.lockOverflow(scrollbarWidths);\n\t\t}\n\t},\n\n\n\t// given a desired total height of the view, returns what the height of the scroller should be\n\tcomputeScrollerHeight: function(totalHeight) {\n\t\treturn totalHeight -\n\t\t\tsubtractInnerElHeight(this.el, this.scroller.el); // everything that's NOT the scroller\n\t},\n\n\n\t// Sets the height of just the DayGrid component in this view\n\tsetGridHeight: function(height, isAuto) {\n\t\tif (isAuto) {\n\t\t\tundistributeHeight(this.dayGrid.rowEls); // let the rows be their natural height with no expanding\n\t\t}\n\t\telse {\n\t\t\tdistributeHeight(this.dayGrid.rowEls, height, true); // true = compensate for height-hogging rows\n\t\t}\n\t},\n\n\n\t/* Scroll\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\tcomputeInitialDateScroll: function() {\n\t\treturn { top: 0 };\n\t},\n\n\n\tqueryDateScroll: function() {\n\t\treturn { top: this.scroller.getScrollTop() };\n\t},\n\n\n\tapplyDateScroll: function(scroll) {\n\t\tif (scroll.top !== undefined) {\n\t\t\tthis.scroller.setScrollTop(scroll.top);\n\t\t}\n\t}\n\n});\n\n\n// Methods that will customize the rendering behavior of the BasicView's dayGrid\nvar basicDayGridMethods = { // not relly methods anymore\n\n\n\tcolWeekNumbersVisible: false, // display week numbers along the side?\n\n\n\t// Generates the HTML that will go before the day-of week header cells\n\trenderHeadIntroHtml: function() {\n\t\tvar view = this.view;\n\n\t\tif (this.colWeekNumbersVisible) {\n\t\t\treturn '' +\n\t\t\t\t'<th class=\"fc-week-number ' + view.calendar.theme.getClass('widgetHeader') + '\" ' + view.weekNumberStyleAttr() + '>' +\n\t\t\t\t\t'<span>' + // needed for matchCellWidths\n\t\t\t\t\t\thtmlEscape(this.opt('weekNumberTitle')) +\n\t\t\t\t\t'</span>' +\n\t\t\t\t'</th>';\n\t\t}\n\n\t\treturn '';\n\t},\n\n\n\t// Generates the HTML that will go before content-skeleton cells that display the day/week numbers\n\trenderNumberIntroHtml: function(row) {\n\t\tvar view = this.view;\n\t\tvar weekStart = this.getCellDate(row, 0);\n\n\t\tif (this.colWeekNumbersVisible) {\n\t\t\treturn '' +\n\t\t\t\t'<td class=\"fc-week-number\" ' + view.weekNumberStyleAttr() + '>' +\n\t\t\t\t\tview.buildGotoAnchorHtml( // aside from link, important for matchCellWidths\n\t\t\t\t\t\t{ date: weekStart, type: 'week', forceOff: this.colCnt === 1 },\n\t\t\t\t\t\tweekStart.format('w') // inner HTML\n\t\t\t\t\t) +\n\t\t\t\t'</td>';\n\t\t}\n\n\t\treturn '';\n\t},\n\n\n\t// Generates the HTML that goes before the day bg cells for each day-row\n\trenderBgIntroHtml: function() {\n\t\tvar view = this.view;\n\n\t\tif (this.colWeekNumbersVisible) {\n\t\t\treturn '<td class=\"fc-week-number ' + view.calendar.theme.getClass('widgetContent') + '\" ' +\n\t\t\t\tview.weekNumberStyleAttr() + '></td>';\n\t\t}\n\n\t\treturn '';\n\t},\n\n\n\t// Generates the HTML that goes before every other type of row generated by DayGrid.\n\t// Affects helper-skeleton and highlight-skeleton rows.\n\trenderIntroHtml: function() {\n\t\tvar view = this.view;\n\n\t\tif (this.colWeekNumbersVisible) {\n\t\t\treturn '<td class=\"fc-week-number\" ' + view.weekNumberStyleAttr() + '></td>';\n\t\t}\n\n\t\treturn '';\n\t},\n\n\n\tgetIsNumbersVisible: function() {\n\t\treturn DayGrid.prototype.getIsNumbersVisible.apply(this, arguments) || this.colWeekNumbersVisible;\n\t}\n\n};\n\n;;\n\n/* A month view with day cells running in rows (one-per-week) and columns\n----------------------------------------------------------------------------------------------------------------------*/\n\nvar MonthView = FC.MonthView = BasicView.extend({\n\n\n\t// Computes the date range that will be rendered.\n\tbuildRenderRange: function(currentUnzonedRange, currentRangeUnit, isRangeAllDay) {\n\t\tvar renderUnzonedRange = BasicView.prototype.buildRenderRange.apply(this, arguments);\n\t\tvar start = this.calendar.msToUtcMoment(renderUnzonedRange.startMs, isRangeAllDay);\n\t\tvar end = this.calendar.msToUtcMoment(renderUnzonedRange.endMs, isRangeAllDay);\n\t\tvar rowCnt;\n\n\t\t// ensure 6 weeks\n\t\tif (this.isFixedWeeks()) {\n\t\t\trowCnt = Math.ceil( // could be partial weeks due to hiddenDays\n\t\t\t\tend.diff(start, 'weeks', true) // dontRound=true\n\t\t\t);\n\t\t\tend.add(6 - rowCnt, 'weeks');\n\t\t}\n\n\t\treturn new UnzonedRange(start, end);\n\t},\n\n\n\t// Overrides the default BasicView behavior to have special multi-week auto-height logic\n\tsetGridHeight: function(height, isAuto) {\n\n\t\t// if auto, make the height of each row the height that it would be if there were 6 weeks\n\t\tif (isAuto) {\n\t\t\theight *= this.rowCnt / 6;\n\t\t}\n\n\t\tdistributeHeight(this.dayGrid.rowEls, height, !isAuto); // if auto, don't compensate for height-hogging rows\n\t},\n\n\n\tisFixedWeeks: function() {\n\t\treturn this.opt('fixedWeekCount');\n\t},\n\n\n\tisDateInOtherMonth: function(date, dateProfile) {\n\t\treturn date.month() !== moment.utc(dateProfile.currentUnzonedRange.startMs).month(); // TODO: optimize\n\t}\n\n});\n\n;;\n\nfcViews.basic = {\n\t'class': BasicView\n};\n\nfcViews.basicDay = {\n\ttype: 'basic',\n\tduration: { days: 1 }\n};\n\nfcViews.basicWeek = {\n\ttype: 'basic',\n\tduration: { weeks: 1 }\n};\n\nfcViews.month = {\n\t'class': MonthView,\n\tduration: { months: 1 }, // important for prev/next\n\tdefaults: {\n\t\tfixedWeekCount: true\n\t}\n};\n;;\n\nvar TimeGridFillRenderer = FillRenderer.extend({\n\n\n\tattachSegEls: function(type, segs) {\n\t\tvar timeGrid = this.component;\n\t\tvar containerEls;\n\n\t\t// TODO: more efficient lookup\n\t\tif (type === 'bgEvent') {\n\t\t\tcontainerEls = timeGrid.bgContainerEls;\n\t\t}\n\t\telse if (type === 'businessHours') {\n\t\t\tcontainerEls = timeGrid.businessContainerEls;\n\t\t}\n\t\telse if (type === 'highlight') {\n\t\t\tcontainerEls = timeGrid.highlightContainerEls;\n\t\t}\n\n\t\ttimeGrid.updateSegVerticals(segs);\n\t\ttimeGrid.attachSegsByCol(timeGrid.groupSegsByCol(segs), containerEls);\n\n\t\treturn segs.map(function(seg) {\n\t\t\treturn seg.el[0];\n\t\t});\n\t}\n\n});\n\n;;\n\n/*\nOnly handles foreground segs.\nDoes not own rendering. Use for low-level util methods by TimeGrid.\n*/\nvar TimeGridEventRenderer = EventRenderer.extend({\n\n\ttimeGrid: null,\n\n\n\tconstructor: function(timeGrid) {\n\t\tEventRenderer.apply(this, arguments);\n\n\t\tthis.timeGrid = timeGrid;\n\t},\n\n\n\trenderFgSegs: function(segs) {\n\t\tthis.renderFgSegsIntoContainers(segs, this.timeGrid.fgContainerEls);\n\t},\n\n\n\t// Given an array of foreground segments, render a DOM element for each, computes position,\n\t// and attaches to the column inner-container elements.\n\trenderFgSegsIntoContainers: function(segs, containerEls) {\n\t\tvar segsByCol;\n\t\tvar col;\n\n\t\tsegsByCol = this.timeGrid.groupSegsByCol(segs);\n\n\t\tfor (col = 0; col < this.timeGrid.colCnt; col++) {\n\t\t\tthis.updateFgSegCoords(segsByCol[col]);\n\t\t}\n\n\t\tthis.timeGrid.attachSegsByCol(segsByCol, containerEls);\n\t},\n\n\n\tunrenderFgSegs: function() {\n\t\tif (this.fgSegs) { // hack\n\t\t\tthis.fgSegs.forEach(function(seg) {\n\t\t\t\tseg.el.remove();\n\t\t\t});\n\t\t}\n\t},\n\n\n\t// Computes a default event time formatting string if `timeFormat` is not explicitly defined\n\tcomputeEventTimeFormat: function() {\n\t\treturn this.opt('noMeridiemTimeFormat'); // like \"6:30\" (no AM/PM)\n\t},\n\n\n\t// Computes a default `displayEventEnd` value if one is not expliclty defined\n\tcomputeDisplayEventEnd: function() {\n\t\treturn true;\n\t},\n\n\n\t// Renders the HTML for a single event segment's default rendering\n\tfgSegHtml: function(seg, disableResizing) {\n\t\tvar view = this.view;\n\t\tvar calendar = view.calendar;\n\t\tvar componentFootprint = seg.footprint.componentFootprint;\n\t\tvar isAllDay = componentFootprint.isAllDay;\n\t\tvar eventDef = seg.footprint.eventDef;\n\t\tvar isDraggable = view.isEventDefDraggable(eventDef);\n\t\tvar isResizableFromStart = !disableResizing && seg.isStart && view.isEventDefResizableFromStart(eventDef);\n\t\tvar isResizableFromEnd = !disableResizing && seg.isEnd && view.isEventDefResizableFromEnd(eventDef);\n\t\tvar classes = this.getSegClasses(seg, isDraggable, isResizableFromStart || isResizableFromEnd);\n\t\tvar skinCss = cssToStr(this.getSkinCss(eventDef));\n\t\tvar timeText;\n\t\tvar fullTimeText; // more verbose time text. for the print stylesheet\n\t\tvar startTimeText; // just the start time text\n\n\t\tclasses.unshift('fc-time-grid-event', 'fc-v-event');\n\n\t\t// if the event appears to span more than one day...\n\t\tif (view.isMultiDayRange(componentFootprint.unzonedRange)) {\n\t\t\t// Don't display time text on segments that run entirely through a day.\n\t\t\t// That would appear as midnight-midnight and would look dumb.\n\t\t\t// Otherwise, display the time text for the *segment's* times (like 6pm-midnight or midnight-10am)\n\t\t\tif (seg.isStart || seg.isEnd) {\n\t\t\t\tvar zonedStart = calendar.msToMoment(seg.startMs);\n\t\t\t\tvar zonedEnd = calendar.msToMoment(seg.endMs);\n\t\t\t\ttimeText = this._getTimeText(zonedStart, zonedEnd, isAllDay);\n\t\t\t\tfullTimeText = this._getTimeText(zonedStart, zonedEnd, isAllDay, 'LT');\n\t\t\t\tstartTimeText = this._getTimeText(zonedStart, zonedEnd, isAllDay, null, false); // displayEnd=false\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// Display the normal time text for the *event's* times\n\t\t\ttimeText = this.getTimeText(seg.footprint);\n\t\t\tfullTimeText = this.getTimeText(seg.footprint, 'LT');\n\t\t\tstartTimeText = this.getTimeText(seg.footprint, null, false); // displayEnd=false\n\t\t}\n\n\t\treturn '<a class=\"' + classes.join(' ') + '\"' +\n\t\t\t(eventDef.url ?\n\t\t\t\t' href=\"' + htmlEscape(eventDef.url) + '\"' :\n\t\t\t\t''\n\t\t\t\t) +\n\t\t\t(skinCss ?\n\t\t\t\t' style=\"' + skinCss + '\"' :\n\t\t\t\t''\n\t\t\t\t) +\n\t\t\t'>' +\n\t\t\t\t'<div class=\"fc-content\">' +\n\t\t\t\t\t(timeText ?\n\t\t\t\t\t\t'<div class=\"fc-time\"' +\n\t\t\t\t\t\t' data-start=\"' + htmlEscape(startTimeText) + '\"' +\n\t\t\t\t\t\t' data-full=\"' + htmlEscape(fullTimeText) + '\"' +\n\t\t\t\t\t\t'>' +\n\t\t\t\t\t\t\t'<span>' + htmlEscape(timeText) + '</span>' +\n\t\t\t\t\t\t'</div>' :\n\t\t\t\t\t\t''\n\t\t\t\t\t\t) +\n\t\t\t\t\t(eventDef.title ?\n\t\t\t\t\t\t'<div class=\"fc-title\">' +\n\t\t\t\t\t\t\thtmlEscape(eventDef.title) +\n\t\t\t\t\t\t'</div>' :\n\t\t\t\t\t\t''\n\t\t\t\t\t\t) +\n\t\t\t\t'</div>' +\n\t\t\t\t'<div class=\"fc-bg\"/>' +\n\t\t\t\t/* TODO: write CSS for this\n\t\t\t\t(isResizableFromStart ?\n\t\t\t\t\t'<div class=\"fc-resizer fc-start-resizer\" />' :\n\t\t\t\t\t''\n\t\t\t\t\t) +\n\t\t\t\t*/\n\t\t\t\t(isResizableFromEnd ?\n\t\t\t\t\t'<div class=\"fc-resizer fc-end-resizer\" />' :\n\t\t\t\t\t''\n\t\t\t\t\t) +\n\t\t\t'</a>';\n\t},\n\n\n\t// Given segments that are assumed to all live in the *same column*,\n\t// compute their verical/horizontal coordinates and assign to their elements.\n\tupdateFgSegCoords: function(segs) {\n\t\tthis.timeGrid.computeSegVerticals(segs); // horizontals relies on this\n\t\tthis.computeFgSegHorizontals(segs); // compute horizontal coordinates, z-index's, and reorder the array\n\t\tthis.timeGrid.assignSegVerticals(segs);\n\t\tthis.assignFgSegHorizontals(segs);\n\t},\n\n\n\t// Given an array of segments that are all in the same column, sets the backwardCoord and forwardCoord on each.\n\t// NOTE: Also reorders the given array by date!\n\tcomputeFgSegHorizontals: function(segs) {\n\t\tvar levels;\n\t\tvar level0;\n\t\tvar i;\n\n\t\tthis.sortEventSegs(segs); // order by certain criteria\n\t\tlevels = buildSlotSegLevels(segs);\n\t\tcomputeForwardSlotSegs(levels);\n\n\t\tif ((level0 = levels[0])) {\n\n\t\t\tfor (i = 0; i < level0.length; i++) {\n\t\t\t\tcomputeSlotSegPressures(level0[i]);\n\t\t\t}\n\n\t\t\tfor (i = 0; i < level0.length; i++) {\n\t\t\t\tthis.computeFgSegForwardBack(level0[i], 0, 0);\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Calculate seg.forwardCoord and seg.backwardCoord for the segment, where both values range\n\t// from 0 to 1. If the calendar is left-to-right, the seg.backwardCoord maps to \"left\" and\n\t// seg.forwardCoord maps to \"right\" (via percentage). Vice-versa if the calendar is right-to-left.\n\t//\n\t// The segment might be part of a \"series\", which means consecutive segments with the same pressure\n\t// who's width is unknown until an edge has been hit. `seriesBackwardPressure` is the number of\n\t// segments behind this one in the current series, and `seriesBackwardCoord` is the starting\n\t// coordinate of the first segment in the series.\n\tcomputeFgSegForwardBack: function(seg, seriesBackwardPressure, seriesBackwardCoord) {\n\t\tvar forwardSegs = seg.forwardSegs;\n\t\tvar i;\n\n\t\tif (seg.forwardCoord === undefined) { // not already computed\n\n\t\t\tif (!forwardSegs.length) {\n\n\t\t\t\t// if there are no forward segments, this segment should butt up against the edge\n\t\t\t\tseg.forwardCoord = 1;\n\t\t\t}\n\t\t\telse {\n\n\t\t\t\t// sort highest pressure first\n\t\t\t\tthis.sortForwardSegs(forwardSegs);\n\n\t\t\t\t// this segment's forwardCoord will be calculated from the backwardCoord of the\n\t\t\t\t// highest-pressure forward segment.\n\t\t\t\tthis.computeFgSegForwardBack(forwardSegs[0], seriesBackwardPressure + 1, seriesBackwardCoord);\n\t\t\t\tseg.forwardCoord = forwardSegs[0].backwardCoord;\n\t\t\t}\n\n\t\t\t// calculate the backwardCoord from the forwardCoord. consider the series\n\t\t\tseg.backwardCoord = seg.forwardCoord -\n\t\t\t\t(seg.forwardCoord - seriesBackwardCoord) / // available width for series\n\t\t\t\t(seriesBackwardPressure + 1); // # of segments in the series\n\n\t\t\t// use this segment's coordinates to computed the coordinates of the less-pressurized\n\t\t\t// forward segments\n\t\t\tfor (i=0; i<forwardSegs.length; i++) {\n\t\t\t\tthis.computeFgSegForwardBack(forwardSegs[i], 0, seg.forwardCoord);\n\t\t\t}\n\t\t}\n\t},\n\n\n\tsortForwardSegs: function(forwardSegs) {\n\t\tforwardSegs.sort(proxy(this, 'compareForwardSegs'));\n\t},\n\n\n\t// A cmp function for determining which forward segment to rely on more when computing coordinates.\n\tcompareForwardSegs: function(seg1, seg2) {\n\t\t// put higher-pressure first\n\t\treturn seg2.forwardPressure - seg1.forwardPressure ||\n\t\t\t// put segments that are closer to initial edge first (and favor ones with no coords yet)\n\t\t\t(seg1.backwardCoord || 0) - (seg2.backwardCoord || 0) ||\n\t\t\t// do normal sorting...\n\t\t\tthis.compareEventSegs(seg1, seg2);\n\t},\n\n\n\t// Given foreground event segments that have already had their position coordinates computed,\n\t// assigns position-related CSS values to their elements.\n\tassignFgSegHorizontals: function(segs) {\n\t\tvar i, seg;\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tseg = segs[i];\n\t\t\tseg.el.css(this.generateFgSegHorizontalCss(seg));\n\n\t\t\t// if the height is short, add a className for alternate styling\n\t\t\tif (seg.bottom - seg.top < 30) {\n\t\t\t\tseg.el.addClass('fc-short');\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Generates an object with CSS properties/values that should be applied to an event segment element.\n\t// Contains important positioning-related properties that should be applied to any event element, customized or not.\n\tgenerateFgSegHorizontalCss: function(seg) {\n\t\tvar shouldOverlap = this.opt('slotEventOverlap');\n\t\tvar backwardCoord = seg.backwardCoord; // the left side if LTR. the right side if RTL. floating-point\n\t\tvar forwardCoord = seg.forwardCoord; // the right side if LTR. the left side if RTL. floating-point\n\t\tvar props = this.timeGrid.generateSegVerticalCss(seg); // get top/bottom first\n\t\tvar left; // amount of space from left edge, a fraction of the total width\n\t\tvar right; // amount of space from right edge, a fraction of the total width\n\n\t\tif (shouldOverlap) {\n\t\t\t// double the width, but don't go beyond the maximum forward coordinate (1.0)\n\t\t\tforwardCoord = Math.min(1, backwardCoord + (forwardCoord - backwardCoord) * 2);\n\t\t}\n\n\t\tif (this.timeGrid.isRTL) {\n\t\t\tleft = 1 - forwardCoord;\n\t\t\tright = backwardCoord;\n\t\t}\n\t\telse {\n\t\t\tleft = backwardCoord;\n\t\t\tright = 1 - forwardCoord;\n\t\t}\n\n\t\tprops.zIndex = seg.level + 1; // convert from 0-base to 1-based\n\t\tprops.left = left * 100 + '%';\n\t\tprops.right = right * 100 + '%';\n\n\t\tif (shouldOverlap && seg.forwardPressure) {\n\t\t\t// add padding to the edge so that forward stacked events don't cover the resizer's icon\n\t\t\tprops[this.isRTL ? 'marginLeft' : 'marginRight'] = 10 * 2; // 10 is a guesstimate of the icon's width\n\t\t}\n\n\t\treturn props;\n\t}\n\n});\n\n\n// Builds an array of segments \"levels\". The first level will be the leftmost tier of segments if the calendar is\n// left-to-right, or the rightmost if the calendar is right-to-left. Assumes the segments are already ordered by date.\nfunction buildSlotSegLevels(segs) {\n\tvar levels = [];\n\tvar i, seg;\n\tvar j;\n\n\tfor (i=0; i<segs.length; i++) {\n\t\tseg = segs[i];\n\n\t\t// go through all the levels and stop on the first level where there are no collisions\n\t\tfor (j=0; j<levels.length; j++) {\n\t\t\tif (!computeSlotSegCollisions(seg, levels[j]).length) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tseg.level = j;\n\n\t\t(levels[j] || (levels[j] = [])).push(seg);\n\t}\n\n\treturn levels;\n}\n\n\n// For every segment, figure out the other segments that are in subsequent\n// levels that also occupy the same vertical space. Accumulate in seg.forwardSegs\nfunction computeForwardSlotSegs(levels) {\n\tvar i, level;\n\tvar j, seg;\n\tvar k;\n\n\tfor (i=0; i<levels.length; i++) {\n\t\tlevel = levels[i];\n\n\t\tfor (j=0; j<level.length; j++) {\n\t\t\tseg = level[j];\n\n\t\t\tseg.forwardSegs = [];\n\t\t\tfor (k=i+1; k<levels.length; k++) {\n\t\t\t\tcomputeSlotSegCollisions(seg, levels[k], seg.forwardSegs);\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n// Figure out which path forward (via seg.forwardSegs) results in the longest path until\n// the furthest edge is reached. The number of segments in this path will be seg.forwardPressure\nfunction computeSlotSegPressures(seg) {\n\tvar forwardSegs = seg.forwardSegs;\n\tvar forwardPressure = 0;\n\tvar i, forwardSeg;\n\n\tif (seg.forwardPressure === undefined) { // not already computed\n\n\t\tfor (i=0; i<forwardSegs.length; i++) {\n\t\t\tforwardSeg = forwardSegs[i];\n\n\t\t\t// figure out the child's maximum forward path\n\t\t\tcomputeSlotSegPressures(forwardSeg);\n\n\t\t\t// either use the existing maximum, or use the child's forward pressure\n\t\t\t// plus one (for the forwardSeg itself)\n\t\t\tforwardPressure = Math.max(\n\t\t\t\tforwardPressure,\n\t\t\t\t1 + forwardSeg.forwardPressure\n\t\t\t);\n\t\t}\n\n\t\tseg.forwardPressure = forwardPressure;\n\t}\n}\n\n\n// Find all the segments in `otherSegs` that vertically collide with `seg`.\n// Append into an optionally-supplied `results` array and return.\nfunction computeSlotSegCollisions(seg, otherSegs, results) {\n\tresults = results || [];\n\n\tfor (var i=0; i<otherSegs.length; i++) {\n\t\tif (isSlotSegCollision(seg, otherSegs[i])) {\n\t\t\tresults.push(otherSegs[i]);\n\t\t}\n\t}\n\n\treturn results;\n}\n\n\n// Do these segments occupy the same vertical space?\nfunction isSlotSegCollision(seg1, seg2) {\n\treturn seg1.bottom > seg2.top && seg1.top < seg2.bottom;\n}\n\n;;\n\nvar TimeGridHelperRenderer = HelperRenderer.extend({\n\n\n\trenderSegs: function(segs, sourceSeg) {\n\t\tvar helperNodes = [];\n\t\tvar i, seg;\n\t\tvar sourceEl;\n\n\t\t// TODO: not good to call eventRenderer this way\n\t\tthis.eventRenderer.renderFgSegsIntoContainers(\n\t\t\tsegs,\n\t\t\tthis.component.helperContainerEls\n\t\t);\n\n\t\t// Try to make the segment that is in the same row as sourceSeg look the same\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tseg = segs[i];\n\n\t\t\tif (sourceSeg && sourceSeg.col === seg.col) {\n\t\t\t\tsourceEl = sourceSeg.el;\n\t\t\t\tseg.el.css({\n\t\t\t\t\tleft: sourceEl.css('left'),\n\t\t\t\t\tright: sourceEl.css('right'),\n\t\t\t\t\t'margin-left': sourceEl.css('margin-left'),\n\t\t\t\t\t'margin-right': sourceEl.css('margin-right')\n\t\t\t\t});\n\t\t\t}\n\n\t\t\thelperNodes.push(seg.el[0]);\n\t\t}\n\n\t\treturn $(helperNodes); // must return the elements rendered\n\t}\n\n});\n\n;;\n\n/* A component that renders one or more columns of vertical time slots\n----------------------------------------------------------------------------------------------------------------------*/\n// We mixin DayTable, even though there is only a single row of days\n\nvar TimeGrid = FC.TimeGrid = InteractiveDateComponent.extend(StandardInteractionsMixin, DayTableMixin, {\n\n\teventRendererClass: TimeGridEventRenderer,\n\tbusinessHourRendererClass: BusinessHourRenderer,\n\thelperRendererClass: TimeGridHelperRenderer,\n\tfillRendererClass: TimeGridFillRenderer,\n\n\tview: null, // TODO: make more general and/or remove\n\thelperRenderer: null,\n\n\tdayRanges: null, // UnzonedRange[], of start-end of each day\n\tslotDuration: null, // duration of a \"slot\", a distinct time segment on given day, visualized by lines\n\tsnapDuration: null, // granularity of time for dragging and selecting\n\tsnapsPerSlot: null,\n\tlabelFormat: null, // formatting string for times running along vertical axis\n\tlabelInterval: null, // duration of how often a label should be displayed for a slot\n\n\theadContainerEl: null, // div that hold's the date header\n\tcolEls: null, // cells elements in the day-row background\n\tslatContainerEl: null, // div that wraps all the slat rows\n\tslatEls: null, // elements running horizontally across all columns\n\tnowIndicatorEls: null,\n\n\tcolCoordCache: null,\n\tslatCoordCache: null,\n\n\tbottomRuleEl: null, // hidden by default\n\tcolContainerEls: null, // containers for each column\n\n\t// inner-containers for each column where different types of segs live\n\tfgContainerEls: null,\n\tbgContainerEls: null,\n\thelperContainerEls: null,\n\thighlightContainerEls: null,\n\tbusinessContainerEls: null,\n\n\t// arrays of different types of displayed segments\n\thelperSegs: null,\n\thighlightSegs: null,\n\tbusinessSegs: null,\n\n\n\tconstructor: function(view) {\n\t\tthis.view = view; // do first, for opt calls during initialization\n\n\t\tInteractiveDateComponent.call(this); // call the super-constructor\n\n\t\tthis.processOptions();\n\t},\n\n\n\t// Slices up the given span (unzoned start/end with other misc data) into an array of segments\n\tcomponentFootprintToSegs: function(componentFootprint) {\n\t\tvar segs = this.sliceRangeByTimes(componentFootprint.unzonedRange);\n\t\tvar i;\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tif (this.isRTL) {\n\t\t\t\tsegs[i].col = this.daysPerRow - 1 - segs[i].dayIndex;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsegs[i].col = segs[i].dayIndex;\n\t\t\t}\n\t\t}\n\n\t\treturn segs;\n\t},\n\n\n\t/* Date Handling\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\tsliceRangeByTimes: function(unzonedRange) {\n\t\tvar segs = [];\n\t\tvar segRange;\n\t\tvar dayIndex;\n\n\t\tfor (dayIndex = 0; dayIndex < this.daysPerRow; dayIndex++) {\n\n\t\t\tsegRange = unzonedRange.intersect(this.dayRanges[dayIndex]);\n\n\t\t\tif (segRange) {\n\t\t\t\tsegs.push({\n\t\t\t\t\tstartMs: segRange.startMs,\n\t\t\t\t\tendMs: segRange.endMs,\n\t\t\t\t\tisStart: segRange.isStart,\n\t\t\t\t\tisEnd: segRange.isEnd,\n\t\t\t\t\tdayIndex: dayIndex\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn segs;\n\t},\n\n\n\t/* Options\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Parses various options into properties of this object\n\tprocessOptions: function() {\n\t\tvar slotDuration = this.opt('slotDuration');\n\t\tvar snapDuration = this.opt('snapDuration');\n\t\tvar input;\n\n\t\tslotDuration = moment.duration(slotDuration);\n\t\tsnapDuration = snapDuration ? moment.duration(snapDuration) : slotDuration;\n\n\t\tthis.slotDuration = slotDuration;\n\t\tthis.snapDuration = snapDuration;\n\t\tthis.snapsPerSlot = slotDuration / snapDuration; // TODO: ensure an integer multiple?\n\n\t\t// might be an array value (for TimelineView).\n\t\t// if so, getting the most granular entry (the last one probably).\n\t\tinput = this.opt('slotLabelFormat');\n\t\tif ($.isArray(input)) {\n\t\t\tinput = input[input.length - 1];\n\t\t}\n\n\t\tthis.labelFormat = input ||\n\t\t\tthis.opt('smallTimeFormat'); // the computed default\n\n\t\tinput = this.opt('slotLabelInterval');\n\t\tthis.labelInterval = input ?\n\t\t\tmoment.duration(input) :\n\t\t\tthis.computeLabelInterval(slotDuration);\n\t},\n\n\n\t// Computes an automatic value for slotLabelInterval\n\tcomputeLabelInterval: function(slotDuration) {\n\t\tvar i;\n\t\tvar labelInterval;\n\t\tvar slotsPerLabel;\n\n\t\t// find the smallest stock label interval that results in more than one slots-per-label\n\t\tfor (i = AGENDA_STOCK_SUB_DURATIONS.length - 1; i >= 0; i--) {\n\t\t\tlabelInterval = moment.duration(AGENDA_STOCK_SUB_DURATIONS[i]);\n\t\t\tslotsPerLabel = divideDurationByDuration(labelInterval, slotDuration);\n\t\t\tif (isInt(slotsPerLabel) && slotsPerLabel > 1) {\n\t\t\t\treturn labelInterval;\n\t\t\t}\n\t\t}\n\n\t\treturn moment.duration(slotDuration); // fall back. clone\n\t},\n\n\n\t/* Date Rendering\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\trenderDates: function(dateProfile) {\n\t\tthis.dateProfile = dateProfile;\n\t\tthis.updateDayTable();\n\t\tthis.renderSlats();\n\t\tthis.renderColumns();\n\t},\n\n\n\trenderSkeleton: function() {\n\t\tvar theme = this.view.calendar.theme;\n\n\t\tthis.el.html(\n\t\t\t'<div class=\"fc-bg\"></div>' +\n\t\t\t'<div class=\"fc-slats\"></div>' +\n\t\t\t'<hr class=\"fc-divider ' + theme.getClass('widgetHeader') + '\" style=\"display:none\" />'\n\t\t);\n\n\t\tthis.bottomRuleEl = this.el.find('hr');\n\t},\n\n\n\trenderSlats: function() {\n\t\tvar theme = this.view.calendar.theme;\n\n\t\tthis.slatContainerEl = this.el.find('> .fc-slats')\n\t\t\t.html(\n\t\t\t\t'<table class=\"' + theme.getClass('tableGrid') + '\">' +\n\t\t\t\t\tthis.renderSlatRowHtml() +\n\t\t\t\t'</table>'\n\t\t\t);\n\n\t\tthis.slatEls = this.slatContainerEl.find('tr');\n\n\t\tthis.slatCoordCache = new CoordCache({\n\t\t\tels: this.slatEls,\n\t\t\tisVertical: true\n\t\t});\n\t},\n\n\n\t// Generates the HTML for the horizontal \"slats\" that run width-wise. Has a time axis on a side. Depends on RTL.\n\trenderSlatRowHtml: function() {\n\t\tvar view = this.view;\n\t\tvar calendar = view.calendar;\n\t\tvar theme = calendar.theme;\n\t\tvar isRTL = this.isRTL;\n\t\tvar dateProfile = this.dateProfile;\n\t\tvar html = '';\n\t\tvar slotTime = moment.duration(+dateProfile.minTime); // wish there was .clone() for durations\n\t\tvar slotIterator = moment.duration(0);\n\t\tvar slotDate; // will be on the view's first day, but we only care about its time\n\t\tvar isLabeled;\n\t\tvar axisHtml;\n\n\t\t// Calculate the time for each slot\n\t\twhile (slotTime < dateProfile.maxTime) {\n\t\t\tslotDate = calendar.msToUtcMoment(dateProfile.renderUnzonedRange.startMs).time(slotTime);\n\t\t\tisLabeled = isInt(divideDurationByDuration(slotIterator, this.labelInterval));\n\n\t\t\taxisHtml =\n\t\t\t\t'<td class=\"fc-axis fc-time ' + theme.getClass('widgetContent') + '\" ' + view.axisStyleAttr() + '>' +\n\t\t\t\t\t(isLabeled ?\n\t\t\t\t\t\t'<span>' + // for matchCellWidths\n\t\t\t\t\t\t\thtmlEscape(slotDate.format(this.labelFormat)) +\n\t\t\t\t\t\t'</span>' :\n\t\t\t\t\t\t''\n\t\t\t\t\t\t) +\n\t\t\t\t'</td>';\n\n\t\t\thtml +=\n\t\t\t\t'<tr data-time=\"' + slotDate.format('HH:mm:ss') + '\"' +\n\t\t\t\t\t(isLabeled ? '' : ' class=\"fc-minor\"') +\n\t\t\t\t\t'>' +\n\t\t\t\t\t(!isRTL ? axisHtml : '') +\n\t\t\t\t\t'<td class=\"' + theme.getClass('widgetContent') + '\"/>' +\n\t\t\t\t\t(isRTL ? axisHtml : '') +\n\t\t\t\t\"</tr>\";\n\n\t\t\tslotTime.add(this.slotDuration);\n\t\t\tslotIterator.add(this.slotDuration);\n\t\t}\n\n\t\treturn html;\n\t},\n\n\n\trenderColumns: function() {\n\t\tvar dateProfile = this.dateProfile;\n\t\tvar theme = this.view.calendar.theme;\n\n\t\tthis.dayRanges = this.dayDates.map(function(dayDate) {\n\t\t\treturn new UnzonedRange(\n\t\t\t\tdayDate.clone().add(dateProfile.minTime),\n\t\t\t\tdayDate.clone().add(dateProfile.maxTime)\n\t\t\t);\n\t\t});\n\n\t\tif (this.headContainerEl) {\n\t\t\tthis.headContainerEl.html(this.renderHeadHtml());\n\t\t}\n\n\t\tthis.el.find('> .fc-bg').html(\n\t\t\t'<table class=\"' + theme.getClass('tableGrid') + '\">' +\n\t\t\t\tthis.renderBgTrHtml(0) + // row=0\n\t\t\t'</table>'\n\t\t);\n\n\t\tthis.colEls = this.el.find('.fc-day, .fc-disabled-day');\n\n\t\tthis.colCoordCache = new CoordCache({\n\t\t\tels: this.colEls,\n\t\t\tisHorizontal: true\n\t\t});\n\n\t\tthis.renderContentSkeleton();\n\t},\n\n\n\t/* Content Skeleton\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Renders the DOM that the view's content will live in\n\trenderContentSkeleton: function() {\n\t\tvar cellHtml = '';\n\t\tvar i;\n\t\tvar skeletonEl;\n\n\t\tfor (i = 0; i < this.colCnt; i++) {\n\t\t\tcellHtml +=\n\t\t\t\t'<td>' +\n\t\t\t\t\t'<div class=\"fc-content-col\">' +\n\t\t\t\t\t\t'<div class=\"fc-event-container fc-helper-container\"></div>' +\n\t\t\t\t\t\t'<div class=\"fc-event-container\"></div>' +\n\t\t\t\t\t\t'<div class=\"fc-highlight-container\"></div>' +\n\t\t\t\t\t\t'<div class=\"fc-bgevent-container\"></div>' +\n\t\t\t\t\t\t'<div class=\"fc-business-container\"></div>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</td>';\n\t\t}\n\n\t\tskeletonEl = $(\n\t\t\t'<div class=\"fc-content-skeleton\">' +\n\t\t\t\t'<table>' +\n\t\t\t\t\t'<tr>' + cellHtml + '</tr>' +\n\t\t\t\t'</table>' +\n\t\t\t'</div>'\n\t\t);\n\n\t\tthis.colContainerEls = skeletonEl.find('.fc-content-col');\n\t\tthis.helperContainerEls = skeletonEl.find('.fc-helper-container');\n\t\tthis.fgContainerEls = skeletonEl.find('.fc-event-container:not(.fc-helper-container)');\n\t\tthis.bgContainerEls = skeletonEl.find('.fc-bgevent-container');\n\t\tthis.highlightContainerEls = skeletonEl.find('.fc-highlight-container');\n\t\tthis.businessContainerEls = skeletonEl.find('.fc-business-container');\n\n\t\tthis.bookendCells(skeletonEl.find('tr')); // TODO: do this on string level\n\t\tthis.el.append(skeletonEl);\n\t},\n\n\n\t// Given a flat array of segments, return an array of sub-arrays, grouped by each segment's col\n\tgroupSegsByCol: function(segs) {\n\t\tvar segsByCol = [];\n\t\tvar i;\n\n\t\tfor (i = 0; i < this.colCnt; i++) {\n\t\t\tsegsByCol.push([]);\n\t\t}\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tsegsByCol[segs[i].col].push(segs[i]);\n\t\t}\n\n\t\treturn segsByCol;\n\t},\n\n\n\t// Given segments grouped by column, insert the segments' elements into a parallel array of container\n\t// elements, each living within a column.\n\tattachSegsByCol: function(segsByCol, containerEls) {\n\t\tvar col;\n\t\tvar segs;\n\t\tvar i;\n\n\t\tfor (col = 0; col < this.colCnt; col++) { // iterate each column grouping\n\t\t\tsegs = segsByCol[col];\n\n\t\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\t\tcontainerEls.eq(col).append(segs[i].el);\n\t\t\t}\n\t\t}\n\t},\n\n\n\t/* Now Indicator\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\tgetNowIndicatorUnit: function() {\n\t\treturn 'minute'; // will refresh on the minute\n\t},\n\n\n\trenderNowIndicator: function(date) {\n\t\t// seg system might be overkill, but it handles scenario where line needs to be rendered\n\t\t//  more than once because of columns with the same date (resources columns for example)\n\t\tvar segs = this.componentFootprintToSegs(\n\t\t\tnew ComponentFootprint(\n\t\t\t\tnew UnzonedRange(date, date.valueOf() + 1), // protect against null range\n\t\t\t\tfalse // all-day\n\t\t\t)\n\t\t);\n\t\tvar top = this.computeDateTop(date, date);\n\t\tvar nodes = [];\n\t\tvar i;\n\n\t\t// render lines within the columns\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tnodes.push($('<div class=\"fc-now-indicator fc-now-indicator-line\"></div>')\n\t\t\t\t.css('top', top)\n\t\t\t\t.appendTo(this.colContainerEls.eq(segs[i].col))[0]);\n\t\t}\n\n\t\t// render an arrow over the axis\n\t\tif (segs.length > 0) { // is the current time in view?\n\t\t\tnodes.push($('<div class=\"fc-now-indicator fc-now-indicator-arrow\"></div>')\n\t\t\t\t.css('top', top)\n\t\t\t\t.appendTo(this.el.find('.fc-content-skeleton'))[0]);\n\t\t}\n\n\t\tthis.nowIndicatorEls = $(nodes);\n\t},\n\n\n\tunrenderNowIndicator: function() {\n\t\tif (this.nowIndicatorEls) {\n\t\t\tthis.nowIndicatorEls.remove();\n\t\t\tthis.nowIndicatorEls = null;\n\t\t}\n\t},\n\n\n\t/* Coordinates\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\tupdateSize: function(totalHeight, isAuto, isResize) {\n\t\tInteractiveDateComponent.prototype.updateSize.apply(this, arguments);\n\n\t\tthis.slatCoordCache.build();\n\n\t\tif (isResize) {\n\t\t\tthis.updateSegVerticals(\n\t\t\t\t[].concat(this.eventRenderer.getSegs(), this.businessSegs || [])\n\t\t\t);\n\t\t}\n\t},\n\n\n\tgetTotalSlatHeight: function() {\n\t\treturn this.slatContainerEl.outerHeight();\n\t},\n\n\n\t// Computes the top coordinate, relative to the bounds of the grid, of the given date.\n\t// `ms` can be a millisecond UTC time OR a UTC moment.\n\t// A `startOfDayDate` must be given for avoiding ambiguity over how to treat midnight.\n\tcomputeDateTop: function(ms, startOfDayDate) {\n\t\treturn this.computeTimeTop(\n\t\t\tmoment.duration(\n\t\t\t\tms - startOfDayDate.clone().stripTime()\n\t\t\t)\n\t\t);\n\t},\n\n\n\t// Computes the top coordinate, relative to the bounds of the grid, of the given time (a Duration).\n\tcomputeTimeTop: function(time) {\n\t\tvar len = this.slatEls.length;\n\t\tvar dateProfile = this.dateProfile;\n\t\tvar slatCoverage = (time - dateProfile.minTime) / this.slotDuration; // floating-point value of # of slots covered\n\t\tvar slatIndex;\n\t\tvar slatRemainder;\n\n\t\t// compute a floating-point number for how many slats should be progressed through.\n\t\t// from 0 to number of slats (inclusive)\n\t\t// constrained because minTime/maxTime might be customized.\n\t\tslatCoverage = Math.max(0, slatCoverage);\n\t\tslatCoverage = Math.min(len, slatCoverage);\n\n\t\t// an integer index of the furthest whole slat\n\t\t// from 0 to number slats (*exclusive*, so len-1)\n\t\tslatIndex = Math.floor(slatCoverage);\n\t\tslatIndex = Math.min(slatIndex, len - 1);\n\n\t\t// how much further through the slatIndex slat (from 0.0-1.0) must be covered in addition.\n\t\t// could be 1.0 if slatCoverage is covering *all* the slots\n\t\tslatRemainder = slatCoverage - slatIndex;\n\n\t\treturn this.slatCoordCache.getTopPosition(slatIndex) +\n\t\t\tthis.slatCoordCache.getHeight(slatIndex) * slatRemainder;\n\t},\n\n\n\t// Refreshes the CSS top/bottom coordinates for each segment element.\n\t// Works when called after initial render, after a window resize/zoom for example.\n\tupdateSegVerticals: function(segs) {\n\t\tthis.computeSegVerticals(segs);\n\t\tthis.assignSegVerticals(segs);\n\t},\n\n\n\t// For each segment in an array, computes and assigns its top and bottom properties\n\tcomputeSegVerticals: function(segs) {\n\t\tvar eventMinHeight = this.opt('agendaEventMinHeight');\n\t\tvar i, seg;\n\t\tvar dayDate;\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tseg = segs[i];\n\t\t\tdayDate = this.dayDates[seg.dayIndex];\n\n\t\t\tseg.top = this.computeDateTop(seg.startMs, dayDate);\n\t\t\tseg.bottom = Math.max(\n\t\t\t\tseg.top + eventMinHeight,\n\t\t\t\tthis.computeDateTop(seg.endMs, dayDate)\n\t\t\t);\n\t\t}\n\t},\n\n\n\t// Given segments that already have their top/bottom properties computed, applies those values to\n\t// the segments' elements.\n\tassignSegVerticals: function(segs) {\n\t\tvar i, seg;\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tseg = segs[i];\n\t\t\tseg.el.css(this.generateSegVerticalCss(seg));\n\t\t}\n\t},\n\n\n\t// Generates an object with CSS properties for the top/bottom coordinates of a segment element\n\tgenerateSegVerticalCss: function(seg) {\n\t\treturn {\n\t\t\ttop: seg.top,\n\t\t\tbottom: -seg.bottom // flipped because needs to be space beyond bottom edge of event container\n\t\t};\n\t},\n\n\n\t/* Hit System\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\tprepareHits: function() {\n\t\tthis.colCoordCache.build();\n\t\tthis.slatCoordCache.build();\n\t},\n\n\n\treleaseHits: function() {\n\t\tthis.colCoordCache.clear();\n\t\t// NOTE: don't clear slatCoordCache because we rely on it for computeTimeTop\n\t},\n\n\n\tqueryHit: function(leftOffset, topOffset) {\n\t\tvar snapsPerSlot = this.snapsPerSlot;\n\t\tvar colCoordCache = this.colCoordCache;\n\t\tvar slatCoordCache = this.slatCoordCache;\n\n\t\tif (colCoordCache.isLeftInBounds(leftOffset) && slatCoordCache.isTopInBounds(topOffset)) {\n\t\t\tvar colIndex = colCoordCache.getHorizontalIndex(leftOffset);\n\t\t\tvar slatIndex = slatCoordCache.getVerticalIndex(topOffset);\n\n\t\t\tif (colIndex != null && slatIndex != null) {\n\t\t\t\tvar slatTop = slatCoordCache.getTopOffset(slatIndex);\n\t\t\t\tvar slatHeight = slatCoordCache.getHeight(slatIndex);\n\t\t\t\tvar partial = (topOffset - slatTop) / slatHeight; // floating point number between 0 and 1\n\t\t\t\tvar localSnapIndex = Math.floor(partial * snapsPerSlot); // the snap # relative to start of slat\n\t\t\t\tvar snapIndex = slatIndex * snapsPerSlot + localSnapIndex;\n\t\t\t\tvar snapTop = slatTop + (localSnapIndex / snapsPerSlot) * slatHeight;\n\t\t\t\tvar snapBottom = slatTop + ((localSnapIndex + 1) / snapsPerSlot) * slatHeight;\n\n\t\t\t\treturn {\n\t\t\t\t\tcol: colIndex,\n\t\t\t\t\tsnap: snapIndex,\n\t\t\t\t\tcomponent: this, // needed unfortunately :(\n\t\t\t\t\tleft: colCoordCache.getLeftOffset(colIndex),\n\t\t\t\t\tright: colCoordCache.getRightOffset(colIndex),\n\t\t\t\t\ttop: snapTop,\n\t\t\t\t\tbottom: snapBottom\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t},\n\n\n\tgetHitFootprint: function(hit) {\n\t\tvar start = this.getCellDate(0, hit.col); // row=0\n\t\tvar time = this.computeSnapTime(hit.snap); // pass in the snap-index\n\t\tvar end;\n\n\t\tstart.time(time);\n\t\tend = start.clone().add(this.snapDuration);\n\n\t\treturn new ComponentFootprint(\n\t\t\tnew UnzonedRange(start, end),\n\t\t\tfalse // all-day?\n\t\t);\n\t},\n\n\n\t// Given a row number of the grid, representing a \"snap\", returns a time (Duration) from its start-of-day\n\tcomputeSnapTime: function(snapIndex) {\n\t\treturn moment.duration(this.dateProfile.minTime + this.snapDuration * snapIndex);\n\t},\n\n\n\tgetHitEl: function(hit) {\n\t\treturn this.colEls.eq(hit.col);\n\t},\n\n\n\t/* Event Drag Visualization\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Renders a visual indication of an event being dragged over the specified date(s).\n\t// A returned value of `true` signals that a mock \"helper\" event has been rendered.\n\trenderDrag: function(eventFootprints, seg, isTouch) {\n\t\tvar i;\n\n\t\tif (seg) { // if there is event information for this drag, render a helper event\n\n\t\t\tif (eventFootprints.length) {\n\t\t\t\tthis.helperRenderer.renderEventDraggingFootprints(eventFootprints, seg, isTouch);\n\n\t\t\t\t// signal that a helper has been rendered\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\telse { // otherwise, just render a highlight\n\n\t\t\tfor (i = 0; i < eventFootprints.length; i++) {\n\t\t\t\tthis.renderHighlight(eventFootprints[i].componentFootprint);\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// Unrenders any visual indication of an event being dragged\n\tunrenderDrag: function(seg) {\n\t\tthis.unrenderHighlight();\n\t\tthis.helperRenderer.unrender();\n\t},\n\n\n\t/* Event Resize Visualization\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Renders a visual indication of an event being resized\n\trenderEventResize: function(eventFootprints, seg, isTouch) {\n\t\tthis.helperRenderer.renderEventResizingFootprints(eventFootprints, seg, isTouch);\n\t},\n\n\n\t// Unrenders any visual indication of an event being resized\n\tunrenderEventResize: function(seg) {\n\t\tthis.helperRenderer.unrender();\n\t},\n\n\n\t/* Selection\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Renders a visual indication of a selection. Overrides the default, which was to simply render a highlight.\n\trenderSelectionFootprint: function(componentFootprint) {\n\t\tif (this.opt('selectHelper')) { // this setting signals that a mock helper event should be rendered\n\t\t\tthis.helperRenderer.renderComponentFootprint(componentFootprint);\n\t\t}\n\t\telse {\n\t\t\tthis.renderHighlight(componentFootprint);\n\t\t}\n\t},\n\n\n\t// Unrenders any visual indication of a selection\n\tunrenderSelection: function() {\n\t\tthis.helperRenderer.unrender();\n\t\tthis.unrenderHighlight();\n\t}\n\n});\n\n;;\n\n/* An abstract class for all agenda-related views. Displays one more columns with time slots running vertically.\n----------------------------------------------------------------------------------------------------------------------*/\n// Is a manager for the TimeGrid subcomponent and possibly the DayGrid subcomponent (if allDaySlot is on).\n// Responsible for managing width/height.\n\nvar AgendaView = FC.AgendaView = View.extend({\n\n\tscroller: null,\n\n\ttimeGridClass: TimeGrid, // class used to instantiate the timeGrid. subclasses can override\n\ttimeGrid: null, // the main time-grid subcomponent of this view\n\n\tdayGridClass: DayGrid, // class used to instantiate the dayGrid. subclasses can override\n\tdayGrid: null, // the \"all-day\" subcomponent. if all-day is turned off, this will be null\n\n\taxisWidth: null, // the width of the time axis running down the side\n\n\t// indicates that minTime/maxTime affects rendering\n\tusesMinMaxTime: true,\n\n\n\tconstructor: function() {\n\t\tView.apply(this, arguments);\n\n\t\tthis.timeGrid = this.instantiateTimeGrid();\n\t\tthis.addChild(this.timeGrid);\n\n\t\tif (this.opt('allDaySlot')) { // should we display the \"all-day\" area?\n\t\t\tthis.dayGrid = this.instantiateDayGrid(); // the all-day subcomponent of this view\n\t\t\tthis.addChild(this.dayGrid);\n\t\t}\n\n\t\tthis.scroller = new Scroller({\n\t\t\toverflowX: 'hidden',\n\t\t\toverflowY: 'auto'\n\t\t});\n\t},\n\n\n\t// Instantiates the TimeGrid object this view needs. Draws from this.timeGridClass\n\tinstantiateTimeGrid: function() {\n\t\tvar subclass = this.timeGridClass.extend(agendaTimeGridMethods);\n\n\t\treturn new subclass(this);\n\t},\n\n\n\t// Instantiates the DayGrid object this view might need. Draws from this.dayGridClass\n\tinstantiateDayGrid: function() {\n\t\tvar subclass = this.dayGridClass.extend(agendaDayGridMethods);\n\n\t\treturn new subclass(this);\n\t},\n\n\n\t/* Rendering\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\trenderSkeleton: function() {\n\t\tvar timeGridWrapEl;\n\t\tvar timeGridEl;\n\n\t\tthis.el.addClass('fc-agenda-view').html(this.renderSkeletonHtml());\n\n\t\tthis.scroller.render();\n\n\t\ttimeGridWrapEl = this.scroller.el.addClass('fc-time-grid-container');\n\t\ttimeGridEl = $('<div class=\"fc-time-grid\" />').appendTo(timeGridWrapEl);\n\n\t\tthis.el.find('.fc-body > tr > td').append(timeGridWrapEl);\n\n\t\tthis.timeGrid.headContainerEl = this.el.find('.fc-head-container');\n\t\tthis.timeGrid.setElement(timeGridEl);\n\n\t\tif (this.dayGrid) {\n\t\t\tthis.dayGrid.setElement(this.el.find('.fc-day-grid'));\n\n\t\t\t// have the day-grid extend it's coordinate area over the <hr> dividing the two grids\n\t\t\tthis.dayGrid.bottomCoordPadding = this.dayGrid.el.next('hr').outerHeight();\n\t\t}\n\t},\n\n\n\tunrenderSkeleton: function() {\n\t\tthis.timeGrid.removeElement();\n\n\t\tif (this.dayGrid) {\n\t\t\tthis.dayGrid.removeElement();\n\t\t}\n\n\t\tthis.scroller.destroy();\n\t},\n\n\n\t// Builds the HTML skeleton for the view.\n\t// The day-grid and time-grid components will render inside containers defined by this HTML.\n\trenderSkeletonHtml: function() {\n\t\tvar theme = this.calendar.theme;\n\n\t\treturn '' +\n\t\t\t'<table class=\"' + theme.getClass('tableGrid') + '\">' +\n\t\t\t\t(this.opt('columnHeader') ?\n\t\t\t\t\t'<thead class=\"fc-head\">' +\n\t\t\t\t\t\t'<tr>' +\n\t\t\t\t\t\t\t'<td class=\"fc-head-container ' + theme.getClass('widgetHeader') + '\">&nbsp;</td>' +\n\t\t\t\t\t\t'</tr>' +\n\t\t\t\t\t'</thead>' :\n\t\t\t\t\t''\n\t\t\t\t\t) +\n\t\t\t\t'<tbody class=\"fc-body\">' +\n\t\t\t\t\t'<tr>' +\n\t\t\t\t\t\t'<td class=\"' + theme.getClass('widgetContent') + '\">' +\n\t\t\t\t\t\t\t(this.dayGrid ?\n\t\t\t\t\t\t\t\t'<div class=\"fc-day-grid\"/>' +\n\t\t\t\t\t\t\t\t'<hr class=\"fc-divider ' + theme.getClass('widgetHeader') + '\"/>' :\n\t\t\t\t\t\t\t\t''\n\t\t\t\t\t\t\t\t) +\n\t\t\t\t\t\t'</td>' +\n\t\t\t\t\t'</tr>' +\n\t\t\t\t'</tbody>' +\n\t\t\t'</table>';\n\t},\n\n\n\t// Generates an HTML attribute string for setting the width of the axis, if it is known\n\taxisStyleAttr: function() {\n\t\tif (this.axisWidth !== null) {\n\t\t\t return 'style=\"width:' + this.axisWidth + 'px\"';\n\t\t}\n\t\treturn '';\n\t},\n\n\n\t/* Now Indicator\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\tgetNowIndicatorUnit: function() {\n\t\treturn this.timeGrid.getNowIndicatorUnit();\n\t},\n\n\n\t/* Dimensions\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Adjusts the vertical dimensions of the view to the specified values\n\tupdateSize: function(totalHeight, isAuto, isResize) {\n\t\tvar eventLimit;\n\t\tvar scrollerHeight;\n\t\tvar scrollbarWidths;\n\n\t\tView.prototype.updateSize.apply(this, arguments);\n\n\t\t// make all axis cells line up, and record the width so newly created axis cells will have it\n\t\tthis.axisWidth = matchCellWidths(this.el.find('.fc-axis'));\n\n\t\t// hack to give the view some height prior to timeGrid's columns being rendered\n\t\t// TODO: separate setting height from scroller VS timeGrid.\n\t\tif (!this.timeGrid.colEls) {\n\t\t\tif (!isAuto) {\n\t\t\t\tscrollerHeight = this.computeScrollerHeight(totalHeight);\n\t\t\t\tthis.scroller.setHeight(scrollerHeight);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// set of fake row elements that must compensate when scroller has scrollbars\n\t\tvar noScrollRowEls = this.el.find('.fc-row:not(.fc-scroller *)');\n\n\t\t// reset all dimensions back to the original state\n\t\tthis.timeGrid.bottomRuleEl.hide(); // .show() will be called later if this <hr> is necessary\n\t\tthis.scroller.clear(); // sets height to 'auto' and clears overflow\n\t\tuncompensateScroll(noScrollRowEls);\n\n\t\t// limit number of events in the all-day area\n\t\tif (this.dayGrid) {\n\t\t\tthis.dayGrid.removeSegPopover(); // kill the \"more\" popover if displayed\n\n\t\t\teventLimit = this.opt('eventLimit');\n\t\t\tif (eventLimit && typeof eventLimit !== 'number') {\n\t\t\t\teventLimit = AGENDA_ALL_DAY_EVENT_LIMIT; // make sure \"auto\" goes to a real number\n\t\t\t}\n\t\t\tif (eventLimit) {\n\t\t\t\tthis.dayGrid.limitRows(eventLimit);\n\t\t\t}\n\t\t}\n\n\t\tif (!isAuto) { // should we force dimensions of the scroll container?\n\n\t\t\tscrollerHeight = this.computeScrollerHeight(totalHeight);\n\t\t\tthis.scroller.setHeight(scrollerHeight);\n\t\t\tscrollbarWidths = this.scroller.getScrollbarWidths();\n\n\t\t\tif (scrollbarWidths.left || scrollbarWidths.right) { // using scrollbars?\n\n\t\t\t\t// make the all-day and header rows lines up\n\t\t\t\tcompensateScroll(noScrollRowEls, scrollbarWidths);\n\n\t\t\t\t// the scrollbar compensation might have changed text flow, which might affect height, so recalculate\n\t\t\t\t// and reapply the desired height to the scroller.\n\t\t\t\tscrollerHeight = this.computeScrollerHeight(totalHeight);\n\t\t\t\tthis.scroller.setHeight(scrollerHeight);\n\t\t\t}\n\n\t\t\t// guarantees the same scrollbar widths\n\t\t\tthis.scroller.lockOverflow(scrollbarWidths);\n\n\t\t\t// if there's any space below the slats, show the horizontal rule.\n\t\t\t// this won't cause any new overflow, because lockOverflow already called.\n\t\t\tif (this.timeGrid.getTotalSlatHeight() < scrollerHeight) {\n\t\t\t\tthis.timeGrid.bottomRuleEl.show();\n\t\t\t}\n\t\t}\n\t},\n\n\n\t// given a desired total height of the view, returns what the height of the scroller should be\n\tcomputeScrollerHeight: function(totalHeight) {\n\t\treturn totalHeight -\n\t\t\tsubtractInnerElHeight(this.el, this.scroller.el); // everything that's NOT the scroller\n\t},\n\n\n\t/* Scroll\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Computes the initial pre-configured scroll state prior to allowing the user to change it\n\tcomputeInitialDateScroll: function() {\n\t\tvar scrollTime = moment.duration(this.opt('scrollTime'));\n\t\tvar top = this.timeGrid.computeTimeTop(scrollTime);\n\n\t\t// zoom can give weird floating-point values. rather scroll a little bit further\n\t\ttop = Math.ceil(top);\n\n\t\tif (top) {\n\t\t\ttop++; // to overcome top border that slots beyond the first have. looks better\n\t\t}\n\n\t\treturn { top: top };\n\t},\n\n\n\tqueryDateScroll: function() {\n\t\treturn { top: this.scroller.getScrollTop() };\n\t},\n\n\n\tapplyDateScroll: function(scroll) {\n\t\tif (scroll.top !== undefined) {\n\t\t\tthis.scroller.setScrollTop(scroll.top);\n\t\t}\n\t},\n\n\n\t/* Hit Areas\n\t------------------------------------------------------------------------------------------------------------------*/\n\t// forward all hit-related method calls to the grids (dayGrid might not be defined)\n\n\n\tgetHitFootprint: function(hit) {\n\t\t// TODO: hit.component is set as a hack to identify where the hit came from\n\t\treturn hit.component.getHitFootprint(hit);\n\t},\n\n\n\tgetHitEl: function(hit) {\n\t\t// TODO: hit.component is set as a hack to identify where the hit came from\n\t\treturn hit.component.getHitEl(hit);\n\t},\n\n\n\t/* Event Rendering\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\texecuteEventRender: function(eventsPayload) {\n\t\tvar dayEventsPayload = {};\n\t\tvar timedEventsPayload = {};\n\t\tvar id, eventInstanceGroup;\n\n\t\t// separate the events into all-day and timed\n\t\tfor (id in eventsPayload) {\n\t\t\teventInstanceGroup = eventsPayload[id];\n\n\t\t\tif (eventInstanceGroup.getEventDef().isAllDay()) {\n\t\t\t\tdayEventsPayload[id] = eventInstanceGroup;\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttimedEventsPayload[id] = eventInstanceGroup;\n\t\t\t}\n\t\t}\n\n\t\tthis.timeGrid.executeEventRender(timedEventsPayload);\n\n\t\tif (this.dayGrid) {\n\t\t\tthis.dayGrid.executeEventRender(dayEventsPayload);\n\t\t}\n\t},\n\n\n\t/* Dragging/Resizing Routing\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// A returned value of `true` signals that a mock \"helper\" event has been rendered.\n\trenderDrag: function(eventFootprints, seg, isTouch) {\n\t\tvar groups = groupEventFootprintsByAllDay(eventFootprints);\n\t\tvar renderedHelper = false;\n\n\t\trenderedHelper = this.timeGrid.renderDrag(groups.timed, seg, isTouch);\n\n\t\tif (this.dayGrid) {\n\t\t\trenderedHelper = this.dayGrid.renderDrag(groups.allDay, seg, isTouch) || renderedHelper;\n\t\t}\n\n\t\treturn renderedHelper;\n\t},\n\n\n\trenderEventResize: function(eventFootprints, seg, isTouch) {\n\t\tvar groups = groupEventFootprintsByAllDay(eventFootprints);\n\n\t\tthis.timeGrid.renderEventResize(groups.timed, seg, isTouch);\n\n\t\tif (this.dayGrid) {\n\t\t\tthis.dayGrid.renderEventResize(groups.allDay, seg, isTouch);\n\t\t}\n\t},\n\n\n\t/* Selection\n\t------------------------------------------------------------------------------------------------------------------*/\n\n\n\t// Renders a visual indication of a selection\n\trenderSelectionFootprint: function(componentFootprint) {\n\t\tif (!componentFootprint.isAllDay) {\n\t\t\tthis.timeGrid.renderSelectionFootprint(componentFootprint);\n\t\t}\n\t\telse if (this.dayGrid) {\n\t\t\tthis.dayGrid.renderSelectionFootprint(componentFootprint);\n\t\t}\n\t}\n\n});\n\n\n// Methods that will customize the rendering behavior of the AgendaView's timeGrid\n// TODO: move into TimeGrid\nvar agendaTimeGridMethods = {\n\n\n\t// Generates the HTML that will go before the day-of week header cells\n\trenderHeadIntroHtml: function() {\n\t\tvar view = this.view;\n\t\tvar calendar = view.calendar;\n\t\tvar weekStart = calendar.msToUtcMoment(this.dateProfile.renderUnzonedRange.startMs, true);\n\t\tvar weekText;\n\n\t\tif (this.opt('weekNumbers')) {\n\t\t\tweekText = weekStart.format(this.opt('smallWeekFormat'));\n\n\t\t\treturn '' +\n\t\t\t\t'<th class=\"fc-axis fc-week-number ' + calendar.theme.getClass('widgetHeader') + '\" ' + view.axisStyleAttr() + '>' +\n\t\t\t\t\tview.buildGotoAnchorHtml( // aside from link, important for matchCellWidths\n\t\t\t\t\t\t{ date: weekStart, type: 'week', forceOff: this.colCnt > 1 },\n\t\t\t\t\t\thtmlEscape(weekText) // inner HTML\n\t\t\t\t\t) +\n\t\t\t\t'</th>';\n\t\t}\n\t\telse {\n\t\t\treturn '<th class=\"fc-axis ' + calendar.theme.getClass('widgetHeader') + '\" ' + view.axisStyleAttr() + '></th>';\n\t\t}\n\t},\n\n\n\t// Generates the HTML that goes before the bg of the TimeGrid slot area. Long vertical column.\n\trenderBgIntroHtml: function() {\n\t\tvar view = this.view;\n\n\t\treturn '<td class=\"fc-axis ' + view.calendar.theme.getClass('widgetContent') + '\" ' + view.axisStyleAttr() + '></td>';\n\t},\n\n\n\t// Generates the HTML that goes before all other types of cells.\n\t// Affects content-skeleton, helper-skeleton, highlight-skeleton for both the time-grid and day-grid.\n\trenderIntroHtml: function() {\n\t\tvar view = this.view;\n\n\t\treturn '<td class=\"fc-axis\" ' + view.axisStyleAttr() + '></td>';\n\t}\n\n};\n\n\n// Methods that will customize the rendering behavior of the AgendaView's dayGrid\nvar agendaDayGridMethods = {\n\n\n\t// Generates the HTML that goes before the all-day cells\n\trenderBgIntroHtml: function() {\n\t\tvar view = this.view;\n\n\t\treturn '' +\n\t\t\t'<td class=\"fc-axis ' + view.calendar.theme.getClass('widgetContent') + '\" ' + view.axisStyleAttr() + '>' +\n\t\t\t\t'<span>' + // needed for matchCellWidths\n\t\t\t\t\tview.getAllDayHtml() +\n\t\t\t\t'</span>' +\n\t\t\t'</td>';\n\t},\n\n\n\t// Generates the HTML that goes before all other types of cells.\n\t// Affects content-skeleton, helper-skeleton, highlight-skeleton for both the time-grid and day-grid.\n\trenderIntroHtml: function() {\n\t\tvar view = this.view;\n\n\t\treturn '<td class=\"fc-axis\" ' + view.axisStyleAttr() + '></td>';\n\t}\n\n};\n\n\nfunction groupEventFootprintsByAllDay(eventFootprints) {\n\tvar allDay = [];\n\tvar timed = [];\n\tvar i;\n\n\tfor (i = 0; i < eventFootprints.length; i++) {\n\t\tif (eventFootprints[i].componentFootprint.isAllDay) {\n\t\t\tallDay.push(eventFootprints[i]);\n\t\t}\n\t\telse {\n\t\t\ttimed.push(eventFootprints[i]);\n\t\t}\n\t}\n\n\treturn { allDay: allDay, timed: timed };\n}\n\n;;\n\nvar AGENDA_ALL_DAY_EVENT_LIMIT = 5;\n\n// potential nice values for the slot-duration and interval-duration\n// from largest to smallest\nvar AGENDA_STOCK_SUB_DURATIONS = [\n\t{ hours: 1 },\n\t{ minutes: 30 },\n\t{ minutes: 15 },\n\t{ seconds: 30 },\n\t{ seconds: 15 }\n];\n\nfcViews.agenda = {\n\t'class': AgendaView,\n\tdefaults: {\n\t\tallDaySlot: true,\n\t\tslotDuration: '00:30:00',\n\t\tslotEventOverlap: true // a bad name. confused with overlap/constraint system\n\t}\n};\n\nfcViews.agendaDay = {\n\ttype: 'agenda',\n\tduration: { days: 1 }\n};\n\nfcViews.agendaWeek = {\n\ttype: 'agenda',\n\tduration: { weeks: 1 }\n};\n;;\n\n/*\nResponsible for the scroller, and forwarding event-related actions into the \"grid\".\n*/\nvar ListView = FC.ListView = View.extend({\n\n\tsegSelector: '.fc-list-item', // which elements accept event actions\n\t//eventRendererClass is below\n\t//eventPointingClass is below\n\n\tscroller: null,\n\tcontentEl: null,\n\n\tdayDates: null, // localized ambig-time moment array\n\tdayRanges: null, // UnzonedRange[], of start-end of each day\n\n\n\tconstructor: function() {\n\t\tView.apply(this, arguments);\n\n\t\tthis.scroller = new Scroller({\n\t\t\toverflowX: 'hidden',\n\t\t\toverflowY: 'auto'\n\t\t});\n\t},\n\n\n\trenderSkeleton: function() {\n\t\tthis.el.addClass(\n\t\t\t'fc-list-view ' +\n\t\t\tthis.calendar.theme.getClass('listView')\n\t\t);\n\n\t\tthis.scroller.render();\n\t\tthis.scroller.el.appendTo(this.el);\n\n\t\tthis.contentEl = this.scroller.scrollEl; // shortcut\n\t},\n\n\n\tunrenderSkeleton: function() {\n\t\tthis.scroller.destroy(); // will remove the Grid too\n\t},\n\n\n\tupdateSize: function(totalHeight, isAuto, isResize) {\n\t\tthis.scroller.setHeight(this.computeScrollerHeight(totalHeight));\n\t},\n\n\n\tcomputeScrollerHeight: function(totalHeight) {\n\t\treturn totalHeight -\n\t\t\tsubtractInnerElHeight(this.el, this.scroller.el); // everything that's NOT the scroller\n\t},\n\n\n\trenderDates: function(dateProfile) {\n\t\tvar calendar = this.calendar;\n\t\tvar dayStart = calendar.msToUtcMoment(dateProfile.renderUnzonedRange.startMs, true);\n\t\tvar viewEnd = calendar.msToUtcMoment(dateProfile.renderUnzonedRange.endMs, true);\n\t\tvar dayDates = [];\n\t\tvar dayRanges = [];\n\n\t\twhile (dayStart < viewEnd) {\n\n\t\t\tdayDates.push(dayStart.clone());\n\n\t\t\tdayRanges.push(new UnzonedRange(\n\t\t\t\tdayStart,\n\t\t\t\tdayStart.clone().add(1, 'day')\n\t\t\t));\n\n\t\t\tdayStart.add(1, 'day');\n\t\t}\n\n\t\tthis.dayDates = dayDates;\n\t\tthis.dayRanges = dayRanges;\n\n\t\t// all real rendering happens in EventRenderer\n\t},\n\n\n\t// slices by day\n\tcomponentFootprintToSegs: function(footprint) {\n\t\tvar dayRanges = this.dayRanges;\n\t\tvar dayIndex;\n\t\tvar segRange;\n\t\tvar seg;\n\t\tvar segs = [];\n\n\t\tfor (dayIndex = 0; dayIndex < dayRanges.length; dayIndex++) {\n\t\t\tsegRange = footprint.unzonedRange.intersect(dayRanges[dayIndex]);\n\n\t\t\tif (segRange) {\n\t\t\t\tseg = {\n\t\t\t\t\tstartMs: segRange.startMs,\n\t\t\t\t\tendMs: segRange.endMs,\n\t\t\t\t\tisStart: segRange.isStart,\n\t\t\t\t\tisEnd: segRange.isEnd,\n\t\t\t\t\tdayIndex: dayIndex\n\t\t\t\t};\n\n\t\t\t\tsegs.push(seg);\n\n\t\t\t\t// detect when footprint won't go fully into the next day,\n\t\t\t\t// and mutate the latest seg to the be the end.\n\t\t\t\tif (\n\t\t\t\t\t!seg.isEnd && !footprint.isAllDay &&\n\t\t\t\t\tdayIndex + 1 < dayRanges.length &&\n\t\t\t\t\tfootprint.unzonedRange.endMs < dayRanges[dayIndex + 1].startMs + this.nextDayThreshold\n\t\t\t\t) {\n\t\t\t\t\tseg.endMs = footprint.unzonedRange.endMs;\n\t\t\t\t\tseg.isEnd = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn segs;\n\t},\n\n\n\teventRendererClass: EventRenderer.extend({\n\n\n\t\trenderFgSegs: function(segs) {\n\t\t\tif (!segs.length) {\n\t\t\t\tthis.component.renderEmptyMessage();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.component.renderSegList(segs);\n\t\t\t}\n\t\t},\n\n\n\t\t// generates the HTML for a single event row\n\t\tfgSegHtml: function(seg) {\n\t\t\tvar view = this.view;\n\t\t\tvar calendar = view.calendar;\n\t\t\tvar theme = calendar.theme;\n\t\t\tvar eventFootprint = seg.footprint;\n\t\t\tvar eventDef = eventFootprint.eventDef;\n\t\t\tvar componentFootprint = eventFootprint.componentFootprint;\n\t\t\tvar url = eventDef.url;\n\t\t\tvar classes = [ 'fc-list-item' ].concat(this.getClasses(eventDef));\n\t\t\tvar bgColor = this.getBgColor(eventDef);\n\t\t\tvar timeHtml;\n\n\t\t\tif (componentFootprint.isAllDay) {\n\t\t\t\ttimeHtml = view.getAllDayHtml();\n\t\t\t}\n\t\t\t// if the event appears to span more than one day\n\t\t\telse if (view.isMultiDayRange(componentFootprint.unzonedRange)) {\n\t\t\t\tif (seg.isStart || seg.isEnd) { // outer segment that probably lasts part of the day\n\t\t\t\t\ttimeHtml = htmlEscape(this._getTimeText(\n\t\t\t\t\t\tcalendar.msToMoment(seg.startMs),\n\t\t\t\t\t\tcalendar.msToMoment(seg.endMs),\n\t\t\t\t\t\tcomponentFootprint.isAllDay\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t\telse { // inner segment that lasts the whole day\n\t\t\t\t\ttimeHtml = view.getAllDayHtml();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Display the normal time text for the *event's* times\n\t\t\t\ttimeHtml = htmlEscape(this.getTimeText(eventFootprint));\n\t\t\t}\n\n\t\t\tif (url) {\n\t\t\t\tclasses.push('fc-has-url');\n\t\t\t}\n\n\t\t\treturn '<tr class=\"' + classes.join(' ') + '\">' +\n\t\t\t\t(this.displayEventTime ?\n\t\t\t\t\t'<td class=\"fc-list-item-time ' + theme.getClass('widgetContent') + '\">' +\n\t\t\t\t\t\t(timeHtml || '') +\n\t\t\t\t\t'</td>' :\n\t\t\t\t\t'') +\n\t\t\t\t'<td class=\"fc-list-item-marker ' + theme.getClass('widgetContent') + '\">' +\n\t\t\t\t\t'<span class=\"fc-event-dot\"' +\n\t\t\t\t\t(bgColor ?\n\t\t\t\t\t\t' style=\"background-color:' + bgColor + '\"' :\n\t\t\t\t\t\t'') +\n\t\t\t\t\t'></span>' +\n\t\t\t\t'</td>' +\n\t\t\t\t'<td class=\"fc-list-item-title ' + theme.getClass('widgetContent') + '\">' +\n\t\t\t\t\t'<a' + (url ? ' href=\"' + htmlEscape(url) + '\"' : '') + '>' +\n\t\t\t\t\t\thtmlEscape(eventDef.title || '') +\n\t\t\t\t\t'</a>' +\n\t\t\t\t'</td>' +\n\t\t\t'</tr>';\n\t\t},\n\n\n\t\t// like \"4:00am\"\n\t\tcomputeEventTimeFormat: function() {\n\t\t\treturn this.opt('mediumTimeFormat');\n\t\t}\n\n\t}),\n\n\n\teventPointingClass: EventPointing.extend({\n\n\t\t// for events with a url, the whole <tr> should be clickable,\n\t\t// but it's impossible to wrap with an <a> tag. simulate this.\n\t\thandleClick: function(seg, ev) {\n\t\t\tvar url;\n\n\t\t\tEventPointing.prototype.handleClick.apply(this, arguments); // super. might prevent the default action\n\n\t\t\t// not clicking on or within an <a> with an href\n\t\t\tif (!$(ev.target).closest('a[href]').length) {\n\t\t\t\turl = seg.footprint.eventDef.url;\n\n\t\t\t\tif (url && !ev.isDefaultPrevented()) { // jsEvent not cancelled in handler\n\t\t\t\t\twindow.location.href = url; // simulate link click\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}),\n\n\n\trenderEmptyMessage: function() {\n\t\tthis.contentEl.html(\n\t\t\t'<div class=\"fc-list-empty-wrap2\">' + // TODO: try less wraps\n\t\t\t'<div class=\"fc-list-empty-wrap1\">' +\n\t\t\t'<div class=\"fc-list-empty\">' +\n\t\t\t\thtmlEscape(this.opt('noEventsMessage')) +\n\t\t\t'</div>' +\n\t\t\t'</div>' +\n\t\t\t'</div>'\n\t\t);\n\t},\n\n\n\t// render the event segments in the view\n\trenderSegList: function(allSegs) {\n\t\tvar segsByDay = this.groupSegsByDay(allSegs); // sparse array\n\t\tvar dayIndex;\n\t\tvar daySegs;\n\t\tvar i;\n\t\tvar tableEl = $('<table class=\"fc-list-table ' + this.calendar.theme.getClass('tableList') + '\"><tbody/></table>');\n\t\tvar tbodyEl = tableEl.find('tbody');\n\n\t\tfor (dayIndex = 0; dayIndex < segsByDay.length; dayIndex++) {\n\t\t\tdaySegs = segsByDay[dayIndex];\n\n\t\t\tif (daySegs) { // sparse array, so might be undefined\n\n\t\t\t\t// append a day header\n\t\t\t\ttbodyEl.append(this.dayHeaderHtml(this.dayDates[dayIndex]));\n\n\t\t\t\tthis.eventRenderer.sortEventSegs(daySegs);\n\n\t\t\t\tfor (i = 0; i < daySegs.length; i++) {\n\t\t\t\t\ttbodyEl.append(daySegs[i].el); // append event row\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.contentEl.empty().append(tableEl);\n\t},\n\n\n\t// Returns a sparse array of arrays, segs grouped by their dayIndex\n\tgroupSegsByDay: function(segs) {\n\t\tvar segsByDay = []; // sparse array\n\t\tvar i, seg;\n\n\t\tfor (i = 0; i < segs.length; i++) {\n\t\t\tseg = segs[i];\n\t\t\t(segsByDay[seg.dayIndex] || (segsByDay[seg.dayIndex] = []))\n\t\t\t\t.push(seg);\n\t\t}\n\n\t\treturn segsByDay;\n\t},\n\n\n\t// generates the HTML for the day headers that live amongst the event rows\n\tdayHeaderHtml: function(dayDate) {\n\t\tvar mainFormat = this.opt('listDayFormat');\n\t\tvar altFormat = this.opt('listDayAltFormat');\n\n\t\treturn '<tr class=\"fc-list-heading\" data-date=\"' + dayDate.format('YYYY-MM-DD') + '\">' +\n\t\t\t'<td class=\"' + this.calendar.theme.getClass('widgetHeader') + '\" colspan=\"3\">' +\n\t\t\t\t(mainFormat ?\n\t\t\t\t\tthis.buildGotoAnchorHtml(\n\t\t\t\t\t\tdayDate,\n\t\t\t\t\t\t{ 'class': 'fc-list-heading-main' },\n\t\t\t\t\t\thtmlEscape(dayDate.format(mainFormat)) // inner HTML\n\t\t\t\t\t) :\n\t\t\t\t\t'') +\n\t\t\t\t(altFormat ?\n\t\t\t\t\tthis.buildGotoAnchorHtml(\n\t\t\t\t\t\tdayDate,\n\t\t\t\t\t\t{ 'class': 'fc-list-heading-alt' },\n\t\t\t\t\t\thtmlEscape(dayDate.format(altFormat)) // inner HTML\n\t\t\t\t\t) :\n\t\t\t\t\t'') +\n\t\t\t'</td>' +\n\t\t'</tr>';\n\t}\n\n});\n\n;;\n\nfcViews.list = {\n\t'class': ListView,\n\tbuttonTextKey: 'list', // what to lookup in locale files\n\tdefaults: {\n\t\tbuttonText: 'list', // text to display for English\n\t\tlistDayFormat: 'LL', // like \"January 1, 2016\"\n\t\tnoEventsMessage: 'No events to display'\n\t}\n};\n\nfcViews.listDay = {\n\ttype: 'list',\n\tduration: { days: 1 },\n\tdefaults: {\n\t\tlistDayFormat: 'dddd' // day-of-week is all we need. full date is probably in header\n\t}\n};\n\nfcViews.listWeek = {\n\ttype: 'list',\n\tduration: { weeks: 1 },\n\tdefaults: {\n\t\tlistDayFormat: 'dddd', // day-of-week is more important\n\t\tlistDayAltFormat: 'LL'\n\t}\n};\n\nfcViews.listMonth = {\n\ttype: 'list',\n\tduration: { month: 1 },\n\tdefaults: {\n\t\tlistDayAltFormat: 'dddd' // day-of-week is nice-to-have\n\t}\n};\n\nfcViews.listYear = {\n\ttype: 'list',\n\tduration: { year: 1 },\n\tdefaults: {\n\t\tlistDayAltFormat: 'dddd' // day-of-week is nice-to-have\n\t}\n};\n\n;;\n\r\nreturn FC; // export for Node/CommonJS\r\n});"]}