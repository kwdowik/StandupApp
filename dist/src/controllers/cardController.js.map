{"version":3,"sources":["../../../src/controllers/cardController.js"],"names":["Note","require","dbService","cardController","nav","getNotePage","req","res","params","cardNumber","redirect","query","find","numberOfCards","getNumberOfNotes","then","count","getUsers","users","sort","createdOn","skip","limit","exec","err","results","render","title","notes","currentCard","undefined","message","userName","user","username","filter","length","Promise","resolve","reject","console","log","memberName","getNoteByMember","body","where","module","exports"],"mappings":"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","file":"cardController.js","sourcesContent":["var Note = require('../models/noteModel');\nvar dbService = require('../services/dbService')();\n\nvar cardController = function (nav) {\n\n    var getNotePage = function (req, res) {\n        if(req.params.cardNumber <= 0) {\n            res.redirect('/');\n        }\n        var query = Note.find();\n        var numberOfCards = 1;\n        getNumberOfNotes().then(function (count) {\n            numberOfCards = count;\n        });\n        dbService.getUsers().then(function (users) {\n            query.sort({createdOn: 'desc'})\n                .skip((req.params.cardNumber - 1) * 5)\n                .limit(5)\n                .exec(function (err, results) {\n                    res.render('index',\n                        {\n                            title: 'Standup - List',\n                            notes: results,\n                            currentCard: req.params.cardNumber === undefined ? 1 : req.params.cardNumber,\n                            numberOfCards: numberOfCards,\n                            nav: nav,\n                            message: req.query.message,\n                            userName: req.user === undefined ? undefined : req.user.username,\n                            users: users\n                        });\n                });\n        });\n    };\n\n    var getNumberOfNotes = function (filter) {\n        var query = Note.find();\n        if(filter == null || filter.length === 0) {\n            return new Promise(\n                function (resolve, reject) {\n                    query.count({}, function (err, count) {\n                        console.log(`number of cards: ${count}`);\n                        resolve(count);\n                        reject(err);\n                    });\n                }\n            );\n        }else {\n            return new Promise(\n                function (resolve, reject) {\n                    query.count({memberName: filter}, function (err, count) {\n                        console.log(`number of cards: ${count}`);\n                        resolve(count);\n                        reject(err);\n                    });\n                }\n            );\n        }\n\n    };\n\n    var getNoteByMember = function (req, res) {\n        var query = Note.find();\n        var filter = req.body.memberName;\n        var numberOfCards = 1;\n        getNumberOfNotes(filter).then(function (count) {\n            numberOfCards = count;\n        });\n\n        query.sort({ createdOn: 'desc'});\n\n        if(filter.length > 0)\n        {\n            query.where({ memberName: filter })\n                .limit(5);\n        }else {\n            query.skip((req.params.cardNumber - 1 ) * 5)\n                .limit(5);\n        }\n\n        dbService.getUsers().then(function (users) {\n            query.exec(function (err, results) {\n                res.render('index',\n                    {\n                        title: \"Standup - List\",\n                        notes: results,\n                        nav: nav,\n                        currentCard: 1,\n                        numberOfCards: numberOfCards,\n                        userName: req.user === undefined ? undefined : req.user.username,\n                        users: users\n                    });\n            });\n        });\n    };\n\n    return {\n        getNotePage: getNotePage,\n        getNoteByMember: getNoteByMember,\n    };\n};\n\nmodule.exports = cardController;\n"]}